!function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=28)}([function(t,e,s){window,t.exports=function(t){var e={};function s(i){if(e[i])return e[i].exports;var n=e[i]={i:i,l:!1,exports:{}};return t[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}return s.m=t,s.c=e,s.d=function(t,e,i){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)s.d(i,n,function(e){return t[e]}.bind(null,n));return i},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=33)}([function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);class n extends i.Vec2{constructor(t,e,s,i){super(t,e),this.width=s,this.height=i}get x1(){return this.x}get y1(){return this.y}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get left(){return this.x}get top(){return this.y}clone(){return new n(this.x,this.y,this.width,this.height)}getCenter(){return new i.Vec2(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.x<=this.x2&&t.y>=this.y&&t.y<=this.y2}}e.Rect=n},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Vec2=class{constructor(t,e){this.x=t,this.y=e}add(t){this.x+=t.x,this.y+=t.y}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class i{}i.VK_CANCEL=3,i.VK_HELP=6,i.VK_BACK_SPACE=8,i.VK_TAB=9,i.VK_CLEAR=12,i.VK_ENTER=13,i.VK_SHIFT=16,i.VK_CONTROL=17,i.VK_ALT=18,i.VK_PAUSE=19,i.VK_CAPS_LOCK=20,i.VK_ESCAPE=27,i.VK_SPACE=32,i.VK_PAGE_UP=33,i.VK_PAGE_DOWN=34,i.VK_END=35,i.VK_HOME=36,i.VK_LEFT=37,i.VK_UP=38,i.VK_RIGHT=39,i.VK_DOWN=40,i.VK_PRINTSCREEN=44,i.VK_INSERT=45,i.VK_DELETE=46,i.VK_0=48,i.VK_1=49,i.VK_2=50,i.VK_3=51,i.VK_4=52,i.VK_5=53,i.VK_6=54,i.VK_7=55,i.VK_8=56,i.VK_9=57,i.VK_COLON=58,i.VK_SEMICOLON=59,i.VK_LESS_THAN=60,i.VK_EQUALS=61,i.VK_GREATER_THAN=62,i.VK_QUESTION_MARK=63,i.VK_AT=64,i.VK_A=65,i.VK_B=66,i.VK_C=67,i.VK_D=68,i.VK_E=69,i.VK_F=70,i.VK_G=71,i.VK_H=72,i.VK_I=73,i.VK_J=74,i.VK_K=75,i.VK_L=76,i.VK_M=77,i.VK_N=78,i.VK_O=79,i.VK_P=80,i.VK_Q=81,i.VK_R=82,i.VK_S=83,i.VK_T=84,i.VK_U=85,i.VK_V=86,i.VK_W=87,i.VK_X=88,i.VK_Y=89,i.VK_Z=90,i.VK_CONTEXT_MENU=93,i.VK_NUMPAD0=96,i.VK_NUMPAD1=97,i.VK_NUMPAD2=98,i.VK_NUMPAD3=99,i.VK_NUMPAD4=100,i.VK_NUMPAD5=101,i.VK_NUMPAD6=102,i.VK_NUMPAD7=103,i.VK_NUMPAD8=104,i.VK_NUMPAD9=105,i.VK_MULTIPLY=106,i.VK_ADD=107,i.VK_SEPARATOR=108,i.VK_SUBTRACT=109,i.VK_DECIMAL=110,i.VK_DIVIDE=111,i.VK_F1=112,i.VK_F2=113,i.VK_F3=114,i.VK_F4=115,i.VK_F5=116,i.VK_F6=117,i.VK_F7=118,i.VK_F8=119,i.VK_F9=120,i.VK_F10=121,i.VK_F11=122,i.VK_F12=123,i.VK_F13=124,i.VK_F14=125,i.VK_F15=126,i.VK_F16=127,i.VK_F17=128,i.VK_F18=129,i.VK_F19=130,i.VK_F20=131,i.VK_F21=132,i.VK_F22=133,i.VK_F23=134,i.VK_F24=135,i.VK_NUM_LOCK=144,i.VK_SCROLL_LOCK=145,i.VK_CIRCUMFLEX=160,i.VK_EXCLAMATION=161,i.VK_DOUBLE_QUOTE=162,i.VK_HASH=163,i.VK_DOLLAR=164,i.VK_PERCENT=165,i.VK_AMPERSAND=166,i.VK_UNDERSCORE=167,i.VK_OPEN_PAREN=168,i.VK_CLOSE_PAREN=169,i.VK_ASTERISK=170,i.VK_PLUS=171,i.VK_PIPE=172,i.VK_HYPHEN_MINUS=173,i.VK_OPEN_CURLY_BRACKET=174,i.VK_CLOSE_CURLY_BRACKET=175,i.VK_TILDE=176,i.VK_COMMA=188,i.VK_PERIOD=190,i.VK_SLASH=191,i.VK_BACK_QUOTE=192,i.VK_OPEN_BRACKET=219,i.VK_BACK_SLASH=220,i.VK_CLOSE_BRACKET=221,i.VK_QUOTE=222,i.VK_META=224,i.VK_ALTGR=225,i.VK_WIN=91,i.VK_KANA=21,i.VK_HANGUL=21,i.VK_EISU=22,i.VK_JUNJA=23,i.VK_FINAL=24,i.VK_HANJA=25,i.VK_KANJI=25,i.VK_CONVERT=28,i.VK_NONCONVERT=29,i.VK_ACCEPT=30,i.VK_MODECHANGE=31,i.VK_SELECT=41,i.VK_PRINT=42,i.VK_EXECUTE=43,i.VK_SLEEP=95,e.Keys=i},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(7);e.Panel=class{constructor(t){this.gui=null,this.rect=t,this.children=new i.ArrayList,this.modal=!1,this.visible=!0}setGui(t){if(!this.gui){this.gui=t;for(let e=0;e<this.children.length;e++)this.children.get(e).setGui(t)}}add(t){t.parent=this,t.setGui(this.gui),this.children.add(t)}remove(t){this.children.remove(t)}move(t){this.parent&&this.parent.remove(this),t.add(this)}getPanelAt(t){for(let e=this.children.length-1;e>=0;e--){const s=this.children.get(e);if(!s.visible)continue;if(s.isDragging())continue;const i=s.getPanelAt(t);if(i)return i}if(this.rect.contains(t))return this}drawContents(){this.drawChildren()}drawChildren(){for(let t=0;t<this.children.length;t++){const e=this.children.get(t);e.visible&&e.drawContents()}}handleInput(){return this.handleChildrenInput()}handleChildrenInput(){for(let t=this.children.length-1;t>=0;t--){const e=this.children.get(t);if(e.visible&&(e.handleInput()||e.modal))return!0}return!1}isDragging(){return this.gui&&this.gui.dragElement===this}onDrop(t){return!1}updateTooltip(t){t.visible=!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(34);e.Animation=class{constructor(t,e){this.promise=new i.AnimationPromise,this.countdown=t,this.blocking=e}isDone(){return this.countdown<=0}update(){this.countdown--}draw(t){}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(9);class n{}n.BLACK=i.fromRgb(0,0,0),n.WHITE=i.fromRgb(255,255,255),n.GRAY=i.fromRgb(128,128,128),n.LIGHT_GRAY=i.fromRgb(170,170,170),n.DARK_GRAY=i.fromRgb(85,85,85),n.YELLOW=i.fromRgb(255,255,85),n.BROWN=i.fromRgb(170,85,0),n.RED=i.fromRgb(255,0,0),n.LIGHT_RED=i.fromRgb(255,85,85),n.DARK_RED=i.fromRgb(170,0,0),n.GREEN=i.fromRgb(0,255,0),n.LIGHT_GREEN=i.fromRgb(85,255,85),n.DARK_GREEN=i.fromRgb(0,170,0),n.LIGHT_CYAN=i.fromRgb(85,255,255),n.DARK_CYAN=i.fromRgb(0,170,170),n.BLUE=i.fromRgb(0,0,255),n.LIGHT_BLUE=i.fromRgb(85,85,255),n.DARK_BLUE=i.fromRgb(0,0,170),n.LIGHT_MAGENTA=i.fromRgb(255,85,255),n.DARK_MAGENTA=i.fromRgb(170,0,170),n.ORANGE=i.fromRgb(255,136,0),e.Colors=n},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),n=s(3);e.Dialog=class extends n.Panel{constructor(t){super(t),this.closeButton=!1}drawContents(){this.gui&&this.gui.renderer.draw(this.gui.app,this)}handleInput(){if(!this.gui)return!1;if(this.handleChildrenInput())return!0;if(this.gui.app.isKeyPressed(i.Keys.VK_ESCAPE))return this.visible=!1,!0;const t=this.gui.app.mouse;return!(!t.isClicked()||this.rect.contains(t)||(this.visible=!1,0))}close(){this.gui&&this.gui.remove(this)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ArrayList=class{constructor(){this.elements=[]}get length(){return this.elements.length}clear(){this.elements.splice(0,this.elements.length)}get(t){return this.elements[t]}add(t){if(this.elements.push(t),this.listeners)for(let e=0;e<this.listeners.length;e++)this.listeners[e].onAdd(this,t)}remove(t){const e=this.elements.indexOf(t);if(e>=0&&(this.elements.splice(e,1),this.listeners))for(let e=0;e<this.listeners.length;e++)this.listeners[e].onRemove(this,t)}contains(t){return this.elements.indexOf(t)>=0}addListener(t){this.listeners||(this.listeners=[]),this.listeners.push(t)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(5),n=s(11);e.TalentButton=class extends n.Button{constructor(t,e,s){super(t,e.ability.sprite),this.talent=e,this.shortcut=!!s,this.tooltipMessages=e.ability.tooltipMessages}click(){this.talent.use()}drawContents(){if(super.drawContents(),this.talent.cooldown>0){const t=this.talent.actor.game,e=t.cooldownSprite;if(e){const s=1-this.talent.cooldown/this.talent.ability.cooldown,n=Math.round(s*e.frames),o=e.x+n*e.width,r=e.y,a=this.rect.x+(this.rect.width-e.width)/2|0,h=this.rect.y+(this.rect.height-e.height)/2|0;t.app.drawImage(a,h,o,r,e.width,e.height);const l=this.rect.x+this.rect.width/2|0,c=this.rect.y+this.rect.height/2|0;t.app.drawCenteredString(this.talent.cooldown.toString(),l+1,c-2,i.Colors.BLACK),t.app.drawCenteredString(this.talent.cooldown.toString(),l,c-3,i.Colors.WHITE)}}}}},function(t,e,s){"use strict";function i(t,e,s,i){return void 0===i&&(i=255),(t<<24)+(e<<16)+(s<<8)+i}Object.defineProperty(e,"__esModule",{value:!0}),e.fromRgb=i,e.fromHsv=function(t,e,s,n){const o=6*t|0,r=6*t-o,a=s*(1-e),h=s*(1-r*e),l=s*(1-(1-r)*e);let c,d,u;switch(o%6){case 0:c=s,d=l,u=a;break;case 1:c=h,d=s,u=a;break;case 2:c=a,d=s,u=l;break;case 3:c=a,d=h,u=s;break;case 4:c=l,d=a,u=s;break;case 5:c=s,d=a,u=h;break;default:c=0,d=0,u=0}return void 0===n&&(n=1),i(255*c|0,255*d|0,255*u|0,255*n|0)}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(11);e.ItemShortcutButton=class extends i.Button{constructor(t,e,s){super(t,s.sprite),this.containerItems=e,this.shortcutItem=s,this.tooltipMessages=s.tooltipMessages}click(){const t=this.getItem();if(t){const e=t.game.player;e&&e.use(t)}}drawContents(){if(this.gui&&(super.drawContents(),!this.isDragging())){const t=this.rect,e=this.countItems();this.gui.app.drawRightString(e.toString(),t.x2-3,t.y2-10)}}getItem(){for(let t=0;t<this.containerItems.length;t++){const e=this.containerItems.get(t);if(e.name===this.shortcutItem.name)return e}}countItems(){let t=0;for(let e=0;e<this.containerItems.length;e++)this.containerItems.get(e).name===this.shortcutItem.name&&t++;return t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3);e.Button=class extends i.Panel{constructor(t,e,s,i){super(t),this.sprite=e,this.shortcutKey=s,this.onClick=i}drawContents(){if(!this.gui)return;const t=this.sprite,e=this.rect,s=(e.width-t.width)/2|0,i=(e.height-t.height)/2|0;t.draw(this.gui.app,e.x+s,e.y+i)}handleInput(){if(!this.gui)return!1;const t=this.gui.app,e=t.mouse;return this.rect.contains(e.start)&&e.isDragging()?(this.gui.startDragging(this),!0):this.shortcutKey&&t.isKeyPressed(this.shortcutKey)||this.rect.contains(e)&&e.isClicked()?(this.click(),!0):e.down&&this.rect.contains(e)}click(){this.onClick&&this.onClick()}updateTooltip(t){this.tooltipMessages?(t.messages=this.tooltipMessages,t.visible=!0):t.visible=!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3);e.ButtonSlot=class extends i.Panel{constructor(t,e){super(t),this.shortcutKey=e}get button(){return this.children.length>0?this.children.get(0):void 0}drawContents(){if(!this.gui)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect;e&&this.gui.app.drawImage(t.x,t.y,e.x,e.y,t.width,t.height);const s=this.button;s&&!s.isDragging()&&(s.rect.x=this.rect.x,s.rect.y=this.rect.y,s.rect.width=this.rect.width,s.rect.height=this.rect.height,this.drawChildren()),this.shortcutKey&&this.gui.app.drawRightString(String.fromCharCode(this.shortcutKey),t.x2-3,t.y+3)}handleInput(){if(!this.gui)return!1;if(this.handleChildrenInput())return!0;const t=this.gui.app,e=t.mouse,s=this.button;return s&&(this.shortcutKey&&t.isKeyPressed(this.shortcutKey)||this.rect.contains(e)&&e.isClicked())?(s.click(),!0):e.down&&this.rect.contains(e)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(7),n=s(11);e.ItemButton=class extends n.Button{constructor(t,e,s){super(t,s.sprite),this.containerItems=e,this.stackItems=new i.ArrayList,this.stackItems.add(s),this.tooltipMessages=s.tooltipMessages}click(){if(this.stackItems.length>0){const t=this.stackItems.get(0),e=t.game.player;e&&e.use(t)}}drawContents(){if(this.gui&&(super.drawContents(),this.stackItems.length>1)){const t=this.rect;this.gui.app.drawRightString(this.stackItems.length.toString(),t.x2-3,t.y2-10)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.SELF=0]="SELF",t[t.ENTITY=1]="ENTITY",t[t.TILE=2]="TILE"}(e.TargetType||(e.TargetType={}))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);e.Entity=class extends i.Vec2{constructor(t,e,s,n,o,r){super(e,s),this.game=t,this.offset=new i.Vec2(0,0),this.name=n,this.sprite=o,this.blocks=r,this.zIndex=1}get pixelX(){return this.x*this.game.tileSize.width+this.offset.x}get pixelY(){return this.y*this.game.tileSize.height+this.offset.y}get centerPixelX(){return this.pixelX+this.sprite.width/2|0}get centerPixelY(){return this.pixelY+this.sprite.height/2|0}distanceTo(t){return Math.hypot(t.x-this.x,t.y-this.y)}distance(t,e){return Math.hypot(t-this.x,e-this.y)}draw(){this.sprite.draw(this.game.app,this.pixelX-this.game.viewport.x,this.pixelY-this.game.viewport.y)}startTurn(){}endTurn(){}sendToBack(){}onBump(t){}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AI=class{constructor(t){this.actor=t,this.alwaysActive=!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Input=class{constructor(){this.down=!1,this.downCount=0,this.upCount=0}update(){this.down?(this.downCount++,this.upCount=0):(this.downCount=0,this.upCount++)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(14),n=s(19),o=s(20),r=s(21),a=s(7),h=s(5),l=s(15);e.Actor=class extends l.Entity{constructor(t,e,s,i,n,o){super(t,e,s,i,n,o),this.hp=100,this.maxHp=100,this.ap=1,this.maxAp=1,this.inventory=new a.ArrayList,this.talents=new a.ArrayList,this.visibleDuration=-1,this.seen=!1}startTurn(){this.ap=this.maxAp;for(let t=0;t<this.talents.length;t++){const e=this.talents.get(t);e.cooldown>0&&e.cooldown--}}move(t,e,s){const i=this.x+t,n=this.y+e;if(this.blocks){if(this.game.isBlocked(i,n))return!1}else if(this.game.tileMap&&this.game.tileMap.isBlocked(i,n))return!1;this.x=i,this.y=n,this.ap--,this.offset.x=-t*this.game.tileSize.width,this.offset.y=-e*this.game.tileSize.height;const o=s||4,a=this.game.tileSize.width/o,h=this.game.tileSize.height/o;return this.game.animations.push(new r.SlideAnimation(this,t*a,e*h,o)),this.game.blocked=!0,!0}moveTo(t,e,s){return this.move(t-this.x,e-this.y,s)}moveToward(t,e,s){const i=t-this.x,n=e-this.y;if(i<0&&n<0&&this.move(-1,-1,s))return!0;if(i<0&&n>0&&this.move(-1,1,s))return!0;if(i>0&&n<0&&this.move(1,-1,s))return!0;if(i>0&&n>0&&this.move(1,1,s))return!0;if(Math.abs(i)>Math.abs(n)){if(i<0&&this.move(-1,0,s))return!0;if(i>0&&this.move(1,0,s))return!0;if(n<0&&this.move(0,-1,s))return!0;if(n>0&&this.move(0,1,s))return!0}else{if(n<0&&this.move(0,-1,s))return!0;if(n>0&&this.move(0,1,s))return!0;if(i<0&&this.move(-1,0,s))return!0;if(i>0&&this.move(1,0,s))return!0}return!1}attack(t,e){t!==this&&(this.onAttack(t,e),t.takeDamage(e),this.ap--,this.game.animations.push(new n.BumpAnimation(this,t)),this.game.blocked=!0)}takeHeal(t){this.hp=Math.min(this.hp+t,this.maxHp),this.addFloatingText(t.toString(),h.Colors.LIGHT_GREEN)}takeDamage(t){this.hp<=0||(this.hp-=t,this.addFloatingText(t.toString(),h.Colors.RED),this.hp<=0&&(this.hp=0,this.onDeath&&this.onDeath(),this.game.entities.remove(this)))}pickup(t){t.onPickup(this),this.inventory.add(t),this.game.entities.remove(t)}use(t){return t.onUse(this)}cast(t,e,s){t.targetType===i.TargetType.SELF||e?t.cast(this,e)&&s&&s():this.game.startTargeting(t,s)}addFloatingText(t,e){this.game.animations.push(new o.FloatingTextAnimation(this,t,e))}onAttack(t,e){}onDeath(){}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(4);e.BumpAnimation=class extends i.Animation{constructor(t,e){super(12,!0),this.entity=t,this.dx=e.x-t.x,this.dy=e.y-t.y}update(){const t=12-this.countdown;t>=0&&t<4&&(this.entity.offset.x+=this.dx,this.entity.offset.y+=this.dy),t>=4&&t<8&&(this.entity.offset.x-=this.dx,this.entity.offset.y-=this.dy),super.update()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(5),n=s(4);e.FloatingTextAnimation=class extends n.Animation{constructor(t,e,s){super(40,!1),this.actor=t,this.str=e,this.color=s||i.Colors.WHITE}draw(t){const e=40-this.countdown,s=this.actor.pixelX+(this.actor.sprite.width/2|0)-t.viewport.x,i=this.actor.pixelY-3-t.viewport.y-Math.min(4,Math.floor(e/2));t.app.drawCenteredString(this.str,s,i,this.color)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(4);e.SlideAnimation=class extends i.Animation{constructor(t,e,s,i){super(i,!0),this.entity=t,this.dx=e,this.dy=s}update(){this.countdown--,this.countdown>=0&&(this.entity.offset.x+=this.dx,this.entity.offset.y+=this.dy),0===this.countdown&&(this.entity.offset.x=0,this.entity.offset.y=0)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(17),n=256;e.Keyboard=class{constructor(t){this.keys=new Array(n);for(let t=0;t<n;t++)this.keys[t]=new i.Input;t.addEventListener("keydown",t=>this.setKey(t,!0)),t.addEventListener("keyup",t=>this.setKey(t,!1))}setKey(t,e){t.stopPropagation(),t.preventDefault();const s=t.keyCode;s>=0&&s<n&&(this.keys[s].down=e)}update(){for(let t=0;t<n;t++)this.keys[t].down?this.keys[t].downCount++:this.keys[t].downCount=0}getKey(t){return t>=0&&t<n?this.keys[t]:null}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(17),n=s(0),o=s(1);e.Mouse=class extends i.Input{constructor(t){super(),this.app=t,this.prev=new o.Vec2(0,0),this.start=new o.Vec2(0,0),this.x=0,this.y=0,this.dx=0,this.dy=0,this.dragDistance=0,this.longPress=!1;const e=t.canvas,s=this.handleEvent.bind(this);e.addEventListener("mousedown",s),e.addEventListener("mouseup",s),e.addEventListener("mousemove",s),e.addEventListener("contextmenu",s);const i=this.handleTouchEvent.bind(this);e.addEventListener("touchstart",i),e.addEventListener("touchend",i),e.addEventListener("touchcancel",i),e.addEventListener("touchmove",i)}handleTouchEvent(t){if(t.stopPropagation(),t.preventDefault(),t.touches.length>0){const e=t.touches[0];this.updatePosition(e.clientX,e.clientY)}"touchstart"===t.type&&(this.down=!0,this.prev.x=this.x,this.prev.y=this.y,this.start.x=this.x,this.start.y=this.y,this.dx=0,this.dy=0,this.dragDistance=0),"touchend"===t.type&&(this.down=!1,this.longPress=this.downCount>=30)}handleEvent(t){t.stopPropagation(),t.preventDefault(),this.updatePosition(t.clientX,t.clientY),"mousedown"===t.type&&(this.down=!0,this.start.x=this.x,this.start.y=this.y,this.dragDistance=0,this.app.canvas.focus()),"mouseup"===t.type&&(this.down=!1,this.longPress=this.downCount>=30)}updatePosition(t,e){let s=this.app.canvas.getBoundingClientRect();const i=this.app.size.width/this.app.size.height,o=s.width/s.height;if(o-i>.01){const t=i*s.height,e=s.width-t;s=new n.Rect(Math.floor(e/2),0,t,s.height)}if(o-i<-.01){const t=s.width/i,e=s.height-t;s=new n.Rect(0,Math.floor(e/2),s.width,t)}this.x=this.app.size.width*(t-s.left)/s.width|0,this.y=this.app.size.height*(e-s.top)/s.height|0}update(){super.update(),this.dx=this.x-this.prev.x,this.dy=this.y-this.prev.y,this.prev.x=this.x,this.prev.y=this.y,this.down&&(this.dragDistance+=Math.abs(this.dx)+Math.abs(this.dy))}isClicked(){return 1===this.upCount&&this.dragDistance<4&&!this.longPress}isDragging(){return this.down&&this.dragDistance>4}isLongPress(){return 30===this.downCount&&!this.isDragging()}}},function(t,e,s){"use strict";function i(t,e,s){const i=t.createShader(e);return t.shaderSource(i,s),t.compileShader(i),i}Object.defineProperty(e,"__esModule",{value:!0}),e.ExtendedTexture=class extends WebGLTexture{constructor(){super(),this.loaded=!1,this.width=0,this.height=0}},e.initShaderProgram=function(t,e,s){const n=i(t,t.VERTEX_SHADER,e),o=i(t,t.FRAGMENT_SHADER,s),r=t.createProgram();return t.attachShader(r,n),t.attachShader(r,o),t.linkProgram(r),r},e.loadShader=i,e.createTexture=function(t,e){const s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s);const i=t.RGBA,n=t.RGBA,o=t.UNSIGNED_BYTE,r=new Uint8Array([0,0,0,255]);t.texImage2D(t.TEXTURE_2D,0,i,1,1,0,n,o,r);const a=new Image;return a.onload=(()=>{t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,i,n,o,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.generateMipmap(t.TEXTURE_2D),s.loaded=!0,s.width=a.width,s.height=a.height}),a.src=e,s}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(26);e.AppState=class{constructor(t){this.app=t,this.gui=new i.GUI(t)}update(){this.gui.handleInput(),this.gui.draw()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(27),n=s(10),o=s(3),r=s(8),a=s(0),h=s(1);e.GUI=class{constructor(t){this.app=t,this.renderer=new i.DialogRenderer(new a.Rect(0,0,1,1)),this.rootPanel=new o.Panel(t.size),this.rootPanel.gui=this}add(t){this.rootPanel.add(t)}remove(t){this.rootPanel.remove(t)}getPanelAt(t){return this.rootPanel.getPanelAt(t)}handleInput(){return this.dragElement&&this.dragOffset?(this.updateDragging(),!0):this.rootPanel.handleInput()}draw(){this.rootPanel.drawContents(),this.dragElement&&this.dragElement.drawContents()}startDragging(t){const e=this.app.mouse;this.dragElement=t,this.dragOffset=new h.Vec2(e.start.x-t.rect.x,e.start.y-t.rect.y)}updateDragging(){const t=this.app.mouse,e=this.dragElement,s=this.dragOffset;if(t.down)e.rect.x=t.x-s.x,e.rect.y=t.y-s.y;else{const i=this.rootPanel.getPanelAt(t);i&&i.onDrop(e)?(e.rect.x=i.rect.x,e.rect.y=i.rect.y,e.move(i)):e instanceof n.ItemShortcutButton&&i===this.rootPanel?e.parent&&e.parent.remove(e):e instanceof r.TalentButton&&e.shortcut&&i===this.rootPanel?e.parent&&e.parent.remove(e):(e.rect.x=t.start.x-s.x,e.rect.y=t.start.y-s.y),this.dragElement=void 0,this.dragOffset=void 0}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DialogRenderer=class{constructor(t,e){this.baseRect=t,this.closeButtonRect=e}draw(t,e){const s=this.baseRect.x,i=this.baseRect.y,n=this.baseRect.width/3|0,o=this.baseRect.height/3|0,r=s+n,a=i+o,h=s+2*n,l=i+2*n,c=e.rect.x,d=e.rect.y,u=e.rect.width-2*n,g=e.rect.height-2*o,p=c+n,m=d+o,y=p+u,w=m+g;if(t.drawImage(c,d,s,i,n,o,void 0,n,o),t.drawImage(p,d,r,i,n,o,void 0,u,o),t.drawImage(y,d,h,i,n,o,void 0,n,o),t.drawImage(c,m,s,a,n,o,void 0,n,g),t.drawImage(p,m,r,a,n,o,void 0,u,g),t.drawImage(y,m,h,a,n,o,void 0,n,g),t.drawImage(c,w,s,l,n,o,void 0,n,o),t.drawImage(p,w,r,l,n,o,void 0,u,o),t.drawImage(y,w,h,l,n,o,void 0,n,o),this.closeButtonRect&&e.closeButton){const s=this.closeButtonRect.width,i=this.closeButtonRect.height,n=e.rect.x2-s,o=e.rect.y,r=this.closeButtonRect.x,a=this.closeButtonRect.y;t.drawImage(n,o,r,a,s,i)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=[-1,0,1,-1,1,-1,0,1],n=[-1,-1,-1,0,0,1,1,1],o=[1.5,1,1.5,1,1,1.5,1,1.5];function r(t){let e=null,s=-1,i=1/0;for(let n=0;n<t.length;n++){const o=t[n];o.g!==1/0&&o.g+o.h<i&&(e=o,s=n,i=o.g+o.h)}return t.splice(s,1),e}function a(t){const e=[];let s=t;for(;s;)e.push(s),s=s.prev;return e.reverse(),e}e.computePath=function(t,e,s,h){!function(t,e){for(let s=0;s<t.height;s++)for(let i=0;i<t.width;i++){const n=t.grid[s][i];n.g=1/0,n.h=Math.min(Math.abs(i-e.x),Math.abs(s-e.y)),n.prev=null}}(t,s);const l=t.grid[e.y][e.x];l.g=0;const c=[l];for(;c.length>0;){const e=r(c);if(e.x===s.x&&e.y===s.y)return a(e);for(let s=0;s<i.length;s++){const r=e.x+i[s],a=e.y+n[s];if(r>=0&&r<t.width&&a>=0&&a<t.height){const i=t.grid[a][r],n=e.g+o[s];n<i.g&&n<=h&&!t.grid[a][r].blocked&&(i.g=n,i.prev=e,c.push(i))}}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RNG=class{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}setSeed(t){this.state=t}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(t,e){const s=e-t;return t+(this.nextInt()/this.m*s|0)}chooseIndex(t){const e=t.reduce((t,e)=>t+e),s=this.nextRange(1,e+1);let i=0;for(let e=0;e<t.length;e++)if(s<=(i+=t[e]))return e;return t.length-1}chooseKey(t){const e=[],s=[];for(const i in t)t.hasOwnProperty(i)&&(e.push(i),s.push(t[i]));return e[this.chooseIndex(s)]}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=30;class o extends i.Rect{constructor(t,e,s,i,o,r,a,h){super(t,e,s,i),this.frames=o||1,this.loop=!!r,this.ticksPerFrame=a||n,this.colorOverride=h,this.animIndex=0,this.animDelay=0}draw(t,e,s,i){let n=this.animIndex;this.loop&&(n=(o.globalAnimIndex/this.ticksPerFrame|0)%this.frames);const r=this.x+n*this.width,a=this.y,h=i||this.colorOverride;t.drawImage(e,s,r,a,this.width,this.height,h),this.animDelay++,this.animDelay>this.ticksPerFrame&&(this.animDelay=0,this.animIndex++,this.animIndex>=this.frames&&(this.loop?this.animIndex=0:this.animIndex=this.frames-1))}static updateGlobalAnimations(){o.globalAnimIndex++}}o.globalAnimIndex=0,e.Sprite=o},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Message=class{constructor(t,e){this.text=t,this.color=e}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(12),n=s(13),o=s(10),r=s(8);e.ShortcutButtonSlot=class extends i.ButtonSlot{onDrop(t){if(this.children.length>0)return!1;if(t instanceof n.ItemButton){const e=t,s=e.containerItems,i=e.stackItems.get(0);return this.add(new o.ItemShortcutButton(this.rect.clone(),s,i)),!1}return t instanceof r.TalentButton?!!t.shortcut||(this.add(new r.TalentButton(this.rect.clone(),t.talent,!0)),!1):!!(t instanceof o.ItemShortcutButton||t instanceof r.TalentButton&&t.shortcut)}}},function(t,e,s){"use strict";function i(t){for(var s in t)e.hasOwnProperty(s)||(e[s]=t[s])}Object.defineProperty(e,"__esModule",{value:!0}),i(s(14)),i(s(18)),i(s(16)),i(s(35)),i(s(36)),i(s(4)),i(s(19)),i(s(37)),i(s(38)),i(s(20)),i(s(39)),i(s(21)),i(s(40)),i(s(25)),i(s(7)),i(s(9)),i(s(5)),i(s(15)),i(s(43)),i(s(26)),i(s(11)),i(s(12)),i(s(45)),i(s(6)),i(s(27)),i(s(47)),i(s(13)),i(s(48)),i(s(10)),i(s(50)),i(s(51)),i(s(3)),i(s(52)),i(s(53)),i(s(32)),i(s(8)),i(s(54)),i(s(17)),i(s(55)),i(s(22)),i(s(2)),i(s(31)),i(s(23)),i(s(28)),i(s(0)),i(s(29)),i(s(30)),i(s(56)),i(s(57)),i(s(1))},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnimationPromise=class{constructor(){this.handlers=[]}then(t){return this.handlers.push(t),this}resolve(){for(let t=0;t<this.handlers.length;t++)this.handlers[t]()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(16);e.BasicMonster=class extends i.AI{constructor(t,e){super(t),this.damageFunc=e}doAi(){const t=this.actor,e=t.game.player;if(e)if(t.distanceTo(e)>1.5)t.moveToward(e.x,e.y);else if(e.hp>0){const s=this.damageFunc?this.damageFunc(t,e):1;t.attack(e,s)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(16);e.ConfusedMonster=class extends i.AI{constructor(t){super(t),this.numTurns=10,this.oldAi=t.ai}doAi(){if(this.numTurns>0){const t=this.actor.game.rng;this.actor.move(t.nextRange(-1,2),t.nextRange(-1,2)),this.numTurns--}else this.actor.ai=this.oldAi}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(9),n=s(4);e.FadeInAnimation=class extends n.Animation{constructor(t){super(t,!0),this.duration=t}draw(t){const e=t.blackoutRect;if(!e)return;const s=this.countdown/this.duration,n=Math.max(1,Math.min(255,255*s|0)),o=i.fromRgb(0,0,0,n);t.app.drawImage(0,0,e.x,e.y,e.width,e.height,o,t.app.size.width,t.app.size.height)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(9),n=s(4);e.FadeOutAnimation=class extends n.Animation{constructor(t){super(t,!0),this.duration=t}draw(t){const e=t.blackoutRect;if(!e)return;const s=1-this.countdown/this.duration,n=Math.max(1,Math.min(255,255*s|0)),o=i.fromRgb(0,0,0,n);t.app.drawImage(0,0,e.x,e.y,e.width,e.height,o,t.app.size.width,t.app.size.height)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(4);e.ProjectileAnimation=class extends i.Animation{constructor(t,e,s,i){super(i,!0),this.sprite=t,this.position=e,this.velocity=s,this.duration=i}update(){super.update(),this.position.add(this.velocity)}draw(t){const e=this.position.x-t.viewport.x,s=this.position.y-t.viewport.y;this.sprite.draw(t.app,e,s)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(41),n=s(22),o=s(23),r=s(0),a=s(42),h=s(1),l=s(2),c=[l.Keys.VK_NUMPAD7],d=[l.Keys.VK_NUMPAD9],u=[l.Keys.VK_NUMPAD1],g=[l.Keys.VK_NUMPAD3],p=[l.Keys.VK_UP,l.Keys.VK_NUMPAD8,l.Keys.VK_K,l.Keys.VK_W,l.Keys.VK_Z],m=[l.Keys.VK_LEFT,l.Keys.VK_NUMPAD4,l.Keys.VK_H,l.Keys.VK_A,l.Keys.VK_Q],y=[l.Keys.VK_DOWN,l.Keys.VK_NUMPAD2,l.Keys.VK_J,l.Keys.VK_S],w=[l.Keys.VK_RIGHT,l.Keys.VK_NUMPAD6,l.Keys.VK_L,l.Keys.VK_D],f=[l.Keys.VK_SPACE,l.Keys.VK_NUMPAD5];e.App=class{constructor(t){const e=t.canvas;if(!e)throw new Error("Null or missing canvas element");const s=e.getContext("webgl",{alpha:!1,antialias:!1});if(!s)throw new Error("Could not get WebGL context");this.canvas=e,this.gl=s,this.size=t.size||new r.Rect(0,0,400,224),this.font=t.font||i.FONT_04B03,this.fillWindow=t.fillWindow||!1,this.scaleFactor=t.scaleFactor||2,this.center=new h.Vec2(this.size.width/2|0,this.size.height/2|0),s.disable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),e.width=this.size.width,e.height=this.size.height,e.style.outline="none",e.tabIndex=0,e.focus(),this.mobile=this.isMobile(),this.renderSet=new a.RenderSet(s,t.imageUrl,this.font),this.keyboard=new n.Keyboard(e),this.mouse=new o.Mouse(this),this.fillWindow&&(window.addEventListener("resize",this.handleResizeEvent.bind(this),!1),this.handleResizeEvent()),this.renderLoop()}handleResizeEvent(){const t=window.innerWidth,e=window.innerHeight,s=this.isMobile(),i=s?320:400,n=s?224:300;this.scaleFactor=1,this.scaleFactor=t>e?Math.max(1,Math.min(Math.round(t/i),Math.round(e/n))):Math.max(1,Math.min(Math.round(t/n),Math.round(e/i))),this.size.width=Math.round(t/this.scaleFactor),this.size.height=Math.round(e/this.scaleFactor),this.center.x=this.size.width/2|0,this.center.y=this.size.height/2|0,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"}isMobile(){return!!navigator.userAgent.match(/Android|iPhone|iPod|IEMobile|WPDesktop|Opera Mini/i)}renderLoop(){this.keyboard.update(),this.mouse.update(),this.resetGl(),this.state&&this.state.update(),this.renderSet.flush(this.size.width,this.size.height),requestAnimationFrame(this.renderLoop.bind(this))}resetGl(){const t=this.gl;t.viewport(0,0,this.size.width,this.size.height),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.renderSet.positionArrayIndex=0,this.renderSet.texcoordArrayIndex=0,this.renderSet.colorArrayIndex=0}drawImage(t,e,s,i,n,o,r,a,h){this.renderSet.drawImage(t,e,s,i,n,o,r,a,h)}drawString(t,e,s,i){this.renderSet.drawString(t,e,s,i)}drawCenteredString(t,e,s,i){this.renderSet.drawCenteredString(t,e,s,i)}drawRightString(t,e,s,i){this.renderSet.drawRightString(t,e,s,i)}isKeyDown(t){const e=this.keyboard.getKey(t);return e&&e.down}isKeyPressed(t){const e=this.keyboard.getKey(t),s=e?e.downCount:0;return 1===s||s>30}isDownLeftKeyPressed(){return this.isKeyArrayPressed(u)}isDownKeyPressed(){return this.isKeyArrayPressed(y)}isDownRightKeyPressed(){return this.isKeyArrayPressed(g)}isLeftKeyPressed(){return this.isKeyArrayPressed(m)}isWaitKeyPressed(){return this.isKeyArrayPressed(f)}isRightKeyPressed(){return this.isKeyArrayPressed(w)}isUpLeftKeyPressed(){return this.isKeyArrayPressed(c)}isUpKeyPressed(){return this.isKeyArrayPressed(p)}isUpRightKeyPressed(){return this.isKeyArrayPressed(d)}isKeyArrayPressed(t){for(let e=0;e<t.length;e++)if(this.isKeyPressed(t[e]))return!0;return!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=32,n=126;class o{isInRange(t){return t>=i&&t<=n}getStringWidth(t){let e=0;for(let s=0;s<t.length;s++)e+=this.getWidth(t.charCodeAt(s));return e}}e.Font=o,e.MonospacedFont=class extends o{constructor(t){super(),this.glyphSize=t}getOffset(t){return(t-i)*this.glyphSize.width}getWidth(){return this.glyphSize.width}getHeight(){return this.glyphSize.height}};class r extends o{constructor(t,e){super(),this.height=t,this.widths=e,this.offsets=[0];let s=0;for(let t=0;t<this.widths.length;t++)s+=this.widths[t],this.offsets.push(s)}getOffset(t){return this.offsets[t-i]}getWidth(t){return this.widths[t-i]}getHeight(){return this.height}}e.ProportionalFont=r,e.FONT_04B03=new r(8,[4,2,4,6,5,6,6,2,3,3,4,4,3,4,2,6,5,3,5,5,5,5,5,5,5,5,2,2,4,4,4,5,6,5,5,4,5,4,4,5,5,4,5,5,4,6,5,5,5,5,5,5,4,5,5,6,5,5,4,3,6,3,4,5,3,5,5,4,5,5,4,5,5,2,3,5,2,6,5,5,5,5,4,5,4,5,5,6,4,5,5,4,2,4,5,0])},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(24),n=65536;e.RenderSet=class{constructor(t,e,s){this.gl=t,this.font=s;const o=i.initShaderProgram(t,"uniform vec2 u_viewportSize;attribute vec2 a_position;attribute vec2 a_texCoord;attribute vec4 a_color;varying vec2 v_texCoord;varying vec4 v_color;void main() {vec2 zeroToOne = a_position / u_viewportSize;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;v_color = a_color;}","precision highp float;uniform sampler2D u_image;varying vec2 v_texCoord;varying vec4 v_color;void main() {gl_FragColor = texture2D(u_image, v_texCoord);if (gl_FragColor.a < 0.1) discard;if (v_color.a != 0.0) gl_FragColor = v_color;}");this.program=o,this.viewportSizeLocation=t.getUniformLocation(o,"u_viewportSize"),this.positionLocation=t.getAttribLocation(o,"a_position"),this.texcoordLocation=t.getAttribLocation(o,"a_texCoord"),this.colorLocation=t.getAttribLocation(o,"a_color"),this.positionBuffer=t.createBuffer(),this.texcoordBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.spriteTexture=i.createTexture(t,e),this.positionArray=new Float32Array(n),this.positionArrayIndex=0,this.texcoordArray=new Float32Array(n),this.texcoordArrayIndex=0,this.colorUint8Array=new Uint8Array(n),this.colorDataView=new DataView(this.colorUint8Array.buffer),this.colorArrayIndex=0}drawCenteredString(t,e,s,i){const n=e-this.font.getStringWidth(t)/2|0;this.drawString(t,n,s,i)}drawRightString(t,e,s,i){const n=e-this.font.getStringWidth(t);this.drawString(t,n,s,i)}drawString(t,e,s,i){const n=t.split("\n"),o=this.font.getHeight();let r=s;for(let t=0;t<n.length;t++){let s=e;for(let e=0;e<n[t].length;e++){const a=n[t].charCodeAt(e);if(this.font.isInRange(a)){const t=this.font.getOffset(a),e=this.font.getWidth(a);this.drawImage(s,r,t,0,e,o,i),s+=e}}r+=o}}drawChar(t,e,s,i){if(this.font.isInRange(t)){const n=this.font.getOffset(t),o=this.font.getWidth(t),r=this.font.getHeight();this.drawImage(e,s,n,0,o,r,i)}}drawImage(t,e,s,i,n,o,r,a,h){const l=this.spriteTexture;if(!l.loaded)return;const c=void 0!==a?a:n,d=void 0!==h?h:o,u=t+Math.abs(c),g=e+d,p=s/l.width,m=i/l.height,y=(s+n)/l.width,w=(i+o)/l.height,f=r||0;this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=p,this.texcoordArray[this.texcoordArrayIndex++]=m,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=m,this.texcoordArray[this.texcoordArrayIndex++]=p,this.texcoordArray[this.texcoordArrayIndex++]=w,this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=g,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=p,this.texcoordArray[this.texcoordArrayIndex++]=w,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=m,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=w;for(let t=0;t<6;t++)this.colorDataView.setUint32(this.colorArrayIndex,f,!1),this.colorArrayIndex+=4}flush(t,e){if(!this.spriteTexture.loaded||0===this.positionArrayIndex)return;const s=this.gl;s.useProgram(this.program),s.uniform2f(this.viewportSizeLocation,t,e),s.activeTexture(s.TEXTURE0),s.bindTexture(s.TEXTURE_2D,this.spriteTexture);{s.enableVertexAttribArray(this.positionLocation),s.bindBuffer(s.ARRAY_BUFFER,this.positionBuffer),s.bufferData(s.ARRAY_BUFFER,this.positionArray,s.DYNAMIC_DRAW);const t=2,e=s.FLOAT,i=!1,n=0,o=0;s.vertexAttribPointer(this.positionLocation,t,e,i,n,o)}{s.enableVertexAttribArray(this.texcoordLocation),s.bindBuffer(s.ARRAY_BUFFER,this.texcoordBuffer),s.bufferData(s.ARRAY_BUFFER,this.texcoordArray,s.DYNAMIC_DRAW);const t=2,e=s.FLOAT,i=!1,n=0,o=0;s.vertexAttribPointer(this.texcoordLocation,t,e,i,n,o)}{s.enableVertexAttribArray(this.colorLocation),s.bindBuffer(s.ARRAY_BUFFER,this.colorBuffer),s.bufferData(s.ARRAY_BUFFER,this.colorUint8Array,s.DYNAMIC_DRAW);const t=4,e=s.UNSIGNED_BYTE,i=!0,n=0,o=0;s.vertexAttribPointer(this.colorLocation,t,e,i,n,o)}const i=s.TRIANGLES,n=this.positionArrayIndex/2;s.drawArrays(i,0,n)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(14),n=s(18),o=s(25),r=s(5),a=s(44),h=s(2),l=s(28),c=s(0),d=s(29),u=s(30),g=s(1),p=s(7);e.Game=class extends o.AppState{constructor(t,e){super(t),this.tileSize=e.tileSize||new c.Rect(0,0,16,16),this.viewport=new c.Rect(0,0,t.size.width,t.size.height),this.viewportFocus=new g.Vec2(0,0),this.animations=[],this.entities=new p.ArrayList,this.turnIndex=0,this.blocked=!1,this.cursor=new g.Vec2(-1,-1),this.tooltip=new a.TooltipDialog,this.rng=new d.RNG,this.pathIndex=0,this.horizontalViewDistance=e.viewDistance||13,this.verticalViewDistance=e.viewDistance||13,e.horizontalViewDistance&&(this.horizontalViewDistance=e.horizontalViewDistance),e.verticalViewDistance&&(this.verticalViewDistance=e.verticalViewDistance)}log(t,e){this.messageLog&&this.messageLog.add(t,e)}addAnimation(t){return this.animations.push(t),t.promise}update(){u.Sprite.updateGlobalAnimations(),this.updateTooltip(),this.gui.handleInput()||(this.updateAnimations(),this.updateEntities(),this.onUpdate&&this.onUpdate(),this.updateViewport()),this.drawTileMap(),this.drawTargeting(),this.drawEntities(),this.drawAnimations(),this.gui.draw()}updateTooltip(){if(this.gui.dragElement)return void(this.tooltip.visible=!1);this.tooltip.visible||(this.tooltipElement=void 0);const t=this.app.mouse,e=t.isLongPress();if(!t.down&&(0!==t.dx||0!==t.dy)||e){const s=this.gui.getPanelAt(t);this.tooltipElement!==s&&(this.tooltipElement=s,s&&(s.updateTooltip(this.tooltip),e&&window.navigator.vibrate(100))),this.tooltip.visible&&(this.tooltip.gui||this.gui.add(this.tooltip),this.tooltip.showAt(t.x,t.y),this.tooltip.modal=this.app.mobile)}}updateAnimations(){this.blocked=!1;for(let t=0;t<this.animations.length;t++){const e=this.animations[t];e.update(),e.blocking&&(this.blocked=!0)}for(let t=this.animations.length-1;t>=0;t--)this.animations[t].isDone()&&(this.animations[t].promise.resolve(),this.animations.splice(t,1))}updateEntities(){if(this.player&&this.player.hp<=0)return;let t=0;for(;0!==this.entities.length&&(this.turnIndex>=this.entities.length&&(this.turnIndex=0),!(t>2*this.entities.length));){const e=this.entities.get(this.turnIndex);if(e instanceof n.Actor){if(e.ap>0){if(e===this.player){this.blocked||this.handlePlayerInput();break}this.doAi(e)}e.ap<=0&&(e.ap=0,this.nextTurn())}else this.nextTurn();t++}}resetViewport(){this.player&&(this.viewportFocus.x=this.player.centerPixelX,this.viewportFocus.y=this.player.centerPixelY,this.viewport.x=this.viewportFocus.x-(this.app.size.width/2|0),this.viewport.y=this.viewportFocus.y-(this.app.size.height/2|0))}updateViewport(){this.viewport.width=this.app.size.width,this.viewport.height=this.app.size.height;const t=this.app.mouse;if(t.isDragging())this.viewport.x-=t.dx,this.viewport.y-=t.dy,this.viewportFocus.x=this.viewport.x+(this.viewport.width/2|0),this.viewportFocus.y=this.viewport.y+(this.viewport.height/2|0);else{const t=this.viewportFocus.x-(this.app.size.width/2|0);if(t!==this.viewport.x){let e=.1*t-.1*this.viewport.x;e=e<0?Math.floor(e):Math.ceil(e),this.viewport.x+=e}const e=this.viewportFocus.y-(this.app.size.height/2|0);if(e!==this.viewport.y){let t=.1*e-.1*this.viewport.y;t=t<0?Math.floor(t):Math.ceil(t),this.viewport.y+=t}}}drawTileMap(){if(this.app.renderSet.spriteTexture.loaded&&this.tileMap){const t=(u.Sprite.globalAnimIndex/30|0)%2;this.tileMap.draw(this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height,t)}}drawTargeting(){if(this.isTargeting()&&this.targetSprite){const t=this.cursor.x*this.tileSize.width-this.viewport.x,e=this.cursor.y*this.tileSize.height-this.viewport.y;this.targetSprite.draw(this.app,t,e)}}drawEntities(){for(let t=0;t<3;t++)for(let e=0;e<this.entities.length;e++){const s=this.entities.get(e);s.zIndex!==t||this.tileMap&&!this.tileMap.isVisible(s.x,s.y)||s.draw()}}drawAnimations(){let t=0;for(let e=0;e<this.animations.length;e++){const s=this.animations[e];0!==t&&s.blocking||s.draw(this),s.blocking&&t++}}isTargeting(){return!!this.targetAbility}startTargeting(t,e){this.targetAbility=t,this.targetCallback=e,this.player&&(this.cursor.x=this.player.x,this.cursor.y=this.player.y)}endTargeting(){if(this.player&&this.targetAbility){const t=this.targetAbility.targetType;let e=null;t===i.TargetType.ENTITY?e=this.getActorAt(this.cursor.x,this.cursor.y):t===i.TargetType.TILE&&this.tileMap&&(e=this.tileMap.getCell(this.cursor.x,this.cursor.y)),e&&this.targetAbility.cast(this.player,e)&&this.targetCallback&&this.targetCallback()}this.cancelTargeting()}cancelTargeting(){this.targetAbility=void 0,this.targetCallback=void 0}handlePlayerInput(){if(!this.player||this.blocked)return;if(this.player.ai)return this.player.ai.doAi(),void(this.player.ap=0);const t=this.app.mouse;if((t.down||0!==t.dx||0!==t.dy)&&(this.cursor.x=(this.viewport.x+t.x)/this.tileSize.width|0,this.cursor.y=(this.viewport.y+t.y)/this.tileSize.height|0),this.app.isKeyDown(h.Keys.VK_SHIFT)){let t=0,e=0;return this.app.isDownLeftKeyPressed()&&(t=-1,e=1),this.app.isDownKeyPressed()&&(e=1),this.app.isDownRightKeyPressed()&&(t=1,e=1),this.app.isLeftKeyPressed()&&(t=-1),this.app.isRightKeyPressed()&&(t=1),this.app.isUpLeftKeyPressed()&&(t=-1,e=-1),this.app.isUpKeyPressed()&&(e=-1),this.app.isUpRightKeyPressed()&&(t=1,e=-1),this.viewportFocus.x-=t*this.tileSize.height,void(this.viewportFocus.y-=e*this.tileSize.height)}if(this.isTargeting())return(this.app.isKeyPressed(h.Keys.VK_ENTER)||this.app.mouse.isClicked())&&this.endTargeting(),this.app.isKeyPressed(h.Keys.VK_ESCAPE)&&this.cancelTargeting(),this.app.isDownLeftKeyPressed()&&(this.cursor.x--,this.cursor.y++),this.app.isDownKeyPressed()&&this.cursor.y++,this.app.isDownRightKeyPressed()&&(this.cursor.x++,this.cursor.y++),this.app.isLeftKeyPressed()&&this.cursor.x--,this.app.isRightKeyPressed()&&this.cursor.x++,this.app.isUpLeftKeyPressed()&&(this.cursor.x--,this.cursor.y--),this.app.isUpKeyPressed()&&this.cursor.y--,void(this.app.isUpRightKeyPressed()&&(this.cursor.x++,this.cursor.y--));if(t.isClicked()){const e=(this.viewport.x+t.x)/this.tileSize.width|0,s=(this.viewport.y+t.y)/this.tileSize.height|0;if(this.tileMap){const t=this.tileMap.getCell(e,s);t&&t!==this.targetTile&&(this.targetTile=t,this.path=l.computePath(this.tileMap,this.player,this.targetTile,100),this.pathIndex=0)}}let e=null;if(this.path){for(e=this.path[this.pathIndex];e&&e.x===this.player.x&&e.y===this.player.y;)this.pathIndex++,e=this.pathIndex<this.path.length?this.path[this.pathIndex]:null;e||this.stopAutoWalk()}if(e){const t=e.x-this.player.x,s=e.y-this.player.y;this.tryMoveOrAttack(t,s)}else this.app.isDownLeftKeyPressed()&&this.tryMoveOrAttack(-1,1)||this.app.isDownKeyPressed()&&this.tryMoveOrAttack(0,1)||this.app.isDownRightKeyPressed()&&this.tryMoveOrAttack(1,1)||this.app.isLeftKeyPressed()&&this.tryMoveOrAttack(-1,0)||this.app.isRightKeyPressed()&&this.tryMoveOrAttack(1,0)||this.app.isUpLeftKeyPressed()&&this.tryMoveOrAttack(-1,-1)||this.app.isUpKeyPressed()&&this.tryMoveOrAttack(0,-1)||this.app.isUpRightKeyPressed()&&this.tryMoveOrAttack(1,-1)||this.app.isWaitKeyPressed()&&(this.player.ap=0)}tryMoveOrAttack(t,e){const s=this.player;if(!s)return;const i=s.x+t,o=s.y+e;for(let t=0;t<this.entities.length;t++){const e=this.entities.get(t);if(s!==e&&e.x===i&&e.y===o)return this.path&&e instanceof n.Actor?1===this.pathIndex?(e.onBump(s),this.stopAutoWalk(),!0):(this.stopAutoWalk(),!0):(e.onBump(s),!0)}return s.move(t,e)}recalculateViewportFocus(){const t=this.player;if(!t)return;let e=t.x*t.sprite.width,s=t.y*t.sprite.height,i=e+t.sprite.width,o=s+t.sprite.height;if(this.path)for(let t=this.pathIndex;t<this.path.length;t++){const n=this.path[t];e=Math.min(e,n.x*this.tileSize.width),s=Math.min(s,n.y*this.tileSize.height),i=Math.max(i,(n.x+1)*this.tileSize.width),o=Math.max(o,(n.y+1)*this.tileSize.height)}else for(let t=0;t<this.entities.length;t++){const r=this.entities.get(t);r instanceof n.Actor&&this.tileMap&&this.tileMap.isVisible(r.x,r.y)&&(e=Math.min(e,r.pixelX),s=Math.min(s,r.pixelY),i=Math.max(i,r.pixelX+r.sprite.width),o=Math.max(o,r.pixelY+r.sprite.height))}this.viewportFocus.x=Math.round((e+i)/2),this.viewportFocus.y=Math.round((s+o)/2)}doAi(t){t.ai?((t.visibleDuration>0||t.ai.alwaysActive)&&t.ai.doAi(),t.ap=0):t.ap=0}nextTurn(){if(this.turnIndex<this.entities.length){const t=this.entities.get(this.turnIndex);t.endTurn(),this.player===t&&(this.recomputeFov(),this.recalculateViewportFocus())}this.turnIndex++,this.turnIndex>=this.entities.length&&(this.turnIndex=0),this.turnIndex>=0&&this.turnIndex<this.entities.length&&this.entities.get(this.turnIndex).startTurn()}stopAutoWalk(){this.path=void 0,this.targetTile=void 0}isBlocked(t,e){if(this.tileMap&&this.tileMap.isBlocked(t,e))return!0;for(let s=0;s<this.entities.length;s++){const i=this.entities.get(s);if(i.blocks&&i.x===t&&i.y===e)return!0}return!1}getEntityAt(t,e){for(let s=0;s<this.entities.length;s++){const i=this.entities.get(s);if(i.x===t&&i.y===e)return i}}getActorAt(t,e){for(let s=0;s<this.entities.length;s++){const i=this.entities.get(s);if(i instanceof n.Actor&&i.x===t&&i.y===e)return i}}recomputeFov(){if(this.player&&this.tileMap){this.tileMap.computeFov(this.player.x,this.player.y,this.horizontalViewDistance,this.verticalViewDistance);for(let t=0;t<this.entities.length;t++){const e=this.entities.get(t);e!==this.player&&e instanceof n.Actor&&(this.tileMap.isVisible(e.x,e.y)?(e.seen||(e.seen=!0,this.player.addFloatingText("!",r.Colors.WHITE),this.stopAutoWalk(),this.viewportFocus.x=(this.player.centerPixelX+e.centerPixelX)/2|0,this.viewportFocus.y=(this.player.centerPixelY+e.centerPixelY)/2|0),e.visibleDuration++):e.visibleDuration=-1)}}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(6);e.TooltipDialog=class extends n.Dialog{constructor(){super(new i.Rect(0,0,100,10)),this.messages=[],this.visible=!1}showAt(t,e){if(!this.gui)return;const s=this.gui.app,i=s.font,n=i.getHeight()+2;this.rect.width=10,this.rect.height=10+this.messages.length*n;for(let t=0;t<this.messages.length;t++){const e=this.messages[t],s=10+i.getStringWidth(e.text);this.rect.width=Math.max(this.rect.width,s)}t+this.rect.width>=s.size.width?this.rect.x=t-this.rect.width-2:this.rect.x=t+2,e-this.rect.height<0?this.rect.y=e+2:this.rect.y=e-this.rect.height-2,this.rect.x<0&&(this.rect.x=0),this.rect.y<0&&(this.rect.y=0),this.visible=!0}drawContents(){if(!this.gui)return;super.drawContents();const t=this.gui.app.font.getHeight()+2,e=this.rect.x+5;let s=this.rect.y+5;for(let i=0;i<this.messages.length;i++){const n=this.messages[i];this.gui.app.drawString(n.text,e,s,n.color),s+=t}}handleInput(){return!!this.gui&&(this.gui.app.mouse.isClicked()&&(this.visible=!1),!1)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),n=s(1),o=s(46),r=s(6);e.ComplexSelectDialog=class extends r.Dialog{constructor(t,e){super(t),this.options=e,this.selectedIndex=0,this.renderer=new o.DefaultSelectOptionRenderer}drawContents(){if(!this.gui)return;super.drawContents();const t=this.rect,e=new n.Vec2(t.x+4,t.y+4);for(let t=0;t<this.options.length;t++){const s=this.options[t],i=t===this.selectedIndex;this.renderer.drawOption(this.gui,e,s,i),e.y+=this.renderer.getHeight(s,i)}}handleInput(){if(!this.gui)return!1;const t=this.gui.app;for(let e=0;e<this.options.length;e++)t.isKeyPressed(i.Keys.VK_A+e)&&(this.selectedIndex=e,this.onSelect&&this.onSelect(this.options[e]));t.isKeyPressed(i.Keys.VK_ENTER)&&this.onSelect&&this.onSelect(this.options[this.selectedIndex]),t.isKeyPressed(i.Keys.VK_ESCAPE)&&this.onCancel&&this.onCancel(),t.isKeyPressed(i.Keys.VK_UP)&&this.selectedIndex--,t.isKeyPressed(i.Keys.VK_DOWN)&&this.selectedIndex++,this.selectedIndex<0&&(this.selectedIndex+=this.options.length),this.selectedIndex>=this.options.length&&(this.selectedIndex-=this.options.length);const e=t.mouse,s=this.rect;let n=s.y+4;if(1===e.upCount&&e.x>=s.x1&&e.x<s.x2)for(let t=0;t<this.options.length;t++){const s=this.options[t],i=t===this.selectedIndex,o=this.renderer.getHeight(s,i),r=n,a=n+o;e.y>=r&&e.y<a&&(i?this.onSelect&&this.onSelect(s):this.selectedIndex=t),n+=o}return!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(5);e.DefaultSelectOptionRenderer=class{getHeight(t,e){return 10}drawOption(t,e,s,n){const o=n?i.Colors.YELLOW:i.Colors.WHITE;t.app.drawString(s.name,e.x,e.y,o)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3);e.ImagePanel=class extends i.Panel{constructor(t,e){super(e),this.srcRect=t}drawContents(){if(!this.gui)return;const t=this.srcRect,e=this.rect;this.gui.app.drawImage(e.x,e.y,t.x,t.y,e.width,e.height)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),n=s(0),o=s(6),r=s(13),a=s(49);e.ItemContainerDialog=class extends o.Dialog{constructor(t,e,s,o){super(t),this.messages=e,this.capacity=s,this.items=o,this.modal=!0,o.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)});for(let t=0;t<s;t++)this.add(new a.ItemContainerButtonSlot(new n.Rect(0,0,24,24),o,i.Keys.VK_A+t))}addItem(t){const e=this.getExistingButton(t);if(e)return void e.stackItems.add(t);const s=this.getNextFreeSlot();s&&s.add(new r.ItemButton(s.rect.clone(),this.items,t))}removeItem(t){for(let e=0;e<this.children.length;e++){const s=this.children.get(e),i=s.button;i&&i instanceof r.ItemButton&&i.stackItems.contains(t)&&(i.stackItems.remove(t),0===i.stackItems.length&&s.remove(i))}}getExistingButton(t){for(let e=0;e<this.children.length;e++){const s=this.children.get(e).button;if(s&&s instanceof r.ItemButton&&s.stackItems.get(0).name===t.name)return s}}getNextFreeSlot(){for(let t=0;t<this.children.length;t++){const e=this.children.get(t);if(!e.button)return e}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect;let s=t.x+4,i=t.y+4;for(let t=0;t<this.messages.length;t++){const e=this.messages[t];this.gui.app.drawString(e.text,s,i,e.color),i+=10}for(let n=0;n<this.capacity;n++){const o=this.children.get(n);o.rect.x=s,o.rect.y=i,o.rect.width=e.width,o.rect.height=e.height,(s+=e.width+2)>t.x2-e.width-4&&(s=t.x+4,i+=e.height+2)}this.rect.height=i+4-t.y,this.drawChildren()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(12),n=s(13);e.ItemContainerButtonSlot=class extends i.ButtonSlot{constructor(t,e,s){super(t,s),this.items=e}onDrop(t){return t instanceof n.ItemButton}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(5),n=s(31),o=s(3);e.MessageLog=class extends o.Panel{constructor(t,e){super(t),this.messages=[],this.maxItems=e||5}add(t,e){t instanceof o.Panel||(this.messages.push(new n.Message(t,e||i.Colors.WHITE)),this.messages.length>this.maxItems&&this.messages.splice(0,this.messages.length-this.maxItems))}drawContents(){if(!this.gui)return;const t=this.rect.x;let e=this.rect.y;e<0&&(e=this.gui.app.size.height+e+this.rect.height-10*this.messages.length);for(let s=0;s<this.messages.length;s++){const i=this.messages[s];this.gui.app.drawString(i.text,t,e,i.color),e+=10}}handleInput(){return!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(3);e.MessagePanel=class extends i.Panel{constructor(t,e){super(t),this.message=e}drawContents(){if(!this.gui)return;const t=this.message,e=this.rect;this.gui.app.drawString(t.text,e.x,e.y,t.color)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),n=s(6);e.SelectDialog=class extends n.Dialog{constructor(t,e,s){super(t),this.options=e,this.callback=s}drawContents(){if(!this.gui)return;super.drawContents();const t=this.rect;for(let e=0;e<this.options.length;e++){const s=String.fromCharCode(65+e)+" - "+this.options[e].name;this.gui.app.drawString(s,t.x+4,t.y+4+10*e)}}handleInput(){if(!this.gui)return!1;for(let t=0;t<this.options.length;t++)if(this.gui.app.isKeyPressed(i.Keys.VK_A+t))return this.callback(this.options[t]),this.close(),!0;if(this.gui.app.isKeyPressed(i.Keys.VK_ESCAPE))return this.close(),!0;const t=this.gui.app.mouse,e=this.rect;if(t.isClicked()&&t.x>=e.x1&&t.x<e.x2){if(this.closeButton&&t.x>=e.x2-16&&t.y<e.y+16)return this.close(),!0;for(let s=0;s<this.options.length;s++){const i=e.y+4+10*s,n=i+10;t.y>=i&&t.y<n&&(this.callback(this.options[s]),this.close())}}return!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),n=s(0),o=s(10),r=s(3),a=s(32),h=s(8);e.ShortcutBar=class extends r.Panel{constructor(t,e,s){super(t),this.spacing=void 0!==s?s:2;for(let t=0;t<e;t++){const e=new a.ShortcutButtonSlot(new n.Rect(0,0,24,24),i.Keys.VK_1+t);this.add(e)}}addTalent(t,e){if(this.containsTalent(t))return;const s=this.getFreeSlot(!!e);s&&s.add(new h.TalentButton(s.rect.clone(),t,!0))}containsTalent(t){for(let e=0;e<this.children.length;e++){const s=this.children.get(e);if(s.button&&s.button instanceof h.TalentButton&&s.button.talent===t)return!0}return!1}addItem(t,e,s){if(this.containsItem(e))return;const i=this.getFreeSlot(!!s);i&&i.add(new o.ItemShortcutButton(i.rect.clone(),t,e))}containsItem(t){for(let e=0;e<this.children.length;e++){const s=this.children.get(e);if(s.button&&s.button instanceof o.ItemShortcutButton&&s.button.shortcutItem.name===t.name)return!0}return!1}drawContents(){if(!this.gui)return;const t=this.gui.renderer.buttonSlotRect;if(t){for(let e=0;e<this.children.length;e++){const s=this.children.get(e);s.rect.x=this.rect.x+e*(t.width+2),s.rect.y=this.rect.y,s.rect.width=t.width,s.rect.height=t.height}this.drawChildren()}}getFreeSlot(t){if(t)for(let t=this.children.length-1;t>=0;t--){const e=this.children.get(t);if(!e.button)return e}else for(let t=0;t<this.children.length;t++){const e=this.children.get(t);if(!e.button)return e}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(2),n=s(0),o=s(12),r=s(6),a=s(8);e.TalentsDialog=class extends r.Dialog{constructor(t,e,s,r){super(t),this.messages=e,this.capacity=s,this.talents=r,this.modal=!0,r.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)});for(let t=0;t<s;t++)this.add(new o.ButtonSlot(new n.Rect(0,0,24,24),i.Keys.VK_A+t))}addItem(t){const e=this.getNextFreeSlot();e&&e.add(new a.TalentButton(e.rect.clone(),t))}removeItem(t){for(let e=0;e<this.children.length;e++){const s=this.children.get(e),i=s.button;i&&i instanceof a.TalentButton&&i.talent===t&&s.remove(i)}}getNextFreeSlot(){for(let t=0;t<this.children.length;t++){const e=this.children.get(t);if(!e.button)return e}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect;let s=t.x+4,i=t.y+4;for(let t=0;t<this.messages.length;t++){const e=this.messages[t];this.gui.app.drawString(e.text,s,i,e.color),i+=10}for(let n=0;n<this.capacity;n++){const o=this.children.get(n);o.rect.x=s,o.rect.y=i,o.rect.width=e.width,o.rect.height=e.height,(s+=e.width+2)>t.x2-e.width-4&&(s=t.x+4,i+=e.height+2)}this.rect.height=i+4-t.y,this.drawChildren()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(15);e.Item=class extends i.Entity{onBump(t){t.pickup(this),t.moveToward(this.x,this.y)}onPickup(t){}onUse(t){return!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Talent=class{constructor(t,e,s){this.actor=t,this.ability=e,this.rank=s||1,this.cooldown=0}use(t){return!(this.cooldown>0||(this.actor.cast(this.ability,t,()=>{this.cooldown=this.ability.cooldown}),0))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(24),n=s(1);class o extends n.Vec2{constructor(t,e,s){super(t,e),this.tile=s,this.blocked=!0,this.blockedSight=!0,this.visible=!1,this.seen=!1,this.g=0,this.h=0,this.prev=null}}e.TileMapCell=o;class r{constructor(t,e){this.width=t,this.height=e,this.imageData=new Uint8Array(4*t*e),this.dimensions=new Float32Array([t,e]),this.texture=null,this.clear()}clear(){let t=0;for(;t<this.imageData.length;)this.imageData[t++]=255,this.imageData[t++]=255,this.imageData[t++]=0,this.imageData[t++]=0}setAlpha(t,e,s){this.imageData[4*(e*this.width+t)+3]=s}initGl(t){this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.imageData),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}updateGl(t){t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.imageData)}}e.TileMapLayer=r,e.TileMap=class{constructor(t,e,s,n){this.gl=t,this.width=e,this.height=s,this.grid=new Array(s),this.layers=new Array(n),this.tileWidth=16,this.tileHeight=16,this.dirty=!0,this.originX=0,this.originY=0,this.minX=0,this.maxX=e-1,this.minY=0,this.maxY=s-1;for(let t=0;t<s;t++){this.grid[t]=new Array(e);for(let s=0;s<e;s++)this.grid[t][s]=new o(s,t,0)}for(let t=0;t<n;t++)this.layers[t]=new r(e,s);this.quadVertBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadVertBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,-1,0,1,1,1,1,0,-1,1,0,0]),t.STATIC_DRAW),this.tilemapShader=i.initShaderProgram(t,"precision highp float;attribute vec2 position;attribute vec2 texture;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 viewOffset;uniform vec2 viewportSize;uniform vec2 tileSize;uniform vec2 mapSize;void main(void) {   pixelCoord = (texture * viewportSize) + viewOffset;   texCoord = pixelCoord / mapSize / tileSize;   gl_Position = vec4(position, 0.0, 1.0);}","precision highp float;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 tileSize;uniform float animFrame;uniform sampler2D tiles;uniform sampler2D sprites;void main(void) {   vec4 tile = texture2D(tiles, texCoord);   if(tile.x == 1.0 && tile.y == 1.0) { discard; }   vec2 spriteOffset = floor(tile.xy * 256.0) * tileSize;   if(tile.z != 0.0) spriteOffset.x += animFrame * tileSize.x;   vec2 spriteCoord = mod(pixelCoord, tileSize);   gl_FragColor = texture2D(sprites, (spriteOffset + spriteCoord) / 1024.0);   if (gl_FragColor.a == 0.0) discard;   gl_FragColor.a *= tile.a;}"),this.positionAttribute=t.getAttribLocation(this.tilemapShader,"position"),this.textureAttribute=t.getAttribLocation(this.tilemapShader,"texture"),this.viewportSizeUniform=t.getUniformLocation(this.tilemapShader,"viewportSize"),this.viewOffsetUniform=t.getUniformLocation(this.tilemapShader,"viewOffset"),this.mapSizeUniform=t.getUniformLocation(this.tilemapShader,"mapSize"),this.tileSizeUniform=t.getUniformLocation(this.tilemapShader,"tileSize"),this.animFrameUniform=t.getUniformLocation(this.tilemapShader,"animFrame"),this.tileSamplerUniform=t.getUniformLocation(this.tilemapShader,"tiles"),this.spriteSamplerUniform=t.getUniformLocation(this.tilemapShader,"sprites");for(let e=0;e<this.layers.length;e++)this.layers[e].initGl(t)}clear(){for(let t=0;t<this.layers.length;t++)this.layers[t].clear()}setTile(t,e,s,i,n,o){if(e<0||e>=this.width||s<0||s>=this.height)return;0===t&&(this.grid[s][e].tile=i,this.grid[s][e].blocked=!!n,this.grid[s][e].blockedSight=void 0!==o?o:!!n);const r=this.layers[t],a=4*(s*r.width+e),h=0===i?255:(i-1)%64|0,l=0===i?255:(i-1)/64|0;r.imageData[a+0]=h,r.imageData[a+1]=l}getCell(t,e){return t<0||t>=this.width||e<0||e>=this.height?null:this.grid[e][t]}getTile(t,e){const s=this.getCell(t,e);return s?s.tile:0}isBlocked(t,e){const s=this.getCell(t,e);return!s||s.blocked}isVisible(t,e){return!(t<this.minX||t>this.maxX||e<this.minY||e>this.maxY)&&this.grid[e][t].visible}isSeen(t,e){const s=this.getCell(t,e);return s&&s.seen}setSeen(t,e,s){const i=this.getCell(t,e);i&&(i.seen=s)}isAnimated(t,e,s){if(t<0||t>=this.width||e<0||e>=this.height)return!1;const i=this.layers[s],n=4*(e*i.width+t);return 0!==i.imageData[n+2]}setAnimated(t,e,s,i){if(t<0||t>=this.width||e<0||e>=this.height)return;const n=this.layers[s],o=4*(e*n.width+t);n.imageData[o+2]=i?1:0}draw(t,e,s,i,n){const o=this.gl;o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.useProgram(this.tilemapShader),o.bindBuffer(o.ARRAY_BUFFER,this.quadVertBuffer),o.enableVertexAttribArray(this.positionAttribute),o.enableVertexAttribArray(this.textureAttribute),o.vertexAttribPointer(this.positionAttribute,2,o.FLOAT,!1,16,0),o.vertexAttribPointer(this.textureAttribute,2,o.FLOAT,!1,16,8),o.uniform2f(this.viewOffsetUniform,t,e),o.uniform2f(this.viewportSizeUniform,s,i),o.uniform2f(this.tileSizeUniform,this.tileWidth,this.tileHeight),o.uniform1f(this.animFrameUniform,n||0),o.activeTexture(o.TEXTURE0),o.uniform1i(this.spriteSamplerUniform,0),o.activeTexture(o.TEXTURE1),o.uniform1i(this.tileSamplerUniform,1);const r=t/this.tileWidth|0,a=e/this.tileHeight|0,h=(t+s)/this.tileWidth|0,l=(e+i)/this.tileHeight|0;for(let t=0;t<this.layers.length;t++){const e=this.layers[t];if(o.uniform2fv(this.mapSizeUniform,e.dimensions),o.bindTexture(o.TEXTURE_2D,e.texture),this.dirty){for(let t=a;t<=l;t++)for(let s=r;s<=h;s++){const i=this.isVisible(s,t)?255:this.isSeen(s,t)?144:0;e.setAlpha(s,t,i)}e.updateGl(o)}o.drawArrays(o.TRIANGLES,0,6)}this.dirty=!1}resetFov(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.grid[t][e].seen=!1,this.grid[t][e].visible=!1}computeFov(t,e,s,i){this.originX=t,this.originY=e;const n=s,o=i||s;this.minX=Math.max(0,t-n),this.minY=Math.max(0,e-o),this.maxX=Math.min(this.width-1,t+n),this.maxY=Math.min(this.height-1,e+o);for(let t=this.minY;t<=this.maxY;t++)for(let e=this.minX;e<=this.maxX;e++)this.grid[t][e].seen=this.grid[t][e].seen||this.grid[t][e].visible,this.grid[t][e].visible=!1;this.grid[e][t].visible=!0,this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantY(1,-1),this.computeOctantX(1,-1),this.computeOctantY(-1,1),this.computeOctantX(-1,1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1),this.dirty=!0}computeOctantY(t,e){const s=[],i=[];let n,o,r,a,h,l,c,d,u,g,p=1,m=0,y=0,w=0;for(o=this.originY+e;o>=this.minY&&o<=this.maxY;o+=e,y=m,++p)for(r=.5/p,g=-1,a=Math.floor(w*p+.5),n=this.originX+a*t;a<=p&&n>=this.minX&&n<=this.maxX;n+=t,++a,g=u){if(h=!0,l=!1,d=g,u=(c=a/p)+r,y>0)if(this.grid[o-e][n].visible&&!this.grid[o-e][n].blockedSight||this.grid[o-e][n-t].visible&&!this.grid[o-e][n-t].blockedSight){for(let t=0;t<y&&h;++t)if(d<=i[t]&&u>=s[t])if(this.grid[o][n].blockedSight){if(d>=s[t]&&u<=i[t]){h=!1;break}s[t]=Math.min(s[t],d),i[t]=Math.max(i[t],u),l=!0}else if(c>s[t]&&c<i[t]){h=!1;break}}else h=!1;h&&(this.grid[o][n].visible=!0,this.grid[o][n].blockedSight&&(w>=d?w=u:l||(s[m]=d,i[m++]=u)))}}computeOctantX(t,e){const s=[],i=[];let n,o,r,a,h,l,c,d,u,g,p=1,m=0,y=0,w=0;for(n=this.originX+t;n>=this.minX&&n<=this.maxX;n+=t,y=m,++p)for(r=.5/p,g=-1,a=Math.floor(w*p+.5),o=this.originY+a*e;a<=p&&o>=this.minY&&o<=this.maxY;o+=e,++a,g=u){if(h=!0,l=!1,d=g,u=(c=a/p)+r,y>0)if(this.grid[o][n-t].visible&&!this.grid[o][n-t].blockedSight||this.grid[o-e][n-t].visible&&!this.grid[o-e][n-t].blockedSight){for(let t=0;t<y&&h;++t)if(d<=i[t]&&u>=s[t])if(this.grid[o][n].blockedSight){if(d>=s[t]&&u<=i[t]){h=!1;break}s[t]=Math.min(s[t],d),i[t]=Math.max(i[t],u),l=!0}else if(c>s[t]&&c<i[t]){h=!1;break}}else h=!1;h&&(this.grid[o][n].visible=!0,this.grid[o][n].blockedSight&&(w>=d?w=u:l||(s[m]=d,i[m++]=u)))}}}}])},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);!function(t){t[t.HEAD=0]="HEAD",t[t.NECK=1]="NECK",t[t.BACK=2]="BACK",t[t.CHEST=3]="CHEST",t[t.HANDS=4]="HANDS",t[t.LEGS=5]="LEGS",t[t.FEET=6]="FEET",t[t.RING=7]="RING",t[t.MAINHAND=8]="MAINHAND",t[t.OFFHAND=9]="OFFHAND"}(e.EquipmentSlot||(e.EquipmentSlot={}));e.Equipment=class extends i.Item{constructor(t,e,s,i,n,o){super(t,e,s,i,n,!1),this.slot=o,this.bonusArmor=0,this.bonusStrength=0,this.bonusDexterity=0,this.bonusConstitution=0,this.bonusIntelligence=0}onUse(t){const e=t.getEquipment(this.slot);return e&&(t.equipment.remove(e),t.inventory.add(e)),t.inventory.remove(this),t.equipment.add(this),!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(4),o=s(25),r=1367,a=1371;e.Monster=class extends n.StatsActor{constructor(t,e,s,o,r){super(t,e,s,o,r),this.maxHp=10,this.hp=10,this.ai=new i.BasicMonster(this,this.calculateDamage),this.sentiment=n.Sentiment.HOSTILE,this.loot=this.getLoot()}onBump(t){t.attack(this,t.getDamage(this))}onDeath(){this.game.log(this.name+" is dead"),this.blocks=!1,this.ai=void 0,this.name="remains of "+this.name,this.sendToBack();const t=this.game.player,e=Math.round(10*t.level*Math.pow(2,.5*(this.level-t.level)));t.addXp(e),this.game.tileMap.setTile(3,this.x,this.y,this.game.rng.nextRange(r,a));for(let t=0;t<this.loot.length;t++){const e=this.loot[t];e.x=this.x,e.y=this.y,this.game.entities.add(e)}}calculateDamage(t,e){const s=t,i=1+s.level,n=1+Math.round(1.5*s.level),o=s.game.rng.nextRange(i,n+1),r=s.strengthModifier,a=Math.round(.1*e.armor);return Math.max(0,o+r-a)}getLoot(){const t=[];return this.game.rng.nextRange(0,6)<=2&&t.push(new o.Gold(this.game,this.x,this.y)),t}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.CharacterClass=class{constructor(t,e,s,i){this.name=t,this.icon=e,this.description=s,this.details=i}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1);var o;!function(t){t[t.HOSTILE=-1]="HOSTILE",t[t.NEUTRAL=0]="NEUTRAL",t[t.FRIENDLY=1]="FRIENDLY"}(o=e.Sentiment||(e.Sentiment={}));e.StatsActor=class extends i.Actor{constructor(t,e,s,n,r){super(t,e,s,n,r,!0),this.level=1,this.mp=1,this.maxMp=1,this.armor=0,this.strength=10,this.dexterity=10,this.constitution=10,this.intelligence=10,this.showFrame=!0,this.sentiment=o.NEUTRAL,this.equipment=new i.ArrayList,this.buffs=[],this.equipment.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)})}get strengthModifier(){return this.calculateModifier(this.strength)}get dexterityModifier(){return this.calculateModifier(this.dexterity)}get constitutionModifier(){return this.calculateModifier(this.constitution)}get intelligenceModifier(){return this.calculateModifier(this.intelligence)}calculateModifier(t){return Math.floor((t-10)/2)}getEquipment(t){for(let e=0;e<this.equipment.length;e++){const s=this.equipment.get(e);if(s.slot===t)return s}}get mainHandWeapon(){return this.getEquipment(n.EquipmentSlot.MAINHAND)}getDamage(t){const e=this.mainHandWeapon,s=this.game.rng,i=e?s.nextRange(e.minDamage,e.maxDamage+1):1,n=e&&e.finesse?this.dexterityModifier:this.strengthModifier,o=Math.round(.1*t.armor);return Math.max(0,i+n-o)}onAttack(t,e){e>0?this.game.log(this.name+" attacks "+t.name+" for "+e+" hit points.",2155905279):this.game.log(this.name+" attacks "+t.name+" but it has no effect!",2155905279)}startTurn(){super.startTurn();for(let t=this.buffs.length-1;t>=0;t--){const e=this.buffs[t];e.update(),e.isDone()&&this.buffs.splice(t,1)}}addItem(t){this.armor+=t.bonusArmor,this.constitution+=t.bonusConstitution,this.dexterity+=t.bonusDexterity,this.strength+=t.bonusStrength,this.intelligence+=t.bonusIntelligence}removeItem(t){this.armor-=t.bonusArmor,this.constitution-=t.bonusConstitution,this.dexterity-=t.bonusDexterity,this.strength-=t.bonusStrength,this.intelligence-=t.bonusIntelligence}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(31),o=3,r=2,a=i.fromRgb(255,128,128),h=new i.Sprite(720,336,16,24,void 0,void 0,void 0,a),l=[new i.Message("Heroic Leap",i.Colors.WHITE),new i.Message("Instant cast",i.Colors.WHITE),new i.Message("Stun all enemies within 1 tile.",i.Colors.YELLOW)];e.LeapAbility=class{constructor(){this.sprite=h,this.name="leap",this.targetType=i.TargetType.TILE,this.minRange=1,this.maxRange=o,this.cooldown=10,this.tooltipMessages=l}cast(t,e){const s=t.game;if(t.distanceTo(e)>o)return t===s.player&&s.log("Target out of range.",i.Colors.LIGHT_GRAY),!1;if(s.tileMap&&!s.tileMap.isVisible(e.x,e.y))return t===s.player&&s.log("Target not visible.",i.Colors.LIGHT_GRAY),!1;if(s.tileMap&&s.tileMap.isBlocked(e.x,e.y))return t===s.player&&s.log("Target is blocked.",i.Colors.LIGHT_GRAY),!1;if(s.getActorAt(e.x,e.y))return t===s.player&&s.log("Target is occupied.",i.Colors.LIGHT_GRAY),!1;const h=(e.x-t.x)*s.tileSize.width/4,l=(e.y-t.y)*s.tileSize.height/4;return s.addAnimation(new i.SlideAnimation(t,h,l,4)).then(()=>{t.x=e.x,t.y=e.y;let o=0;for(let a=s.entities.length-1;a>=0;a--){const h=s.entities.get(a);h!==t&&h instanceof i.Actor&&h.distanceTo(e)<r&&(h.ai=new n.Stunned(h,3),o++)}o>0&&s.log("Stunned "+o+" foes!",a),t.ap--}),!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(1);e.Weapon=class extends i.Equipment{constructor(){super(...arguments),this.minDamage=1,this.maxDamage=2,this.ranged=!1,this.finesse=!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.CharacterRace=class{constructor(t,e,s,i){this.name=t,this.icon=e,this.description=s,this.details=i}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=5,o=[new i.Message("Lightning",i.Colors.WHITE),new i.Message("10 mana",i.Colors.WHITE),new i.Message("Instant cast",i.Colors.WHITE),new i.Message("Hurls a bolt of lightning at the nearest enemy",i.Colors.YELLOW),new i.Message("dealing 4 + INT damage.",i.Colors.YELLOW)];e.LightningAbility=class{constructor(){this.sprite=new i.Sprite(158,10,16,24,void 0,void 0,void 0,4294902015),this.name="lightning",this.targetType=i.TargetType.SELF,this.minRange=1,this.maxRange=n,this.cooldown=10,this.tooltipMessages=o}cast(t){const e=t.game,s=this.getClosestMonster(e,t,t.x,t.y,n);if(!s)return e.log("No enemy is close enough to strike.",i.Colors.LIGHT_RED),!1;e.log("A lightning bolt strikes the "+s.name+" with a loud thunder!",i.Colors.LIGHT_BLUE);const o=4+t.intelligenceModifier,r=new i.Sprite(256,408,16,24,2,!0,8,i.Colors.YELLOW);return e.addAnimation(new i.ProjectileAnimation(r,new i.Vec2(s.pixelX,s.pixelY),new i.Vec2(0,0),32)).then(()=>{e.log("The damage is "+o+" hit points",i.Colors.LIGHT_BLUE),s.takeDamage(o),t.ap--}),!0}getClosestMonster(t,e,s,n,o){let r=o+1,a=null;for(let o=0;o<t.entities.length;o++){const h=t.entities.get(o);if(h===e)continue;if(!(h instanceof i.Actor))continue;if(t.tileMap&&!t.tileMap.isVisible(h.x,h.y))continue;const l=h.distance(s,n);l<r&&(r=l,a=h)}return a}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(10),o=s(5),r=s(8),a=s(3),h=s(11),l=s(12),c=s(13),d=s(32),u="Paladin",g=new i.Sprite(504,700,24,26,void 0,void 0,void 0,4286611711),p=new i.Sprite(320,96,16,24,2,!0,void 0,4286611711),m="Holy warriors commanding the power of the light",y=[new i.Message("+2 Strength, +2 Intelligence",i.Colors.LIGHT_GREEN),new i.Message("Heroic Leap - jump up to 3 tiles and stun enemies",i.Colors.YELLOW)];e.Paladin=class extends a.CharacterClass{constructor(){super(u,g,m,y)}initPlayer(t){const e=t.game;t.class=this,t.sprite=p,t.talents.add(new i.Talent(t,new o.LeapAbility)),t.talents.add(new i.Talent(t,new r.LightningAbility)),t.talents.add(new i.Talent(t,new n.FlashHealAbility)),t.equipment.add(new h.SquiresVest(e)),t.equipment.add(new l.SquiresPants(e)),t.equipment.add(new c.SquiresBoots(e)),t.equipment.add(new d.BattlewornHammer(e)),t.strength+=2,t.intelligence+=2}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=new i.Sprite(672,144,16,24,1,!1,void 0,4291875071),o=[new i.Message("Flash Heal",i.Colors.WHITE),new i.Message("20 mana",i.Colors.WHITE),new i.Message("A fast spell that heals an ally",i.Colors.YELLOW),new i.Message("for 1d8 + INT points.",i.Colors.YELLOW)];e.FlashHealAbility=class{constructor(){this.sprite=n,this.name="Flash Heal",this.targetType=i.TargetType.SELF,this.minRange=0,this.maxRange=0,this.cooldown=5,this.tooltipMessages=o}cast(t){if(t.hp===t.maxHp)return t===t.game.player&&t.game.log("You are already at full health.",i.Colors.DARK_RED),!1;const e=t.game.rng.nextRange(1,8)+t.intelligenceModifier;return t.takeHeal(e),t.ap--,!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o="Squire's Vest",r=new i.Sprite(608,288,16,24,1,!1,void 0,3231744255),a=[new i.Message(o,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Chest, Plate",i.Colors.WHITE),new i.Message("7 Armor",i.Colors.WHITE)];e.SquiresVest=class extends n.Equipment{constructor(t,e,s){super(t,e||0,s||0,o,r,n.EquipmentSlot.CHEST),this.tooltipMessages=a,this.bonusArmor=7}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o="Squire's Pants",r=new i.Sprite(656,144,16,24,1,!1,void 0,3231744255),a=[new i.Message(o,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Legs, Plate",i.Colors.WHITE),new i.Message("6 Armor",i.Colors.WHITE)];e.SquiresPants=class extends n.Equipment{constructor(t,e,s){super(t,e||0,s||0,o,r,n.EquipmentSlot.LEGS),this.tooltipMessages=a,this.bonusArmor=6}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o="Squire's Boots",r=new i.Sprite(640,144,16,24,1,!1,void 0,3231744255),a=[new i.Message(o,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Feet, Plate",i.Colors.WHITE),new i.Message("5 Armor",i.Colors.WHITE)];e.SquiresBoots=class extends n.Equipment{constructor(t,e,s){super(t,e||0,s||0,o,r,n.EquipmentSlot.FEET),this.tooltipMessages=a,this.bonusArmor=5}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(34),o=10,r=3,a=12,h=i.Colors.ORANGE,l=new i.Sprite(512,336,16,24,void 0,void 0,void 0,h),c=[new i.Message("Fireball",i.Colors.WHITE),new i.Message("2% of base mana",i.Colors.WHITE),new i.Message("2 turn cast",i.Colors.WHITE),new i.Message("Throws a fiery ball causing 10 damage",i.Colors.YELLOW),new i.Message("to all enemies within 3 tiles.",i.Colors.YELLOW)];e.FireballAbility=class{constructor(){this.sprite=l,this.name="fireball",this.targetType=i.TargetType.TILE,this.minRange=1,this.maxRange=o,this.cooldown=30,this.tooltipMessages=c}cast(t,e){const s=t.game,h=t.distanceTo(e);if(h>o)return t===s.player&&s.log("Target out of range.",i.Colors.LIGHT_GRAY),!1;if(s.tileMap&&!s.tileMap.isVisible(e.x,e.y))return t===s.player&&s.log("Target not visible.",i.Colors.LIGHT_GRAY),!1;const c=h*(s.tileSize.width/8),d=(e.x*s.tileSize.width-t.pixelX)/c,u=(e.y*s.tileSize.height-t.pixelY)/c;return t.ap--,s.addAnimation(new i.ProjectileAnimation(l,new i.Vec2(t.pixelX,t.pixelY),new i.Vec2(d,u),c)).then(()=>{s.addAnimation(new n.ExplosionAnimation(s,e,r,30)).then(()=>{s.log("The fireball explodes, burning everything within "+r+" tiles!",i.Colors.ORANGE);for(let t=s.entities.length-1;t>=0;t--){const n=s.entities.get(t);n instanceof i.Actor&&n.distanceTo(e)<=r&&(s.log("The "+n.name+" gets burned for "+a+" hit points.",i.Colors.ORANGE),n.takeDamage(a))}})}),!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o="Acolyte's Pants",r=new i.Sprite(656,144,16,24,1,!1,void 0,3231744255),a=[new i.Message(o,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Legs, Cloth",i.Colors.WHITE),new i.Message("2 Armor",i.Colors.WHITE)];e.AcolytesPants=class extends n.Equipment{constructor(t,e,s){super(t,e||0,s||0,o,r,n.EquipmentSlot.LEGS),this.tooltipMessages=a,this.bonusArmor=2}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o="Acolyte's Robe",r=new i.Sprite(608,288,16,24,1,!1,void 0,3231744255),a=[new i.Message(o,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Chest, Cloth",i.Colors.WHITE),new i.Message("2 Armor",i.Colors.WHITE)];e.AcolytesRobe=class extends n.Equipment{constructor(t,e,s){super(t,e||0,s||0,o,r,n.EquipmentSlot.CHEST),this.tooltipMessages=a,this.bonusArmor=2}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o="Acolyte's Shoes",r=new i.Sprite(640,144,16,24,1,!1,void 0,3231744255),a=[new i.Message(o,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Feet, Cloth",i.Colors.WHITE),new i.Message("1 Armor",i.Colors.WHITE)];e.AcolytesShoes=class extends n.Equipment{constructor(t,e,s){super(t,e||0,s||0,o,r,n.EquipmentSlot.FEET),this.tooltipMessages=a,this.bonusArmor=1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o=s(6),r="Bent Staff",a=new i.Sprite(640,120,16,24,1,!1,void 0,3231744255),h=[new i.Message(r,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Two-Hand Staff",i.Colors.WHITE),new i.Message("1-2 Damage",i.Colors.WHITE)];e.BentStaff=class extends o.Weapon{constructor(t,e,s){super(t,e||0,s||0,r,a,n.EquipmentSlot.MAINHAND),this.tooltipMessages=h}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o="Initiate's Vest",r=new i.Sprite(608,288,16,24,1,!1,void 0,3231744255),a=[new i.Message(o,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Chest, Leather",i.Colors.WHITE),new i.Message("5 Armor",i.Colors.WHITE)];e.InitiatesVest=class extends n.Equipment{constructor(t,e,s){super(t,e||0,s||0,o,r,n.EquipmentSlot.CHEST),this.tooltipMessages=a,this.bonusArmor=5}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o="Initiate's Pants",r=new i.Sprite(656,144,16,24,1,!1,void 0,3231744255),a=[new i.Message(o,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Legs, Leather",i.Colors.WHITE),new i.Message("4 Armor",i.Colors.WHITE)];e.InitiatesPants=class extends n.Equipment{constructor(t,e,s){super(t,e||0,s||0,o,r,n.EquipmentSlot.LEGS),this.tooltipMessages=a,this.bonusArmor=4}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o="Initiate's Boots",r=new i.Sprite(640,144,16,24,1,!1,void 0,3231744255),a=[new i.Message(o,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Feet, Leather",i.Colors.WHITE),new i.Message("3 Armor",i.Colors.WHITE)];e.InitiatesBoots=class extends n.Equipment{constructor(t,e,s){super(t,e||0,s||0,o,r,n.EquipmentSlot.FEET),this.tooltipMessages=a,this.bonusArmor=3}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o=s(6),r="Worn Dirk",a=new i.Sprite(672,96,16,24,1,!1,void 0,3231744255),h=[new i.Message(r,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("One-Hand Dagger",i.Colors.WHITE),new i.Message("1-2 Damage",i.Colors.WHITE)];e.WornDirk=class extends o.Weapon{constructor(t,e,s){super(t,e||0,s||0,r,a,n.EquipmentSlot.MAINHAND),this.tooltipMessages=h,this.finesse=!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.MenuItemRenderer=class{constructor(t,e){this.expandedHeight=t,this.collapsedHeight=e}drawOption(t,e,s,n){const o=t.app;let r=e.x;const a=e.y;let h=i.Colors.GRAY,l=i.Colors.GRAY,c=i.Colors.GRAY;if(n&&(h=void 0,l=i.Colors.YELLOW,c=i.Colors.WHITE),s.icon&&(s.icon.draw(o,r,a,h),r+=s.icon.width+2),o.drawString(s.name,r,a,l),s.description&&o.drawString(s.description,r+3,a+10,c),n&&s.details)for(let t=0;t<s.details.length;t++){const e=s.details[t],h=n?e.color:i.Colors.LIGHT_GRAY;o.drawString(e.text,r+3,a+20+10*t,h)}}getHeight(t,e){return e?this.expandedHeight:this.collapsedHeight}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(7),o="Human",r=new i.Sprite(0,730,34,34,void 0,void 0,void 0,3719193343),a="Young race with lust for power",h=[new i.Message("+1 all attributes",i.Colors.LIGHT_GREEN),new i.Message("Reduced stun times",i.Colors.YELLOW),new i.Message("Hustle - when active, double actions",i.Colors.YELLOW)];e.Human=class extends n.CharacterRace{constructor(){super(o,r,a,h)}initPlayer(t){t.race=this,t.constitution++,t.strength++,t.dexterity++,t.intelligence++}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=new i.Sprite(896,168,16,24,1,!0,void 0,4294902015),o=[new i.Message("Gold",i.Colors.WHITE),new i.Message("The coin of the realm.",i.Colors.WHITE)];e.Gold=class extends i.Item{constructor(t,e,s){super(t,e,s,"gold",n,!1),this.tooltipMessages=o}onPickup(t){this.game.log(t.name+" picked up gold coins",i.Colors.LIGHT_GREEN)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=new i.Sprite(688,168,16,24,1,!0,void 0,4294902015);e.Key=class extends i.Item{constructor(t,e,s,i){super(t,e,s,"key",n,!1),this.keyId=i}onBump(t){t.keys[this.keyId]=!0,t.moveTo(this.x,this.y),this.game.entities.remove(this)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=new i.Sprite(848,168,16,24,1,!0,void 0,2160115967),o=[new i.Message("Hearthstone",i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Use: Returns you to your home.",i.Colors.LIGHT_GREEN),new i.Message("Speak to an Innkeeper in a different",i.Colors.LIGHT_GREEN),new i.Message("place to change your home location.",i.Colors.LIGHT_GREEN)];e.Hearthstone=class extends i.Item{constructor(t,e,s){super(t,e||0,s||0,"Hearthstone",n,!1),this.tooltipMessages=o}onUse(t){return t.game.warpToPoint(t.home),!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=new(s(29).App);window.location.hash&&"#"!==window.location.hash&&(window.location.hash=""),window.addEventListener("hashchange",function(){const t=window.location.hash;"#game"===t?i.startGame():"#chooserace"===t?i.chooseRace():"#chooseclass"===t?i.chooseClass():"#highscores"===t?i.showHighScores():"#credits"===t?i.showCredits():i.showMainMenu()})},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(0),o=s(30),r=s(48),a=s(71),h=s(72),l=s(27);e.App=class extends i.App{constructor(){super({canvas:document.querySelector("canvas"),imageUrl:"graphics.png",size:new n.Rect(0,0,224,400),fillWindow:!0}),this.mainMenu=new a.MainMenu(this),this.raceMenu=new h.RaceMenu(this),this.classMenu=new o.ClassMenu(this),this.highScores=new n.AppState(this),this.credits=new n.AppState(this),this.game=new r.Game(this),this.showMainMenu()}showMainMenu(){this.state=this.mainMenu}chooseRace(){this.state=this.raceMenu}chooseClass(){this.state=this.classMenu}startGame(){this.state=this.game,this.game.player.inventory.add(new l.Hearthstone(this.game)),this.playerRace&&this.playerRace.initPlayer(this.game.player),this.playerClass&&this.playerClass.initPlayer(this.game.player),this.game.addAnimation(new n.FadeInAnimation(30))}showHighScores(){this.state=this.highScores}showCredits(){this.state=this.credits}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(9),o=s(33),r=s(35),a=s(38),h=s(40),l=s(46),c=s(23),d=[new n.Paladin,new o.Priest,new r.Ranger,new a.Rogue,new h.Warlock,new l.Warrior];e.ClassMenu=class extends i.AppState{constructor(t){super(t),this.gui.renderer.baseRect=new i.Rect(0,64,24,24),this.gui.add(new i.MessagePanel(new i.Rect(2,2,256,10),new i.Message("Choose your class",i.Colors.WHITE)));const e=new i.ComplexSelectDialog(new i.Rect(2,15,246,204),d);e.renderer=new c.MenuItemRenderer(60,30),e.onSelect=(t=>{this.app.playerClass=t,window.location.hash="game"}),e.onCancel=(()=>{window.history.back()}),this.gui.add(e)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.Stunned=class extends i.AI{constructor(t,e){super(t),this.numTurns=e,this.oldAi=t.ai}doAi(){this.numTurns>0?this.numTurns--:this.actor.ai=this.oldAi}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o=s(6),r="Battleworn Hammer",a=new i.Sprite(640,96,16,24,1,!1,void 0,3231744255),h=[new i.Message(r,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Two-Hand Mace",i.Colors.WHITE),new i.Message("1-2 Damage",i.Colors.WHITE)];e.BattlewornHammer=class extends o.Weapon{constructor(t,e,s){super(t,e||0,s||0,r,a,n.EquipmentSlot.MAINHAND),this.tooltipMessages=h}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(14),o=s(10),r=s(8),a=s(15),h=s(16),l=s(17),c=s(18),d=s(3),u="Priest",g=new i.Sprite(0,700,24,26,void 0,void 0,void 0,4294967295),p=new i.Sprite(384,96,16,24,2,!0,void 0,4177066239),m="Devoted to the spiritual, powerful healing magic",y=[new i.Message("+5 Intelligence",i.Colors.LIGHT_GREEN),new i.Message("Heroic Leap - jump up to 3 tiles and stun enemies",i.Colors.YELLOW)];e.Priest=class extends d.CharacterClass{constructor(){super(u,g,m,y)}initPlayer(t){const e=t.game;t.class=this,t.sprite=p,t.talents.add(new i.Talent(t,new n.FireballAbility)),t.talents.add(new i.Talent(t,new r.LightningAbility)),t.talents.add(new i.Talent(t,new o.FlashHealAbility)),t.equipment.add(new h.AcolytesRobe(e)),t.equipment.add(new a.AcolytesPants(e)),t.equipment.add(new l.AcolytesShoes(e)),t.equipment.add(new c.BentStaff(e)),t.intelligence+=5}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.ExplosionAnimation=class extends i.Animation{constructor(t,e,s,i){super(i,!0),this.game=t,this.center=e,this.radius=s,this.duration=i,this.sprites=[]}update(){super.update();const t=this.game,e=this.radius*(1-(this.countdown+1)/(this.duration+1)),s=this.center.x*t.tileSize.width,n=this.center.y*t.tileSize.height;for(let o=0;o<3;o++){const r=e,a=this.countdown+o,h=s+t.tileSize.width*r*Math.cos(a),l=n+t.tileSize.height*r*Math.sin(a),c=new i.Sprite(512,336,16,24,4,!1,4,i.Colors.ORANGE),d=new i.ProjectileAnimation(c,new i.Vec2(h,l),new i.Vec2(0,0),16);d.blocking=!1,t.animations.push(d)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(5),o=s(3),r=s(19),a=s(20),h=s(21),l=s(36),c=s(37),d="Ranger",u=new i.Sprite(168,700,24,26,void 0,void 0,void 0,2164228351),g=new i.Sprite(64,120,16,24,2,!0,void 0,2164228351),p="Strategy and finesse, attacking from a distance",m=[new i.Message("+2 Strength, +2 Dexterity",i.Colors.LIGHT_GREEN),new i.Message("Heroic Leap - jump up to 3 tiles and stun enemies",i.Colors.YELLOW)];e.Ranger=class extends o.CharacterClass{constructor(){super(d,u,p,m)}initPlayer(t){const e=t.game;t.class=this,t.sprite=g,t.talents.add(new i.Talent(t,new c.ShootAbility)),t.talents.add(new i.Talent(t,new n.LeapAbility)),t.equipment.add(new r.InitiatesVest(e)),t.equipment.add(new a.InitiatesPants(e)),t.equipment.add(new h.InitiatesBoots(e)),t.equipment.add(new l.WeatheredCrossbow(e)),t.strength+=2,t.dexterity+=2}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o=s(6),r="Weathered Crossbow",a=new i.Sprite(896,96,16,24,1,!1,void 0,3231744255),h=[new i.Message(r,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Ranged Crossbow",i.Colors.WHITE),new i.Message("1-2 Damage",i.Colors.WHITE)];e.WeatheredCrossbow=class extends o.Weapon{constructor(t,e,s){super(t,e||0,s||0,r,a,n.EquipmentSlot.MAINHAND),this.tooltipMessages=h,this.ranged=!0,this.finesse=!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=8,o=new i.Sprite(896,96,16,24,1,!1,void 0,1087426815),r=[new i.Message("Shoot",i.Colors.WHITE),new i.Message("30 yard range",i.Colors.WHITE),new i.Message("Requires a ranged weapon.",i.Colors.WHITE)];e.ShootAbility=class{constructor(){this.sprite=o,this.name="shoot",this.targetType=i.TargetType.ENTITY,this.minRange=1,this.maxRange=n,this.cooldown=3,this.tooltipMessages=r}cast(t,e){const s=t.game,o=t.mainHandWeapon;if(!o||!o.ranged)return t===s.player&&s.log("Shoot requires a ranged weapon.",i.Colors.LIGHT_GRAY),!1;if(t.distanceTo(e)>n)return t===s.player&&s.log("Target out of range.",i.Colors.LIGHT_GRAY),!1;if(s.tileMap&&!s.tileMap.isVisible(e.x,e.y))return t===s.player&&s.log("Target not visible.",i.Colors.LIGHT_GRAY),!1;const r=t.getDamage(e);return e.takeDamage(r),t.ap--,!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(5),o=s(39),r=s(3),a=s(19),h=s(20),l=s(21),c=s(22),d="Rogue",u=new i.Sprite(144,700,24,26,void 0,void 0,void 0,2684354815),g=new i.Sprite(192,96,16,24,2,!0,void 0,2684354815),p="Lethal assasins and masters of stealth",m=[new i.Message("+5 Dexterity",i.Colors.LIGHT_GREEN),new i.Message("Stealth - go invisible for 10 turns",i.Colors.YELLOW),new i.Message("Shadow Strike - sneak attack from a distance",i.Colors.YELLOW)];e.Rogue=class extends r.CharacterClass{constructor(){super(d,u,p,m)}initPlayer(t){const e=t.game;t.class=this,t.sprite=g,t.talents.add(new i.Talent(t,new n.LeapAbility)),t.talents.add(new i.Talent(t,new o.ShadowStrikeAbility)),t.equipment.add(new a.InitiatesVest(e)),t.equipment.add(new h.InitiatesPants(e)),t.equipment.add(new l.InitiatesBoots(e)),t.equipment.add(new c.WornDirk(e)),t.dexterity+=5}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=10,o=new i.Sprite(656,192,16,24,void 0,void 0,void 0,3301229823),r=[new i.Message("Shadow Strike",i.Colors.WHITE),new i.Message("Instant cast",i.Colors.WHITE),new i.Message("Appear behind your target up to 25 yards away,",i.Colors.YELLOW),new i.Message("dealing double damage.",i.Colors.YELLOW)];e.ShadowStrikeAbility=class{constructor(){this.sprite=o,this.name="Shadow Strike",this.targetType=i.TargetType.ENTITY,this.minRange=1,this.maxRange=n,this.cooldown=10,this.tooltipMessages=r}cast(t,e){const s=t.game;if(t.distanceTo(e)>n)return t===s.player&&s.log("Target out of range.",i.Colors.LIGHT_GRAY),!1;if(s.tileMap&&!s.tileMap.isVisible(e.x,e.y))return t===s.player&&s.log("Target not visible.",i.Colors.LIGHT_GRAY),!1;let o=null,r=0;for(let n=e.y-1;n<=e.y+1;n++)for(let a=e.x-1;a<=e.x+1;a++){if(Math.hypot(a-e.x,n-e.y)>1.001)continue;if(s.isBlocked(a,n))continue;const h=t.distance(a,n);h>r&&(o=new i.Vec2(a,n),r=h)}if(!o)return t===s.player&&s.log("No free spaces available.",i.Colors.LIGHT_GRAY),!1;const a=(o.x-t.x)*s.tileSize.width/4,h=(o.y-t.y)*s.tileSize.height/4;return s.addAnimation(new i.SlideAnimation(t,a,h,4)).then(()=>{t.x=o.x,t.y=o.y,t.attack(e,2*t.getDamage(e)),t.ap--}),!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(41),o=s(44),r=s(8),a=s(15),h=s(16),l=s(17),c=s(18),d=s(3),u="Warlock",g=new i.Sprite(24,700,24,26,void 0,void 0,void 0,2686492927),p=new i.Sprite(416,96,16,24,2,!0,void 0,2686492927),m="Practitioners of the dark arts",y=[new i.Message("+2 Constitution, +2 Intelligence",i.Colors.LIGHT_GREEN),new i.Message("Demonic Gateway - teleport by dark magic",i.Colors.YELLOW)];e.Warlock=class extends d.CharacterClass{constructor(){super(u,g,m,y)}initPlayer(t){const e=t.game;t.class=this,t.sprite=p,t.talents.add(new i.Talent(t,new n.CurseAbility)),t.talents.add(new i.Talent(t,new r.LightningAbility)),t.talents.add(new i.Talent(t,new o.DemonicGatewayAbility)),t.equipment.add(new h.AcolytesRobe(e)),t.equipment.add(new a.AcolytesPants(e)),t.equipment.add(new l.AcolytesShoes(e)),t.equipment.add(new c.BentStaff(e)),t.constitution+=2,t.intelligence+=2}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(42),o=8,r=new i.Sprite(880,144,16,24,1,!1,void 0,3225469183),a=[new i.Message("Curse",i.Colors.WHITE),new i.Message("20 mana",i.Colors.WHITE),new i.Message("Instant cast",i.Colors.WHITE),new i.Message("Corrupts the target, causing (1 + INT) / 4",i.Colors.YELLOW),new i.Message("damage per turn for 8 turns.",i.Colors.YELLOW)];e.CurseAbility=class{constructor(){this.sprite=r,this.name="Curse",this.targetType=i.TargetType.ENTITY,this.minRange=1,this.maxRange=o,this.cooldown=3,this.tooltipMessages=a}cast(t,e){const s=t.game;if(t.distanceTo(e)>o)return t===s.player&&s.log("Target out of range.",i.Colors.LIGHT_GRAY),!1;if(s.tileMap&&!s.tileMap.isVisible(e.x,e.y))return t===s.player&&s.log("Target not visible.",i.Colors.LIGHT_GRAY),!1;const r=Math.round((1+t.intelligenceModifier)/4);return e.buffs.push(new n.Curse(e,r,8)),t.ap--,!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(43);e.Curse=class extends i.Buff{constructor(t,e,s){super(t),this.damage=e,this.countdown=s}update(){this.countdown>0&&(this.actor.takeDamage(this.damage),this.countdown--)}isDone(){return this.countdown<=0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Buff=class{constructor(t){this.actor=t}update(){}isDone(){return!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(45),o=10,r=new i.Sprite(432,408,16,24,1,!0,void 0,3285193471),a=[new i.Message("Demonic Gateway",i.Colors.WHITE),new i.Message("20 mana",i.Colors.WHITE),new i.Message("2 turn cast",i.Colors.WHITE),new i.Message("Creates a demonic gateway between two",i.Colors.YELLOW),new i.Message("locations. User can transport to the other gateway.",i.Colors.YELLOW)];e.DemonicGatewayAbility=class{constructor(){this.sprite=r,this.name="Demonic Gateway",this.targetType=i.TargetType.TILE,this.minRange=1,this.maxRange=o,this.cooldown=10,this.tooltipMessages=a}cast(t,e){const s=t.game;if(t.distanceTo(e)>o)return t===s.player&&s.log("Target out of range.",i.Colors.LIGHT_GRAY),!1;if(s.tileMap&&!s.tileMap.isVisible(e.x,e.y))return t===s.player&&s.log("Target not visible.",i.Colors.LIGHT_GRAY),!1;const r=new n.Gateway(s,t.x,t.y,t),a=new n.Gateway(s,e.x,e.y,t);return r.other=a,a.other=r,s.entities.add(r),s.entities.add(a),t.move(e.x-t.x,e.y-t.y,16),t.ap--,!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=new i.Sprite(432,408,16,24,1,!0,void 0,3285193471);e.Gateway=class extends i.Item{constructor(t,e,s,i){super(t,e,s,"gateway",n,!1),this.owner=i,this.zIndex=0}onBump(t){const e=this.other;e&&t.move(e.x-t.x,e.y-t.y,16)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(5),o=s(3),r=s(11),a=s(12),h=s(13),l=s(47),c=s(22),d="Warrior",u=new i.Sprite(216,700,24,26,void 0,void 0,void 0,2151678207),g=new i.Sprite(0,96,16,24,2,!0,void 0,4291779839),p="Lords of war, strength, and combat",m=[new i.Message("+5 Strength, +2 Constitution",i.Colors.LIGHT_GREEN),new i.Message("Heroic Leap - jump up to 3 tiles and stun enemies",i.Colors.YELLOW)];e.Warrior=class extends o.CharacterClass{constructor(){super(d,u,p,m)}initPlayer(t){const e=t.game;t.class=this,t.sprite=g,t.talents.add(new i.Talent(t,new n.LeapAbility)),t.equipment.add(new r.SquiresVest(e)),t.equipment.add(new a.SquiresPants(e)),t.equipment.add(new h.SquiresBoots(e)),t.equipment.add(new l.WornGreatsword(e)),t.inventory.add(new c.WornDirk(e)),t.constitution+=2,t.strength+=5}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o=s(6),r="Worn Greatsword",a=new i.Sprite(624,96,16,24,1,!1,void 0,3231744255),h=[new i.Message(r,i.Colors.WHITE),new i.Message("Item Level 1",i.Colors.YELLOW),new i.Message("Two-Hand Sword",i.Colors.WHITE),new i.Message("1-2 Damage",i.Colors.WHITE)];e.WornGreatsword=class extends o.Weapon{constructor(t,e,s){super(t,e||0,s||0,r,a,n.EquipmentSlot.MAINHAND),this.tooltipMessages=h}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(0),o=s(49),r=s(50),a=s(51),h=s(52),l=s(53),c=s(69),d=s(70),u=s(27),g=s(25),p=new n.Sprite(16,40,16,24);e.Game=class extends i.Game{constructor(t){super(t,{tileSize:new n.Rect(0,0,16,24),horizontalViewDistance:8,verticalViewDistance:6}),this.targetSprite=p,this.cooldownSprite=new n.Sprite(192,16,16,24,24),this.blackoutRect=new n.Rect(0,40,16,16),this.gui.renderer.baseRect=new n.Rect(0,64,24,24),this.mapGen=new l.MapGenerator(this);const e=new o.Player(this,30,20);this.player=e,this.entities.add(e),this.gui.renderer.baseRect=new n.Rect(0,16,24,24),this.gui.renderer.buttonSlotRect=new n.Rect(64,16,20,28),this.messageLog=new n.MessageLog(new n.Rect(1,-84,100,50)),this.gui.add(this.messageLog),this.log("Welcome stranger! Prepare to perish!",n.Colors.DARK_RED);const s=new h.TopPanel(e);this.gui.add(s);const i=new r.BottomPanel;this.gui.add(i),this.gui.add(new d.EntityFrames(this));const m=new n.Button(new n.Rect(0,0,20,28),new n.Sprite(832,168,16,24,1,!0,30,3766493439),void 0,()=>{x.visible=!x.visible,_.visible=!1,v.visible=!1});m.tooltipMessages=[new n.Message("Traveler's Backpack",n.Colors.GREEN),new n.Message("Item Level 55",n.Colors.YELLOW),new n.Message("16 Slot Bag",n.Colors.WHITE),new n.Message("Sell Price: 87 coins",n.Colors.WHITE)],i.inventorySlot.add(m);const y=new n.Button(new n.Rect(0,0,20,28),new n.Sprite(640,240,16,24,void 0,void 0,void 0,4291779839),void 0,()=>{v.visible=!v.visible,x.visible=!1,_.visible=!1});y.tooltipMessages=[new n.Message("Character",n.Colors.WHITE),new n.Message("Currently equipped items,",n.Colors.YELLOW),new n.Message("stats and abilities.",n.Colors.YELLOW)],s.characterSlot.add(y);const w=new n.Button(new n.Rect(0,0,20,28),new n.Sprite(656,360,16,24,void 0,void 0,void 0,n.Colors.LIGHT_BLUE),void 0,()=>{_.visible=!_.visible,x.visible=!1,v.visible=!1});w.tooltipMessages=[new n.Message("Talents",n.Colors.WHITE),new n.Message("A list of all of your",n.Colors.YELLOW),new n.Message("character's talents.",n.Colors.YELLOW)],s.talentsSlot.add(w);const f=new n.Button(new n.Rect(0,0,20,28),new n.Sprite(352,672,16,24,void 0,void 0,void 0,n.Colors.LIGHT_GRAY),void 0,()=>{window.location.hash="menu"});f.tooltipMessages=[new n.Message("Main Menu",n.Colors.WHITE)],s.menuSlot.add(f);const x=new n.ItemContainerDialog(new n.Rect(4,38,94,126),[new n.Message("Traveler's Backpack",n.Colors.GREEN),new n.Message("Click an item to use",n.Colors.LIGHT_GRAY),new n.Message("Drag for shortcut",n.Colors.LIGHT_GRAY)],16,e.inventory);x.visible=!1,this.gui.add(x);const v=new a.CharacterDialog(new n.Rect(4,38,120,126),e);v.visible=!1,this.gui.add(v);const _=new n.TalentsDialog(new n.Rect(4,38,94,126),[new n.Message("Talents",n.Colors.GREEN),new n.Message("Click an ability to use",n.Colors.LIGHT_GRAY),new n.Message("Drag for shortcut",n.Colors.LIGHT_GRAY)],16,e.talents);_.visible=!1,this.gui.add(_);const T=new c.LevelUpDialog(new n.Rect(4,38,140,126),e);T.visible=!1,this.gui.add(T),this.levelUpDialog=T,e.inventory.addListener({onAdd:(t,s)=>{s instanceof u.Hearthstone||s instanceof g.Gold||i.shortcutBar.addItem(e.inventory,s,!0)},onRemove:()=>{}}),e.talents.addListener({onAdd:(t,e)=>{i.shortcutBar.addTalent(e)},onRemove:()=>{}}),this.mapGen.createMap()}warpToPoint(t){this.addAnimation(new n.FadeOutAnimation(30)).then(()=>{this.player&&(this.player.x=t.x,this.player.y=t.y),this.stopAutoWalk(),this.resetViewport(),this.recomputeFov(),this.addAnimation(new n.FadeInAnimation(30))})}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(9),o=s(24),r=s(4),a=new i.Sprite(0,96,16,24,2,!0,void 0,4291779839);e.Player=class extends r.StatsActor{constructor(t,e,s){super(t,e,s,"Player",a),this.level=1,this.hp=10,this.maxHp=10,this.xp=0,this.maxXp=20,this.race=new o.Human,this.class=new n.Paladin,this.remainingAbilityPoints=0,this.home=new i.Vec2(e,s),this.keys=new Array(1e3)}onDeath(){this.game.log("You died!")}addXp(t){this.xp+=t,this.addFloatingText("+"+t,i.Colors.LIGHT_MAGENTA);let e=!1;for(;this.xp>=this.maxXp;)this.level++,this.maxHp+=2,this.hp=this.maxHp,this.xp=0,this.maxXp=this.nextMaxXp(this.maxXp),this.remainingAbilityPoints+=2,this.game.log("You reached level "+this.level,i.Colors.LIGHT_MAGENTA),e=!0;e&&(this.game.levelUpDialog.visible=!0)}nextMaxXp(t){return 10*Math.round(1.5*t/10)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.BottomPanel=class extends i.Panel{constructor(){super(new i.Rect(0,-43,400,43)),this.add(new i.ShortcutBar(new i.Rect(0,0,144,28),6)),this.add(new i.ButtonSlot(new i.Rect(100,0,20,28),i.Keys.VK_I))}get shortcutBar(){return this.children.get(0)}get inventorySlot(){return this.children.get(this.children.length-1)}drawContents(){if(!this.gui)return;const t=this.gui.app,e=t.size.height-43;t.drawImage(0,e,48,16,16,48,void 0,t.size.width,48);for(let e=0;e<this.children.length;e++)this.children.get(e).rect.y=t.size.height-31;this.inventorySlot.rect.x=t.size.width-22,this.drawChildren()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(1),o=4,r=2;e.CharacterDialog=class extends i.Dialog{constructor(t,e){super(t),this.player=e,this.modal=!0;for(let t=0;t<10;t++)this.add(new i.ButtonSlot(new i.Rect(0,0,24,24)));e.equipment.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)})}get headSlot(){return this.children.get(0)}get neckSlot(){return this.children.get(1)}get backSlot(){return this.children.get(2)}get chestSlot(){return this.children.get(3)}get handsSlot(){return this.children.get(4)}get legsSlot(){return this.children.get(5)}get feetSlot(){return this.children.get(6)}get ringSlot(){return this.children.get(7)}get mainHandSlot(){return this.children.get(8)}get offHandSlot(){return this.children.get(9)}addItem(t){const e=this.getSlot(t);e&&e.add(new i.ItemButton(e.rect.clone(),this.player.inventory,t))}removeItem(t){const e=this.getSlot(t);if(e){const t=e.button;t&&e.remove(t)}}getSlot(t){switch(t.slot){case n.EquipmentSlot.HEAD:return this.headSlot;case n.EquipmentSlot.NECK:return this.neckSlot;case n.EquipmentSlot.BACK:return this.backSlot;case n.EquipmentSlot.CHEST:return this.chestSlot;case n.EquipmentSlot.HANDS:return this.handsSlot;case n.EquipmentSlot.LEGS:return this.legsSlot;case n.EquipmentSlot.FEET:return this.feetSlot;case n.EquipmentSlot.RING:return this.ringSlot;case n.EquipmentSlot.MAINHAND:return this.mainHandSlot;case n.EquipmentSlot.OFFHAND:return this.offHandSlot;default:return}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect,s=(t.x1+t.x2)/2|0,n=t.x+o;let a=t.y+o;this.gui.app.drawCenteredString("ORYX THE BRAVE",s,a,i.Colors.WHITE),a+=10;const h="Level "+this.player.level+" "+this.player.race.name+" "+this.player.class.name;this.gui.app.drawCenteredString(h,s,a,i.Colors.WHITE),a+=10,this.player.sprite.draw(this.gui.app,s-8,a+32);for(let t=0;t<4;t++){const s=this.children.get(t);s.rect.x=n,s.rect.y=a+t*(e.height+r),s.rect.width=e.width,s.rect.height=e.height}for(let s=0;s<4;s++){const i=this.children.get(4+s);i.rect.x=t.x2-o-e.width,i.rect.y=a+s*(e.height+r),i.rect.width=e.width,i.rect.height=e.height}this.mainHandSlot.rect.x=s-e.width-1,this.mainHandSlot.rect.y=a+90,this.mainHandSlot.rect.width=e.width,this.mainHandSlot.rect.height=e.height,this.offHandSlot.rect.x=s+1,this.offHandSlot.rect.y=a+90,this.offHandSlot.rect.width=e.width,this.offHandSlot.rect.height=e.height,a+=4*(e.height+r)+o,this.gui.app.drawString("Armor",n+2,a,i.Colors.YELLOW),this.gui.app.drawRightString(this.player.armor.toString(),n+85,a,i.Colors.WHITE),a+=10,this.gui.app.drawString("Constitution",n+2,a,i.Colors.YELLOW),this.gui.app.drawRightString(this.player.constitution.toString(),n+85,a,i.Colors.WHITE),this.gui.app.drawString("+"+this.player.constitutionModifier,n+95,a,i.Colors.LIGHT_GREEN),a+=10,this.gui.app.drawString("Strength",n+2,a,i.Colors.YELLOW),this.gui.app.drawRightString(this.player.strength.toString(),n+85,a,i.Colors.WHITE),this.gui.app.drawString("+"+this.player.strengthModifier,n+95,a,i.Colors.LIGHT_GREEN),a+=10,this.gui.app.drawString("Dexterity",n+2,a,i.Colors.YELLOW),this.gui.app.drawRightString(this.player.dexterity.toString(),n+85,a,i.Colors.WHITE),this.gui.app.drawString("+"+this.player.dexterityModifier,n+95,a,i.Colors.LIGHT_GREEN),a+=10,this.gui.app.drawString("Intelligence",n+2,a,i.Colors.YELLOW),this.gui.app.drawRightString(this.player.intelligence.toString(),n+85,a,i.Colors.WHITE),this.gui.app.drawString("+"+this.player.intelligenceModifier,n+95,a,i.Colors.LIGHT_GREEN),a+=10,this.rect.height=a+o-t.y,this.drawChildren()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.TopPanel=class extends i.Panel{constructor(t){super(new i.Rect(0,0,400,42)),this.player=t,this.add(new i.ButtonSlot(new i.Rect(0,3,20,28),i.Keys.VK_C)),this.add(new i.ButtonSlot(new i.Rect(0,3,20,28),i.Keys.VK_N)),this.add(new i.ButtonSlot(new i.Rect(0,3,20,28),i.Keys.VK_QUESTION_MARK)),this.add(new i.ButtonSlot(new i.Rect(0,3,20,28),i.Keys.VK_Q))}get characterSlot(){return this.children.get(0)}get talentsSlot(){return this.children.get(1)}get inspectSlot(){return this.children.get(2)}get menuSlot(){return this.children.get(3)}drawContents(){if(!this.gui)return;const t=this.gui.app;t.drawImage(0,0,32,22,16,42,void 0,t.size.width,42),t.drawString("Oryx the Brave".toUpperCase(),1,1,i.Colors.WHITE),t.drawImage(2,12,128,16,12,12),t.drawString(this.player.hp.toString(),16,15),t.drawImage(38,12,144,16,12,12),t.drawString("88",52,15),t.drawImage(74,12,160,16,12,12),t.drawString("88",88,15);for(let e=0;e<this.children.length;e++)this.children.get(e).rect.x=t.size.width-24*(4-e);this.drawChildren()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(54),o=s(14),r=s(8),a=s(55),h=s(56),l=s(57),c=s(58),d=s(59),u=s(60),g=s(61),p=s(62),m=s(64),y=s(65),w=s(66),f=s(67),x=s(26),v=s(68),_=512,T=512,E=256,M=256,A=64,S=48,C=0,b=q(0,3),I=q(0,19),R=q(0,20),L=q(1,20),P=q(2,20),K=q(13,17),O=q(0,18),H=q(15,27),D=q(28,22),V=q(29,22),W=q(30,22),G=q(31,22),k=q(7,20),N=q(14,18),B=q(15,18),F=q(24,19),U=q(16,20),Y=q(0,17),j=q(22,23),z=q(18,17);function q(t,e){return 1+64*e+t}const X=6,Z=10,Q=4,J=8,$=10,tt=3,et=2,st=4,it=new i.Sprite(700,500,16,24,1),nt=[{bossZone:new i.Rect(0,0,A,10),bossRoom:new i.Rect(8,2,14,8),stairsRoom:new i.Rect(2,4,4,4)},{bossZone:new i.Rect(0,0,A,10),bossRoom:new i.Rect(A-22,2,14,8),stairsRoom:new i.Rect(A-6,4,4,4)},{bossZone:new i.Rect(0,S-10,A,10),bossRoom:new i.Rect(8,S-10,14,8),stairsRoom:new i.Rect(2,S-10+2,4,4)},{bossZone:new i.Rect(0,S-10,A,10),bossRoom:new i.Rect(A-22,S-10,14,8),stairsRoom:new i.Rect(A-6,S-10+2,4,4)}];e.MapGenerator=class{constructor(t){this.nextKeyId=0,this.game=t;const e=new i.TileMap(t.app.gl,_,T,4);e.tileWidth=16,e.tileHeight=24,t.tileMap=e}createMap(){this.createOverworld();const t=[];for(let e=0;e<10;e++){const s=_-A,n=e*S,o=new w.Dungeon(new i.Rect(s,n,A,S),e);this.createDungeon(o),t.push(o)}const e=this.game,s=e.player,n=new i.Sprite(528,408,16,24,1,!1,void 0,16777215),o=new y.Portal(e,s.x+4,s.y,"portal",n),r=t[0].entrance;o.other=r,r.other=o,e.entities.add(o),e.entities.add(r);for(let e=1;e<10;e++){const s=t[e-1].exit,i=t[e].entrance;s.other=i,i.other=s}this.touchUp(this.game.tileMap)}createOverworld(){const t=this.game,e=t.tileMap,s=t.player,n=t.rng,o=new i.Rect(0,0,E,M),r=new i.Rect(4,4,E-8,M-8);this.clearMap(e,o,O,!0,!1),this.clearMap(e,r,Y,!1,!1),s.x=E/2|0,s.y=M/2|0,s.home.x=s.x,s.home.y=s.y;const h=new i.Vec2(0,0);for(h.y=o.y1;h.y<o.y2;h.y++)for(h.x=o.x1;h.x<o.x2;h.x++)r.contains(h)||e.setAnimated(h.x,h.y,0,!0);this.createRiver(e,r,5e3);for(let t=s.y-4;t<=s.y+4;t++)for(let i=s.x-4;i<=s.x+4;i++)e.setTile(0,i,t,Y,!1),e.setAnimated(i,t,0,!1);for(let t=0;t<1e3;t++){const t=n.nextRange(r.x1,r.x2),i=n.nextRange(r.y1,r.y2);t===s.x&&i===s.y||e.getTile(t,i)!==Y||(e.setTile(0,t,i,Y,!0),e.setTile(1,t,i,j))}const l=this.createCastle(e),u=i.computePath(e,s,l.getCenter(),1e4);if(u)for(let t=0;t<u.length;t++)e.getTile(u[t].x,u[t].y)===Y&&e.setTile(1,u[t].x,u[t].y,z);else console.log("eek! no path!");for(let i=0;i<500;i++){const i=n.nextRange(r.x1+1,r.x2-2),o=n.nextRange(r.y1+1,r.y2-2);if(e.getTile(i,o)!==Y||e.isBlocked(i,o))continue;if(t.getEntityAt(i,o))continue;const h=Math.hypot(i-s.x,o-s.y);if(h<20)continue;const l=n.nextRange(0,100),u=Math.round((h-20)/10)+n.nextRange(1,3);let g=null;g=l<40?new c.Spider(t,i,o,u):l<80?new a.Bat(t,i,o,u):new d.Troll(t,i,o,u),t.entities.add(g)}const g=new i.Sprite(528,408,16,24,1,!1,void 0,4278255615),p=new y.Portal(t,s.x+2,s.y,"portal",g),m=new y.Portal(t,35,35,"portal",g);p.other=m,m.other=p,t.entities.add(p),t.entities.add(m);const w=new f.LockedDoor(t,s.x-2,s.y,0);t.entities.add(w);const v=new x.Key(t,s.x,s.y-2,0);t.entities.add(v),t.resetViewport(),t.recomputeFov()}createCastle(t){const e=this.game,s=e.rng,n=s.nextRange(20,40),o=s.nextRange(15,30),r=s.nextRange(10,E-10-n),a=s.nextRange(10,M-10-o),h=new i.Rect(r,a,n,o),l=h.getCenter(),c=h,d=new i.Rect(h.x+2,h.y+2,h.width-4,h.height-4),u=new i.Rect(d.x+1,d.y+1,d.width-2,d.height-2);for(let e=c.y1;e<c.y2;e++)for(let s=c.x1;s<c.x2;s++)t.setTile(0,s,e,O,!0,!1),t.setTile(1,s,e,C),t.setAnimated(s,e,0,!0);for(let e=d.y1;e<d.y2;e++)for(let s=d.x1;s<d.x2;s++)t.setTile(0,s,e,K,!1),t.setAnimated(s,e,0,!1);for(let e=d.x1;e<d.x2;e++)t.setTile(0,e,d.y1,I,!0),t.setTile(0,e,d.y2-1,I,!0);for(let e=d.y1;e<d.y2;e++)t.setTile(0,d.x1,e,I,!0),t.setTile(0,d.x2-1,e,I,!0);for(let e=c.y1-1;e<c.y1+3;e++)for(let s=l.x-1;s<=l.x;s++)t.setTile(0,s,e,H,!1),t.setTile(1,s,e,C),t.setAnimated(s,e,0,!1);for(let e=c.y2-3;e<c.y2+1;e++)for(let s=l.x-1;s<=l.x;s++)t.setTile(0,s,e,H,!1),t.setTile(1,s,e,C),t.setAnimated(s,e,0,!1);for(let e=l.y-1;e<=l.y;e++)for(let s=c.x1-1;s<c.x1+3;s++)t.setTile(0,s,e,H,!1),t.setTile(1,s,e,C),t.setAnimated(s,e,0,!1);for(let e=l.y-1;e<=l.y;e++)for(let s=c.x2-3;s<c.x2+1;s++)t.setTile(0,s,e,H,!1),t.setTile(1,s,e,C),t.setAnimated(s,e,0,!1);for(let t=0;t<10;t++){const t=[new i.Vec2(s.nextRange(u.x1,u.x2),s.nextRange(u.y1,u.y2))];for(let e=1;e<4;e++){const n=t[e-1];0===s.nextRange(0,2)?t.push(new i.Vec2(n.x,s.nextRange(u.y1,u.y2))):t.push(new i.Vec2(s.nextRange(u.x1,u.x2),n.y))}const n=new m.Guard(e,t[0].x,t[0].y,t);e.entities.add(n)}return h}createDungeon(t){const e=this.game,s=e.tileMap,n=e.rng,o=this.nextKeyId++;this.clearMap(s,t.rect,I,!0,!0),this.createRiver(s,t.rect,200);for(let e=t.rect.x1;e<t.rect.x2;e++)s.setTile(0,e,t.rect.y1,C,!0),s.setAnimated(e,t.rect.y1,0,!1),s.setTile(0,e,t.rect.y2-1,C,!0),s.setAnimated(e,t.rect.y2-1,0,!1);for(let e=t.rect.y1;e<t.rect.y2;e++)s.setTile(0,t.rect.x1,e,C,!0),s.setAnimated(t.rect.x1,e,0,!1),s.setTile(0,t.rect.x2-1,e,C,!0),s.setAnimated(t.rect.x2-1,e,0,!1);const r=nt[n.nextRange(0,nt.length)],a=new i.Rect(r.bossZone.x+t.rect.x,r.bossZone.y+t.rect.y,r.bossZone.width,r.bossZone.height),l=new i.Rect(r.bossRoom.x+t.rect.x,r.bossRoom.y+t.rect.y,r.bossRoom.width,r.bossRoom.height),c=new i.Rect(r.stairsRoom.x+t.rect.x,r.stairsRoom.y+t.rect.y,r.stairsRoom.width,r.stairsRoom.height);for(;t.rooms.length<$;){const o=n.nextRange(X,Z),r=n.nextRange(Q,J),h=n.nextRange(t.rect.x1+2,t.rect.x2-o-3),l=n.nextRange(t.rect.y1+2,t.rect.y2-r-3),c=new i.Rect(h,l,o,r);let d=c.intersects(a);for(let e=0;e<t.rooms.length;e++)if(c.intersects(t.rooms[e])){d=!0;break}if(d)continue;this.createRoom(s,c);const u=c.getCenter();if(0===t.rooms.length)t.entrance=new y.Portal(e,u.x,u.y,"stairs",it),e.entities.add(t.entrance),s.setTile(0,u.x,u.y,B);else{const e=t.rooms[t.rooms.length-1].getCenter();1===n.nextRange(0,1)?(this.createHTunnel(s,e.x,u.x,e.y),this.createVTunnel(s,e.y,u.y,u.x)):(this.createVTunnel(s,e.y,u.y,e.x),this.createHTunnel(s,e.x,u.x,u.y)),this.placeMonsters(c,t.level)}this.placeItems(c),t.rooms.push(c)}{this.createRoom(s,l);const i=t.rooms[t.rooms.length-1].getCenter(),r=l.getCenter();this.createHTunnel(s,i.x,r.x,i.y),this.createVTunnel(s,i.y,r.y,r.x);const a=3*t.level+5;let d=void 0;(d=0!==n.nextRange(0,1e3)?new p.RedDragon(e,r.x,r.y,a,l):new h.Griffon(e,r.x,r.y,a)).loot=[new x.Key(e,d.x,d.y,o)],e.entities.add(d),r.y>i.y?(s.setTile(0,r.x,l.y1,k,!1,!0),e.entities.add(new v.BossDoor(e,r.x,l.y1,d))):(s.setTile(0,r.x,l.y2,k,!1,!0),e.entities.add(new v.BossDoor(e,r.x,l.y2,d))),this.createRoom(s,c);const u=c.getCenter();this.createHTunnel(s,r.x,u.x,u.y),s.setTile(0,u.x,u.y,N),t.exit=new y.Portal(e,u.x,u.y,"stairs",it),e.entities.add(t.exit),r.x>u.x?(s.setTile(0,l.x1,r.y,k,!1,!0),e.entities.add(new f.LockedDoor(e,l.x1,r.y,o))):(s.setTile(0,l.x2,r.y,k,!1,!0),e.entities.add(new f.LockedDoor(e,l.x2,r.y,o)))}for(let e=0;e<t.rooms.length;e++)this.placeObstacles(t.rooms[e]);e.resetViewport(),e.recomputeFov()}clearMap(t,e,s,i,n){for(let o=e.y1;o<e.y2;o++)for(let r=e.x1;r<e.x2;r++){t.setTile(0,r,o,s,i,n),t.setAnimated(r,o,0,!1);for(let e=1;e<4;e++)t.setTile(e,r,o,C),t.setAnimated(r,o,e,!1)}}createRoom(t,e){for(let s=e.y1+1;s<e.y2;s++)for(let i=e.x1+1;i<e.x2;i++)t.setTile(0,i,s,K,!1),t.setAnimated(i,s,0,!1)}createHTunnel(t,e,s,i){for(let n=Math.min(e,s);n<=Math.max(e,s);n++){const e=t.getTile(n,i);e!==B&&e!==N&&(e===O?t.setTile(0,n,i,H,!1):t.setTile(0,n,i,K,!1),t.setAnimated(n,i,0,!1))}}createVTunnel(t,e,s,i){for(let n=Math.min(e,s);n<=Math.max(e,s);n++){const e=t.getTile(i,n);e!==B&&e!==N&&(e===O?t.setTile(0,i,n,H,!1):t.setTile(0,i,n,K,!1),t.setAnimated(i,n,0,!1))}}placeMonsters(t,e){const s=this.game,i=s.rng,n=i.nextRange(0,tt);for(let o=0;o<n;o++){const n=i.nextRange(t.x1+1,t.x2-1),o=i.nextRange(t.y1+1,t.y2-1);if(s.getEntityAt(n,o))continue;const r=i.nextRange(0,100),h=2*e+i.nextRange(1,3);let l=null;l=r<40?new c.Spider(s,n,o,h):r<80?new a.Bat(s,n,o,h):new d.Troll(s,n,o,h),s.entities.add(l)}}placeItems(t){const e=this.game,s=e.rng,i=s.nextRange(0,et);for(let a=0;a<i;a++){const i=s.nextRange(t.x1+1,t.x2-1),a=s.nextRange(t.y1+1,t.y2-1);if(e.getEntityAt(i,a))continue;const h=s.nextRange(0,100);let l=null;l=h<50?new u.HealthPotion(e,i,a):h<70?new g.Scroll(e,i,a,new r.LightningAbility):h<85?new g.Scroll(e,i,a,new o.FireballAbility):new g.Scroll(e,i,a,new n.ConfuseAbility),e.entities.add(l)}}placeObstacles(t){const e=this.game,s=e.rng,i=e.tileMap,n=s.nextRange(0,st+1);for(let o=0;o<n;o++){const n=s.nextRange(t.x1+2,t.x2-3),o=s.nextRange(t.y1+2,t.y2-3);e.getEntityAt(n,o)||(s.nextRange(0,100)<80?(i.setTile(0,n,o,K,!0,!1),i.setTile(1,n,o,F)):(i.setTile(0,n,o,K,!0,!1),i.setTile(1,n,o,U)))}}createRiver(t,e,s){const i=this.game.rng,n=e.getCenter();for(let o=0;o<s;o++)if(t.setTile(0,n.x,n.y,O,!0,!1),t.setTile(0,n.x-1,n.y,O,!0,!1),t.setTile(0,n.x+1,n.y,O,!0,!1),t.setTile(0,n.x,n.y-1,O,!0,!1),t.setTile(0,n.x,n.y+1,O,!0,!1),t.setAnimated(n.x,n.y,0,!0),t.setAnimated(n.x-1,n.y,0,!0),t.setAnimated(n.x+1,n.y,0,!0),t.setAnimated(n.x,n.y-1,0,!0),t.setAnimated(n.x,n.y+1,0,!0),n.x+=i.nextRange(-1,2),n.y+=i.nextRange(-1,2),!e.contains(n))return}touchUp(t){const e=this.game,s=e.rng;for(let i=0;i<T;i++)for(let n=0;n<_;n++){const o=t.getTile(n,i),r=t.getTile(n,i+1),a=t.getTile(n-1,i),h=t.getTile(n+1,i),c=t.getTile(n,i-1);if(o===K&&a===I&&c===R&&0===s.nextRange(0,4)&&t.setTile(1,n,i,D),o===K&&h===I&&c===R&&0===s.nextRange(0,4)&&t.setTile(1,n,i,V),o===K&&a===I&&r===I&&0===s.nextRange(0,4)&&t.setTile(1,n,i,W),o===K&&h===I&&r===I&&0===s.nextRange(0,4)&&t.setTile(1,n,i,G),o===k&&r!==I&&t.setTile(2,n,i+1,b),o===I&&r!==I&&r!==k){const e=s.nextRange(0,20);0===e?t.setTile(0,n,i,L,!0):1===e?t.setTile(0,n,i,P,!0):t.setTile(0,n,i,R,!0),t.setTile(2,n,i+1,b)}o!==O&&r===O&&t.setTile(2,n,i+1,b);const d=r===H||a===H||h===H||c===H;o===O&&d&&1===s.nextRange(0,20)&&e.entities.add(new l.Shark(e,n,i))}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=8,o=new i.Sprite(128,32,16,24,3,!1),r=[new i.Message("Confuse",i.Colors.WHITE),new i.Message("20 mana",i.Colors.WHITE),new i.Message("Befuddles an enemy into a random",i.Colors.YELLOW),new i.Message("stupor for 10 turns.",i.Colors.YELLOW)];e.ConfuseAbility=class{constructor(){this.sprite=o,this.name="confuse",this.targetType=i.TargetType.ENTITY,this.minRange=1,this.maxRange=n,this.cooldown=1,this.tooltipMessages=r}cast(t,e){const s=t.game;return t.distanceTo(e)>n?(t===s.player&&s.log("Target out of range.",i.Colors.LIGHT_GRAY),!1):s.tileMap&&!s.tileMap.isVisible(e.x,e.y)?(t===s.player&&s.log("Target not visible.",i.Colors.LIGHT_GRAY),!1):(e.ai=new i.ConfusedMonster(e),s.log("The eyes of the "+e.name+" look vacant, as he stumbles around!",i.Colors.LIGHT_GREEN),t.ap--,!0)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(2),o=new i.Sprite(192,144,16,24,2,!0,void 0,1733810687),r=8;class a extends i.AI{doAi(){const t=this.actor,e=t.game.player;if(!e)return;const s=e.game.rng;t.distanceTo(e)<3&&s.nextRange(0,100)<33?t.attack(e,r):this.actor.move(s.nextRange(-2,3),s.nextRange(-2,3))}}e.Bat=class extends n.Monster{constructor(t,e,s,i){super(t,e,s,"Bat",o),this.ai=new a(this),this.level=i,this.strength=10+2*i,this.maxHp=10+2*i,this.hp=this.maxHp,this.armor=2*i}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(5),o=s(2),r=s(4),a=new i.Sprite(448,144,16,24,2,!0,void 0,4075971071),h=10;class l extends i.AI{doAi(){const t=this.actor,e=t.game,s=e.player;if(!s||s.hp<=0)return;const i=t.leapTalent;if(0===i.cooldown){const n=this.findLeapTarget(e,t,s);if(n&&i.use(n))return}if(t.distanceTo(s)<=2)t.attack(s,h);else if(t.sentiment===r.Sentiment.HOSTILE)t.moveToward(s.x,s.y);else{const e=s.game.rng;t.move(e.nextRange(-1,2),e.nextRange(-1,2))}}findLeapTarget(t,e,s){for(let i=s.y-1;i<=s.y+1;i++)for(let n=s.x-1;n<=s.x+1;n++){const s=t.tileMap&&t.tileMap.getCell(n,i);if(s&&!s.blocked&&!(e.distanceTo(s)>3||t.getActorAt(n,i)))return s}}}e.Griffon=class extends o.Monster{constructor(t,e,s,o){super(t,e,s,"Griffon",a),this.level=o,this.maxHp=10*this.level,this.hp=this.maxHp,this.ai=new l(this),this.talents.add(new i.Talent(this,new n.LeapAbility)),this.sentiment=r.Sentiment.NEUTRAL}get leapTalent(){return this.talents.get(0)}takeDamage(t){super.takeDamage(t),this.sentiment=r.Sentiment.HOSTILE}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(2),o=new i.Sprite(0,168,16,24,2,!0,void 0,1469102079),r=10;class a extends i.AI{doAi(){const t=this.actor,e=t.game.player;e&&t.distanceTo(e)<2&&t.attack(e,r)}}e.Shark=class extends n.Monster{constructor(t,e,s){super(t,e,s,"Shark",o),this.ai=new a(this)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(2),o=new i.Sprite(64,144,16,24,2,!0,void 0,551964671);e.Spider=class extends n.Monster{constructor(t,e,s,i){super(t,e,s,"Spider",o),this.level=i,this.strength=10+2*i,this.maxHp=10+2*i,this.hp=this.maxHp,this.armor=2*i}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(2),o=new i.Sprite(64,216,16,24,2,!0,void 0,551964671);e.Troll=class extends n.Monster{constructor(t,e,s,i){super(t,e,s,"Troll",o),this.level=i,this.strength=10+2*i,this.maxHp=10+2*i,this.hp=this.maxHp,this.armor=2*i}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=4,o=new i.Sprite(656,168,16,24,1,!0,void 0,4278190335),r=[new i.Message("Ancient Healing Potion",i.Colors.LIGHT_BLUE),new i.Message("Item Level 5",i.Colors.YELLOW),new i.Message("Use: Restore 10 health",i.Colors.LIGHT_GREEN)];e.HealthPotion=class extends i.Item{constructor(t,e,s){super(t,e,s,"health potion",o,!1),this.tooltipMessages=r}onPickup(t){this.game.log(t.name+" picked up a "+this.name,i.Colors.LIGHT_GREEN)}onUse(t){return t.hp===t.maxHp?(this.game.log("You are already at full health.",i.Colors.DARK_RED),!1):(this.game.log("Your wounds start to feel better!",i.Colors.LIGHT_MAGENTA),t.takeHeal(n),t.inventory.remove(this),t.ap--,!0)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=new i.Sprite(736,168,16,24,1,!0,void 0,4042318079);e.Scroll=class extends i.Item{constructor(t,e,s,i){super(t,e,s,"scroll of "+i.name,n,!1),this.ability=i,this.tooltipMessages=i.tooltipMessages}onPickup(t){this.game.log(t.name+" picked up a "+this.name,i.Colors.LIGHT_GREEN)}onUse(t){const e=this.ability;return e.targetType===i.TargetType.SELF?e.cast(t)&&t.inventory.remove(this):this.game.startTargeting(e,()=>{t.inventory.remove(this)}),!0}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(2),o=s(63),r=s(4),a=s(26),h=new i.Sprite(576,312,16,24,2,!0,void 0,3574665727),l=10;class c extends i.AI{doAi(){const t=this.actor,e=t.game,s=e.player;if(s&&!(s.hp<=0))if(t.sentiment!==r.Sentiment.HOSTILE||0!==t.cooldown)t.cooldown>0&&t.cooldown--,t.distanceTo(s)<=2&&t.attack(s,l);else{const s=t.room,i=e.rng;for(let t=s.x1+1;t<s.x2-1;t++)0===i.nextRange(0,2)?e.entities.add(new o.FlameCrawler(e,t,s.y1+1,0,1)):e.entities.add(new o.FlameCrawler(e,t,s.y2-1,0,-1));for(let t=s.y1+1;t<s.y2-1;t++)0===i.nextRange(0,2)?e.entities.add(new o.FlameCrawler(e,s.x1+1,t,1,0)):e.entities.add(new o.FlameCrawler(e,s.x2-1,t,-1,0));t.cooldown=10}}}e.RedDragon=class extends n.Monster{constructor(t,e,s,i,n){super(t,e,s,"Dragon",h),this.cooldown=0,this.room=n,this.level=i,this.maxHp=10*i,this.hp=this.maxHp,this.ai=new c(this),this.sentiment=r.Sentiment.NEUTRAL}takeDamage(t){super.takeDamage(t),this.sentiment=r.Sentiment.HOSTILE}getLoot(){return[new a.Key(this.game,this.x,this.y,0)]}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(2),o=new i.Sprite(256,312,16,24,2,!0,void 0,3574665727),r=8;class a extends i.AI{constructor(t){super(t),this.alwaysActive=!0,this.aliveCount=0}doAi(){const t=this.actor,e=t.game.player;if(!e||e.hp<=0)return;if(this.aliveCount++,1===this.aliveCount)return;const s=t.x+t.dx,i=t.y+t.dy;e.x===s&&e.y===i?t.attack(e,r):t.move(t.dx,t.dy)||t.game.entities.remove(t)}}e.FlameCrawler=class extends n.Monster{constructor(t,e,s,i,n){super(t,e,s,"Flame Crawler",o),this.ai=new a(this),this.hp=this.maxHp=5,this.dx=i,this.dy=n,this.showFrame=!1,this.seen=!0,this.blocks=!1}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(2),o=s(4),r=new i.Sprite(320,96,16,24,2,!0,void 0,1469102079);class a extends i.AI{constructor(t,e){super(t),this.waypoints=e,this.waypointIndex=0,this.waitCount=0,this.aggroCount=0}doAi(){const t=this.actor,e=t.game.player;if(t.aggro){if(this.aggroCount++,1===this.aggroCount){const e=t.game;e.log("Guard shouts for help!",i.Colors.LIGHT_BLUE);for(let s=0;s<e.entities.length;s++){const i=e.entities.get(s);if(i instanceof h){const e=i;t.distanceTo(e)<6&&(e.aggro=!0)}}}else if(t.distanceTo(e)>1)t.moveToward(e.x,e.y);else if(e.hp>0){const s=10;t.attack(e,s)}return}if(this.waitCount>0)return void this.waitCount--;const s=this.waypoints[this.waypointIndex];if(t.x===s.x&&t.y===s.y)return this.waypointIndex=(this.waypointIndex+1)%this.waypoints.length,void(this.waitCount=t.game.rng.nextRange(5,15));t.moveToward(s.x,s.y)}}class h extends n.Monster{constructor(t,e,s,i){super(t,e,s,"Guard",r),this.aggro=!1,this.ai=new a(this,i),this.seen=!0,this.level=10,this.strength=10+2*this.level,this.maxHp=10+2*this.level,this.hp=this.maxHp,this.sentiment=o.Sentiment.FRIENDLY}takeDamage(t){super.takeDamage(t),this.aggro=!0}}e.Guard=h},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0);e.Portal=class extends i.Item{constructor(t,e,s,i,n){super(t,e,s,i,n,!1),this.zIndex=0,this.fade=!1}onBump(t){const e=this.other;e&&this.game.warpToPoint(e)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Dungeon=class{constructor(t,e){this.rect=t,this.level=e,this.rooms=[]}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=new i.Sprite(256,432,16,24,1,!0,void 0,2151686399);e.LockedDoor=class extends i.Item{constructor(t,e,s,i){super(t,e,s,"door",n,!0),this.keyId=i,this.zIndex=0}onBump(t){t.keys[this.keyId]&&(this.game.entities.remove(this),t.moveTo(this.x,this.y))}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=new i.Sprite(256,432,16,24,1,!0,void 0,2151686399);e.BossDoor=class extends i.Item{constructor(t,e,s,i){super(t,e,s,"door",n,!0),this.boss=i,this.zIndex=0}onBump(t){if(this.boss.hp<=0&&(this.game.entities.remove(this),t.moveTo(this.x,this.y)),(this.x-t.x)*(this.boss.x-t.x)+(this.y-t.y)*(this.boss.y-t.y)>0){const e=this.x-t.x,s=this.y-t.y;t.move(2*e,2*s)}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=5,o=2,r=new i.Sprite(688,144,16,24,1,!1,void 0,3225428223),a=new i.Sprite(640,144,16,24,1,!1,void 0,3225428223),h=new i.Sprite(688,168,16,24,1,!1,void 0,3225428223),l=new i.Sprite(608,312,16,24,1,!1,void 0,3225428223),c=[[new i.Message("Constitution",i.Colors.YELLOW),new i.Message("Health, staminal,",i.Colors.WHITE),new i.Message("and vital force",i.Colors.WHITE)],[new i.Message("Dexterity",i.Colors.YELLOW),new i.Message("Physical agility, reflexes,",i.Colors.WHITE),new i.Message("balance, and poise",i.Colors.WHITE)],[new i.Message("Intelligence",i.Colors.YELLOW),new i.Message("Mental acuity, recall,",i.Colors.WHITE),new i.Message("and analytical skill",i.Colors.WHITE)],[new i.Message("Strength",i.Colors.YELLOW),new i.Message("Natural athleticism,",i.Colors.WHITE),new i.Message("and bodily power",i.Colors.WHITE)]];e.LevelUpDialog=class extends i.Dialog{constructor(t,e){super(t),this.player=e,this.modal=!0;const s=new i.ButtonSlot(new i.Rect(0,0,24,24),i.Keys.VK_1),n=new i.Button(new i.Rect(0,0,16,24),r,void 0,()=>this.incConstitution());s.add(n),this.add(s);const o=new i.ButtonSlot(new i.Rect(0,0,24,24),i.Keys.VK_2),c=new i.Button(new i.Rect(0,0,16,24),a,void 0,()=>this.incDexterity());o.add(c),this.add(o);const d=new i.ButtonSlot(new i.Rect(0,0,24,24),i.Keys.VK_3),u=new i.Button(new i.Rect(0,0,16,24),h,void 0,()=>this.incIntelligence());d.add(u),this.add(d);const g=new i.ButtonSlot(new i.Rect(0,0,24,24),i.Keys.VK_4),p=new i.Button(new i.Rect(0,0,16,24),l,void 0,()=>this.incStrength());g.add(p),this.add(g)}incConstitution(){this.increaseStat(1,0,0,0)}incDexterity(){this.increaseStat(0,1,0,0)}incIntelligence(){this.increaseStat(0,0,1,0)}incStrength(){this.increaseStat(0,0,0,1)}increaseStat(t,e,s,i){this.player.constitution+=t,this.player.dexterity+=e,this.player.intelligence+=s,this.player.strength+=i,this.player.remainingAbilityPoints--,0===this.player.remainingAbilityPoints&&(this.visible=!1)}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect,s=t.x+n;let r=t.y+n;this.gui.app.drawString("Leveled up!",s,r,i.Colors.WHITE),r+=10,this.gui.app.drawString("Choose "+this.player.remainingAbilityPoints+" stats to increase:",s,r,i.Colors.WHITE),r+=10;for(let t=0;t<4;t++){const i=c[t];for(let t=0;t<i.length;t++)this.gui.app.drawString(i[t].text,s+25,r+1+8*t,i[t].color);const n=this.children.get(t);n.rect.x=s,n.rect.y=r,n.rect.width=e.width,n.rect.height=e.height,r+=e.height+o}this.rect.height=r+n-t.y,this.drawChildren()}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(4);e.EntityFrames=class extends i.Panel{constructor(t){super(new i.Rect(0,40,40,200)),this.game=t}drawContents(){if(!this.gui)return;const t=this.game.blackoutRect;if(!t)return;const e=this.gui.app,s=this.game.player,o=this.game.entities;let r=40;for(let a=0;a<o.length;a++){const h=o.get(a);if(h===this.game.player||!(h instanceof n.StatsActor))continue;const l=h;if(!l.showFrame||l.visibleDuration<0)continue;e.drawImage(2,r,64,48,54,18);let c=i.Colors.YELLOW;l.sentiment===n.Sentiment.FRIENDLY?c=i.Colors.LIGHT_GREEN:l.sentiment===n.Sentiment.HOSTILE&&(c=i.Colors.RED),e.drawCenteredString(l.name,22,r+1,c);const d=Math.round(38*l.hp/l.maxHp);e.drawImage(3,r+9,t.x,t.y,t.width,t.height,i.Colors.DARK_GREEN,d,7),e.drawCenteredString(l.hp+"/"+l.maxHp,22,r+9,i.Colors.WHITE);let u=i.Colors.YELLOW;l.level>s.level+3?u=i.Colors.RED:l.level>s.level+1?u=i.Colors.ORANGE:l.level<s.level-3?u=i.Colors.LIGHT_GREEN:l.level<s.level-1&&(u=3152954623),e.drawCenteredString(l.level.toString(),49,r+5,u),r+=24}}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=[{display:"NEW GAME",hash:"chooserace",enabled:!0},{display:"CONTINUE",hash:"game",enabled:!1},{display:"ENTER SEED",hash:"seed",enabled:!0},{display:"TUTORIAL",hash:"tutorial",enabled:!0},{display:"HIGH SCORES",hash:"highscores",enabled:!0},{display:"CREDITS",hash:"credits",enabled:!0}];e.MainMenu=class extends i.AppState{constructor(t){super(t),this.selectedIndex=0,this.time=0,this.sprites=[],this.chooseSprites()}chooseSprites(){this.sprites=[];for(let t=0;t<4;t++){const t=32*Math.floor(19*Math.random()),e=96+24*Math.floor(13*Math.random()),s=i.fromHsv(Math.random(),.9,.5);this.sprites.push(new i.Sprite(t,e,16,24,2,!0,void 0,s))}}update(){i.Sprite.updateGlobalAnimations();const t=this.time%300;t<80&&t%8==0&&this.chooseSprites(),this.app.drawImage(this.app.center.x-128,0,0,800,256,128),this.app.drawCenteredString("KOPI LUWAK DUNGEON",this.app.center.x+1,33,i.Colors.BLACK),this.app.drawCenteredString("KOPI LUWAK DUNGEON",this.app.center.x,32);for(let t=0;t<4;t++){const e=this.app.center.x-56+32*t,s=52;this.sprites[t].draw(this.app,e,s)}const e=this.app.mouse;for(let t=0;t<n.length;t++){const s=n[t],o=this.app.center.x,r=90+15*t;let a=i.Colors.WHITE;s.enabled?t===this.selectedIndex&&(a=i.Colors.YELLOW):a=i.Colors.GRAY,this.app.drawCenteredString(s.display,o+1,r+1,i.Colors.BLACK),this.app.drawCenteredString(s.display,o,r,a),e.y>=r&&e.y<r+14&&e.isClicked()&&(window.location.hash=s.hash),t===this.selectedIndex&&this.app.isKeyPressed(i.Keys.VK_ENTER)&&(window.location.hash=s.hash)}this.app.isKeyPressed(i.Keys.VK_UP)&&this.selectedIndex--,this.app.isKeyPressed(i.Keys.VK_DOWN)&&this.selectedIndex++,this.selectedIndex<0&&(this.selectedIndex+=n.length),this.selectedIndex>=n.length&&(this.selectedIndex-=n.length),this.time++}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(23),o=s(73),r=s(74),a=s(24),h=s(75),l=s(76),c=[new a.Human,new o.Dwarf,new r.Elf,new h.Orc,new l.Undead];e.RaceMenu=class extends i.AppState{constructor(t){super(t),this.gui.renderer.baseRect=new i.Rect(0,64,24,24),this.gui.add(new i.MessagePanel(new i.Rect(2,2,256,10),new i.Message("Choose your race",i.Colors.WHITE)));const e=new i.ComplexSelectDialog(new i.Rect(2,15,246,204),c);e.renderer=new n.MenuItemRenderer(60,40),e.onSelect=(t=>{this.app.playerRace=t,window.location.hash="chooseclass"}),e.onCancel=(()=>{window.history.back()}),this.gui.add(e)}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(7),o="Dwarf",r=new i.Sprite(510,730,34,34,void 0,void 0,void 0,1082179839),a="Bold and hardy, skilled warriors",h=[new i.Message("+4 Constitution, +2 Strength",i.Colors.LIGHT_GREEN),new i.Message("Critical strike bonus",i.Colors.YELLOW),new i.Message("Stoneform - Removes all curses",i.Colors.YELLOW)];e.Dwarf=class extends n.CharacterRace{constructor(){super(o,r,a,h)}initPlayer(t){t.race=this,t.constitution+=4,t.strength+=2}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(7),o="Elf",r=new i.Sprite(238,730,34,34,void 0,void 0,void 0,4286611711),a="Magical people of otherworldly grace",h=[new i.Message("+3 Dexterity, +3 Intelligence",i.Colors.LIGHT_GREEN),new i.Message("Shadowmeld - slip into the shadows",i.Colors.YELLOW)];e.Elf=class extends n.CharacterRace{constructor(){super(o,r,a,h)}initPlayer(t){t.race=this,t.dexterity+=3,t.intelligence+=3}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(7),o="Orc",r=new i.Sprite(442,730,34,34,void 0,void 0,void 0,548413695),a="Noble savages of shamanistic roots",h=[new i.Message("+2 Constitution, +4 Strength",i.Colors.LIGHT_GREEN),new i.Message("War Shout - Boost all stats by +1 for 5 turns",i.Colors.YELLOW)];e.Orc=class extends n.CharacterRace{constructor(){super(o,r,a,h)}initPlayer(t){t.race=this,t.constitution+=2,t.strength+=4}}},function(t,e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const i=s(0),n=s(7),o="Undead",r=new i.Sprite(578,730,34,34,void 0,void 0,void 0,3493908735),a="Cursed to wander for eternity",h=[new i.Message("+2 Dexterity, +4 Intelligence",i.Colors.LIGHT_GREEN),new i.Message("Cannibalize - 10% of damage returns as health",i.Colors.YELLOW)];e.Undead=class extends n.CharacterRace{constructor(){super(o,r,a,h)}initPlayer(t){t.race=this,t.dexterity+=2,t.intelligence+=4}}}]);
//# sourceMappingURL=index.js.map