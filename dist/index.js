!function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=23)}([function(t,e,i){window,t.exports=function(t){var e={};function i(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,i),n.l=!0,n.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(s,n,function(e){return t[e]}.bind(null,n));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=41)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(27);e.Serializable=function(t,e){return function(i){const n=s.createSerializeMetadata(i);n.className=t,e&&(n.valueType=!!e.valueType)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);class n extends s.Vec2{constructor(t,e,i,s){super(t,e),this.width=i,this.height=s}get x1(){return this.x}get y1(){return this.y}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get left(){return this.x}get top(){return this.y}clone(){return new n(this.x,this.y,this.width,this.height)}copy(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height}getCenter(){return new s.Vec2(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.x<=this.x2&&t.y>=this.y&&t.y<=this.y2}}e.Rect=n},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});let n=class{constructor(t,e){this.x=t,this.y=e}add(t){this.x+=t.x,this.y+=t.y}};n=s([i(0).Serializable("Vec2",{valueType:!0})],n),e.Vec2=n},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(8);let r=class{constructor(t){this.gui=null,this.rect=t,this.children=new n.ArrayList,this.modal=!1,this.visible=!0}setGui(t){if(!this.gui){this.gui=t;for(let e=0;e<this.children.length;e++)this.children.get(e).setGui(t)}}add(t){t.parent=this,t.setGui(this.gui),this.children.add(t)}remove(t){this.children.remove(t)}move(t){this.parent&&this.parent.remove(this),t.add(this)}getPanelAt(t){for(let e=this.children.length-1;e>=0;e--){const i=this.children.get(e);if(!i.visible)continue;if(i.isDragging())continue;const s=i.getPanelAt(t);if(s)return s}if(this.rect.contains(t))return this}drawContents(){this.drawChildren()}drawChildren(){for(let t=0;t<this.children.length;t++){const e=this.children.get(t);e.visible&&e.drawContents()}}handleInput(){return this.handleChildrenInput()}handleChildrenInput(){for(let t=this.children.length-1;t>=0;t--){const e=this.children.get(t);if(e.visible&&(e.handleInput()||e.modal))return!0}return!1}isDragging(){return this.gui&&this.gui.dragElement===this}onDrop(t){return!1}updateTooltip(t){t.visible=!1}};r=s([i(0).Serializable("Panel")],r),e.Panel=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});class s{}s.VK_CANCEL=3,s.VK_HELP=6,s.VK_BACK_SPACE=8,s.VK_TAB=9,s.VK_CLEAR=12,s.VK_ENTER=13,s.VK_SHIFT=16,s.VK_CONTROL=17,s.VK_ALT=18,s.VK_PAUSE=19,s.VK_CAPS_LOCK=20,s.VK_ESCAPE=27,s.VK_SPACE=32,s.VK_PAGE_UP=33,s.VK_PAGE_DOWN=34,s.VK_END=35,s.VK_HOME=36,s.VK_LEFT=37,s.VK_UP=38,s.VK_RIGHT=39,s.VK_DOWN=40,s.VK_PRINTSCREEN=44,s.VK_INSERT=45,s.VK_DELETE=46,s.VK_0=48,s.VK_1=49,s.VK_2=50,s.VK_3=51,s.VK_4=52,s.VK_5=53,s.VK_6=54,s.VK_7=55,s.VK_8=56,s.VK_9=57,s.VK_COLON=58,s.VK_SEMICOLON=59,s.VK_LESS_THAN=60,s.VK_EQUALS=61,s.VK_GREATER_THAN=62,s.VK_QUESTION_MARK=63,s.VK_AT=64,s.VK_A=65,s.VK_B=66,s.VK_C=67,s.VK_D=68,s.VK_E=69,s.VK_F=70,s.VK_G=71,s.VK_H=72,s.VK_I=73,s.VK_J=74,s.VK_K=75,s.VK_L=76,s.VK_M=77,s.VK_N=78,s.VK_O=79,s.VK_P=80,s.VK_Q=81,s.VK_R=82,s.VK_S=83,s.VK_T=84,s.VK_U=85,s.VK_V=86,s.VK_W=87,s.VK_X=88,s.VK_Y=89,s.VK_Z=90,s.VK_CONTEXT_MENU=93,s.VK_NUMPAD0=96,s.VK_NUMPAD1=97,s.VK_NUMPAD2=98,s.VK_NUMPAD3=99,s.VK_NUMPAD4=100,s.VK_NUMPAD5=101,s.VK_NUMPAD6=102,s.VK_NUMPAD7=103,s.VK_NUMPAD8=104,s.VK_NUMPAD9=105,s.VK_MULTIPLY=106,s.VK_ADD=107,s.VK_SEPARATOR=108,s.VK_SUBTRACT=109,s.VK_DECIMAL=110,s.VK_DIVIDE=111,s.VK_F1=112,s.VK_F2=113,s.VK_F3=114,s.VK_F4=115,s.VK_F5=116,s.VK_F6=117,s.VK_F7=118,s.VK_F8=119,s.VK_F9=120,s.VK_F10=121,s.VK_F11=122,s.VK_F12=123,s.VK_F13=124,s.VK_F14=125,s.VK_F15=126,s.VK_F16=127,s.VK_F17=128,s.VK_F18=129,s.VK_F19=130,s.VK_F20=131,s.VK_F21=132,s.VK_F22=133,s.VK_F23=134,s.VK_F24=135,s.VK_NUM_LOCK=144,s.VK_SCROLL_LOCK=145,s.VK_CIRCUMFLEX=160,s.VK_EXCLAMATION=161,s.VK_DOUBLE_QUOTE=162,s.VK_HASH=163,s.VK_DOLLAR=164,s.VK_PERCENT=165,s.VK_AMPERSAND=166,s.VK_UNDERSCORE=167,s.VK_OPEN_PAREN=168,s.VK_CLOSE_PAREN=169,s.VK_ASTERISK=170,s.VK_PLUS=171,s.VK_PIPE=172,s.VK_HYPHEN_MINUS=173,s.VK_OPEN_CURLY_BRACKET=174,s.VK_CLOSE_CURLY_BRACKET=175,s.VK_TILDE=176,s.VK_COMMA=188,s.VK_PERIOD=190,s.VK_SLASH=191,s.VK_BACK_QUOTE=192,s.VK_OPEN_BRACKET=219,s.VK_BACK_SLASH=220,s.VK_CLOSE_BRACKET=221,s.VK_QUOTE=222,s.VK_META=224,s.VK_ALTGR=225,s.VK_WIN=91,s.VK_KANA=21,s.VK_HANGUL=21,s.VK_EISU=22,s.VK_JUNJA=23,s.VK_FINAL=24,s.VK_HANJA=25,s.VK_KANJI=25,s.VK_CONVERT=28,s.VK_NONCONVERT=29,s.VK_ACCEPT=30,s.VK_MODECHANGE=31,s.VK_SELECT=41,s.VK_PRINT=42,s.VK_EXECUTE=43,s.VK_SLEEP=95,e.Keys=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(42);e.Animation=class{constructor(t,e){this.promise=new s.AnimationPromise,this.countdown=t,this.blocking=e}isDone(){return this.countdown<=0}update(){this.countdown--}draw(t){}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11);class n{}n.BLACK=s.fromRgb(0,0,0),n.WHITE=s.fromRgb(255,255,255),n.GRAY=s.fromRgb(128,128,128),n.LIGHT_GRAY=s.fromRgb(170,170,170),n.DARK_GRAY=s.fromRgb(85,85,85),n.YELLOW=s.fromRgb(255,255,85),n.BROWN=s.fromRgb(170,85,0),n.RED=s.fromRgb(255,0,0),n.LIGHT_RED=s.fromRgb(255,85,85),n.DARK_RED=s.fromRgb(170,0,0),n.GREEN=s.fromRgb(0,255,0),n.LIGHT_GREEN=s.fromRgb(85,255,85),n.DARK_GREEN=s.fromRgb(0,170,0),n.LIGHT_CYAN=s.fromRgb(85,255,255),n.DARK_CYAN=s.fromRgb(0,170,170),n.BLUE=s.fromRgb(0,0,255),n.LIGHT_BLUE=s.fromRgb(85,85,255),n.DARK_BLUE=s.fromRgb(0,0,170),n.LIGHT_MAGENTA=s.fromRgb(255,85,255),n.DARK_MAGENTA=s.fromRgb(170,0,170),n.ORANGE=s.fromRgb(255,136,0),e.Colors=n},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(4),r=i(3);let o=class extends r.Panel{constructor(t){super(t),this.closeButton=!1}drawContents(){this.gui&&this.gui.renderer.draw(this.gui.app,this)}handleInput(){if(!this.gui)return!1;if(this.handleChildrenInput())return!0;if(this.gui.app.isKeyPressed(n.Keys.VK_ESCAPE))return this.visible=!1,!0;const t=this.gui.app.mouse;return!(!t.isClicked()||this.rect.contains(t)||(this.visible=!1,0))}close(){this.gui&&this.gui.remove(this)}};o=s([i(0).Serializable("Dialog")],o),e.Dialog=o},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});let n=class{constructor(){this.elements=[]}get length(){return this.elements.length}clear(){this.elements.splice(0,this.elements.length)}get(t){return this.elements[t]}add(t){if(this.elements.push(t),this.listeners)for(let e=0;e<this.listeners.length;e++)this.listeners[e].onAdd(this,t)}remove(t){const e=this.elements.indexOf(t);if(e>=0&&(this.elements.splice(e,1),this.listeners))for(let e=0;e<this.listeners.length;e++)this.listeners[e].onRemove(this,t)}contains(t){return this.elements.indexOf(t)>=0}addListener(t){this.listeners||(this.listeners=[]),this.listeners.push(t)}};n=s([i(0).Serializable("ArrayList")],n),e.ArrayList=n},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(6),r=i(13);let o=class extends r.Button{constructor(t,e,i){super(t,e.ability.sprite),this.talent=e,this.shortcut=!!i,this.tooltipMessages=e.ability.tooltipMessages}click(){this.talent.use()}drawContents(){if(super.drawContents(),this.talent.cooldown>0){const t=this.talent.actor.game,e=t.cooldownSprite;if(e){const i=1-this.talent.cooldown/this.talent.ability.cooldown,s=Math.round(i*e.frames),r=e.x+s*e.width,o=e.y,a=this.rect.x+(this.rect.width-e.width)/2|0,h=this.rect.y+(this.rect.height-e.height)/2|0;t.app.drawImage(a,h,r,o,e.width,e.height);const l=this.rect.x+this.rect.width/2|0,c=this.rect.y+this.rect.height/2|0;t.app.drawCenteredString(this.talent.cooldown.toString(),l+1,c-2,n.Colors.BLACK),t.app.drawCenteredString(this.talent.cooldown.toString(),l,c-3,n.Colors.WHITE)}}}};o=s([i(0).Serializable("TalentButton")],o),e.TalentButton=o},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(8),r=i(13);let o=class extends r.Button{constructor(t,e,i){super(t,i.sprite),this.containerItems=e,this.stackItems=new n.ArrayList,this.stackItems.add(i),this.tooltipMessages=i.tooltipMessages}click(){if(this.stackItems.length>0){const t=this.stackItems.get(0),e=t.game.player;e&&e.use(t)}}removeAll(){for(let t=this.stackItems.length-1;t>=0;t--)this.containerItems.remove(this.stackItems.get(t))}drawContents(){if(this.gui&&(super.drawContents(),this.stackItems.length>1)){const t=this.rect;this.gui.app.drawRightString(this.stackItems.length.toString(),t.x2-3,t.y2-10)}}updateTooltip(t){if(this.stackItems.length>0){const t=this.stackItems.get(0);t.onUpdateTooltip(),this.tooltipMessages=t.tooltipMessages}super.updateTooltip(t)}};o=s([i(0).Serializable("ItemButton")],o),e.ItemButton=o},function(t,e,i){"use strict";function s(t,e,i,s){return void 0===s&&(s=255),(t<<24)+(e<<16)+(i<<8)+s}Object.defineProperty(e,"__esModule",{value:!0}),e.fromRgb=s,e.fromHsv=function(t,e,i,n){const r=6*t|0,o=6*t-r,a=i*(1-e),h=i*(1-o*e),l=i*(1-(1-o)*e);let c,d,u;switch(r%6){case 0:c=i,d=l,u=a;break;case 1:c=h,d=i,u=a;break;case 2:c=a,d=i,u=l;break;case 3:c=a,d=h,u=i;break;case 4:c=l,d=a,u=i;break;case 5:c=i,d=a,u=h;break;default:c=0,d=0,u=0}return void 0===n&&(n=1),s(255*c|0,255*d|0,255*u|0,255*n|0)}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(13);let r=class extends n.Button{constructor(t,e,i){super(t,i.sprite),this.containerItems=e,this.shortcutItem=i,this.tooltipMessages=i.tooltipMessages}click(){const t=this.getItem();if(t){const e=t.game.player;e&&e.use(t)}}drawContents(){if(this.gui&&(super.drawContents(),!this.isDragging())){const t=this.rect,e=this.countItems();this.gui.app.drawRightString(e.toString(),t.x2-3,t.y2-10)}}getItem(){for(let t=0;t<this.containerItems.length;t++){const e=this.containerItems.get(t);if(this.shortcutItem.isStackable(e))return e}}countItems(){let t=0;for(let e=0;e<this.containerItems.length;e++)this.shortcutItem.isStackable(this.containerItems.get(e))&&t++;return t}};r=s([i(0).Serializable("ItemShortcutButton")],r),e.ItemShortcutButton=r},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3);let r=class extends n.Panel{constructor(t,e,i,s){super(t),this.sprite=e,this.shortcutKey=i,this.onClick=s}drawContents(){if(!this.gui)return;const t=this.sprite,e=this.rect,i=(e.width-t.width)/2|0,s=(e.height-t.height)/2|0;t.draw(this.gui.app,e.x+i,e.y+s)}handleInput(){if(!this.gui)return!1;const t=this.gui.app,e=t.mouse;return this.rect.contains(e.start)&&e.isDragging()?(this.gui.startDragging(this),!0):this.shortcutKey&&t.isKeyPressed(this.shortcutKey)||this.rect.contains(e)&&e.isClicked()?(this.click(),!0):e.down&&this.rect.contains(e)}click(){this.onClick&&this.onClick()}updateTooltip(t){this.tooltipMessages?(t.messages=this.tooltipMessages,t.visible=!0):t.visible=!1}};r=s([i(0).Serializable("Button")],r),e.Button=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(39),n=i(1),r=i(51);e.getTileId=function(t,e){return 64*e+t},e.TileMap=class{constructor(t,e,i,o){this.width=t,this.height=e,this.depth=i,this.tileSize=o,this.grid=new Array(e),this.layers=new Array(i),this.dirty=!0,this.originX=0,this.originY=0,this.visibleRect=new n.Rect(0,0,t,e),this.prevVisibleRect=new n.Rect(0,0,t,e);for(let i=0;i<e;i++){this.grid[i]=new Array(t);for(let e=0;e<t;e++)this.grid[i][e]=new s.TileMapCell(e,i)}for(let s=0;s<i;s++)this.layers[s]=new r.TileMapLayer(t,e)}isOutOfRange(t,e,i){return t<0||t>=this.width||e<0||e>=this.height||i<0||i>=this.depth}clear(){for(let t=0;t<this.layers.length;t++)this.layers[t].clear()}getTile(t,e,i){return this.isOutOfRange(t,e,i)?0:this.layers[i].getTile(t,e)}setTile(t,e,i,s){this.isOutOfRange(t,e,i)||this.layers[i].setTile(t,e,s)}isBlocked(t,e){return!!this.isOutOfRange(t,e,0)||this.grid[e][t].blocked}setBlocked(t,e,i,s){this.isOutOfRange(t,e,0)||(this.grid[e][t].blocked=i,this.grid[e][t].blockedSight=void 0!==s?s:i)}getCell(t,e){return this.isOutOfRange(t,e,0)?null:this.grid[e][t]}isVisible(t,e){return!(t<this.visibleRect.x1||t>=this.visibleRect.x2||e<this.visibleRect.y1||e>=this.visibleRect.y2)&&this.grid[e][t].visible}isSeen(t,e){const i=this.getCell(t,e);return i&&i.seen}setSeen(t,e,i){const s=this.getCell(t,e);s&&(s.seen=i)}isAnimated(t,e,i){return!this.isOutOfRange(t,e,i)&&this.layers[i].isAnimated(t,e)}setAnimated(t,e,i,s){this.isOutOfRange(t,e,i)||this.layers[i].setAnimated(t,e,s)}resetFov(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.grid[t][e].seen=!1,this.grid[t][e].visible=!1}computeFov(t,e,i,s){this.originX=t,this.originY=e,this.prevVisibleRect.copy(this.visibleRect);const n=i,r=s||i;this.visibleRect.x=Math.max(0,t-n),this.visibleRect.y=Math.max(0,e-r),this.visibleRect.width=Math.min(this.width-1,t+n)-this.visibleRect.x+1,this.visibleRect.height=Math.min(this.height-1,e+r)-this.visibleRect.y+1;for(let t=this.visibleRect.y1;t<this.visibleRect.y2;t++)for(let e=this.visibleRect.x1;e<this.visibleRect.x2;e++)this.grid[t][e].visible=!1;this.grid[e][t].visible=!0,this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantY(1,-1),this.computeOctantX(1,-1),this.computeOctantY(-1,1),this.computeOctantX(-1,1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1),this.dirty=!0}computeOctantY(t,e){const i=[],s=[];let n,r,o,a,h,l,c,d,u,p,g=1,m=0,w=0,y=0;for(r=this.originY+e;r>=this.visibleRect.y1&&r<this.visibleRect.y2;r+=e,w=m,++g)for(o=.5/g,p=-1,a=Math.floor(y*g+.5),n=this.originX+a*t;a<=g&&n>=this.visibleRect.x1&&n<this.visibleRect.x2;n+=t,++a,p=u){if(h=!0,l=!1,d=p,u=(c=a/g)+o,w>0)if(this.grid[r-e][n].visible&&!this.grid[r-e][n].blockedSight||this.grid[r-e][n-t].visible&&!this.grid[r-e][n-t].blockedSight){for(let t=0;t<w&&h;++t)if(d<=s[t]&&u>=i[t])if(this.grid[r][n].blockedSight){if(d>=i[t]&&u<=s[t]){h=!1;break}i[t]=Math.min(i[t],d),s[t]=Math.max(s[t],u),l=!0}else if(c>i[t]&&c<s[t]){h=!1;break}}else h=!1;h&&(this.grid[r][n].visible=!0,this.grid[r][n].seen=!0,this.grid[r][n].blockedSight&&(y>=d?y=u:l||(i[m]=d,s[m++]=u)))}}computeOctantX(t,e){const i=[],s=[];let n,r,o,a,h,l,c,d,u,p,g=1,m=0,w=0,y=0;for(n=this.originX+t;n>=this.visibleRect.x1&&n<this.visibleRect.x2;n+=t,w=m,++g)for(o=.5/g,p=-1,a=Math.floor(y*g+.5),r=this.originY+a*e;a<=g&&r>=this.visibleRect.y1&&r<this.visibleRect.y2;r+=e,++a,p=u){if(h=!0,l=!1,d=p,u=(c=a/g)+o,w>0)if(this.grid[r][n-t].visible&&!this.grid[r][n-t].blockedSight||this.grid[r-e][n-t].visible&&!this.grid[r-e][n-t].blockedSight){for(let t=0;t<w&&h;++t)if(d<=s[t]&&u>=i[t])if(this.grid[r][n].blockedSight){if(d>=i[t]&&u<=s[t]){h=!1;break}i[t]=Math.min(i[t],d),s[t]=Math.max(s[t],u),l=!0}else if(c>i[t]&&c<s[t]){h=!1;break}}else h=!1;h&&(this.grid[r][n].visible=!0,this.grid[r][n].seen=!0,this.grid[r][n].blockedSight&&(y>=d?y=u:l||(i[m]=d,s[m++]=u)))}}}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3);let r=class extends n.Panel{constructor(t,e){super(t),this.shortcutKey=e}get button(){return this.children.length>0?this.children.get(0):void 0}drawContents(){if(!this.gui)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect;e&&this.gui.app.drawImage(t.x,t.y,e.x,e.y,t.width,t.height);const i=this.button;i&&!i.isDragging()&&(i.rect.x=this.rect.x,i.rect.y=this.rect.y,i.rect.width=this.rect.width,i.rect.height=this.rect.height,this.drawChildren()),this.shortcutKey&&this.gui.app.drawRightString(String.fromCharCode(this.shortcutKey),t.x2-3,t.y+3)}handleInput(){if(!this.gui)return!1;if(this.handleChildrenInput())return!0;const t=this.gui.app,e=t.mouse,i=this.button;return i&&(this.shortcutKey&&t.isKeyPressed(this.shortcutKey)||this.rect.contains(e)&&e.isClicked())?(i.click(),!0):e.down&&this.rect.contains(e)}};r=s([i(0).Serializable("ButtonSlot")],r),e.ButtonSlot=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.SELF=0]="SELF",t[t.ENTITY=1]="ENTITY",t[t.TILE=2]="TILE"}(e.TargetType||(e.TargetType={}))},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(2);let r=class extends n.Vec2{constructor(t,e,i,s,r,o){super(e,i),this.game=t,this.offset=new n.Vec2(0,0),this.name=s,this.sprite=r,this.blocks=o,this.zIndex=1}get pixelX(){return this.x*this.game.tileSize.width+this.offset.x}get pixelY(){return this.y*this.game.tileSize.height+this.offset.y}get centerPixelX(){return this.pixelX+this.sprite.width/2|0}get centerPixelY(){return this.pixelY+this.sprite.height/2|0}distanceTo(t){return Math.hypot(t.x-this.x,t.y-this.y)}distance(t,e){return Math.hypot(t-this.x,e-this.y)}draw(){this.sprite.draw(this.game.app,this.pixelX-this.game.viewport.x,this.pixelY-this.game.viewport.y)}startTurn(){}endTurn(){}sendToBack(){}onBump(t){return!1}};r=s([i(0).Serializable("Entity")],r),e.Entity=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AI=class{constructor(t){this.actor=t,this.alwaysActive=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Input=class{constructor(){this.down=!1,this.downCount=0,this.upCount=0}update(){this.down?(this.downCount++,this.upCount=0):(this.downCount=0,this.upCount++)}}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(34),r=i(12),o=i(3),a=i(9),h=i(1),l=i(2),c=i(10);let d=class{constructor(t){this.app=t,this.renderer=new n.DialogRenderer(new h.Rect(0,0,1,1)),this.rootPanel=new o.Panel(t.size),this.rootPanel.gui=this}add(t){this.rootPanel.add(t)}remove(t){this.rootPanel.remove(t)}getPanelAt(t){return this.rootPanel.getPanelAt(t)}handleInput(){return this.dragElement&&this.dragOffset?(this.updateDragging(),!0):this.rootPanel.handleInput()}draw(){this.rootPanel.drawContents(),this.dragElement&&this.dragElement.drawContents()}startDragging(t){const e=this.app.mouse;this.dragElement=t,this.dragOffset=new l.Vec2(e.start.x-t.rect.x,e.start.y-t.rect.y)}updateDragging(){const t=this.app.mouse,e=this.dragElement,i=this.dragOffset;if(t.down)e.rect.x=t.x-i.x,e.rect.y=t.y-i.y;else{const s=this.rootPanel.getPanelAt(t);s&&s.onDrop(e)?(e.rect.x=s.rect.x,e.rect.y=s.rect.y,e.move(s)):e instanceof c.ItemButton&&s===this.rootPanel?e.removeAll():e instanceof r.ItemShortcutButton&&s===this.rootPanel?e.parent&&e.parent.remove(e):e instanceof a.TalentButton&&e.shortcut&&s===this.rootPanel?e.parent&&e.parent.remove(e):(e.rect.x=t.start.x-i.x,e.rect.y=t.start.y-i.y),this.dragElement=void 0,this.dragOffset=void 0}}};d=s([i(0).Serializable("GUI")],d),e.GUI=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Message=class{constructor(t,e){this.text=t,this.color=e}draw(t,e){t.drawString(this.text,e.x,e.y,this.color,e)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(32);e.TileMapRenderer=class{constructor(t,e){this.gl=t,this.tileMap=e,this.quadVertBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadVertBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,-1,0,1,1,1,1,0,-1,1,0,0]),t.STATIC_DRAW),this.tilemapShader=s.initShaderProgram(t,"precision highp float;attribute vec2 position;attribute vec2 texture;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 viewOffset;uniform vec2 viewportSize;uniform vec2 tileSize;uniform vec2 mapSize;void main(void) {   pixelCoord = (texture * viewportSize) + viewOffset;   texCoord = pixelCoord / mapSize / tileSize;   gl_Position = vec4(position, 0.0, 1.0);}","precision highp float;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 tileSize;uniform float animFrame;uniform sampler2D tiles;uniform sampler2D sprites;void main(void) {   vec4 tile = texture2D(tiles, texCoord);   if(tile.x == 0.0 && tile.y == 0.0) { discard; }   vec2 spriteOffset = floor(tile.xy * 256.0) * tileSize;   if(tile.z != 0.0) spriteOffset.x += animFrame * tileSize.x;   vec2 spriteCoord = mod(pixelCoord, tileSize);   gl_FragColor = texture2D(sprites, (spriteOffset + spriteCoord) / 1024.0);   if (gl_FragColor.a == 0.0) discard;   gl_FragColor.a *= tile.a;}"),this.positionAttribute=t.getAttribLocation(this.tilemapShader,"position"),this.textureAttribute=t.getAttribLocation(this.tilemapShader,"texture"),this.viewportSizeUniform=t.getUniformLocation(this.tilemapShader,"viewportSize"),this.viewOffsetUniform=t.getUniformLocation(this.tilemapShader,"viewOffset"),this.mapSizeUniform=t.getUniformLocation(this.tilemapShader,"mapSize"),this.tileSizeUniform=t.getUniformLocation(this.tilemapShader,"tileSize"),this.animFrameUniform=t.getUniformLocation(this.tilemapShader,"animFrame"),this.tileSamplerUniform=t.getUniformLocation(this.tilemapShader,"tiles"),this.spriteSamplerUniform=t.getUniformLocation(this.tilemapShader,"sprites"),this.layerTextures=new Array(e.depth);for(let i=0;i<e.depth;i++){const s=t.createTexture(),n=e.layers[i].imageData;t.bindTexture(t.TEXTURE_2D,s),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,e.width,e.height,0,t.RGBA,t.UNSIGNED_BYTE,n),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),this.layerTextures[i]=s}}draw(t,e,i,s,n){const r=this.gl,o=this.tileMap;r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.tilemapShader),r.bindBuffer(r.ARRAY_BUFFER,this.quadVertBuffer),r.enableVertexAttribArray(this.positionAttribute),r.enableVertexAttribArray(this.textureAttribute),r.vertexAttribPointer(this.positionAttribute,2,r.FLOAT,!1,16,0),r.vertexAttribPointer(this.textureAttribute,2,r.FLOAT,!1,16,8),r.uniform2f(this.viewOffsetUniform,t,e),r.uniform2f(this.viewportSizeUniform,i,s),r.uniform2f(this.tileSizeUniform,o.tileSize.width,o.tileSize.height),r.uniform1f(this.animFrameUniform,n||0),r.activeTexture(r.TEXTURE0),r.uniform1i(this.spriteSamplerUniform,0),r.activeTexture(r.TEXTURE1),r.uniform1i(this.tileSamplerUniform,1);const a=Math.min(o.visibleRect.x1,o.prevVisibleRect.x1),h=Math.min(o.visibleRect.y1,o.prevVisibleRect.y1),l=Math.max(o.visibleRect.x2,o.prevVisibleRect.x2),c=Math.max(o.visibleRect.y2,o.prevVisibleRect.y2);for(let t=0;t<o.depth;t++){const e=o.layers[t],i=this.layerTextures[t];if(r.uniform2f(this.mapSizeUniform,o.width,o.height),r.bindTexture(r.TEXTURE_2D,i),o.dirty){for(let t=h;t<c;t++)for(let i=a;i<l;i++){const s=o.isVisible(i,t)?255:o.isSeen(i,t)?144:0;e.setAlpha(i,t,s)}r.texSubImage2D(r.TEXTURE_2D,0,0,0,e.width,e.height,r.RGBA,r.UNSIGNED_BYTE,e.imageData)}r.drawArrays(r.TRIANGLES,0,6)}o.dirty=!1}}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(16),r=i(24),o=i(25),a=i(26),h=i(8),l=i(6),c=i(17);let d=class extends c.Entity{constructor(t,e,i,s,n,r){super(t,e,i,s,n,r),this.hp=100,this.maxHp=100,this.ap=1,this.maxAp=1,this.inventory=new h.ArrayList,this.talents=new h.ArrayList,this.visibleDuration=-1,this.seen=!1}startTurn(){this.ap=this.maxAp;for(let t=0;t<this.talents.length;t++){const e=this.talents.get(t);e.cooldown>0&&e.cooldown--}}move(t,e,i){const s=this.x+t,n=this.y+e;if(this.blocks){if(this.game.isBlocked(s,n))return!1}else if(this.game.tileMap.isBlocked(s,n))return!1;this.x=s,this.y=n,this.ap--,this.offset.x=-t*this.game.tileSize.width,this.offset.y=-e*this.game.tileSize.height;const r=i||4,o=this.game.tileSize.width/r,h=this.game.tileSize.height/r;return this.game.animations.push(new a.SlideAnimation(this,t*o,e*h,r)),this.game.blocked=!0,!0}moveTo(t,e,i){return this.move(t-this.x,e-this.y,i)}moveToward(t,e,i){const s=t-this.x,n=e-this.y;if(s<0&&n<0&&this.move(-1,-1,i))return!0;if(s<0&&n>0&&this.move(-1,1,i))return!0;if(s>0&&n<0&&this.move(1,-1,i))return!0;if(s>0&&n>0&&this.move(1,1,i))return!0;if(Math.abs(s)>Math.abs(n)){if(s<0&&this.move(-1,0,i))return!0;if(s>0&&this.move(1,0,i))return!0;if(n<0&&this.move(0,-1,i))return!0;if(n>0&&this.move(0,1,i))return!0}else{if(n<0&&this.move(0,-1,i))return!0;if(n>0&&this.move(0,1,i))return!0;if(s<0&&this.move(-1,0,i))return!0;if(s>0&&this.move(1,0,i))return!0}return!1}attack(t,e){t!==this&&(this.onAttack(t,e),t.takeDamage(this,e),this.ap--,this.game.animations.push(new r.BumpAnimation(this,t)),this.game.blocked=!0)}takeHeal(t){this.hp=Math.min(this.hp+t,this.maxHp),this.addFloatingText(t.toString(),l.Colors.LIGHT_GREEN)}takeDamage(t,e){this.hp<=0||(this.hp-=e,this.addFloatingText(e.toString(),l.Colors.RED),this.hp<=0&&(this.hp=0,this.onDeath(t),this.game.entities.remove(this)))}pickup(t){t.onPickup(this),this.inventory.add(t),this.game.entities.remove(t)}use(t){return t.onUse(this)}cast(t,e,i){t.targetType===n.TargetType.SELF||e?t.cast(this,e)&&i&&i():this.game.startTargeting(t,i)}addFloatingText(t,e){this.game.animations.push(new o.FloatingTextAnimation(this,t,e))}onAttack(t,e){}onDeath(t){}};d=s([i(0).Serializable("Actor")],d),e.Actor=d},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5);e.BumpAnimation=class extends s.Animation{constructor(t,e){super(12,!0),this.entity=t,this.dx=e.x-t.x,this.dy=e.y-t.y}update(){const t=12-this.countdown;t>=0&&t<4&&(this.entity.offset.x+=this.dx,this.entity.offset.y+=this.dy),t>=4&&t<8&&(this.entity.offset.x-=this.dx,this.entity.offset.y-=this.dy),super.update()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(6),n=i(5);e.FloatingTextAnimation=class extends n.Animation{constructor(t,e,i){super(40,!1),this.actor=t,this.str=e,this.color=i||s.Colors.WHITE}draw(t){const e=40-this.countdown,i=this.actor.pixelX+(this.actor.sprite.width/2|0)-t.viewport.x,s=this.actor.pixelY-3-t.viewport.y-Math.min(4,Math.floor(e/2));t.app.drawCenteredString(this.str,i,s,this.color)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5);e.SlideAnimation=class extends s.Animation{constructor(t,e,i,s){super(s,!0),this.entity=t,this.dx=e,this.dy=i}update(){this.countdown--,this.countdown>=0&&(this.entity.offset.x+=this.dx,this.entity.offset.y+=this.dy),0===this.countdown&&(this.entity.offset.x=0,this.entity.offset.y=0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s="__wgltMetadata";function n(t){const e=new r;return t[s]=e,e}e.createSerializeMetadata=n,e.getSerializeMetadata=function(t){return t[s]||n(t)};class r{constructor(){this.className="Object",this.valueType=!1}}e.SerializeMetadata=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(48),n=i(29),r=i(30),o=i(1),a=i(31),h=i(2),l=i(4),c=[l.Keys.VK_NUMPAD7,l.Keys.VK_Y],d=[l.Keys.VK_NUMPAD9,l.Keys.VK_U],u=[l.Keys.VK_NUMPAD1,l.Keys.VK_B],p=[l.Keys.VK_NUMPAD3,l.Keys.VK_N],g=[l.Keys.VK_UP,l.Keys.VK_NUMPAD8,l.Keys.VK_K],m=[l.Keys.VK_LEFT,l.Keys.VK_NUMPAD4,l.Keys.VK_H],w=[l.Keys.VK_DOWN,l.Keys.VK_NUMPAD2,l.Keys.VK_J],y=[l.Keys.VK_RIGHT,l.Keys.VK_NUMPAD6,l.Keys.VK_L],f=[l.Keys.VK_SPACE,l.Keys.VK_NUMPAD5];e.App=class{constructor(t){const e=t.canvas;if(!e)throw new Error("Null or missing canvas element");const i=e.getContext("webgl",{alpha:!1,antialias:!1});if(!i)throw new Error("Could not get WebGL context");this.canvas=e,this.gl=i,this.size=t.size||new o.Rect(0,0,400,224),this.font=t.font||s.FONT_04B03,this.fillWindow=t.fillWindow||!1,this.scaleFactor=t.scaleFactor||2,this.center=new h.Vec2(this.size.width/2|0,this.size.height/2|0),i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),e.width=this.size.width,e.height=this.size.height,e.style.outline="none",e.tabIndex=0,e.focus(),this.mobile=this.isMobile(),this.renderSet=new a.RenderSet(i,t.imageUrl,this.font),this.keyboard=new n.Keyboard(e),this.mouse=new r.Mouse(this),this.fillWindow&&(window.addEventListener("resize",this.handleResizeEvent.bind(this),!1),this.handleResizeEvent()),this.renderLoop()}handleResizeEvent(){const t=window.innerWidth,e=window.innerHeight,i=this.isMobile(),s=i?320:400,n=i?224:300;this.scaleFactor=1,this.scaleFactor=t>e?Math.max(1,Math.min(Math.round(t/s),Math.round(e/n))):Math.max(1,Math.min(Math.round(t/n),Math.round(e/s))),this.size.width=Math.round(t/this.scaleFactor),this.size.height=Math.round(e/this.scaleFactor),this.center.x=this.size.width/2|0,this.center.y=this.size.height/2|0,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.width=t+"px",this.canvas.style.height=e+"px"}isMobile(){return!!navigator.userAgent.match(/Android|iPhone|iPod|IEMobile|WPDesktop|Opera Mini/i)}renderLoop(){this.keyboard.update(),this.mouse.update(),this.resetGl(),this.state&&this.state.update(),this.renderSet.flush(this.size.width,this.size.height),requestAnimationFrame(this.renderLoop.bind(this))}resetGl(){const t=this.gl;t.viewport(0,0,this.size.width,this.size.height),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.renderSet.positionArrayIndex=0,this.renderSet.texcoordArrayIndex=0,this.renderSet.colorArrayIndex=0}drawImage(t,e,i,s,n,r,o,a,h){this.renderSet.drawImage(t,e,i,s,n,r,o,a,h)}drawString(t,e,i,s,n){this.renderSet.drawString(t,e,i,s,n)}drawCenteredString(t,e,i,s){this.renderSet.drawCenteredString(t,e,i,s)}drawRightString(t,e,i,s){this.renderSet.drawRightString(t,e,i,s)}isKeyDown(t){const e=this.keyboard.getKey(t);return e&&e.down}isKeyPressed(t){const e=this.keyboard.getKey(t),i=e?e.downCount:0;return 1===i||i>30}isDownLeftKeyPressed(){return this.isKeyArrayPressed(u)}isDownKeyPressed(){return this.isKeyArrayPressed(w)}isDownRightKeyPressed(){return this.isKeyArrayPressed(p)}isLeftKeyPressed(){return this.isKeyArrayPressed(m)}isWaitKeyPressed(){return this.isKeyArrayPressed(f)}isRightKeyPressed(){return this.isKeyArrayPressed(y)}isUpLeftKeyPressed(){return this.isKeyArrayPressed(c)}isUpKeyPressed(){return this.isKeyArrayPressed(g)}isUpRightKeyPressed(){return this.isKeyArrayPressed(d)}isKeyArrayPressed(t){for(let e=0;e<t.length;e++)if(this.isKeyPressed(t[e]))return!0;return!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(19),n=256;e.Keyboard=class{constructor(t){this.keys=new Array(n);for(let t=0;t<n;t++)this.keys[t]=new s.Input;t.addEventListener("keydown",t=>this.setKey(t,!0)),t.addEventListener("keyup",t=>this.setKey(t,!1))}setKey(t,e){t.stopPropagation(),t.preventDefault();const i=t.keyCode;i>=0&&i<n&&(this.keys[i].down=e)}update(){for(let t=0;t<n;t++)this.keys[t].down?this.keys[t].downCount++:this.keys[t].downCount=0}getKey(t){return t>=0&&t<n?this.keys[t]:null}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(19),n=i(1),r=i(2);e.Mouse=class extends s.Input{constructor(t){super(),this.app=t,this.prev=new r.Vec2(0,0),this.start=new r.Vec2(0,0),this.x=0,this.y=0,this.dx=0,this.dy=0,this.dragDistance=0,this.longPress=!1,this.wheelDelta=0,this.lastWheelDelta=0;const e=t.canvas,i=this.handleEvent.bind(this);e.addEventListener("mousedown",i),e.addEventListener("mouseup",i),e.addEventListener("mousemove",i),e.addEventListener("contextmenu",i);const s=this.handleTouchEvent.bind(this);e.addEventListener("touchstart",s),e.addEventListener("touchend",s),e.addEventListener("touchcancel",s),e.addEventListener("touchmove",s);const n=this.handleMouseWheel.bind(this);e.addEventListener("mousewheel",n)}handleTouchEvent(t){if(t.stopPropagation(),t.preventDefault(),t.touches.length>0){const e=t.touches[0];this.updatePosition(e.clientX,e.clientY)}"touchstart"===t.type&&(this.down=!0,this.prev.x=this.x,this.prev.y=this.y,this.start.x=this.x,this.start.y=this.y,this.dx=0,this.dy=0,this.dragDistance=0),"touchend"===t.type&&(this.down=!1,this.longPress=this.downCount>=30)}handleEvent(t){t.stopPropagation(),t.preventDefault(),this.updatePosition(t.clientX,t.clientY),"mousedown"===t.type&&(this.down=!0,this.start.x=this.x,this.start.y=this.y,this.dragDistance=0,this.app.canvas.focus()),"mouseup"===t.type&&(this.down=!1,this.longPress=this.downCount>=30)}updatePosition(t,e){let i=this.app.canvas.getBoundingClientRect();const s=this.app.size.width/this.app.size.height,r=i.width/i.height;if(r-s>.01){const t=s*i.height,e=i.width-t;i=new n.Rect(Math.floor(e/2),0,t,i.height)}if(r-s<-.01){const t=i.width/s,e=i.height-t;i=new n.Rect(0,Math.floor(e/2),i.width,t)}this.x=this.app.size.width*(t-i.left)/i.width|0,this.y=this.app.size.height*(e-i.top)/i.height|0}handleMouseWheel(t){t.stopPropagation(),t.preventDefault();const e=t;return this.lastWheelDelta=Math.max(-1,Math.min(1,e.deltaY)),!1}update(){super.update(),this.dx=this.x-this.prev.x,this.dy=this.y-this.prev.y,this.prev.x=this.x,this.prev.y=this.y,this.wheelDelta=this.lastWheelDelta,this.lastWheelDelta=0,this.down&&(this.dragDistance+=Math.abs(this.dx)+Math.abs(this.dy))}isClicked(){return 1===this.upCount&&this.dragDistance<4&&!this.longPress}isDragging(){return this.down&&this.dragDistance>4}isLongPress(){return 30===this.downCount&&!this.isDragging()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(32),n=65536;e.RenderSet=class{constructor(t,e,i){this.gl=t,this.font=i;const r=s.initShaderProgram(t,"uniform vec2 u_viewportSize;attribute vec2 a_position;attribute vec2 a_texCoord;attribute vec4 a_color;varying vec2 v_texCoord;varying vec4 v_color;void main() {vec2 zeroToOne = a_position / u_viewportSize;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;v_color = a_color;}","precision highp float;uniform sampler2D u_image;varying vec2 v_texCoord;varying vec4 v_color;void main() {gl_FragColor = texture2D(u_image, v_texCoord);if (gl_FragColor.a < 0.1) discard;if (v_color.a != 0.0) gl_FragColor = v_color;}");this.program=r,this.viewportSizeLocation=t.getUniformLocation(r,"u_viewportSize"),this.positionLocation=t.getAttribLocation(r,"a_position"),this.texcoordLocation=t.getAttribLocation(r,"a_texCoord"),this.colorLocation=t.getAttribLocation(r,"a_color"),this.positionBuffer=t.createBuffer(),this.texcoordBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.spriteTexture=s.createTexture(t,e),this.positionArray=new Float32Array(n),this.positionArrayIndex=0,this.texcoordArray=new Float32Array(n),this.texcoordArrayIndex=0,this.colorUint8Array=new Uint8Array(n),this.colorDataView=new DataView(this.colorUint8Array.buffer),this.colorArrayIndex=0}drawCenteredString(t,e,i,s){const n=e-this.font.getStringWidth(t)/2|0;this.drawString(t,n,i,s)}drawRightString(t,e,i,s){const n=e-this.font.getStringWidth(t);this.drawString(t,n,i,s)}drawString(t,e,i,s,n){const r=t.split("\n"),o=this.font.getHeight();let a=e,h=i;for(let t=0;t<r.length;t++){t>0&&(a=e,h+=o);for(let e=0;e<r[t].length;e++){const i=r[t].charCodeAt(e);if(this.font.isInRange(i)){const t=this.font.getOffset(i),e=this.font.getWidth(i);this.drawImage(a,h,t,0,e,o,s),a+=e}}}n&&(n.x=a,n.y=h)}drawChar(t,e,i,s){if(this.font.isInRange(t)){const n=this.font.getOffset(t),r=this.font.getWidth(t),o=this.font.getHeight();this.drawImage(e,i,n,0,r,o,s)}}drawImage(t,e,i,s,n,r,o,a,h){const l=this.spriteTexture;if(!l.loaded)return;const c=void 0!==a?a:n,d=void 0!==h?h:r,u=t+Math.abs(c),p=e+d,g=i/l.width,m=s/l.height,w=(i+n)/l.width,y=(s+r)/l.height,f=o||0;this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=p,this.texcoordArray[this.texcoordArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=m,this.texcoordArray[this.texcoordArrayIndex++]=w,this.texcoordArray[this.texcoordArrayIndex++]=m,this.texcoordArray[this.texcoordArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=y,this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=p,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=p,this.texcoordArray[this.texcoordArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=w,this.texcoordArray[this.texcoordArrayIndex++]=m,this.texcoordArray[this.texcoordArrayIndex++]=w,this.texcoordArray[this.texcoordArrayIndex++]=y;for(let t=0;t<6;t++)this.colorDataView.setUint32(this.colorArrayIndex,f,!1),this.colorArrayIndex+=4}flush(t,e){if(!this.spriteTexture.loaded||0===this.positionArrayIndex)return;const i=this.gl;i.useProgram(this.program),i.uniform2f(this.viewportSizeLocation,t,e),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.spriteTexture);{i.enableVertexAttribArray(this.positionLocation),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,this.positionArray,i.DYNAMIC_DRAW);const t=2,e=i.FLOAT,s=!1,n=0,r=0;i.vertexAttribPointer(this.positionLocation,t,e,s,n,r)}{i.enableVertexAttribArray(this.texcoordLocation),i.bindBuffer(i.ARRAY_BUFFER,this.texcoordBuffer),i.bufferData(i.ARRAY_BUFFER,this.texcoordArray,i.DYNAMIC_DRAW);const t=2,e=i.FLOAT,s=!1,n=0,r=0;i.vertexAttribPointer(this.texcoordLocation,t,e,s,n,r)}{i.enableVertexAttribArray(this.colorLocation),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),i.bufferData(i.ARRAY_BUFFER,this.colorUint8Array,i.DYNAMIC_DRAW);const t=4,e=i.UNSIGNED_BYTE,s=!0,n=0,r=0;i.vertexAttribPointer(this.colorLocation,t,e,s,n,r)}const s=i.TRIANGLES,n=this.positionArrayIndex/2;i.drawArrays(s,0,n)}}},function(t,e,i){"use strict";function s(t,e,i){const s=t.createShader(e);return t.shaderSource(s,i),t.compileShader(s),s}Object.defineProperty(e,"__esModule",{value:!0}),e.ExtendedTexture=class extends WebGLTexture{constructor(){super(),this.loaded=!1,this.width=0,this.height=0}},e.initShaderProgram=function(t,e,i){const n=s(t,t.VERTEX_SHADER,e),r=s(t,t.FRAGMENT_SHADER,i),o=t.createProgram();return t.attachShader(o,n),t.attachShader(o,r),t.linkProgram(o),o},e.loadShader=s,e.createTexture=function(t,e){const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const s=t.RGBA,n=t.RGBA,r=t.UNSIGNED_BYTE,o=new Uint8Array([0,0,0,255]);t.texImage2D(t.TEXTURE_2D,0,s,1,1,0,n,r,o);const a=new Image;return a.onload=(()=>{t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,s,n,r,a),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.generateMipmap(t.TEXTURE_2D),i.loaded=!0,i.width=a.width,i.height=a.height}),a.src=e,i}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(20);e.AppState=class{constructor(t){this.app=t,this.gui=new s.GUI(t)}update(){this.gui.handleInput(),this.gui.draw()}}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});let n=class{constructor(t,e){this.baseRect=t,this.closeButtonRect=e}draw(t,e){const i=this.baseRect.x,s=this.baseRect.y,n=this.baseRect.width/3|0,r=this.baseRect.height/3|0,o=i+n,a=s+r,h=i+2*n,l=s+2*n,c=e.rect.x,d=e.rect.y,u=e.rect.width-2*n,p=e.rect.height-2*r,g=c+n,m=d+r,w=g+u,y=m+p;if(t.drawImage(c,d,i,s,n,r,void 0,n,r),t.drawImage(g,d,o,s,n,r,void 0,u,r),t.drawImage(w,d,h,s,n,r,void 0,n,r),t.drawImage(c,m,i,a,n,r,void 0,n,p),t.drawImage(g,m,o,a,n,r,void 0,u,p),t.drawImage(w,m,h,a,n,r,void 0,n,p),t.drawImage(c,y,i,l,n,r,void 0,n,r),t.drawImage(g,y,o,l,n,r,void 0,u,r),t.drawImage(w,y,h,l,n,r,void 0,n,r),this.closeButtonRect&&e.closeButton){const i=this.closeButtonRect.width,s=this.closeButtonRect.height,n=e.rect.x2-i,r=e.rect.y,o=this.closeButtonRect.x,a=this.closeButtonRect.y;t.drawImage(n,r,o,a,i,s)}}};n=s([i(0).Serializable("DialogRenderer")],n),e.DialogRenderer=n},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(16),r=i(23),o=i(33),a=i(6),h=i(50),l=i(4),c=i(36),d=i(1),u=i(37),p=i(38),g=i(2),m=i(8),w=i(0),y=i(14),f=i(22),S=new d.Rect(0,0,256,256);let _=class extends o.AppState{constructor(t,e){super(t),this.viewport=new d.Rect(0,0,t.size.width,t.size.height),this.viewportFocus=new g.Vec2(0,0),this.focusMargins=e.focusMargins||new g.Vec2(0,0),this.animations=[],this.entities=new m.ArrayList,this.turnIndex=0,this.blocked=!1,this.cursor=new g.Vec2(-1,-1),this.tooltip=new h.TooltipDialog,this.rng=new u.RNG,this.pathIndex=0,this.horizontalViewDistance=e.viewDistance||13,this.verticalViewDistance=e.viewDistance||13,this.zoom=1,e.horizontalViewDistance&&(this.horizontalViewDistance=e.horizontalViewDistance),e.verticalViewDistance&&(this.verticalViewDistance=e.verticalViewDistance);const i=e.mapSize||S,s=e.mapLayers||1,n=e.tileSize||new d.Rect(0,0,16,16);this.tileMap=new y.TileMap(i.width,i.height,s,n),this.tileMapRenderer=new f.TileMapRenderer(t.gl,this.tileMap)}get tileSize(){return this.tileMap.tileSize}log(t,e){this.messageLog&&this.messageLog.add(t,e)}addAnimation(t){return this.animations.push(t),t.promise}update(){p.Sprite.updateGlobalAnimations(),this.updateTooltip(),this.updateZoom(),this.gui.handleInput()||(this.updateAnimations(),this.updateEntities(),this.onUpdate&&this.onUpdate(),this.updateViewport()),this.drawTileMap(),1===this.zoom&&(this.drawTargeting(),this.drawEntities(),this.drawAnimations()),this.gui.draw()}updateTooltip(){if(this.gui.dragElement)return void(this.tooltip.visible=!1);this.tooltip.visible||(this.tooltipElement=void 0);const t=this.app.mouse,e=t.isLongPress();if(!t.down&&(0!==t.dx||0!==t.dy)||e){const i=this.gui.getPanelAt(t);this.tooltipElement!==i&&(this.tooltipElement=i,i&&(i.updateTooltip(this.tooltip),e&&window.navigator.vibrate(100))),this.tooltip.visible&&(this.tooltip.gui||this.gui.add(this.tooltip),this.tooltip.showAt(t.x,t.y),this.tooltip.modal=this.app.mobile)}}updateZoom(){if(0!==this.app.mouse.wheelDelta){const t=this.viewport.getCenter();this.viewportFocus.x=t.x,this.viewportFocus.y=t.y,this.app.mouse.wheelDelta>0?this.zoom*=.5:this.zoom*=2,this.viewport.width=this.zoom*this.app.size.width|0,this.viewport.height=this.zoom*this.app.size.height|0,this.viewport.x=t.x-(this.app.size.width/this.zoom/2|0),this.viewport.y=t.y-(this.app.size.height/this.zoom/2|0)}}updateAnimations(){this.blocked=!1;for(let t=0;t<this.animations.length;t++){const e=this.animations[t];e.update(),e.blocking&&(this.blocked=!0)}for(let t=this.animations.length-1;t>=0;t--)this.animations[t].isDone()&&(this.animations[t].promise.resolve(),this.animations.splice(t,1))}updateEntities(){if(this.player&&this.player.hp<=0)return;let t=0;for(;0!==this.entities.length&&(this.turnIndex>=this.entities.length&&(this.turnIndex=0),!(t>2*this.entities.length));){const e=this.entities.get(this.turnIndex);if(e instanceof r.Actor){if(e.ap>0){if(e===this.player){this.blocked||this.handlePlayerInput();break}this.doAi(e)}e.ap<=0&&(e.ap=0,this.nextTurn())}else this.nextTurn();t++}}resetViewport(){this.player&&(this.viewportFocus.x=this.player.centerPixelX,this.viewportFocus.y=this.player.centerPixelY,this.viewport.x=this.viewportFocus.x-(this.app.size.width/this.zoom/2|0),this.viewport.y=this.viewportFocus.y-(this.app.size.height/this.zoom/2|0))}updateViewport(){this.viewport.width=this.app.size.width/this.zoom,this.viewport.height=this.app.size.height/this.zoom;const t=this.app.mouse;if(t.isDragging())this.viewport.x-=t.dx/this.zoom,this.viewport.y-=t.dy/this.zoom,this.viewportFocus.x=this.viewport.x+(this.viewport.width/2|0),this.viewportFocus.y=this.viewport.y+(this.viewport.height/2|0);else{const t=.05,e=this.viewportFocus.x-(this.app.size.width/this.zoom/2|0);if(e!==this.viewport.x){let i=t*e-t*this.viewport.x;i=i<0?Math.floor(i):Math.ceil(i),this.viewport.x+=i}const i=this.viewportFocus.y-(this.app.size.height/this.zoom/2|0);if(i!==this.viewport.y){let e=t*i-t*this.viewport.y;e=e<0?Math.floor(e):Math.ceil(e),this.viewport.y+=e}}}drawTileMap(){if(this.app.renderSet.spriteTexture.loaded){const t=(this.viewport.x/this.zoom|0)*this.zoom,e=(this.viewport.y/this.zoom|0)*this.zoom,i=(p.Sprite.globalAnimIndex/30|0)%2;this.tileMapRenderer.draw(t,e,this.viewport.width,this.viewport.height,i)}}drawTargeting(){if(this.isTargeting()&&this.targetSprite){const t=this.cursor.x*this.tileMap.tileSize.width-this.viewport.x,e=this.cursor.y*this.tileMap.tileSize.height-this.viewport.y;this.targetSprite.draw(this.app,t,e)}}drawEntities(){for(let t=0;t<3;t++)for(let e=0;e<this.entities.length;e++){const i=this.entities.get(e);i.zIndex===t&&this.tileMap.isVisible(i.x,i.y)&&i.draw()}}drawAnimations(){let t=0;for(let e=0;e<this.animations.length;e++){const i=this.animations[e];0!==t&&i.blocking||i.draw(this),i.blocking&&t++}}isTargeting(){return!!this.targetAbility}startTargeting(t,e){this.targetAbility=t,this.targetCallback=e,this.player&&(this.cursor.x=this.player.x,this.cursor.y=this.player.y)}endTargeting(){if(this.player&&this.targetAbility){const t=this.targetAbility.targetType;let e=null;t===n.TargetType.ENTITY?e=this.getActorAt(this.cursor.x,this.cursor.y):t===n.TargetType.TILE&&(e=this.tileMap.getCell(this.cursor.x,this.cursor.y)),e&&this.targetAbility.cast(this.player,e)&&this.targetCallback&&this.targetCallback()}this.cancelTargeting()}cancelTargeting(){this.targetAbility=void 0,this.targetCallback=void 0}handlePlayerInput(){if(!this.player||this.blocked)return;if(this.player.ai)return this.player.ai.doAi(),void(this.player.ap=0);const t=this.app.mouse;if((t.down||0!==t.dx||0!==t.dy)&&(this.cursor.x=(this.viewport.x+t.x)/this.tileMap.tileSize.width|0,this.cursor.y=(this.viewport.y+t.y)/this.tileMap.tileSize.height|0),this.app.isKeyDown(l.Keys.VK_SHIFT)){let t=0,e=0;return this.app.isDownLeftKeyPressed()&&(t=-1,e=1),this.app.isDownKeyPressed()&&(e=1),this.app.isDownRightKeyPressed()&&(t=1,e=1),this.app.isLeftKeyPressed()&&(t=-1),this.app.isRightKeyPressed()&&(t=1),this.app.isUpLeftKeyPressed()&&(t=-1,e=-1),this.app.isUpKeyPressed()&&(e=-1),this.app.isUpRightKeyPressed()&&(t=1,e=-1),this.viewportFocus.x-=t*this.tileMap.tileSize.height,void(this.viewportFocus.y-=e*this.tileMap.tileSize.height)}if(this.isTargeting())return(this.app.isKeyPressed(l.Keys.VK_ENTER)||this.app.mouse.isClicked())&&this.endTargeting(),this.app.isKeyPressed(l.Keys.VK_ESCAPE)&&this.cancelTargeting(),this.app.isDownLeftKeyPressed()&&(this.cursor.x--,this.cursor.y++),this.app.isDownKeyPressed()&&this.cursor.y++,this.app.isDownRightKeyPressed()&&(this.cursor.x++,this.cursor.y++),this.app.isLeftKeyPressed()&&this.cursor.x--,this.app.isRightKeyPressed()&&this.cursor.x++,this.app.isUpLeftKeyPressed()&&(this.cursor.x--,this.cursor.y--),this.app.isUpKeyPressed()&&this.cursor.y--,void(this.app.isUpRightKeyPressed()&&(this.cursor.x++,this.cursor.y--));if(t.isClicked()){const e=(this.viewport.x+t.x)/this.tileMap.tileSize.width|0,i=(this.viewport.y+t.y)/this.tileMap.tileSize.height|0,s=this.tileMap.getCell(e,i);s&&s!==this.targetTile&&(this.targetTile=s,this.path=c.computePath(this.tileMap,this.player,this.targetTile,100),this.pathIndex=0)}let e=null;if(this.path){for(e=this.path[this.pathIndex];e&&e.x===this.player.x&&e.y===this.player.y;)this.pathIndex++,e=this.pathIndex<this.path.length?this.path[this.pathIndex]:null;e||this.stopAutoWalk()}if(e){const t=e.x-this.player.x,i=e.y-this.player.y;this.tryMoveOrAttack(t,i)||this.stopAutoWalk()}else this.app.isDownLeftKeyPressed()&&this.tryMoveOrAttack(-1,1)||this.app.isDownKeyPressed()&&this.tryMoveOrAttack(0,1)||this.app.isDownRightKeyPressed()&&this.tryMoveOrAttack(1,1)||this.app.isLeftKeyPressed()&&this.tryMoveOrAttack(-1,0)||this.app.isRightKeyPressed()&&this.tryMoveOrAttack(1,0)||this.app.isUpLeftKeyPressed()&&this.tryMoveOrAttack(-1,-1)||this.app.isUpKeyPressed()&&this.tryMoveOrAttack(0,-1)||this.app.isUpRightKeyPressed()&&this.tryMoveOrAttack(1,-1)||this.app.isWaitKeyPressed()&&(this.player.ap=0)}tryMoveOrAttack(t,e){const i=this.player;if(!i)return!1;const s=i.x+t,n=i.y+e;for(let t=0;t<this.entities.length;t++){const e=this.entities.get(t);if(i!==e&&e.x===s&&e.y===n)return this.path&&e instanceof r.Actor?1===this.pathIndex?(this.stopAutoWalk(),e.onBump(i)):(this.stopAutoWalk(),!0):e.onBump(i)}return i.move(t,e)}recalculateViewportFocus(){const t=this.player;if(!t)return;const e=this.tileMap,i=e.tileSize.width,s=e.tileSize.height;let n=t.x*i,o=t.y*s,a=(t.x+1)*i,h=(t.y+1)*s;for(let r=t.y-this.verticalViewDistance;r<=t.y+this.verticalViewDistance;r++)for(let l=t.x-this.horizontalViewDistance;l<=t.x+this.horizontalViewDistance;l++)e.isVisible(l,r)&&(n=Math.min(n,l*i),o=Math.min(o,r*s),a=Math.max(a,(l+1)*i),h=Math.max(h,(r+1)*s));let l=t.x*i,c=t.y*s,d=l+i,u=c+s;if(this.path)for(let t=this.pathIndex;t<this.path.length;t++){const e=this.path[t];l=Math.min(l,e.x*i),c=Math.min(c,e.y*s),d=Math.max(d,(e.x+1)*i),u=Math.max(u,(e.y+1)*s)}else for(let t=0;t<this.entities.length;t++){const n=this.entities.get(t);n instanceof r.Actor&&e.isVisible(n.x,n.y)&&(l=Math.min(l,n.x*i),c=Math.min(c,n.y*s),d=Math.max(d,(n.x+1)*i),u=Math.max(u,(n.y+1)*s))}a-n<=this.viewport.width-2*this.focusMargins.x?this.viewportFocus.x=Math.round((n+a)/2):this.viewportFocus.x=Math.round((l+d)/2),h-o<=this.viewport.height-2*this.focusMargins.y?this.viewportFocus.y=Math.round((o+h)/2):this.viewportFocus.y=Math.round((c+u)/2)}doAi(t){t.ai?((t.visibleDuration>0||t.ai.alwaysActive)&&t.ai.doAi(),t.ap=0):t.ap=0}nextTurn(){if(this.turnIndex<this.entities.length){const t=this.entities.get(this.turnIndex);t.endTurn(),this.player===t&&this.recomputeFov()}if(this.turnIndex++,this.turnIndex>=this.entities.length&&(this.turnIndex=0),this.turnIndex>=0&&this.turnIndex<this.entities.length){const t=this.entities.get(this.turnIndex);t.startTurn(),this.player===t&&this.recalculateViewportFocus()}}stopAutoWalk(){this.path=void 0,this.targetTile=void 0}isBlocked(t,e){if(this.tileMap.isBlocked(t,e))return!0;for(let i=0;i<this.entities.length;i++){const s=this.entities.get(i);if(s.blocks&&s.x===t&&s.y===e)return!0}return!1}getEntityAt(t,e){for(let i=0;i<this.entities.length;i++){const s=this.entities.get(i);if(s.x===t&&s.y===e)return s}}getActorAt(t,e){for(let i=0;i<this.entities.length;i++){const s=this.entities.get(i);if(s instanceof r.Actor&&s.x===t&&s.y===e)return s}}recomputeFov(){if(this.player){this.tileMap.computeFov(this.player.x,this.player.y,this.horizontalViewDistance,this.verticalViewDistance);for(let t=0;t<this.entities.length;t++){const e=this.entities.get(t);e!==this.player&&e instanceof r.Actor&&(this.tileMap.isVisible(e.x,e.y)?(e.seen||(e.seen=!0,this.player.addFloatingText("!",a.Colors.WHITE),this.stopAutoWalk(),this.viewportFocus.x=(this.player.centerPixelX+e.centerPixelX)/2|0,this.viewportFocus.y=(this.player.centerPixelY+e.centerPixelY)/2|0),e.visibleDuration++):e.visibleDuration=-1)}}}};_=s([w.Serializable("Game")],_),e.Game=_},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=[-1,0,1,-1,1,-1,0,1],n=[-1,-1,-1,0,0,1,1,1],r=[1.5,1,1.5,1,1,1.5,1,1.5];function o(t){let e=null,i=-1,s=1/0;for(let n=0;n<t.length;n++){const r=t[n];r.g!==1/0&&r.g+r.h<s&&(e=r,i=n,s=r.g+r.h)}return t.splice(i,1),e}function a(t){const e=[];let i=t;for(;i;)e.push(i),i=i.prev;return e.reverse(),e}e.computePath=function(t,e,i,h){!function(t,e){for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){const n=t.grid[i][s];n.g=1/0,n.h=Math.min(Math.abs(s-e.x),Math.abs(i-e.y)),n.prev=null}}(t,i);const l=t.grid[e.y][e.x];l.g=0;const c=[l];for(;c.length>0;){const e=o(c);if(e.x===i.x&&e.y===i.y)return a(e);for(let o=0;o<s.length;o++){const a=e.x+s[o],l=e.y+n[o];if(a>=0&&a<t.width&&l>=0&&l<t.height){const s=t.grid[l][a],n=e.g+r[o];n<s.g&&n<=h&&(a===i.x&&l===i.y||!t.grid[l][a].blocked)&&(s.g=n,s.prev=e,c.push(s))}}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.RNG=class{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}setSeed(t){this.state=t}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(t,e){const i=e-t;return t+(this.nextInt()/this.m*i|0)}chooseIndex(t){const e=t.reduce((t,e)=>t+e),i=this.nextRange(1,e+1);let s=0;for(let e=0;e<t.length;e++)if(i<=(s+=t[e]))return e;return t.length-1}chooseKey(t){const e=[],i=[];for(const s in t)t.hasOwnProperty(s)&&(e.push(s),i.push(t[s]));return e[this.chooseIndex(i)]}}},function(t,e,i){"use strict";var s,n=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const r=i(1),o=i(0);let a=s=class extends r.Rect{constructor(t,e,i,s,n,r,o,a){super(t,e,i,s),this.frames=n||1,this.loop=!!r,this.ticksPerFrame=o||30,this.colorOverride=a,this.animIndex=0,this.animDelay=0}draw(t,e,i,n){let r=this.animIndex;this.loop&&(r=(s.globalAnimIndex/this.ticksPerFrame|0)%this.frames);const o=this.x+r*this.width,a=this.y,h=n||this.colorOverride;t.drawImage(e,i,o,a,this.width,this.height,h),this.animDelay++,this.animDelay>this.ticksPerFrame&&(this.animDelay=0,this.animIndex++,this.animIndex>=this.frames&&(this.loop?this.animIndex=0:this.animIndex=this.frames-1))}clone(){return new s(this.x,this.y,this.width,this.height,this.frames,this.loop,this.ticksPerFrame,this.colorOverride)}static updateGlobalAnimations(){s.globalAnimIndex++}};a.globalAnimIndex=0,a=s=n([o.Serializable("Sprite")],a),e.Sprite=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(2);e.TileMapCell=class extends s.Vec2{constructor(t,e){super(t,e),this.blocked=!0,this.blockedSight=!0,this.visible=!1,this.seen=!1,this.g=0,this.h=0,this.prev=null}}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),r=i(10),o=i(12),a=i(9);let h=class extends n.ButtonSlot{onDrop(t){if(this.children.length>0)return!1;if(t instanceof r.ItemButton){const e=t,i=e.containerItems,s=e.stackItems.get(0);return this.add(new o.ItemShortcutButton(this.rect.clone(),i,s)),!1}return t instanceof a.TalentButton?!!t.shortcut||(this.add(new a.TalentButton(this.rect.clone(),t.talent,!0)),!1):!!(t instanceof o.ItemShortcutButton||t instanceof a.TalentButton&&t.shortcut)}};h=s([i(0).Serializable("ShortcutButtonSlot")],h),e.ShortcutButtonSlot=h},function(t,e,i){"use strict";function s(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,"__esModule",{value:!0}),s(i(16)),s(i(23)),s(i(18)),s(i(43)),s(i(44)),s(i(5)),s(i(24)),s(i(45)),s(i(46)),s(i(25)),s(i(47)),s(i(26)),s(i(28)),s(i(33)),s(i(8)),s(i(11)),s(i(6)),s(i(49)),s(i(17)),s(i(35)),s(i(20)),s(i(13)),s(i(15)),s(i(52)),s(i(7)),s(i(34)),s(i(54)),s(i(10)),s(i(55)),s(i(12)),s(i(57)),s(i(58)),s(i(3)),s(i(59)),s(i(60)),s(i(40)),s(i(9)),s(i(61)),s(i(19)),s(i(62)),s(i(29)),s(i(4)),s(i(21)),s(i(30)),s(i(36)),s(i(1)),s(i(37)),s(i(0)),s(i(63)),s(i(38)),s(i(64)),s(i(14)),s(i(39)),s(i(22)),s(i(2))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AnimationPromise=class{constructor(){this.handlers=[]}then(t){return this.handlers.push(t),this}resolve(){for(let t=0;t<this.handlers.length;t++)this.handlers[t]()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(18);e.BasicMonster=class extends s.AI{constructor(t,e){super(t),this.damageFunc=e}doAi(){const t=this.actor,e=t.game.player;if(e)if(t.distanceTo(e)>1.5)t.moveToward(e.x,e.y);else if(e.hp>0){const i=this.damageFunc?this.damageFunc(t,e):1;t.attack(e,i)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(18);e.ConfusedMonster=class extends s.AI{constructor(t){super(t),this.numTurns=10,this.oldAi=t.ai}doAi(){if(this.numTurns>0){const t=this.actor.game.rng;this.actor.move(t.nextRange(-1,2),t.nextRange(-1,2)),this.numTurns--}else this.actor.ai=this.oldAi}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(5);e.FadeInAnimation=class extends n.Animation{constructor(t){super(t,!0),this.duration=t}draw(t){const e=t.blackoutRect;if(!e)return;const i=this.countdown/this.duration,n=Math.max(1,Math.min(255,255*i|0)),r=s.fromRgb(0,0,0,n);t.app.drawImage(0,0,e.x,e.y,e.width,e.height,r,t.app.size.width,t.app.size.height)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(11),n=i(5);e.FadeOutAnimation=class extends n.Animation{constructor(t){super(t,!0),this.duration=t}draw(t){const e=t.blackoutRect;if(!e)return;const i=1-this.countdown/this.duration,n=Math.max(1,Math.min(255,255*i|0)),r=s.fromRgb(0,0,0,n);t.app.drawImage(0,0,e.x,e.y,e.width,e.height,r,t.app.size.width,t.app.size.height)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(5);e.ProjectileAnimation=class extends s.Animation{constructor(t,e,i,s){super(s,!0),this.sprite=t,this.position=e,this.velocity=i,this.duration=s}update(){super.update(),this.position.add(this.velocity)}draw(t){const e=this.position.x-t.viewport.x,i=this.position.y-t.viewport.y;this.sprite.draw(t.app,e,i)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=32,n=126;class r{isInRange(t){return t>=s&&t<=n}getStringWidth(t){let e=0;for(let i=0;i<t.length;i++)e+=this.getWidth(t.charCodeAt(i));return e}}e.Font=r,e.MonospacedFont=class extends r{constructor(t){super(),this.glyphSize=t}getOffset(t){return(t-s)*this.glyphSize.width}getWidth(){return this.glyphSize.width}getHeight(){return this.glyphSize.height}};class o extends r{constructor(t,e){super(),this.height=t,this.widths=e,this.offsets=[0];let i=0;for(let t=0;t<this.widths.length;t++)i+=this.widths[t],this.offsets.push(i)}getOffset(t){return this.offsets[t-s]}getWidth(t){return this.widths[t-s]}getHeight(){return this.height}}e.ProportionalFont=o,e.FONT_04B03=new o(8,[4,2,4,6,5,6,6,2,3,3,4,4,3,4,2,6,5,3,5,5,5,5,5,5,5,5,2,2,4,4,4,5,6,5,5,4,5,4,4,5,5,4,5,5,4,6,5,5,5,5,5,5,4,5,5,6,5,5,4,3,6,3,4,5,3,5,5,4,5,5,4,5,5,2,3,5,2,6,5,5,5,5,4,5,4,5,5,6,4,5,5,4,2,4,5,0])},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(21);e.CompoundMessage=class extends s.Message{constructor(...t){super("",0),this.messages=t}draw(t,e){for(let i=0;i<this.messages.length;i++)this.messages[i].draw(t,e)}}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(1),r=i(7),o=i(0);let a=class extends r.Dialog{constructor(){super(new n.Rect(0,0,100,10)),this.messages=[],this.visible=!1}showAt(t,e){if(!this.gui)return;const i=this.gui.app,s=i.font,n=s.getHeight()+2;this.rect.width=10,this.rect.height=10+this.messages.length*n;for(let t=0;t<this.messages.length;t++){const e=this.messages[t],i=10+s.getStringWidth(e.text);this.rect.width=Math.max(this.rect.width,i)}t+this.rect.width>=i.size.width?this.rect.x=t-this.rect.width-2:this.rect.x=t+2,e-this.rect.height<0?this.rect.y=e+2:this.rect.y=e-this.rect.height-2,this.rect.x<0&&(this.rect.x=0),this.rect.y<0&&(this.rect.y=0),this.visible=!0}drawContents(){if(!this.gui)return;super.drawContents();const t=this.gui.app.font.getHeight()+2,e=this.rect.x+5;let i=this.rect.y+5;for(let s=0;s<this.messages.length;s++){const n=this.messages[s];this.gui.app.drawString(n.text,e,i,n.color),i+=t}}handleInput(){return!!this.gui&&(this.gui.app.mouse.isClicked()&&(this.visible=!1),!1)}};a=s([o.Serializable("TooltipDialog")],a),e.TooltipDialog=a},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(14);e.TileMapLayer=class{constructor(t,e){this.width=t,this.height=e,this.imageData=new Uint8Array(4*t*e),this.clear()}clear(){let t=0;for(;t<this.imageData.length;)this.imageData[t++]=0}getIndex(t,e){return 4*(e*this.width+t)}setTile(t,e,i){const s=this.getIndex(t,e);this.imageData[s]=i%64|0,this.imageData[s+1]=i/64|0}getTile(t,e){const i=this.getIndex(t,e);return s.getTileId(this.imageData[i],this.imageData[i+1])}isAnimated(t,e){const i=this.getIndex(t,e);return!!this.imageData[i+2]}setAnimated(t,e,i){const s=this.getIndex(t,e);this.imageData[s+2]=i?1:0}getAlpha(t,e){const i=this.getIndex(t,e);return this.imageData[i+3]}setAlpha(t,e,i){const s=this.getIndex(t,e);this.imageData[s+3]=i}}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(4),r=i(2),o=i(53),a=i(7),h=i(0);let l=class extends a.Dialog{constructor(t,e){super(t),this.options=e,this.selectedIndex=0,this.renderer=new o.DefaultSelectOptionRenderer}drawContents(){if(!this.gui)return;super.drawContents();const t=this.rect,e=new r.Vec2(t.x+4,t.y+4);for(let t=0;t<this.options.length;t++){const i=this.options[t],s=t===this.selectedIndex;this.renderer.drawOption(this.gui,e,i,s),e.y+=this.renderer.getHeight(i,s)}}handleInput(){if(!this.gui)return!1;const t=this.gui.app;for(let e=0;e<this.options.length;e++)t.isKeyPressed(n.Keys.VK_A+e)&&(this.selectedIndex=e,this.onSelect&&this.onSelect(this.options[e]));t.isKeyPressed(n.Keys.VK_ENTER)&&this.onSelect&&this.onSelect(this.options[this.selectedIndex]),t.isKeyPressed(n.Keys.VK_ESCAPE)&&this.onCancel&&this.onCancel(),t.isKeyPressed(n.Keys.VK_UP)&&this.selectedIndex--,t.isKeyPressed(n.Keys.VK_DOWN)&&this.selectedIndex++,this.selectedIndex<0&&(this.selectedIndex+=this.options.length),this.selectedIndex>=this.options.length&&(this.selectedIndex-=this.options.length);const e=t.mouse,i=this.rect;let s=i.y+4;if(1===e.upCount&&e.x>=i.x1&&e.x<i.x2)for(let t=0;t<this.options.length;t++){const i=this.options[t],n=t===this.selectedIndex,r=this.renderer.getHeight(i,n),o=s,a=s+r;e.y>=o&&e.y<a&&(n?this.onSelect&&this.onSelect(i):this.selectedIndex=t),s+=r}return!0}};l=s([h.Serializable("ComplexSelectDialog")],l),e.ComplexSelectDialog=l},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(6);let r=class{getHeight(t,e){return 10}drawOption(t,e,i,s){const r=s?n.Colors.YELLOW:n.Colors.WHITE;t.app.drawString(i.name,e.x,e.y,r)}};r=s([i(0).Serializable("DefaultSelectOptionRenderer")],r),e.DefaultSelectOptionRenderer=r},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3);let r=class extends n.Panel{constructor(t,e){super(e),this.srcRect=t}drawContents(){if(!this.gui)return;const t=this.srcRect,e=this.rect;this.gui.app.drawImage(e.x,e.y,t.x,t.y,e.width,e.height)}};r=s([i(0).Serializable("ImagePanel")],r),e.ImagePanel=r},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(4),r=i(1),o=i(7),a=i(10),h=i(56),l=i(0);let c=class extends o.Dialog{constructor(t,e,i,s){super(t),this.messages=e,this.capacity=i,this.items=s,this.modal=!0,s.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)});for(let t=0;t<i;t++)this.add(new h.ItemContainerButtonSlot(new r.Rect(0,0,24,24),s,n.Keys.VK_A+t))}addItem(t){const e=this.getExistingButton(t);if(e)return void e.stackItems.add(t);const i=this.getNextFreeSlot();i&&i.add(new a.ItemButton(i.rect.clone(),this.items,t))}removeItem(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e),s=i.button;s&&s instanceof a.ItemButton&&s.stackItems.contains(t)&&(s.stackItems.remove(t),0===s.stackItems.length&&i.remove(s))}}getExistingButton(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e).button;if(i&&i instanceof a.ItemButton){const e=i.stackItems.get(0);if(t.isStackable(e))return i}}}getNextFreeSlot(){for(let t=0;t<this.children.length;t++){const e=this.children.get(t);if(!e.button)return e}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect;let i=t.x+4,s=t.y+4;for(let t=0;t<this.messages.length;t++){const e=this.messages[t];this.gui.app.drawString(e.text,i,s,e.color),s+=10}for(let n=0;n<this.capacity;n++){const r=this.children.get(n);r.rect.x=i,r.rect.y=s,r.rect.width=e.width,r.rect.height=e.height,(i+=e.width+2)>t.x2-e.width-4&&(i=t.x+4,s+=e.height+2)}this.rect.height=s+4-t.y,this.drawChildren()}};c=s([l.Serializable("ItemContainerDialog")],c),e.ItemContainerDialog=c},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(15),r=i(10);let o=class extends n.ButtonSlot{constructor(t,e,i){super(t,i),this.items=e}onDrop(t){return t instanceof r.ItemButton}};o=s([i(0).Serializable("ItemContainerButtonSlot")],o),e.ItemContainerButtonSlot=o},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(6),r=i(21),o=i(3),a=i(0),h=i(2);let l=class extends o.Panel{constructor(t,e){super(t),this.messages=[],this.maxItems=e||5}add(t,e){t instanceof o.Panel||(t instanceof r.Message?this.messages.push(t):this.messages.push(new r.Message(t,e||n.Colors.WHITE)),this.messages.length>this.maxItems&&this.messages.splice(0,this.messages.length-this.maxItems))}drawContents(){if(!this.gui)return;const t=new h.Vec2(this.rect.x,this.rect.y);if(t.y<0){const e=this.gui.app.size.height+t.y+this.rect.height;t.y=e-10*this.messages.length}for(let e=0;e<this.messages.length;e++)this.messages[e].draw(this.gui.app,t),t.x=0,t.y+=10}handleInput(){return!1}};l=s([a.Serializable("MessageLog")],l),e.MessageLog=l},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(3);let r=class extends n.Panel{constructor(t,e){super(t),this.message=e}drawContents(){if(!this.gui)return;const t=this.message,e=this.rect;this.gui.app.drawString(t.text,e.x,e.y,t.color)}};r=s([i(0).Serializable("MessagePanel")],r),e.MessagePanel=r},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(4),r=i(7),o=i(0);let a=class extends r.Dialog{constructor(t,e,i){super(t),this.options=e,this.callback=i}drawContents(){if(!this.gui)return;super.drawContents();const t=this.rect;for(let e=0;e<this.options.length;e++){const i=String.fromCharCode(65+e)+" - "+this.options[e].name;this.gui.app.drawString(i,t.x+4,t.y+4+10*e)}}handleInput(){if(!this.gui)return!1;for(let t=0;t<this.options.length;t++)if(this.gui.app.isKeyPressed(n.Keys.VK_A+t))return this.callback(this.options[t]),this.close(),!0;if(this.gui.app.isKeyPressed(n.Keys.VK_ESCAPE))return this.close(),!0;const t=this.gui.app.mouse,e=this.rect;if(t.isClicked()&&t.x>=e.x1&&t.x<e.x2){if(this.closeButton&&t.x>=e.x2-16&&t.y<e.y+16)return this.close(),!0;for(let i=0;i<this.options.length;i++){const s=e.y+4+10*i,n=s+10;t.y>=s&&t.y<n&&(this.callback(this.options[i]),this.close())}}return!0}};a=s([o.Serializable("SelectDialog")],a),e.SelectDialog=a},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(4),r=i(1),o=i(12),a=i(3),h=i(40),l=i(9),c=i(0);let d=class extends a.Panel{constructor(t,e,i){super(t),this.spacing=void 0!==i?i:2;for(let t=0;t<e;t++){const e=new h.ShortcutButtonSlot(new r.Rect(0,0,24,24),n.Keys.VK_1+t);this.add(e)}}addTalent(t,e){if(this.containsTalent(t))return;const i=this.getFreeSlot(!!e);i&&i.add(new l.TalentButton(i.rect.clone(),t,!0))}containsTalent(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e);if(i.button&&i.button instanceof l.TalentButton&&i.button.talent===t)return!0}return!1}addItem(t,e,i){if(this.containsItem(e))return;const s=this.getFreeSlot(!!i);s&&s.add(new o.ItemShortcutButton(s.rect.clone(),t,e))}containsItem(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e);if(i.button&&i.button instanceof o.ItemShortcutButton&&t.isStackable(i.button.shortcutItem))return!0}return!1}drawContents(){if(!this.gui)return;const t=this.gui.renderer.buttonSlotRect;if(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e);i.rect.x=this.rect.x+e*(t.width+2),i.rect.y=this.rect.y,i.rect.width=t.width,i.rect.height=t.height}this.drawChildren()}}getFreeSlot(t){if(t)for(let t=this.children.length-1;t>=0;t--){const e=this.children.get(t);if(!e.button)return e}else for(let t=0;t<this.children.length;t++){const e=this.children.get(t);if(!e.button)return e}}};d=s([c.Serializable("ShortcutBar")],d),e.ShortcutBar=d},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(4),r=i(1),o=i(15),a=i(7),h=i(9),l=i(0);let c=class extends a.Dialog{constructor(t,e,i,s){super(t),this.messages=e,this.capacity=i,this.talents=s,this.modal=!0,s.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)});for(let t=0;t<i;t++)this.add(new o.ButtonSlot(new r.Rect(0,0,24,24),n.Keys.VK_A+t))}addItem(t){const e=this.getNextFreeSlot();e&&e.add(new h.TalentButton(e.rect.clone(),t))}removeItem(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e),s=i.button;s&&s instanceof h.TalentButton&&s.talent===t&&i.remove(s)}}getNextFreeSlot(){for(let t=0;t<this.children.length;t++){const e=this.children.get(t);if(!e.button)return e}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect;let i=t.x+4,s=t.y+4;for(let t=0;t<this.messages.length;t++){const e=this.messages[t];this.gui.app.drawString(e.text,i,s,e.color),s+=10}for(let n=0;n<this.capacity;n++){const r=this.children.get(n);r.rect.x=i,r.rect.y=s,r.rect.width=e.width,r.rect.height=e.height,(i+=e.width+2)>t.x2-e.width-4&&(i=t.x+4,s+=e.height+2)}this.rect.height=s+4-t.y,this.drawChildren()}};c=s([l.Serializable("TalentsDialog")],c),e.TalentsDialog=c},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});const n=i(17);let r=class extends n.Entity{isStackable(t){return this.name===t.name}onBump(t){return t.pickup(this),t.moveToward(this.x,this.y),!0}onPickup(t){}onUse(t){return!1}onUpdateTooltip(){}};r=s([i(0).Serializable("Item")],r),e.Item=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(35),n=i(31),r=i(28),o=i(20),a=i(3),h=i(27),l=i(14),c=i(22);e.Serializer=class{constructor(){this.typeLists={}}serialize(t){return{root:this.serializeObject(t),refs:this.typeLists}}serializeObject(t){if(null==t)return t;const e=typeof t;if("boolean"===e||"number"===e||"string"===e)return t;if(!t.constructor)throw new Error("Object does not have a constructor");if(t instanceof r.App||t instanceof o.GUI||t instanceof a.Panel||t instanceof n.RenderSet||t instanceof l.TileMap||t instanceof c.TileMapRenderer||t instanceof Function)return;if(t instanceof Array)return this.serializeArray(t);const i=h.getSerializeMetadata(t.constructor),d=i.className,u=!i.valueType,p={};if(d&&u){if(void 0!==t.__index)return{__className:d,__index:t.__index};let e=this.typeLists[d];e||(e=[],this.typeLists[d]=e),t.__index=e.length,e.push(p)}const g=Object.getOwnPropertyNames(t);let m=0;for(let e=0;e<g.length;e++){const i=g[e],n=t[i];if("__index"===i)continue;if(t instanceof s.Game&&("tooltip"===i||"tooltipElement"===i||"messageLog"===i))continue;const r=this.serializeObject(n);void 0!==r&&(p[i]=r,m++)}return 0!==m?d&&u?{__className:d,__index:t.__index}:p:void 0}serializeArray(t){const e=[];for(let i=0;i<t.length;i++)e.push(this.serializeObject(t[i]));return e}}},function(t,e,i){"use strict";var s=this&&this.__decorate||function(t,e,i,s){var n,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,i,s);else for(var a=t.length-1;a>=0;a--)(n=t[a])&&(o=(r<3?n(o):r>3?n(e,i,o):n(e,i))||o);return r>3&&o&&Object.defineProperty(e,i,o),o};Object.defineProperty(e,"__esModule",{value:!0});let n=class{constructor(t,e,i){this.actor=t,this.ability=e,this.rank=i||1,this.cooldown=0}use(t){return!(this.cooldown>0||(this.actor.cast(this.ability,t,()=>{this.cooldown=this.ability.cooldown}),0))}};n=s([i(0).Serializable("Talent")],n),e.Talent=n}])},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.HEAD="Head",t.NECK="Neck",t.BACK="Back",t.CHEST="Chest",t.HANDS="Hands",t.LEGS="Legs",t.FEET="Feet",t.RING="Ring",t.MAINHAND="Main Hand",t.OFFHAND="Off Hand"}(e.EquipmentSlot||(e.EquipmentSlot={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(18),r=i(5),o=i(51),a=i(6),h=i(10),l=1367,c=1370;e.Monster=class extends r.StatsActor{constructor(t,e,i,n,o,a){super(t,e,i,n,o),this.ai=new s.BasicMonster(this,this.calculateDamage),this.sentiment=r.Sentiment.HOSTILE,this.level=a,this.strength=10+4*a,this.maxHp=10+3*a,this.hp=this.maxHp,this.armor=2*a,this.loot=this.getLoot()}takeDamage(t,e){super.takeDamage(t,e),this.sentiment=r.Sentiment.HOSTILE}onDeath(t){if(this.game.log(this.name+" is dead"),this.blocks=!1,this.ai=void 0,this.game.entities.remove(this),t instanceof n.Player){const t=this.game.player,e=Math.round(10*t.level*Math.pow(2,.5*(this.level-t.level)));t.addXp(e)}this.game.tileMap.setTile(this.x,this.y,3,this.game.rng.nextRange(l,c));for(let t=0;t<this.loot.length;t++){const e=this.findNearestDropLocation();if(!e)break;const i=this.loot[t];i.x=e.x,i.y=e.y,this.game.entities.add(i)}}calculateDamage(t,e){return t.getDamage()}findNearestDropLocation(){for(let t=0;t<10;t+=.5){const e=Math.ceil(t);for(let i=this.y-e;i<=this.y+e;i++)for(let n=this.x-e;n<=this.x+e;n++)if(Math.hypot(n-this.x,i-this.y)<=t&&!this.game.isBlocked(n,i)&&!this.game.getEntityAt(n,i))return new s.Vec2(n,i)}}getLoot(){const t=this.game,e=[];return this.game.rng.nextRange(0,6)<=2&&e.push(new o.Gold(t,this.x,this.y)),this.game.rng.nextRange(0,6)<=2&&e.push(new h.HealthPotion(t,this.x,this.y)),this.game.rng.nextRange(0,6)<=2&&e.push(new a.EquipmentBuilder(t).withRandomDrop(this.level).build()),e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t.NONE="",t.CLOTH="Cloth",t.LEATHER="Leather",t.MAIL="Mail",t.PLATE="Plate"}(e.EquipmentMaterial||(e.EquipmentMaterial={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),function(t){t[t.POOR=0]="POOR",t[t.COMMON=1]="COMMON",t[t.UNCOMMON=2]="UNCOMMON",t[t.RARE=3]="RARE",t[t.EPIC=4]="EPIC",t[t.LEGENDARY=5]="LEGENDARY"}(e.EquipmentQuality||(e.EquipmentQuality={}))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1);var r;!function(t){t[t.HOSTILE=-1]="HOSTILE",t[t.NEUTRAL=0]="NEUTRAL",t[t.FRIENDLY=1]="FRIENDLY"}(r=e.Sentiment||(e.Sentiment={}));e.StatsActor=class extends s.Actor{constructor(t,e,i,n,o){super(t,e,i,n,o,!0),this.level=1,this.mp=1,this.maxMp=1,this.armor=0,this.strength=10,this.dexterity=10,this.constitution=10,this.intelligence=10,this.recalculateMaxHp(),this.hp=this.maxHp,this.showFrame=!0,this.sentiment=r.NEUTRAL,this.equipment=new s.ArrayList,this.buffs=[],this.equipment.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)})}get strengthModifier(){return this.calculateModifier(this.strength)}get dexterityModifier(){return this.calculateModifier(this.dexterity)}get constitutionModifier(){return this.calculateModifier(this.constitution)}get intelligenceModifier(){return this.calculateModifier(this.intelligence)}calculateModifier(t){return Math.floor((t-10)/2)}getEquipment(t){for(let e=0;e<this.equipment.length;e++){const i=this.equipment.get(e);if(i.slot===t)return i}}get mainHandWeapon(){return this.getEquipment(n.EquipmentSlot.MAINHAND)}getDamage(){const t=this.mainHandWeapon,e=this.game.rng;let i=1,s=this.strengthModifier;return t&&(i=e.nextRange(t.minDamage,t.maxDamage+1),s=t.finesse?this.dexterityModifier:this.strengthModifier),this.buffDamage(i+s)}buffDamage(t){let e=t;for(let t=0;t<this.buffs.length;t++)e=this.buffs[t].modifyDamageDealt(e);return e}takeDamage(t,e){let i=Math.max(0,e-Math.round(.1*this.armor));for(let t=0;t<this.buffs.length;t++)i=this.buffs[t].modifyDamageTaken(i);super.takeDamage(t,i)}onBump(t){return this.sentiment===r.FRIENDLY?this.onTalk(t):t.attack(this,t.getDamage()),!0}onTalk(t){}onAttack(t,e){e>0?this.game.log(this.name+" attacks "+t.name+" for "+e+" hit points.",2155905279):this.game.log(this.name+" attacks "+t.name+" but it has no effect!",2155905279)}startTurn(){super.startTurn();for(let t=this.buffs.length-1;t>=0;t--){const e=this.buffs[t];e.update(),e.isDone()&&this.buffs.splice(t,1)}}equipItem(t){const e=this.getEquipment(t.slot),i=this.hp;e&&this.equipment.remove(e),this.inventory.remove(t),this.equipment.add(t),e&&this.inventory.add(e),this.hp=Math.min(i,this.maxHp)}addItem(t){this.armor+=t.armor,this.constitution+=t.constitution,this.dexterity+=t.dexterity,this.strength+=t.strength,this.intelligence+=t.intelligence,this.recalculateMaxHp()}removeItem(t){this.armor-=t.armor,this.constitution-=t.constitution,this.dexterity-=t.dexterity,this.strength-=t.strength,this.intelligence-=t.intelligence,this.recalculateMaxHp()}recalculateMaxHp(){this.maxHp=8+2*this.level+this.constitutionModifier,this.hp=Math.min(this.hp,this.maxHp)}draw(){super.draw();for(let t=0;t<this.buffs.length;t++)this.buffs[t].draw()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),r=i(3),o=i(4),a=i(27),h=i(7),l=new s.Sprite(160,240,16,24,1,!1,void 0,2155905279);e.EquipmentBuilder=class{constructor(t){this.x=0,this.y=0,this.name="",this.sprite=l,this.itemLevel=1,this.slot=n.EquipmentSlot.HEAD,this.material=r.EquipmentMaterial.NONE,this.quality=o.EquipmentQuality.POOR,this.armor=0,this.strength=0,this.dexterity=0,this.constitution=0,this.intelligence=0,this.minDamage=1,this.maxDamage=2,this.ranged=!1,this.finesse=!1,this.statMultiplier=1,this.game=t}withName(t){return this.name=t,this}withSprite(t,e){return this.sprite=new s.Sprite(t.x,t.y,t.width,t.height,t.frames,t.loop,t.ticksPerFrame,e),this}withColor(t){return this.withSprite(this.sprite,t),this}withItemLevel(t){return this.itemLevel=t,this}withSlot(t){return this.slot=t,this}withMaterial(t){return this.material=t,this}withQuality(t){return this.quality=t,this}withArmor(t){return this.armor=t,this}withStrength(t){return this.strength=t,this}withDexterity(t){return this.dexterity=t,this}withConstitution(t){return this.constitution=t,this}withIntelligence(t){return this.intelligence=t,this}withDamage(t,e,i,s){return this.minDamage=t,this.maxDamage=e,this.ranged=!!i,this.finesse=!!s,this}withRandomDrop(t){return this.itemLevel=t,this.chooseQuality(),this.chooseSlot(),this.chooseFlair(),this}chooseQuality(){const t=this.game.rng.nextRange(0,100);99===t?(this.quality=o.EquipmentQuality.LEGENDARY,this.statMultiplier=1.75):t>97?(this.quality=o.EquipmentQuality.EPIC,this.statMultiplier=1.5):t>90?(this.quality=o.EquipmentQuality.RARE,this.statMultiplier=1.25):t>75?(this.quality=o.EquipmentQuality.UNCOMMON,this.statMultiplier=1.1):t>40?(this.quality=o.EquipmentQuality.COMMON,this.statMultiplier=1):(this.quality=o.EquipmentQuality.POOR,this.statMultiplier=.75)}chooseSlot(){switch(this.game.rng.nextRange(0,10)){case 0:this.chooseHead();break;case 1:this.chooseNeck();break;case 2:this.chooseBack();break;case 3:this.chooseChest();break;case 4:this.chooseHands();break;case 5:this.chooseLegs();break;case 6:this.chooseFeet();break;case 7:this.chooseRing();break;case 8:this.chooseMainHand();break;case 9:this.chooseOffHand()}}chooseHead(){switch(this.slot=n.EquipmentSlot.HEAD,this.game.rng.nextRange(0,3)){case 0:this.material=r.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Cowl","Crown","Hood","Wizard Hat"),this.armor=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.CLOTH_HELM_SPRITES);break;case 1:this.material=r.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Hood","Cover","Facemask","Mask"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.LEATHER_HELM_SPRITES);break;case 2:this.material=r.EquipmentMaterial.PLATE,this.name=this.chooseValue("Helm","Helmet","Headguard","Faceguard","Greathelm"),this.armor=Math.ceil(4.5*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.PLATE_HELM_SPRITES)}}chooseNeck(){this.slot=n.EquipmentSlot.NECK,this.name=this.chooseValue("Necklace"),this.sprite=h.NECKLACE_SPRITE_1}chooseBack(){this.slot=n.EquipmentSlot.BACK,this.name=this.chooseValue("Cloak"),this.sprite=this.chooseArrayValue(h.CLOAK_SPRITES),this.armor=Math.ceil(this.itemLevel*this.statMultiplier)}chooseChest(){switch(this.slot=n.EquipmentSlot.CHEST,this.game.rng.nextRange(0,3)){case 0:this.material=r.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Robe","Tunic"),this.armor=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.ROBE_SPRITES);break;case 1:this.material=r.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Vest","Chestpiece","Tunic"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.SHIRT_SPRITES);break;case 2:this.material=r.EquipmentMaterial.PLATE,this.name=this.chooseValue("Breastplate","Chestguard"),this.armor=Math.ceil(4.5*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.SHIRT_SPRITES)}}chooseHands(){switch(this.slot=n.EquipmentSlot.HANDS,this.game.rng.nextRange(0,3)){case 0:this.material=r.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Gloves","Wraps"),this.armor=Math.ceil(1*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.GLOVES_SPRITES);break;case 1:this.material=r.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Gloves","Gauntlets"),this.armor=Math.ceil(2*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.GLOVES_SPRITES);break;case 2:this.material=r.EquipmentMaterial.PLATE,this.name=this.chooseValue("Gloves","Gauntlets"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.GLOVES_SPRITES)}}chooseLegs(){switch(this.slot=n.EquipmentSlot.LEGS,this.game.rng.nextRange(0,3)){case 0:this.material=r.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Leggings","Pants"),this.armor=Math.ceil(1*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.PANTS_SPRITES);break;case 1:this.material=r.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Legguards","Pants"),this.armor=Math.ceil(2*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.PANTS_SPRITES);break;case 2:this.material=r.EquipmentMaterial.PLATE,this.name=this.chooseValue("Legplates","Legguards"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.PANTS_SPRITES)}}chooseFeet(){switch(this.slot=n.EquipmentSlot.FEET,this.game.rng.nextRange(0,3)){case 0:this.material=r.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Boots","Sandals","Shoes","Slippers","Footpads"),this.armor=Math.ceil(1*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.BOOTS_SPRITES);break;case 1:this.material=r.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Boots","Shoes","Treads"),this.armor=Math.ceil(2*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.BOOTS_SPRITES);break;case 2:this.material=r.EquipmentMaterial.PLATE,this.name=this.chooseValue("Boots","Greaves","Sabatons"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(h.BOOTS_SPRITES)}}chooseRing(){this.slot=n.EquipmentSlot.RING,this.name=this.chooseValue("Ring","Band","Signet","Circle","Loop"),this.sprite=this.chooseArrayValue(h.RING_SPRITES)}chooseMainHand(){switch(this.slot=n.EquipmentSlot.MAINHAND,this.minDamage=Math.floor(1*this.itemLevel*this.statMultiplier),this.maxDamage=Math.ceil(1.2*this.itemLevel*this.statMultiplier),this.game.rng.nextRange(0,7)){case 0:this.name=this.chooseValue("Sword","Blade","Slicer","Sabre"),this.sprite=this.chooseArrayValue(h.SWORD_SPRITES);break;case 1:this.name=this.chooseValue("Axe","Ripper","Slicer"),this.sprite=h.AXE_SPRITE_1;break;case 2:this.name=this.chooseValue("Mace","Hammer","Gavel","Club"),this.sprite=this.chooseArrayValue(h.MACE_SPRITES);break;case 3:this.name=this.chooseValue("Dagger","Knife","Edge"),this.sprite=h.DAGGER_SPRITE_1,this.finesse=!0;break;case 4:this.name=this.chooseValue("Bow","Shortbow","Longbow","Recurve","Greatbow"),this.sprite=h.BOW_SPRITE_1,this.finesse=!0,this.ranged=!0;break;case 5:this.name=this.chooseValue("Crossbow","Bolt-Thrower","Speargun","Repeater"),this.sprite=h.CROSSBOW_SPRITE_1,this.finesse=!0,this.ranged=!0;break;case 6:this.name=this.chooseValue("Staff","Spellstaff"),this.sprite=this.chooseArrayValue(h.STAFF_SPRITES)}}chooseOffHand(){this.slot=n.EquipmentSlot.OFFHAND;const t=this.game.rng.nextRange(0,10);9===t?(this.name="Lantern",this.sprite=h.LANTERN_SPRITE,this.intelligence=Math.ceil(1*this.itemLevel*this.statMultiplier)):8===t?(this.name="Orb",this.sprite=h.ORB_SPRITE,this.intelligence=Math.ceil(1*this.itemLevel*this.statMultiplier)):t>=5?(this.name=this.chooseValue("Spellbook","Tome"),this.sprite=h.BOOK_SPRITE,this.intelligence=Math.ceil(1*this.itemLevel*this.statMultiplier)):(this.name=this.chooseValue("Shield","Shield Wall","Bulwark","Barrier"),this.sprite=this.chooseArrayValue(h.SHIELD_SPRITES),this.armor=Math.ceil(2*this.itemLevel*this.statMultiplier),this.constitution=Math.ceil(1*this.itemLevel*this.statMultiplier))}chooseFlair(){switch(this.quality){case o.EquipmentQuality.POOR:this.choosePoorFlair();break;case o.EquipmentQuality.COMMON:this.chooseCommonFlair();break;case o.EquipmentQuality.UNCOMMON:this.chooseUncommonFlair();break;case o.EquipmentQuality.RARE:this.chooseRareFlair();break;case o.EquipmentQuality.EPIC:this.chooseEpicFlair();break;case o.EquipmentQuality.LEGENDARY:this.chooseLegendaryFlair()}}choosePoorFlair(){this.name=this.chooseValue("Patched","Ragged","Chewed","Worn","Loose")+" "+this.name,this.withColor(s.Colors.LIGHT_GRAY)}chooseCommonFlair(){this.name=this.chooseValue("Hunting","Cadet","Veteran","Simple","Pioneer")+" "+this.name,this.withColor(3231744255)}chooseUncommonFlair(){switch(this.game.rng.nextRange(0,6)){case 0:this.name+=" of the Tiger",this.strength+=Math.ceil(this.itemLevel*this.statMultiplier),this.dexterity+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.ORANGE);break;case 1:this.name+=" of the Bear",this.strength+=Math.ceil(this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.BROWN);break;case 2:this.name+=" of the Gorilla",this.strength+=Math.ceil(this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_CYAN);break;case 3:this.name+=" of the Monkey",this.dexterity+=Math.ceil(this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_GREEN);break;case 4:this.name+=" of the Falcon",this.dexterity+=Math.ceil(this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_RED);break;case 5:this.name+=" of the Eagle",this.constitution+=Math.ceil(this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_BLUE)}}chooseRareFlair(){switch(this.game.rng.nextRange(0,4)){case 0:this.name="Elven "+this.name,this.dexterity+=Math.ceil(this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_MAGENTA);break;case 1:this.name="Obsidian "+this.name,this.strength+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.DARK_MAGENTA);break;case 2:this.name="Saphiron "+this.name,this.dexterity+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.DARK_BLUE);break;case 3:this.name="Scarlet "+this.name,this.intelligence+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.DARK_RED)}}chooseEpicFlair(){this.name="Cody's "+this.name,this.dexterity+=Math.ceil(2*this.itemLevel*this.statMultiplier),this.strength+=Math.ceil(2*this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(2*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(2*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_BLUE)}chooseLegendaryFlair(){this.name="Cody's "+this.name,this.dexterity+=Math.ceil(2.5*this.itemLevel*this.statMultiplier),this.strength+=Math.ceil(2.5*this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(2.5*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(2.5*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_BLUE)}chooseValue(...t){return t[this.game.rng.nextRange(0,t.length)]}chooseArrayValue(t){return t[this.game.rng.nextRange(0,t.length)]}build(){return new a.Equipment(this)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=16,r=24,o=2155905279;e.SWORD_SPRITE_1=new s.Sprite(608,96,n,r,1,!1,void 0,o),e.SWORD_SPRITE_2=new s.Sprite(624,96,n,r,1,!1,void 0,o),e.SWORD_SPRITE_3=new s.Sprite(752,120,n,r,1,!1,void 0,o),e.SWORD_SPRITE_4=new s.Sprite(768,120,n,r,1,!1,void 0,o),e.SWORD_SPRITES=[e.SWORD_SPRITE_1,e.SWORD_SPRITE_2,e.SWORD_SPRITE_3,e.SWORD_SPRITE_4],e.MACE_SPRITE_1=new s.Sprite(640,96,n,r,1,!1,void 0,o),e.MACE_SPRITE_2=new s.Sprite(688,96,n,r,1,!1,void 0,o),e.MACE_SPRITE_3=new s.Sprite(704,96,n,r,1,!1,void 0,o),e.MACE_SPRITE_4=new s.Sprite(720,96,n,r,1,!1,void 0,o),e.MACE_SPRITE_5=new s.Sprite(736,96,n,r,1,!1,void 0,o),e.MACE_SPRITE_6=new s.Sprite(833,96,n,r,1,!1,void 0,o),e.MACE_SPRITES=[e.MACE_SPRITE_1,e.MACE_SPRITE_2,e.MACE_SPRITE_3,e.MACE_SPRITE_4,e.MACE_SPRITE_5,e.MACE_SPRITE_6],e.DAGGER_SPRITE_1=new s.Sprite(672,96,n,r,1,!1,void 0,o),e.AXE_SPRITE_1=new s.Sprite(752,96,n,r,1,!1,void 0,o),e.BOW_SPRITE_1=new s.Sprite(880,96,n,r,1,!1,void 0,o),e.CROSSBOW_SPRITE_1=new s.Sprite(896,96,n,r,1,!1,void 0,o),e.STAFF_SPRITE_1=new s.Sprite(896,120,n,r,1,!1,void 0,o),e.STAFF_SPRITE_2=new s.Sprite(608,120,n,r,1,!1,void 0,o),e.STAFF_SPRITE_3=new s.Sprite(624,120,n,r,1,!1,void 0,o),e.STAFF_SPRITE_4=new s.Sprite(640,120,n,r,1,!1,void 0,o),e.STAFF_SPRITE_5=new s.Sprite(656,120,n,r,1,!1,void 0,o),e.STAFF_SPRITES=[e.STAFF_SPRITE_1,e.STAFF_SPRITE_2,e.STAFF_SPRITE_3,e.STAFF_SPRITE_4,e.STAFF_SPRITE_5],e.SHIRT_SPRITE_1=new s.Sprite(608,144,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_2=new s.Sprite(608,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_3=new s.Sprite(624,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_4=new s.Sprite(640,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_5=new s.Sprite(656,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_6=new s.Sprite(672,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_7=new s.Sprite(688,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_8=new s.Sprite(704,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_9=new s.Sprite(720,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_10=new s.Sprite(736,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITE_11=new s.Sprite(752,264,n,r,1,!1,void 0,o),e.SHIRT_SPRITES=[e.SHIRT_SPRITE_1,e.SHIRT_SPRITE_2,e.SHIRT_SPRITE_3,e.SHIRT_SPRITE_4,e.SHIRT_SPRITE_5,e.SHIRT_SPRITE_6,e.SHIRT_SPRITE_7,e.SHIRT_SPRITE_8,e.SHIRT_SPRITE_9,e.SHIRT_SPRITE_10,e.SHIRT_SPRITE_11],e.ROBE_SPRITE_1=new s.Sprite(608,288,n,r,1,!1,void 0,o),e.ROBE_SPRITE_2=new s.Sprite(624,288,n,r,1,!1,void 0,o),e.ROBE_SPRITE_3=new s.Sprite(640,288,n,r,1,!1,void 0,o),e.ROBE_SPRITE_4=new s.Sprite(656,288,n,r,1,!1,void 0,o),e.ROBE_SPRITE_5=new s.Sprite(672,288,n,r,1,!1,void 0,o),e.ROBE_SPRITE_6=new s.Sprite(688,288,n,r,1,!1,void 0,o),e.ROBE_SPRITE_7=new s.Sprite(704,288,n,r,1,!1,void 0,o),e.ROBE_SPRITE_8=new s.Sprite(720,288,n,r,1,!1,void 0,o),e.ROBE_SPRITE_9=new s.Sprite(736,288,n,r,1,!1,void 0,o),e.ROBE_SPRITE_10=new s.Sprite(752,288,n,r,1,!1,void 0,o),e.ROBE_SPRITES=[e.ROBE_SPRITE_1,e.ROBE_SPRITE_2,e.ROBE_SPRITE_3,e.ROBE_SPRITE_4,e.ROBE_SPRITE_5,e.ROBE_SPRITE_6,e.ROBE_SPRITE_7,e.ROBE_SPRITE_8,e.ROBE_SPRITE_9,e.ROBE_SPRITE_10],e.HELM_SPRITE_1=new s.Sprite(608,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_2=new s.Sprite(624,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_3=new s.Sprite(640,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_4=new s.Sprite(656,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_5=new s.Sprite(672,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_6=new s.Sprite(688,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_7=new s.Sprite(704,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_8=new s.Sprite(720,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_9=new s.Sprite(736,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_10=new s.Sprite(752,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_11=new s.Sprite(768,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_12=new s.Sprite(784,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_13=new s.Sprite(800,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_14=new s.Sprite(816,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_15=new s.Sprite(832,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_16=new s.Sprite(848,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_17=new s.Sprite(864,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_18=new s.Sprite(880,240,n,r,1,!1,void 0,o),e.HELM_SPRITE_19=new s.Sprite(896,240,n,r,1,!1,void 0,o),e.HELM_SPRITES=[e.HELM_SPRITE_1,e.HELM_SPRITE_2,e.HELM_SPRITE_3,e.HELM_SPRITE_4,e.HELM_SPRITE_5,e.HELM_SPRITE_6,e.HELM_SPRITE_7,e.HELM_SPRITE_8,e.HELM_SPRITE_9,e.HELM_SPRITE_10,e.HELM_SPRITE_11,e.HELM_SPRITE_12,e.HELM_SPRITE_13,e.HELM_SPRITE_14,e.HELM_SPRITE_15,e.HELM_SPRITE_16,e.HELM_SPRITE_17,e.HELM_SPRITE_18,e.HELM_SPRITE_19],e.CLOTH_HELM_SPRITES=[e.HELM_SPRITE_12,e.HELM_SPRITE_13,e.HELM_SPRITE_14,e.HELM_SPRITE_15,e.HELM_SPRITE_16],e.LEATHER_HELM_SPRITES=[e.HELM_SPRITE_1,e.HELM_SPRITE_2,e.HELM_SPRITE_4,e.HELM_SPRITE_6,e.HELM_SPRITE_7,e.HELM_SPRITE_17,e.HELM_SPRITE_18,e.HELM_SPRITE_19],e.PLATE_HELM_SPRITES=[e.HELM_SPRITE_1,e.HELM_SPRITE_4,e.HELM_SPRITE_8,e.HELM_SPRITE_9,e.HELM_SPRITE_10,e.HELM_SPRITE_11,e.HELM_SPRITE_19],e.GLOVES_SPRITE_1=new s.Sprite(608,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITE_2=new s.Sprite(624,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITE_3=new s.Sprite(640,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITE_4=new s.Sprite(656,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITE_5=new s.Sprite(672,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITE_6=new s.Sprite(688,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITE_7=new s.Sprite(704,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITE_8=new s.Sprite(720,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITE_9=new s.Sprite(736,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITE_10=new s.Sprite(752,312,n,r,1,!1,void 0,o),e.GLOVES_SPRITES=[e.GLOVES_SPRITE_1,e.GLOVES_SPRITE_2,e.GLOVES_SPRITE_3,e.GLOVES_SPRITE_4,e.GLOVES_SPRITE_5,e.GLOVES_SPRITE_6,e.GLOVES_SPRITE_7,e.GLOVES_SPRITE_8,e.GLOVES_SPRITE_9,e.GLOVES_SPRITE_10],e.PANTS_SPRITE_1=new s.Sprite(656,144,n,r,1,!1,void 0,o),e.PANTS_SPRITE_2=new s.Sprite(768,312,n,r,1,!1,void 0,o),e.PANTS_SPRITE_3=new s.Sprite(784,312,n,r,1,!1,void 0,o),e.PANTS_SPRITE_4=new s.Sprite(800,312,n,r,1,!1,void 0,o),e.PANTS_SPRITE_5=new s.Sprite(816,312,n,r,1,!1,void 0,o),e.PANTS_SPRITE_6=new s.Sprite(832,312,n,r,1,!1,void 0,o),e.PANTS_SPRITE_7=new s.Sprite(848,312,n,r,1,!1,void 0,o),e.PANTS_SPRITES=[e.PANTS_SPRITE_1,e.PANTS_SPRITE_2,e.PANTS_SPRITE_3,e.PANTS_SPRITE_4,e.PANTS_SPRITE_5,e.PANTS_SPRITE_6,e.PANTS_SPRITE_7],e.BOOTS_SPRITE_1=new s.Sprite(640,144,n,r,1,!1,void 0,o),e.BOOTS_SPRITES=[e.BOOTS_SPRITE_1],e.SHIELD_SPRITE_1=new s.Sprite(688,144,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_2=new s.Sprite(608,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_3=new s.Sprite(624,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_4=new s.Sprite(640,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_5=new s.Sprite(656,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_6=new s.Sprite(672,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_7=new s.Sprite(688,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_8=new s.Sprite(704,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_9=new s.Sprite(720,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_10=new s.Sprite(736,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_11=new s.Sprite(752,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_12=new s.Sprite(768,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_13=new s.Sprite(784,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_14=new s.Sprite(800,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_15=new s.Sprite(816,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_16=new s.Sprite(832,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITE_17=new s.Sprite(848,216,n,r,1,!1,void 0,o),e.SHIELD_SPRITES=[e.SHIELD_SPRITE_1,e.SHIELD_SPRITE_2,e.SHIELD_SPRITE_3,e.SHIELD_SPRITE_4,e.SHIELD_SPRITE_5,e.SHIELD_SPRITE_6,e.SHIELD_SPRITE_7,e.SHIELD_SPRITE_8,e.SHIELD_SPRITE_9,e.SHIELD_SPRITE_10,e.SHIELD_SPRITE_11,e.SHIELD_SPRITE_12,e.SHIELD_SPRITE_13,e.SHIELD_SPRITE_14,e.SHIELD_SPRITE_15,e.SHIELD_SPRITE_16,e.SHIELD_SPRITE_17],e.NECKLACE_SPRITE_1=new s.Sprite(768,144,n,r,1,!1,void 0,o),e.RING_SPRITE_1=new s.Sprite(784,144,n,r,1,!1,void 0,o),e.RING_SPRITE_2=new s.Sprite(800,144,n,r,1,!1,void 0,o),e.RING_SPRITES=[e.RING_SPRITE_1,e.RING_SPRITE_2],e.CLOAK_SPRITE_1=new s.Sprite(768,288,n,r,1,!1,void 0,o),e.CLOAK_SPRITE_2=new s.Sprite(784,288,n,r,1,!1,void 0,o),e.CLOAK_SPRITE_3=new s.Sprite(800,288,n,r,1,!1,void 0,o),e.CLOAK_SPRITE_4=new s.Sprite(816,288,n,r,1,!1,void 0,o),e.CLOAK_SPRITE_5=new s.Sprite(832,288,n,r,1,!1,void 0,o),e.CLOAK_SPRITE_6=new s.Sprite(848,288,n,r,1,!1,void 0,o),e.CLOAK_SPRITE_7=new s.Sprite(864,288,n,r,1,!1,void 0,o),e.CLOAK_SPRITES=[e.CLOAK_SPRITE_1,e.CLOAK_SPRITE_2,e.CLOAK_SPRITE_3,e.CLOAK_SPRITE_4,e.CLOAK_SPRITE_5,e.CLOAK_SPRITE_6,e.CLOAK_SPRITE_7],e.LANTERN_SPRITE=new s.Sprite(880,168,n,r,1,!1,void 0,o),e.ORB_SPRITE=new s.Sprite(848,168,n,r,1,!1,void 0,o),e.CLOCK_SPRITE=new s.Sprite(880,144,n,r,1,!1,void 0,o),e.BOOK_SPRITE=new s.Sprite(816,168,n,r,1,!1,void 0,o)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(26),r=3,o=2,a=s.fromRgb(255,128,128),h=new s.Sprite(720,336,16,24,void 0,void 0,void 0,a),l=[new s.Message("Heroic Leap",s.Colors.WHITE),new s.Message("Instant cast",s.Colors.WHITE),new s.Message("Stun all enemies within 1 tile.",s.Colors.YELLOW)];e.LeapAbility=class{constructor(){this.sprite=h,this.name="leap",this.targetType=s.TargetType.TILE,this.minRange=1,this.maxRange=r,this.cooldown=10,this.tooltipMessages=l}cast(t,e){const i=t.game;if(t.distanceTo(e)>r)return t===i.player&&i.log("Target out of range.",s.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(e.x,e.y))return t===i.player&&i.log("Target not visible.",s.Colors.LIGHT_GRAY),!1;if(i.tileMap&&i.tileMap.isBlocked(e.x,e.y))return t===i.player&&i.log("Target is blocked.",s.Colors.LIGHT_GRAY),!1;if(i.getActorAt(e.x,e.y))return t===i.player&&i.log("Target is occupied.",s.Colors.LIGHT_GRAY),!1;const h=(e.x-t.x)*i.tileSize.width/4,l=(e.y-t.y)*i.tileSize.height/4;return i.addAnimation(new s.SlideAnimation(t,h,l,4)).then(()=>{t.x=e.x,t.y=e.y;let r=0;for(let a=i.entities.length-1;a>=0;a--){const h=i.entities.get(a);h!==t&&h instanceof s.Actor&&h.distanceTo(e)<o&&(h.ai=new n.Stunned(h,1),r++)}r>0&&i.log("Stunned "+r+" foes!",a),t.ap--}),!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.CharacterClass=class{constructor(t,e,i,s){this.name=t,this.icon=e,this.description=i,this.details=s}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=4,r=new s.Sprite(656,168,16,24,1,!0,void 0,4278190335),o=[new s.Message("Ancient Healing Potion",s.Colors.LIGHT_BLUE),new s.Message("Item Level 5",s.Colors.YELLOW),new s.Message("Use: Restore 10 health",s.Colors.LIGHT_GREEN)];e.HealthPotion=class extends s.Item{constructor(t,e,i){super(t,e||0,i||0,"health potion",r,!1),this.tooltipMessages=o}onPickup(t){this.game.log(t.name+" picked up a "+this.name,s.Colors.LIGHT_GREEN)}onUse(t){return t.hp===t.maxHp?(this.game.log("You are already at full health.",s.Colors.DARK_RED),!1):(this.game.log("Your wounds start to feel better!",s.Colors.LIGHT_MAGENTA),t.takeHeal(n),t.inventory.remove(this),t.ap--,!0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.CharacterRace=class{constructor(t,e,i,s){this.name=t,this.icon=e,this.description=i,this.details=s}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=5,r=[new s.Message("Lightning",s.Colors.WHITE),new s.Message("10 mana",s.Colors.WHITE),new s.Message("Instant cast",s.Colors.WHITE),new s.Message("Hurls a bolt of lightning at the nearest enemy",s.Colors.YELLOW),new s.Message("dealing 4 + INT damage.",s.Colors.YELLOW)];e.LightningAbility=class{constructor(){this.sprite=new s.Sprite(158,10,16,24,void 0,void 0,void 0,4294902015),this.name="lightning",this.targetType=s.TargetType.SELF,this.minRange=1,this.maxRange=n,this.cooldown=10,this.tooltipMessages=r}cast(t){const e=t.game,i=this.getClosestMonster(e,t,t.x,t.y,n);if(!i)return e.log("No enemy is close enough to strike.",s.Colors.LIGHT_RED),!1;e.log("A lightning bolt strikes the "+i.name+" with a loud thunder!",s.Colors.LIGHT_BLUE);const r=4+t.intelligenceModifier,o=new s.Sprite(256,408,16,24,2,!0,8,s.Colors.YELLOW);return e.addAnimation(new s.ProjectileAnimation(o,new s.Vec2(i.pixelX,i.pixelY),new s.Vec2(0,0),32)).then(()=>{e.log("The damage is "+r+" hit points",s.Colors.LIGHT_BLUE),i.takeDamage(t,r),t.ap--}),!0}getClosestMonster(t,e,i,n,r){let o=r+1,a=null;for(let r=0;r<t.entities.length;r++){const h=t.entities.get(r);if(h===e)continue;if(!(h instanceof s.Actor))continue;if(t.tileMap&&!t.tileMap.isVisible(h.x,h.y))continue;const l=h.distance(i,n);l<o&&(o=l,a=h)}return a}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Buff=class{constructor(t){this.actor=t}update(){}modifyDamageTaken(t){return t}modifyDamageDealt(t){return t}draw(){}isDone(){return!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.MenuItemRenderer=class{constructor(t,e){this.expandedHeight=t,this.collapsedHeight=e}drawOption(t,e,i,n){const r=t.app;let o=e.x;const a=e.y;let h=s.Colors.GRAY,l=s.Colors.GRAY,c=s.Colors.GRAY;if(n&&(h=void 0,l=s.Colors.YELLOW,c=s.Colors.WHITE),i.icon&&(i.icon.draw(r,o,a,h),o+=i.icon.width+2),r.drawString(i.name,o,a,l),i.description&&r.drawString(i.description,o+3,a+10,c),n&&i.details)for(let t=0;t<i.details.length;t++){const e=i.details[t],h=n?e.color:s.Colors.LIGHT_GRAY;r.drawString(e.text,o+3,a+20+10*t,h)}}getHeight(t,e){return e?this.expandedHeight:this.collapsedHeight}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(16),r=i(8),o=i(12),a=i(9),h=i(6),l=i(7),c=i(1),d=i(4),u=i(3),p="Paladin",g=new s.Sprite(504,700,24,26,void 0,void 0,void 0,4286611711),m=new s.Sprite(320,96,16,24,2,!0,void 0,4286611711),w="Holy warriors commanding the power of the light",y=[new s.Message("+2 Strength, +2 Intelligence",s.Colors.LIGHT_GREEN),new s.Message("Heroic Leap - jump up to 3 tiles and stun enemies",s.Colors.YELLOW)];e.Paladin=class extends a.CharacterClass{constructor(){super(p,g,w,y)}initPlayer(t){const e=t.game;t.class=this,t.sprite=m,t.talents.add(new s.Talent(t,new r.LeapAbility)),t.talents.add(new s.Talent(t,new o.LightningAbility)),t.talents.add(new s.Talent(t,new n.FlashHealAbility)),t.equipment.add(new h.EquipmentBuilder(e).withName("Squire's Vest").withItemLevel(1).withSlot(c.EquipmentSlot.CHEST).withQuality(d.EquipmentQuality.COMMON).withMaterial(u.EquipmentMaterial.PLATE).withSprite(l.SHIRT_SPRITE_1,3231744255).withArmor(7).build()),t.equipment.add(new h.EquipmentBuilder(e).withName("Squire's Pants").withItemLevel(1).withSlot(c.EquipmentSlot.LEGS).withQuality(d.EquipmentQuality.COMMON).withMaterial(u.EquipmentMaterial.PLATE).withSprite(l.PANTS_SPRITE_1,3231744255).withArmor(6).build()),t.equipment.add(new h.EquipmentBuilder(e).withName("Squire's Boots").withItemLevel(1).withSlot(c.EquipmentSlot.FEET).withQuality(d.EquipmentQuality.COMMON).withMaterial(u.EquipmentMaterial.PLATE).withSprite(l.BOOTS_SPRITE_1,3231744255).withArmor(5).build()),t.equipment.add(new h.EquipmentBuilder(e).withName("Battleworn Hammer").withItemLevel(1).withSlot(c.EquipmentSlot.MAINHAND).withQuality(d.EquipmentQuality.COMMON).withDamage(1,2).withSprite(l.MACE_SPRITE_1,3231744255).build()),t.strength+=2,t.intelligence+=2}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=new s.Sprite(672,144,16,24,1,!1,void 0,4291875071),r=[new s.Message("Flash Heal",s.Colors.WHITE),new s.Message("20 mana",s.Colors.WHITE),new s.Message("A fast spell that heals an ally",s.Colors.YELLOW),new s.Message("for 1d8 + INT points.",s.Colors.YELLOW)];e.FlashHealAbility=class{constructor(){this.sprite=n,this.name="Flash Heal",this.targetType=s.TargetType.SELF,this.minRange=0,this.maxRange=0,this.cooldown=5,this.tooltipMessages=r}cast(t){if(t.hp===t.maxHp)return t===t.game.player&&t.game.log("You are already at full health.",s.Colors.DARK_RED),!1;const e=t.game.rng.nextRange(1,8)+t.intelligenceModifier;return t.takeHeal(e),t.ap--,!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(29),r=10,o=3,a=s.Colors.ORANGE,h=new s.Sprite(512,336,16,24,void 0,void 0,void 0,a),l=[new s.Message("Fireball",s.Colors.WHITE),new s.Message("2% of base mana",s.Colors.WHITE),new s.Message("2 turn cast",s.Colors.WHITE),new s.Message("Throws a fiery ball causing 8 + INT damage",s.Colors.YELLOW),new s.Message("to all enemies within 3 tiles.",s.Colors.YELLOW)];e.FireballAbility=class{constructor(){this.sprite=h,this.name="fireball",this.targetType=s.TargetType.TILE,this.minRange=1,this.maxRange=r,this.cooldown=30,this.tooltipMessages=l}cast(t,e){const i=t.game,a=t.distanceTo(e);if(a>r)return t===i.player&&i.log("Target out of range.",s.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(e.x,e.y))return t===i.player&&i.log("Target not visible.",s.Colors.LIGHT_GRAY),!1;const l=a*(i.tileSize.width/8),c=(e.x*i.tileSize.width-t.pixelX)/l,d=(e.y*i.tileSize.height-t.pixelY)/l;return t.ap--,i.addAnimation(new s.ProjectileAnimation(h,new s.Vec2(t.pixelX,t.pixelY),new s.Vec2(c,d),l)).then(()=>{i.addAnimation(new n.ExplosionAnimation(i,e,o,30)).then(()=>{i.log("The fireball explodes, burning everything within "+o+" tiles!",s.Colors.ORANGE);const n=t.buffDamage(8+t.intelligenceModifier);for(let r=i.entities.length-1;r>=0;r--){const a=i.entities.get(r);a!==t&&a instanceof s.Actor&&a.distanceTo(e)<=o&&(i.log("The "+a.name+" gets burned for "+n+" hit points.",s.Colors.ORANGE),a.takeDamage(t,n))}})}),!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(15),r=i(19),o=i(5),a=new s.Sprite(0,96,16,24,2,!0,void 0,4291779839);e.Player=class extends o.StatsActor{constructor(t,e,i){super(t,e,i,"Player",a),this.level=1,this.hp=10,this.maxHp=10,this.xp=0,this.maxXp=20,this.race=new r.Human,this.class=new n.Paladin,this.remainingAbilityPoints=0,this.home=new s.Vec2(e,i),this.keys=new Array(1e3)}takeDamage(t,e){this.game.stopAutoWalk(),super.takeDamage(t,e)}onDeath(){this.game.log("You died!")}addXp(t){this.xp+=t,this.addFloatingText("+"+t,s.Colors.LIGHT_MAGENTA);let e=!1;for(;this.xp>=this.maxXp;)this.level++,this.xp-=this.maxXp,this.maxXp=this.nextMaxXp(this.maxXp),this.remainingAbilityPoints+=2,this.game.log("You reached level "+this.level,s.Colors.LIGHT_MAGENTA),e=!0;e&&(this.recalculateMaxHp(),this.game.levelUpDialog.visible=!0)}nextMaxXp(t){return 10*Math.round(1.5*t/10)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(11),r="Human",o=new s.Sprite(0,730,34,34,void 0,void 0,void 0,3719193343),a="Young race with lust for power",h=[new s.Message("+1 all attributes",s.Colors.LIGHT_GREEN),new s.Message("Reduced stun times",s.Colors.YELLOW),new s.Message("Hustle - when active, double actions",s.Colors.YELLOW)];e.Human=class extends n.CharacterRace{constructor(){super(r,o,a,h)}initPlayer(t){t.race=this,t.constitution++,t.strength++,t.dexterity++,t.intelligence++}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=new s.Sprite(736,168,16,24,1,!0,void 0,4042318079);e.Scroll=class extends s.Item{constructor(t,e,i,s){super(t,e,i,"scroll of "+s.name,n,!1),this.ability=s,this.tooltipMessages=s.tooltipMessages}onPickup(t){this.game.log(t.name+" picked up a "+this.name,s.Colors.LIGHT_GREEN)}onUse(t){this.game.hideAllDialogs();const e=this.ability;return e.targetType===s.TargetType.SELF?e.cast(t)&&t.inventory.remove(this):this.game.startTargeting(e,()=>{t.inventory.remove(this)}),!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=new s.Sprite(688,168,16,24,1,!0,void 0,4294902015);e.Key=class extends s.Item{constructor(t,e,i,s){super(t,e,i,"key",n,!1),this.keyId=s}onBump(t){return t.keys[this.keyId]=!0,t.moveTo(this.x,this.y),this.game.entities.remove(this),!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=s.getTileId(7,20),r=new s.Sprite(256,432,16,24,1,!0,void 0,2151686399);e.Door=class extends s.Item{constructor(t,e,i){super(t,e,i,"door",r,!0),this.zIndex=0}openDoor(){const t=this.game,e=t.tileMap;t.entities.remove(this),e.setTile(this.x,this.y,0,n),e.setBlocked(this.x,this.y,!1)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=new(i(24).App);window.location.hash&&"#"!==window.location.hash&&(window.location.hash=""),window.addEventListener("hashchange",function(){const t=window.location.hash;"#startgame"===t?s.startGame():"#game"===t?s.playGame():"#chooseseed"===t?s.chooseSeed():"#chooserace"===t?s.chooseRace():"#chooseclass"===t?s.chooseClass():"#highscores"===t?s.showHighScores():"#credits"===t?s.showCredits():s.showMainMenu()})},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(0),r=i(25),o=i(44),a=i(70),h=i(71),l=i(76),c=i(77);e.App=class extends s.App{constructor(){super({canvas:document.querySelector("canvas"),imageUrl:"graphics.png",size:new n.Rect(0,0,224,400),fillWindow:!0}),this.mainMenu=new a.MainMenu(this),this.seedMenu=new c.SeedMenu(this),this.raceMenu=new h.RaceMenu(this),this.classMenu=new r.ClassMenu(this),this.highScores=new n.AppState(this),this.credits=new n.AppState(this),this.seed=0,this.showMainMenu()}showMainMenu(){this.state=this.mainMenu}chooseSeed(){this.state=this.seedMenu}chooseRace(){this.state=this.raceMenu}chooseClass(){this.state=this.classMenu}startGame(){this.game=new o.Game(this,this.seed),this.game.player.inventory.add(new l.Hearthstone(this.game)),this.playerRace&&this.playerRace.initPlayer(this.game.player),this.playerClass&&this.playerClass.initPlayer(this.game.player),window.location.hash="game"}playGame(){const t=this.game;this.state=t,t.addAnimation(new n.FadeInAnimation(30))}showHighScores(){this.state=this.highScores}showCredits(){this.state=this.credits}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(15),r=i(28),o=i(32),a=i(34),h=i(36),l=i(41),c=i(14),d=[new n.Paladin,new r.Priest,new o.Ranger,new a.Rogue,new h.Warlock,new l.Warrior];e.ClassMenu=class extends s.AppState{constructor(t){super(t),this.gui.renderer.baseRect=new s.Rect(0,64,24,24),this.gui.add(new s.MessagePanel(new s.Rect(2,2,256,10),new s.Message("Choose your class",s.Colors.WHITE)));const e=new s.ComplexSelectDialog(new s.Rect(2,15,246,204),d);e.renderer=new c.MenuItemRenderer(60,30),e.onSelect=(t=>{this.app.playerClass=t,window.location.hash="startgame"}),e.onCancel=(()=>{window.history.back()}),this.gui.add(e)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Stunned=class extends s.AI{constructor(t,e){super(t),this.numTurns=e,this.oldAi=t.ai}doAi(){this.numTurns>0?this.numTurns--:this.actor.ai=this.oldAi}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),r=i(3),o=i(4),a=2644352511,h=4294967295,l=520028415,c=7396863,d=2738220799,u=4286578943;e.Equipment=class extends s.Item{constructor(t){super(t.game,t.x,t.y,t.name,t.sprite,!1),this.itemLevel=t.itemLevel,this.slot=t.slot,this.material=t.material,this.quality=t.quality,this.armor=t.armor,this.strength=t.strength,this.dexterity=t.dexterity,this.constitution=t.constitution,this.intelligence=t.intelligence,this.minDamage=t.minDamage,this.maxDamage=t.maxDamage,this.ranged=t.ranged,this.finesse=t.finesse,this.onUpdateTooltip()}getColor(t){switch(t){case o.EquipmentQuality.COMMON:return h;case o.EquipmentQuality.UNCOMMON:return l;case o.EquipmentQuality.RARE:return c;case o.EquipmentQuality.EPIC:return d;case o.EquipmentQuality.LEGENDARY:return u;default:return a}}isStackable(){return!1}onPickup(t){this.game.log(new s.CompoundMessage(new s.Message(t.name+" picked up ",s.Colors.WHITE),new s.Message("["+this.name+"]",this.getColor(this.quality))))}onUse(t){return t.equipItem(this),!1}onUpdateTooltip(){const t=this.game.player.getEquipment(this.slot);t&&t!==this?this.buildComparisonTooltip(t):this.buildNormalTooltip()}buildComparisonTooltip(t){this.tooltipMessages=[],this.tooltipMessages.push(new s.Message(this.name,this.getColor(this.quality))),this.tooltipMessages.push(new s.Message("Item Level "+this.itemLevel+" (vs "+t.itemLevel+")",s.Colors.YELLOW)),this.material===r.EquipmentMaterial.NONE?this.tooltipMessages.push(new s.Message(this.slot,s.Colors.WHITE)):this.tooltipMessages.push(new s.Message(this.slot+", "+this.material,s.Colors.WHITE)),this.slot===n.EquipmentSlot.MAINHAND&&this.tooltipMessages.push(new s.Message(this.minDamage+"-"+this.maxDamage+" Damage (vs "+t.minDamage+"-"+t.maxDamage+")",s.Colors.YELLOW)),(this.armor>0||t.armor>0)&&this.tooltipMessages.push(new s.Message(this.armor+" Armor (vs "+t.armor+")",s.Colors.YELLOW)),(this.strength>0||t.strength>0)&&this.tooltipMessages.push(new s.Message("+"+this.strength+" Strength (vs "+t.strength+")",s.Colors.LIGHT_GREEN)),(this.dexterity>0||t.dexterity>0)&&this.tooltipMessages.push(new s.Message("+"+this.dexterity+" Dexterity (vs "+t.dexterity+")",s.Colors.LIGHT_GREEN)),(this.constitution>0||t.constitution>0)&&this.tooltipMessages.push(new s.Message("+"+this.constitution+" Constitution (vs "+t.constitution+")",s.Colors.LIGHT_GREEN)),(this.intelligence>0||t.intelligence>0)&&this.tooltipMessages.push(new s.Message("+"+this.intelligence+" Intelligence (vs "+t.intelligence+")",s.Colors.LIGHT_GREEN))}buildNormalTooltip(){this.tooltipMessages=[],this.tooltipMessages.push(new s.Message(this.name,this.getColor(this.quality))),this.tooltipMessages.push(new s.Message("Item Level "+this.itemLevel,s.Colors.YELLOW)),this.material===r.EquipmentMaterial.NONE?this.tooltipMessages.push(new s.Message(this.slot,s.Colors.WHITE)):this.tooltipMessages.push(new s.Message(this.slot+", "+this.material,s.Colors.WHITE)),this.slot===n.EquipmentSlot.MAINHAND&&this.tooltipMessages.push(new s.Message(this.minDamage+"-"+this.maxDamage+" Damage",s.Colors.YELLOW)),this.armor>0&&this.tooltipMessages.push(new s.Message(this.armor+" Armor",s.Colors.YELLOW)),this.strength>0&&this.tooltipMessages.push(new s.Message("+"+this.strength+" Strength",s.Colors.LIGHT_GREEN)),this.dexterity>0&&this.tooltipMessages.push(new s.Message("+"+this.dexterity+" Dexterity",s.Colors.LIGHT_GREEN)),this.constitution>0&&this.tooltipMessages.push(new s.Message("+"+this.constitution+" Constitution",s.Colors.LIGHT_GREEN)),this.intelligence>0&&this.tooltipMessages.push(new s.Message("+"+this.intelligence+" Intelligence",s.Colors.LIGHT_GREEN))}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(17),r=i(16),o=i(12),a=i(9),h=i(30),l=i(7),c=i(6),d=i(1),u=i(4),p=i(3),g="Priest",m=new s.Sprite(0,700,24,26,void 0,void 0,void 0,4294967295),w=new s.Sprite(384,96,16,24,2,!0,void 0,4177066239),y="Devoted to the spiritual, powerful healing magic",f=[new s.Message("+5 Intelligence",s.Colors.LIGHT_GREEN),new s.Message("Heroic Leap - jump up to 3 tiles and stun enemies",s.Colors.YELLOW)];e.Priest=class extends a.CharacterClass{constructor(){super(g,m,y,f)}initPlayer(t){const e=t.game;t.class=this,t.sprite=w,t.talents.add(new s.Talent(t,new n.FireballAbility)),t.talents.add(new s.Talent(t,new o.LightningAbility)),t.talents.add(new s.Talent(t,new r.FlashHealAbility)),t.talents.add(new s.Talent(t,new h.BubbleAbility)),t.equipment.add(new c.EquipmentBuilder(e).withName("Neophyte's Robe").withItemLevel(1).withSlot(d.EquipmentSlot.CHEST).withQuality(u.EquipmentQuality.COMMON).withMaterial(p.EquipmentMaterial.CLOTH).withSprite(l.ROBE_SPRITE_1,3231744255).withArmor(2).build()),t.equipment.add(new c.EquipmentBuilder(e).withName("Neophyte's Pants").withItemLevel(1).withSlot(d.EquipmentSlot.LEGS).withQuality(u.EquipmentQuality.COMMON).withMaterial(p.EquipmentMaterial.CLOTH).withSprite(l.PANTS_SPRITE_1,3231744255).withArmor(2).build()),t.equipment.add(new c.EquipmentBuilder(e).withName("Neophyte's Shoes").withItemLevel(1).withSlot(d.EquipmentSlot.FEET).withQuality(u.EquipmentQuality.COMMON).withMaterial(p.EquipmentMaterial.CLOTH).withSprite(l.BOOTS_SPRITE_1,3231744255).withArmor(1).build()),t.equipment.add(new c.EquipmentBuilder(e).withName("Bent Staff").withItemLevel(1).withSlot(d.EquipmentSlot.MAINHAND).withQuality(u.EquipmentQuality.COMMON).withDamage(1,2).withSprite(l.STAFF_SPRITE_1,3231744255).build()),t.intelligence+=5}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.ExplosionAnimation=class extends s.Animation{constructor(t,e,i,s){super(s,!0),this.game=t,this.center=e,this.radius=i,this.duration=s,this.sprites=[]}update(){super.update();const t=this.game,e=this.radius*(1-(this.countdown+1)/(this.duration+1)),i=this.center.x*t.tileSize.width,n=this.center.y*t.tileSize.height;for(let r=0;r<3;r++){const o=e,a=this.countdown+r,h=i+t.tileSize.width*o*Math.cos(a),l=n+t.tileSize.height*o*Math.sin(a),c=new s.Sprite(512,336,16,24,4,!1,4,s.Colors.ORANGE),d=new s.ProjectileAnimation(c,new s.Vec2(h,l),new s.Vec2(0,0),16);d.blocking=!1,t.animations.push(d)}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(31),r=new s.Sprite(896,216,16,24,1,!0,void 0,3438215167),o=[new s.Message("Bubble",s.Colors.WHITE),new s.Message("20 mana",s.Colors.WHITE),new s.Message("Instant cast",s.Colors.WHITE),new s.Message("Shields the caster absorbing 4 + INT",s.Colors.YELLOW),new s.Message("damage.",s.Colors.YELLOW)];e.BubbleAbility=class{constructor(){this.sprite=r,this.name="Bubble",this.targetType=s.TargetType.SELF,this.minRange=1,this.maxRange=1,this.cooldown=20,this.tooltipMessages=o}cast(t){for(let e=0;e<t.buffs.length;e++)if(t.buffs[e]instanceof n.Bubble)return t===t.game.player&&t.game.log("You already have a bubble.",s.Colors.LIGHT_GRAY),!1;const e=4+t.intelligenceModifier;return t.buffs.push(new n.Bubble(t,e)),t.ap--,!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(13),n=i(0),r=2866675711,o=new n.Sprite(608,408,16,24,2,!0,void 0,r);e.Bubble=class extends s.Buff{constructor(t,e){super(t),this.remaining=e}modifyDamageTaken(t){if(t<=0)return t;const e=Math.min(this.remaining,t);return this.remaining-=e,this.remaining<=0?this.actor.game.log("Absorbed the last "+e+" of the bubble!",r):this.actor.game.log("Bubble absorbed "+e+" damage.",r),t-e}draw(){const t=this.actor,e=t.game,i=e.app;o.draw(i,t.pixelX-e.viewport.x,t.pixelY-e.viewport.y)}isDone(){return this.remaining<=0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),r=i(9),o=i(33),a=i(7),h=i(6),l=i(1),c=i(4),d=i(3),u="Ranger",p=new s.Sprite(168,700,24,26,void 0,void 0,void 0,2164228351),g=new s.Sprite(64,120,16,24,2,!0,void 0,2164228351),m="Strategy and finesse, attacking from a distance",w=[new s.Message("+2 Strength, +2 Dexterity",s.Colors.LIGHT_GREEN),new s.Message("Heroic Leap - jump up to 3 tiles and stun enemies",s.Colors.YELLOW)];e.Ranger=class extends r.CharacterClass{constructor(){super(u,p,m,w)}initPlayer(t){const e=t.game;t.class=this,t.sprite=g,t.talents.add(new s.Talent(t,new o.ShootAbility)),t.talents.add(new s.Talent(t,new n.LeapAbility)),t.equipment.add(new h.EquipmentBuilder(e).withName("Trapper's Vest").withItemLevel(1).withSlot(l.EquipmentSlot.CHEST).withQuality(c.EquipmentQuality.COMMON).withMaterial(d.EquipmentMaterial.LEATHER).withSprite(a.SHIRT_SPRITE_1,3231744255).withArmor(7).build()),t.equipment.add(new h.EquipmentBuilder(e).withName("Trapper's Pants").withItemLevel(1).withSlot(l.EquipmentSlot.LEGS).withQuality(c.EquipmentQuality.COMMON).withMaterial(d.EquipmentMaterial.LEATHER).withSprite(a.PANTS_SPRITE_1,3231744255).withArmor(6).build()),t.equipment.add(new h.EquipmentBuilder(e).withName("Trapper's Boots").withItemLevel(1).withSlot(l.EquipmentSlot.FEET).withQuality(c.EquipmentQuality.COMMON).withMaterial(d.EquipmentMaterial.LEATHER).withSprite(a.BOOTS_SPRITE_1,3231744255).withArmor(5).build()),t.equipment.add(new h.EquipmentBuilder(e).withName("Weathered Crossbow").withItemLevel(1).withSlot(l.EquipmentSlot.MAINHAND).withQuality(c.EquipmentQuality.COMMON).withDamage(1,2,!0,!0).withSprite(a.CROSSBOW_SPRITE_1,3231744255).build()),t.strength+=2,t.dexterity+=2}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=8,r=new s.Sprite(896,96,16,24,1,!1,void 0,1087426815),o=[new s.Message("Shoot",s.Colors.WHITE),new s.Message("30 yard range",s.Colors.WHITE),new s.Message("Requires a ranged weapon.",s.Colors.WHITE)];e.ShootAbility=class{constructor(){this.sprite=r,this.name="shoot",this.targetType=s.TargetType.ENTITY,this.minRange=1,this.maxRange=n,this.cooldown=3,this.tooltipMessages=o}cast(t,e){const i=t.game,r=t.mainHandWeapon;return r&&r.ranged?t.distanceTo(e)>n?(t===i.player&&i.log("Target out of range.",s.Colors.LIGHT_GRAY),!1):i.tileMap&&!i.tileMap.isVisible(e.x,e.y)?(t===i.player&&i.log("Target not visible.",s.Colors.LIGHT_GRAY),!1):(e.takeDamage(t,t.getDamage()),t.ap--,!0):(t===i.player&&i.log("Shoot requires a ranged weapon.",s.Colors.LIGHT_GRAY),!1)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),r=i(35),o=i(9),a=i(1),h=i(4),l=i(3),c=i(7),d=i(6),u=i(10),p="Rogue",g=new s.Sprite(144,700,24,26,void 0,void 0,void 0,2684354815),m=new s.Sprite(192,96,16,24,2,!0,void 0,2684354815),w="Lethal assasins and masters of stealth",y=[new s.Message("+5 Dexterity",s.Colors.LIGHT_GREEN),new s.Message("Stealth - go invisible for 10 turns",s.Colors.YELLOW),new s.Message("Shadow Strike - sneak attack from a distance",s.Colors.YELLOW)];e.Rogue=class extends o.CharacterClass{constructor(){super(p,g,w,y)}initPlayer(t){const e=t.game;t.class=this,t.sprite=m,t.talents.add(new s.Talent(t,new n.LeapAbility)),t.talents.add(new s.Talent(t,new r.ShadowStrikeAbility));for(let i=0;i<5;i++)t.inventory.add(new u.HealthPotion(e));t.equipment.add(new d.EquipmentBuilder(e).withName("Footpad's Vest").withItemLevel(1).withSlot(a.EquipmentSlot.CHEST).withQuality(h.EquipmentQuality.COMMON).withMaterial(l.EquipmentMaterial.LEATHER).withSprite(c.SHIRT_SPRITE_1,3231744255).withArmor(7).build()),t.equipment.add(new d.EquipmentBuilder(e).withName("Footpad's Pants").withItemLevel(1).withSlot(a.EquipmentSlot.LEGS).withQuality(h.EquipmentQuality.COMMON).withMaterial(l.EquipmentMaterial.LEATHER).withSprite(c.PANTS_SPRITE_1,3231744255).withArmor(6).build()),t.equipment.add(new d.EquipmentBuilder(e).withName("Footpad's Boots").withItemLevel(1).withSlot(a.EquipmentSlot.FEET).withQuality(h.EquipmentQuality.COMMON).withMaterial(l.EquipmentMaterial.LEATHER).withSprite(c.BOOTS_SPRITE_1,3231744255).withArmor(5).build()),t.equipment.add(new d.EquipmentBuilder(e).withName("Worn Dirk").withItemLevel(1).withSlot(a.EquipmentSlot.MAINHAND).withQuality(h.EquipmentQuality.COMMON).withDamage(1,2,!1,!0).withSprite(c.DAGGER_SPRITE_1,3231744255).build()),t.dexterity+=5}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=10,r=new s.Sprite(656,192,16,24,void 0,void 0,void 0,3301229823),o=[new s.Message("Shadow Strike",s.Colors.WHITE),new s.Message("Instant cast",s.Colors.WHITE),new s.Message("Appear behind your target up to 25 yards away,",s.Colors.YELLOW),new s.Message("dealing double damage.",s.Colors.YELLOW)];e.ShadowStrikeAbility=class{constructor(){this.sprite=r,this.name="Shadow Strike",this.targetType=s.TargetType.ENTITY,this.minRange=1,this.maxRange=n,this.cooldown=10,this.tooltipMessages=o}cast(t,e){const i=t.game;if(t.distanceTo(e)>n)return t===i.player&&i.log("Target out of range.",s.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(e.x,e.y))return t===i.player&&i.log("Target not visible.",s.Colors.LIGHT_GRAY),!1;let r=null,o=0;for(let n=e.y-1;n<=e.y+1;n++)for(let a=e.x-1;a<=e.x+1;a++){if(Math.hypot(a-e.x,n-e.y)>1.001)continue;if(i.isBlocked(a,n))continue;const h=t.distance(a,n);h>o&&(r=new s.Vec2(a,n),o=h)}if(!r)return t===i.player&&i.log("No free spaces available.",s.Colors.LIGHT_GRAY),!1;const a=(r.x-t.x)*i.tileSize.width/4,h=(r.y-t.y)*i.tileSize.height/4;return i.addAnimation(new s.SlideAnimation(t,a,h,4)).then(()=>{t.x=r.x,t.y=r.y,t.attack(e,2*t.getDamage()),t.ap--}),!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(37),r=i(39),o=i(12),a=i(7),h=i(6),l=i(1),c=i(4),d=i(3),u=i(9),p="Warlock",g=new s.Sprite(24,700,24,26,void 0,void 0,void 0,2686492927),m=new s.Sprite(416,96,16,24,2,!0,void 0,2686492927),w="Practitioners of the dark arts",y=[new s.Message("+2 Constitution, +2 Intelligence",s.Colors.LIGHT_GREEN),new s.Message("Demonic Gateway - teleport by dark magic",s.Colors.YELLOW)];e.Warlock=class extends u.CharacterClass{constructor(){super(p,g,w,y)}initPlayer(t){const e=t.game;t.class=this,t.sprite=m,t.talents.add(new s.Talent(t,new n.CurseAbility)),t.talents.add(new s.Talent(t,new o.LightningAbility)),t.talents.add(new s.Talent(t,new r.DemonicGatewayAbility)),t.equipment.add(new h.EquipmentBuilder(e).withName("Acolyte's Robe").withItemLevel(1).withSlot(l.EquipmentSlot.CHEST).withQuality(c.EquipmentQuality.COMMON).withMaterial(d.EquipmentMaterial.CLOTH).withSprite(a.ROBE_SPRITE_1,3231744255).withArmor(2).build()),t.equipment.add(new h.EquipmentBuilder(e).withName("Acolyte's Pants").withItemLevel(1).withSlot(l.EquipmentSlot.LEGS).withQuality(c.EquipmentQuality.COMMON).withMaterial(d.EquipmentMaterial.CLOTH).withSprite(a.PANTS_SPRITE_1,3231744255).withArmor(2).build()),t.equipment.add(new h.EquipmentBuilder(e).withName("Acolyte's Shoes").withItemLevel(1).withSlot(l.EquipmentSlot.FEET).withQuality(c.EquipmentQuality.COMMON).withMaterial(d.EquipmentMaterial.CLOTH).withSprite(a.BOOTS_SPRITE_1,3231744255).withArmor(1).build()),t.equipment.add(new h.EquipmentBuilder(e).withName("Bent Staff").withItemLevel(1).withSlot(l.EquipmentSlot.MAINHAND).withQuality(c.EquipmentQuality.COMMON).withDamage(1,2).withSprite(a.STAFF_SPRITE_1,3231744255).build()),t.constitution+=2,t.intelligence+=2}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(38),r=8,o=new s.Sprite(880,144,16,24,1,!1,void 0,3225469183),a=[new s.Message("Curse",s.Colors.WHITE),new s.Message("20 mana",s.Colors.WHITE),new s.Message("Instant cast",s.Colors.WHITE),new s.Message("Corrupts the target, causing (1 + INT) / 4",s.Colors.YELLOW),new s.Message("damage per turn for 8 turns.",s.Colors.YELLOW)];e.CurseAbility=class{constructor(){this.sprite=o,this.name="Curse",this.targetType=s.TargetType.ENTITY,this.minRange=1,this.maxRange=r,this.cooldown=3,this.tooltipMessages=a}cast(t,e){const i=t.game;if(t.distanceTo(e)>r)return t===i.player&&i.log("Target out of range.",s.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(e.x,e.y))return t===i.player&&i.log("Target not visible.",s.Colors.LIGHT_GRAY),!1;const o=Math.round((1+t.intelligenceModifier)/4);return e.buffs.push(new n.Curse(t,e,o,8)),t.ap--,!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(13);e.Curse=class extends s.Buff{constructor(t,e,i,s){super(e),this.caster=t,this.damage=i,this.countdown=s}update(){this.countdown>0&&(this.actor.takeDamage(this.caster,this.damage),this.countdown--)}isDone(){return this.countdown<=0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(40),r=10,o=new s.Sprite(432,408,16,24,1,!0,void 0,3285193471),a=[new s.Message("Demonic Gateway",s.Colors.WHITE),new s.Message("20 mana",s.Colors.WHITE),new s.Message("2 turn cast",s.Colors.WHITE),new s.Message("Creates a demonic gateway between two",s.Colors.YELLOW),new s.Message("locations. User can transport to the other gateway.",s.Colors.YELLOW)];e.DemonicGatewayAbility=class{constructor(){this.sprite=o,this.name="Demonic Gateway",this.targetType=s.TargetType.TILE,this.minRange=1,this.maxRange=r,this.cooldown=10,this.tooltipMessages=a}cast(t,e){const i=t.game;if(t.distanceTo(e)>r)return t===i.player&&i.log("Target out of range.",s.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(e.x,e.y))return t===i.player&&i.log("Target not visible.",s.Colors.LIGHT_GRAY),!1;const o=new n.Gateway(i,t.x,t.y,t),a=new n.Gateway(i,e.x,e.y,t);return o.other=a,a.other=o,i.entities.add(o),i.entities.add(a),t.move(e.x-t.x,e.y-t.y,16),t.ap--,!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=new s.Sprite(432,408,16,24,1,!0,void 0,3285193471);e.Gateway=class extends s.Item{constructor(t,e,i,s){super(t,e,i,"gateway",n,!1),this.owner=s,this.zIndex=0}onBump(t){const e=this.other;return!!e&&(t.move(e.x-t.x,e.y-t.y,16),!0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),r=i(9),o=i(42),a=i(6),h=i(7),l=i(1),c=i(4),d=i(3),u=i(10),p="Warrior",g=new s.Sprite(216,700,24,26,void 0,void 0,void 0,2151678207),m=new s.Sprite(0,96,16,24,2,!0,void 0,4291779839),w="Lords of war, strength, and combat",y=[new s.Message("+5 Strength, +2 Constitution",s.Colors.LIGHT_GREEN),new s.Message("Heroic Leap - jump up to 3 tiles and stun enemies",s.Colors.YELLOW)];e.Warrior=class extends r.CharacterClass{constructor(){super(p,g,w,y)}initPlayer(t){const e=t.game;t.class=this,t.sprite=m,t.talents.add(new s.Talent(t,new n.LeapAbility)),t.talents.add(new s.Talent(t,new o.RageAbility));for(let i=0;i<5;i++)t.inventory.add(new u.HealthPotion(e));t.equipment.add(new a.EquipmentBuilder(e).withName("Squire's Vest").withItemLevel(1).withSlot(l.EquipmentSlot.CHEST).withQuality(c.EquipmentQuality.COMMON).withMaterial(d.EquipmentMaterial.PLATE).withSprite(h.SHIRT_SPRITE_1,3231744255).withArmor(7).build()),t.equipment.add(new a.EquipmentBuilder(e).withName("Squire's Pants").withItemLevel(1).withSlot(l.EquipmentSlot.LEGS).withQuality(c.EquipmentQuality.COMMON).withMaterial(d.EquipmentMaterial.PLATE).withSprite(h.PANTS_SPRITE_1,3231744255).withArmor(6).build()),t.equipment.add(new a.EquipmentBuilder(e).withName("Squire's Boots").withItemLevel(1).withSlot(l.EquipmentSlot.FEET).withQuality(c.EquipmentQuality.COMMON).withMaterial(d.EquipmentMaterial.PLATE).withSprite(h.BOOTS_SPRITE_1,3231744255).withArmor(5).build()),t.equipment.add(new a.EquipmentBuilder(e).withName("Worn Greatsword").withItemLevel(1).withSlot(l.EquipmentSlot.MAINHAND).withQuality(c.EquipmentQuality.COMMON).withDamage(1,2).withSprite(h.SWORD_SPRITE_1,3231744255).build()),t.constitution+=2,t.strength+=5}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(43),r=new s.Sprite(656,192,16,24,void 0,void 0,void 0,3710001919),o=[new s.Message("Rage",s.Colors.WHITE),new s.Message("Instant cast",s.Colors.WHITE),new s.Message("Become enraged increasing damage by",s.Colors.YELLOW),new s.Message("100% for 8 turns.",s.Colors.YELLOW)];e.RageAbility=class{constructor(){this.sprite=r,this.name="Rage",this.targetType=s.TargetType.SELF,this.minRange=1,this.maxRange=1,this.cooldown=20,this.tooltipMessages=o}cast(t){for(let e=0;e<t.buffs.length;e++)if(t.buffs[e]instanceof n.Rage)return t===t.game.player&&t.game.log("You already have rage.",s.Colors.LIGHT_GRAY),!1;return t.buffs.push(new n.Rage(t,8)),t.ap--,!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(13),n=new(i(0).Sprite)(640,408,16,24,2,!0,void 0,3710001919);e.Rage=class extends s.Buff{constructor(t,e){super(t),this.countdown=e}update(){this.countdown>0&&this.countdown--}modifyDamageDealt(t){return t<=0?t:2*t}draw(){const t=this.actor,e=t.game,i=e.app;n.draw(i,t.pixelX-e.viewport.x,t.pixelY-e.viewport.y)}isDone(){return this.countdown<=0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(0),r=i(18),o=i(45),a=i(46),h=i(47),l=i(48),c=i(68),d=i(69),u=i(10),p=i(20),g=new n.Sprite(16,40,16,24);e.Game=class extends s.Game{constructor(t,e){super(t,{mapSize:new n.Rect(0,0,512,512),mapLayers:4,tileSize:new n.Rect(0,0,16,24),horizontalViewDistance:6,verticalViewDistance:4,focusMargins:new n.Vec2(0,40)}),this.rng.setSeed(e),this.targetSprite=g,this.cooldownSprite=new n.Sprite(192,16,16,24,24),this.blackoutRect=new n.Rect(0,40,16,16),this.gui.renderer.baseRect=new n.Rect(0,64,24,24),this.mapGen=new l.MapGenerator(this);const i=new r.Player(this,30,20);this.player=i,this.entities.add(i),this.gui.renderer.baseRect=new n.Rect(0,16,24,24),this.gui.renderer.buttonSlotRect=new n.Rect(64,16,20,28),this.messageLog=new n.MessageLog(new n.Rect(1,-84,100,50)),this.gui.add(this.messageLog),this.log("Welcome stranger! Prepare to perish!",n.Colors.DARK_RED);const s=new h.TopPanel(i);this.gui.add(s);const m=new o.BottomPanel;this.gui.add(m),this.gui.add(new d.EntityFrames(this));const w=new n.Button(new n.Rect(0,0,20,28),new n.Sprite(832,168,16,24,1,!0,30,3766493439),void 0,()=>{this.hideAllDialogs(),this.inventoryDialog.visible=!0});w.tooltipMessages=[new n.Message("Traveler's Backpack",n.Colors.GREEN),new n.Message("Item Level 55",n.Colors.YELLOW),new n.Message("16 Slot Bag",n.Colors.WHITE),new n.Message("Sell Price: 87 coins",n.Colors.WHITE)],m.inventorySlot.add(w);const y=new n.Button(new n.Rect(0,0,20,28),new n.Sprite(640,240,16,24,void 0,void 0,void 0,4291779839),void 0,()=>{this.hideAllDialogs(),this.characterDialog.visible=!0});y.tooltipMessages=[new n.Message("Character",n.Colors.WHITE),new n.Message("Currently equipped items,",n.Colors.YELLOW),new n.Message("stats and abilities.",n.Colors.YELLOW)],s.characterSlot.add(y);const f=new n.Button(new n.Rect(0,0,20,28),new n.Sprite(656,360,16,24,void 0,void 0,void 0,n.Colors.LIGHT_BLUE),void 0,()=>{this.hideAllDialogs(),this.talentsDialog.visible=!0});f.tooltipMessages=[new n.Message("Talents",n.Colors.WHITE),new n.Message("A list of all of your",n.Colors.YELLOW),new n.Message("character's talents.",n.Colors.YELLOW)],s.talentsSlot.add(f);const S=new n.Button(new n.Rect(0,0,20,28),new n.Sprite(352,672,16,24,void 0,void 0,void 0,n.Colors.LIGHT_GRAY),void 0,()=>{window.location.hash="menu"});S.tooltipMessages=[new n.Message("Main Menu",n.Colors.WHITE)],s.menuSlot.add(S),this.inventoryDialog=new n.ItemContainerDialog(new n.Rect(4,38,94,126),[new n.Message("Traveler's Backpack",n.Colors.GREEN),new n.Message("Click an item to use",n.Colors.LIGHT_GRAY),new n.Message("Drag for shortcut",n.Colors.LIGHT_GRAY)],16,i.inventory),this.inventoryDialog.visible=!1,this.gui.add(this.inventoryDialog),this.characterDialog=new a.CharacterDialog(new n.Rect(4,38,120,126),i),this.characterDialog.visible=!1,this.gui.add(this.characterDialog),this.talentsDialog=new n.TalentsDialog(new n.Rect(4,38,94,126),[new n.Message("Talents",n.Colors.GREEN),new n.Message("Click an ability to use",n.Colors.LIGHT_GRAY),new n.Message("Drag for shortcut",n.Colors.LIGHT_GRAY)],16,i.talents),this.talentsDialog.visible=!1,this.gui.add(this.talentsDialog);const _=new c.LevelUpDialog(new n.Rect(4,38,140,126),i);_.visible=!1,this.gui.add(_),this.levelUpDialog=_,i.inventory.addListener({onAdd:(t,e)=>{(e instanceof u.HealthPotion||e instanceof p.Scroll)&&m.shortcutBar.addItem(i.inventory,e,!0)},onRemove:()=>{}}),i.talents.addListener({onAdd:(t,e)=>{m.shortcutBar.addTalent(e)},onRemove:()=>{}}),this.mapGen.createMap()}hideAllDialogs(){this.inventoryDialog.visible=!1,this.characterDialog.visible=!1,this.talentsDialog.visible=!1}warpToPoint(t){this.addAnimation(new n.FadeOutAnimation(30)).then(()=>{this.player&&(this.player.x=t.x,this.player.y=t.y),this.stopAutoWalk(),this.resetViewport(),this.recomputeFov(),this.addAnimation(new n.FadeInAnimation(30))})}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.BottomPanel=class extends s.Panel{constructor(){super(new s.Rect(0,-43,400,43)),this.add(new s.ShortcutBar(new s.Rect(0,0,144,28),6)),this.add(new s.ButtonSlot(new s.Rect(100,0,20,28),s.Keys.VK_I))}get shortcutBar(){return this.children.get(0)}get inventorySlot(){return this.children.get(this.children.length-1)}drawContents(){if(!this.gui)return;const t=this.gui.app,e=t.size.height-43;t.drawImage(0,e,48,16,16,48,void 0,t.size.width,48);for(let e=0;e<this.children.length;e++)this.children.get(e).rect.y=t.size.height-31;this.inventorySlot.rect.x=t.size.width-22,this.drawChildren()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(1),r=4,o=2;e.CharacterDialog=class extends s.Dialog{constructor(t,e){super(t),this.player=e,this.modal=!0;for(let t=0;t<10;t++)this.add(new s.ButtonSlot(new s.Rect(0,0,24,24)));e.equipment.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)})}get headSlot(){return this.children.get(0)}get neckSlot(){return this.children.get(1)}get backSlot(){return this.children.get(2)}get chestSlot(){return this.children.get(3)}get handsSlot(){return this.children.get(4)}get legsSlot(){return this.children.get(5)}get feetSlot(){return this.children.get(6)}get ringSlot(){return this.children.get(7)}get mainHandSlot(){return this.children.get(8)}get offHandSlot(){return this.children.get(9)}addItem(t){const e=this.getSlot(t);e&&e.add(new s.ItemButton(e.rect.clone(),this.player.inventory,t))}removeItem(t){const e=this.getSlot(t);if(e){const t=e.button;t&&e.remove(t)}}getSlot(t){switch(t.slot){case n.EquipmentSlot.HEAD:return this.headSlot;case n.EquipmentSlot.NECK:return this.neckSlot;case n.EquipmentSlot.BACK:return this.backSlot;case n.EquipmentSlot.CHEST:return this.chestSlot;case n.EquipmentSlot.HANDS:return this.handsSlot;case n.EquipmentSlot.LEGS:return this.legsSlot;case n.EquipmentSlot.FEET:return this.feetSlot;case n.EquipmentSlot.RING:return this.ringSlot;case n.EquipmentSlot.MAINHAND:return this.mainHandSlot;case n.EquipmentSlot.OFFHAND:return this.offHandSlot;default:return}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect,i=(t.x1+t.x2)/2|0,n=t.x+r;let a=t.y+r;this.gui.app.drawCenteredString("ORYX THE BRAVE",i,a,s.Colors.WHITE),a+=10;const h="Level "+this.player.level+" "+this.player.race.name+" "+this.player.class.name;this.gui.app.drawCenteredString(h,i,a,s.Colors.WHITE),a+=10,this.player.sprite.draw(this.gui.app,i-8,a+32);for(let t=0;t<4;t++){const i=this.children.get(t);i.rect.x=n,i.rect.y=a+t*(e.height+o),i.rect.width=e.width,i.rect.height=e.height}for(let i=0;i<4;i++){const s=this.children.get(4+i);s.rect.x=t.x2-r-e.width,s.rect.y=a+i*(e.height+o),s.rect.width=e.width,s.rect.height=e.height}this.mainHandSlot.rect.x=i-e.width-1,this.mainHandSlot.rect.y=a+90,this.mainHandSlot.rect.width=e.width,this.mainHandSlot.rect.height=e.height,this.offHandSlot.rect.x=i+1,this.offHandSlot.rect.y=a+90,this.offHandSlot.rect.width=e.width,this.offHandSlot.rect.height=e.height,a+=4*(e.height+o)+r,this.gui.app.drawString("Armor",n+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.armor.toString(),n+85,a,s.Colors.WHITE),a+=10,this.gui.app.drawString("Constitution",n+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.constitution.toString(),n+85,a,s.Colors.WHITE),this.gui.app.drawString("+"+this.player.constitutionModifier,n+95,a,s.Colors.LIGHT_GREEN),a+=10,this.gui.app.drawString("Strength",n+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.strength.toString(),n+85,a,s.Colors.WHITE),this.gui.app.drawString("+"+this.player.strengthModifier,n+95,a,s.Colors.LIGHT_GREEN),a+=10,this.gui.app.drawString("Dexterity",n+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.dexterity.toString(),n+85,a,s.Colors.WHITE),this.gui.app.drawString("+"+this.player.dexterityModifier,n+95,a,s.Colors.LIGHT_GREEN),a+=10,this.gui.app.drawString("Intelligence",n+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.intelligence.toString(),n+85,a,s.Colors.WHITE),this.gui.app.drawString("+"+this.player.intelligenceModifier,n+95,a,s.Colors.LIGHT_GREEN),a+=10,this.rect.height=a+r-t.y,this.drawChildren()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.TopPanel=class extends s.Panel{constructor(t){super(new s.Rect(0,0,400,42)),this.player=t,this.add(new s.ButtonSlot(new s.Rect(0,3,20,28),s.Keys.VK_C)),this.add(new s.ButtonSlot(new s.Rect(0,3,20,28),s.Keys.VK_T)),this.add(new s.ButtonSlot(new s.Rect(0,3,20,28),s.Keys.VK_QUESTION_MARK)),this.add(new s.ButtonSlot(new s.Rect(0,3,20,28),s.Keys.VK_Q))}get characterSlot(){return this.children.get(0)}get talentsSlot(){return this.children.get(1)}get inspectSlot(){return this.children.get(2)}get menuSlot(){return this.children.get(3)}drawContents(){if(!this.gui)return;const t=this.player.game.blackoutRect;if(!t)return;const e=this.gui.app;e.drawImage(0,0,32,22,16,42,void 0,e.size.width,42);const i=this.player;e.drawImage(2,2,64,48,54,18),e.drawCenteredString("ORYX",22,3,s.Colors.WHITE);const n=Math.round(38*i.hp/i.maxHp);e.drawImage(3,11,t.x,t.y,t.width,t.height,s.Colors.DARK_GREEN,n,7),e.drawCenteredString(i.hp+"/"+i.maxHp,22,11,s.Colors.WHITE),e.drawCenteredString(i.level.toString(),49,7,s.Colors.WHITE);for(let t=0;t<this.children.length;t++)this.children.get(t).rect.x=e.size.width-22*(4-t);this.drawChildren()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(49),r=i(17),o=i(12),a=i(50),h=i(52),l=i(53),c=i(54),d=i(55),u=i(10),p=i(20),g=i(56),m=i(58),w=i(59),y=i(60),f=i(61),S=i(21),_=i(62),E=i(63),T=i(66),R=i(67),v=512,x=512,M=256,I=256,b=64,P=48,A=0,L=s.getTileId(0,3),C=s.getTileId(0,19),O=s.getTileId(0,20),H=s.getTileId(1,20),D=s.getTileId(2,20),K=s.getTileId(13,17),V=s.getTileId(0,18),N=s.getTileId(15,27),k=s.getTileId(28,22),B=s.getTileId(29,22),G=s.getTileId(30,22),j=s.getTileId(31,22),F=s.getTileId(7,19),q=s.getTileId(14,18),W=s.getTileId(15,18),z=s.getTileId(24,19),U=s.getTileId(16,20),Y=s.getTileId(0,17),Q=s.getTileId(20,23),X=s.getTileId(22,23),Z=s.getTileId(18,17),J=s.getTileId(16,22),$=(s.getTileId(17,22),s.getTileId(18,22),s.getTileId(19,22),s.getTileId(20,22)),tt=s.getTileId(21,22),et=s.getTileId(22,22),it=s.getTileId(23,22),st=s.getTileId(24,22),nt=s.getTileId(25,22),rt=6,ot=10,at=4,ht=8,lt=10,ct=3,dt=2,ut=4,pt=new s.Sprite(700,500,16,24,1),gt=[{bossZone:new s.Rect(0,0,b,10),bossRoom:new s.Rect(8,2,14,8),stairsRoom:new s.Rect(2,4,4,4)},{bossZone:new s.Rect(0,0,b,10),bossRoom:new s.Rect(b-22,2,14,8),stairsRoom:new s.Rect(b-6,4,4,4)},{bossZone:new s.Rect(0,P-10,b,10),bossRoom:new s.Rect(8,P-10,14,8),stairsRoom:new s.Rect(2,P-10+2,4,4)},{bossZone:new s.Rect(0,P-10,b,10),bossRoom:new s.Rect(b-22,P-10,14,8),stairsRoom:new s.Rect(b-6,P-10+2,4,4)}];e.MapGenerator=class{constructor(t){this.nextKeyId=0,this.game=t}createMap(){this.createOverworld();const t=[];for(let e=0;e<10;e++){const i=v-b,n=e*P,r=new y.Dungeon(new s.Rect(i,n,b,P),e);this.createDungeon(r),t.push(r)}const e=this.game,i=e.player,n=new s.Sprite(528,408,16,24,1,!1,void 0,16777215),r=new w.Portal(e,i.x+4,i.y,"portal",n),o=t[0].entrance;r.other=o,o.other=r,e.entities.add(r),e.entities.add(o);for(let e=1;e<10;e++){const i=t[e-1].exit,s=t[e].entrance;i.other=s,s.other=i}this.touchUp(this.game.tileMap)}createOverworld(){const t=this.game,e=t.tileMap,i=t.player,n=t.rng,r=new s.Rect(0,0,M,I),o=new s.Rect(4,4,M-8,I-8);this.clearMap(e,r,V,!0,!1),this.clearMap(e,o,Y,!1,!1),i.x=M/2|0,i.y=I/2|0,i.home.x=i.x,i.home.y=i.y;const h=new s.Vec2(0,0);for(h.y=r.y1;h.y<r.y2;h.y++)for(h.x=r.x1;h.x<r.x2;h.x++)o.contains(h)||e.setAnimated(h.x,h.y,0,!0);this.createRiver(e,o,5e3);for(let t=i.y-4;t<=i.y+4;t++)for(let s=i.x-4;s<=i.x+4;s++)e.setTile(s,t,0,Y),e.setAnimated(s,t,0,!1),e.setBlocked(s,t,!1);const l=[];for(let r=0;r<5;r++){const r=n.nextRange(14,18),a=n.nextRange(8,12),h=n.nextRange(o.x1,o.x2-r),c=n.nextRange(o.y1,o.y2-a),d=new s.Rect(h,c,r,a),u=d.getCenter();for(let t=d.y1;t<d.y2;t++)for(let i=d.x1;i<d.x2;i++)i===d.x1&&t===d.y1?(e.setTile(i,t,0,Y),e.setTile(i,t,1,it),e.setBlocked(i,t,!0,!1)):i===d.x2-1&&t===d.y1?(e.setTile(i,t,0,Y),e.setTile(i,t,1,et),e.setBlocked(i,t,!0,!1)):i===d.x1&&t===d.y2-1?(e.setTile(i,t,0,Y),e.setTile(i,t,1,tt),e.setBlocked(i,t,!0,!1)):i===d.x2-1&&t===d.y2-1?(e.setTile(i,t,0,Y),e.setTile(i,t,1,$),e.setBlocked(i,t,!0,!1)):i===d.x1?(e.setTile(i,t,0,Y),e.setTile(i,t,1,nt),e.setBlocked(i,t,!0,!1)):i===d.x2-1?(e.setTile(i,t,0,Y),e.setTile(i,t,1,st),e.setBlocked(i,t,!0,!1)):t===d.y1||t===d.y2-1?(e.setTile(i,t,0,Y),e.setTile(i,t,1,J),e.setBlocked(i,t,!0,!1)):(e.setTile(i,t,0,Y),e.setAnimated(i,t,0,!1),e.setBlocked(i,t,!1));e.setTile(u.x,d.y1,0,Y),e.setTile(u.x,d.y1,1,A),e.setBlocked(u.x,d.y1,!1),e.setTile(u.x,d.y2-1,0,Y),e.setTile(u.x,d.y2-1,1,A),e.setBlocked(u.x,d.y2-1,!1);const p=Math.hypot(u.x-i.x,u.y-i.y),g=Math.round(p/5),m=new T.Ghost(t,u.x,u.y,g);t.entities.add(m),l.push(d)}for(let t=0;t<5e3;t++){const t=n.nextRange(o.x1,o.x2),s=n.nextRange(o.y1,o.y2);t===i.x&&s===i.y||e.getTile(t,s,0)!==Y||e.isBlocked(t,s)||(e.setTile(t,s,0,Y),e.setBlocked(t,s,!0),0===n.nextRange(0,2)?e.setTile(t,s,1,Q):e.setTile(t,s,1,X))}const u=this.createCastle(e),p=s.computePath(e,i,u.getCenter(),1e4);if(p)for(let t=0;t<p.length;t++)e.getTile(p[t].x,p[t].y,0)===Y&&e.setTile(p[t].x,p[t].y,1,Z);else console.log("eek! no path!");for(let s=0;s<500;s++){const s=n.nextRange(o.x1+1,o.x2-2),r=n.nextRange(o.y1+1,o.y2-2);if(e.getTile(s,r,0)!==Y||e.isBlocked(s,r))continue;if(t.getEntityAt(s,r))continue;const h=Math.hypot(s-i.x,r-i.y);if(h<10)continue;const l=n.nextRange(0,100),u=Math.round((h-10)/10)+n.nextRange(1,3);let p=null;p=l<40?new c.Spider(t,s,r,u):l<80?new a.Bat(t,s,r,u):new d.Troll(t,s,r,u),t.entities.add(p)}const g=new s.Sprite(528,408,16,24,1,!1,void 0,4278255615),m=new w.Portal(t,i.x+2,i.y,"portal",g),y=new w.Portal(t,l[0].x+2,l[0].y+2,"portal",g);m.other=y,y.other=m,t.entities.add(m),t.entities.add(y);const f=new E.King(t,i.x-2,i.y);t.entities.add(f),t.resetViewport(),t.recomputeFov()}createCastle(t){const e=this.game,i=e.rng,n=i.nextRange(20,40),r=i.nextRange(15,30),o=i.nextRange(10,M-10-n),a=i.nextRange(10,I-10-r),h=new s.Rect(o,a,n,r),l=h.getCenter(),c=h,d=new s.Rect(h.x+2,h.y+2,h.width-4,h.height-4),u=new s.Rect(d.x+1,d.y+1,d.width-2,d.height-2);for(let e=c.y1;e<c.y2;e++)for(let i=c.x1;i<c.x2;i++)t.setTile(i,e,0,V),t.setTile(i,e,1,A),t.setAnimated(i,e,0,!0),t.setBlocked(i,e,!0,!1);for(let e=d.y1;e<d.y2;e++)for(let i=d.x1;i<d.x2;i++)t.setTile(i,e,0,K),t.setAnimated(i,e,0,!1),t.setBlocked(i,e,!1);for(let e=d.x1;e<d.x2;e++)t.setTile(e,d.y1,0,C),t.setBlocked(e,d.y1,!0),t.setTile(e,d.y2-1,0,C),t.setBlocked(e,d.y2-1,!0);for(let e=d.y1;e<d.y2;e++)t.setTile(d.x1,e,0,C),t.setBlocked(d.x1,e,!0),t.setTile(d.x2-1,e,0,C),t.setBlocked(d.x2-1,e,!0);for(let e=c.y1-1;e<c.y1+3;e++)for(let i=l.x-1;i<=l.x;i++)t.setTile(i,e,0,N),t.setTile(i,e,1,A),t.setAnimated(i,e,0,!1),t.setBlocked(i,e,!1);for(let e=c.y2-3;e<c.y2+1;e++)for(let i=l.x-1;i<=l.x;i++)t.setTile(i,e,0,N),t.setTile(i,e,1,A),t.setAnimated(i,e,0,!1),t.setBlocked(i,e,!1);for(let e=l.y-1;e<=l.y;e++)for(let i=c.x1-1;i<c.x1+3;i++)t.setTile(i,e,0,N),t.setTile(i,e,1,A),t.setAnimated(i,e,0,!1),t.setBlocked(i,e,!1);for(let e=l.y-1;e<=l.y;e++)for(let i=c.x2-3;i<c.x2+1;i++)t.setTile(i,e,0,N),t.setTile(i,e,1,A),t.setAnimated(i,e,0,!1),t.setBlocked(i,e,!1);for(let t=0;t<10;t++){const t=[new s.Vec2(i.nextRange(u.x1,u.x2),i.nextRange(u.y1,u.y2))];for(let e=1;e<4;e++){const n=t[e-1];0===i.nextRange(0,2)?t.push(new s.Vec2(n.x,i.nextRange(u.y1,u.y2))):t.push(new s.Vec2(i.nextRange(u.x1,u.x2),n.y))}const n=new m.Guard(e,t[0].x,t[0].y,t);e.entities.add(n)}return h}createDungeon(t){const e=this.game,i=e.tileMap,n=e.rng,r=this.nextKeyId++;this.clearMap(i,t.rect,C,!0,!0),this.createRiver(i,t.rect,200);for(let e=t.rect.x1;e<t.rect.x2;e++)i.setTile(e,t.rect.y1,0,A),i.setAnimated(e,t.rect.y1,0,!1),i.setBlocked(e,t.rect.y1,!0),i.setTile(e,t.rect.y2-1,0,A),i.setAnimated(e,t.rect.y2-1,0,!1),i.setBlocked(e,t.rect.y2-1,!0);for(let e=t.rect.y1;e<t.rect.y2;e++)i.setTile(t.rect.x1,e,0,A),i.setAnimated(t.rect.x1,e,0,!1),i.setBlocked(t.rect.x1,e,!0),i.setTile(t.rect.x2-1,e,0,A),i.setAnimated(t.rect.x2-1,e,0,!1),i.setBlocked(t.rect.x2-1,e,!0);const o=gt[n.nextRange(0,gt.length)],a=new s.Rect(o.bossZone.x+t.rect.x,o.bossZone.y+t.rect.y,o.bossZone.width,o.bossZone.height),l=new s.Rect(o.bossRoom.x+t.rect.x,o.bossRoom.y+t.rect.y,o.bossRoom.width,o.bossRoom.height),c=new s.Rect(o.stairsRoom.x+t.rect.x,o.stairsRoom.y+t.rect.y,o.stairsRoom.width,o.stairsRoom.height);for(;t.rooms.length<lt;){const r=n.nextRange(rt,ot),o=n.nextRange(at,ht),h=n.nextRange(t.rect.x1+2,t.rect.x2-r-3),l=n.nextRange(t.rect.y1+2,t.rect.y2-o-3),c=new s.Rect(h,l,r,o);let d=c.intersects(a);for(let e=0;e<t.rooms.length;e++)if(c.intersects(t.rooms[e])){d=!0;break}if(d)continue;this.createRoom(i,c);const u=c.getCenter();if(0===t.rooms.length)t.entrance=new w.Portal(e,u.x,u.y,"stairs",pt),e.entities.add(t.entrance),i.setTile(u.x,u.y,0,W);else{const e=t.rooms[t.rooms.length-1].getCenter();1===n.nextRange(0,1)?(this.createHTunnel(i,e.x,u.x,e.y),this.createVTunnel(i,e.y,u.y,u.x)):(this.createVTunnel(i,e.y,u.y,e.x),this.createHTunnel(i,e.x,u.x,u.y)),this.placeMonsters(c,t.level)}this.placeItems(c),t.rooms.push(c)}{this.createRoom(i,l);const s=t.rooms[t.rooms.length-1].getCenter(),o=l.getCenter();this.createHTunnel(i,s.x,o.x,s.y),this.createVTunnel(i,s.y,o.y,o.x);const a=3*t.level+2,d=n.nextRange(0,3);let u=void 0;(u=0===d?new g.RedDragon(e,o.x,o.y,a,l):1===d?new R.WindElemental(e,o.x,o.y,a):new h.Griffon(e,o.x,o.y,a)).loot=[new S.Key(e,u.x,u.y,r)],e.entities.add(u),o.y>s.y?(i.setTile(o.x,l.y1,0,F),i.setBlocked(o.x,l.y1,!0),e.entities.add(new _.BossDoor(e,o.x,l.y1,u))):(i.setTile(o.x,l.y2,0,F),i.setBlocked(o.x,l.y2,!0),e.entities.add(new _.BossDoor(e,o.x,l.y2,u))),this.createRoom(i,c);const p=c.getCenter();this.createHTunnel(i,o.x,p.x,p.y),i.setTile(p.x,p.y,0,q),t.exit=new w.Portal(e,p.x,p.y,"stairs",pt),e.entities.add(t.exit),o.x>p.x?(i.setTile(l.x1,o.y,0,F),i.setBlocked(l.x1,o.y,!0),e.entities.add(new f.LockedDoor(e,l.x1,o.y,r))):(i.setTile(l.x2,o.y,0,F),i.setBlocked(l.x2,o.y,!0),e.entities.add(new f.LockedDoor(e,l.x2,o.y,r)))}for(let e=0;e<t.rooms.length;e++)this.placeObstacles(t.rooms[e]);e.resetViewport(),e.recomputeFov()}clearMap(t,e,i,s,n){for(let r=e.y1;r<e.y2;r++)for(let o=e.x1;o<e.x2;o++){t.setTile(o,r,0,i),t.setAnimated(o,r,0,!1),t.setBlocked(o,r,s,n);for(let e=1;e<4;e++)t.setTile(e,o,r,A),t.setAnimated(o,r,e,!1)}}createRoom(t,e){for(let i=e.y1+1;i<e.y2;i++)for(let s=e.x1+1;s<e.x2;s++)t.setTile(s,i,0,K),t.setAnimated(s,i,0,!1),t.setBlocked(s,i,!1)}createHTunnel(t,e,i,s){for(let n=Math.min(e,i);n<=Math.max(e,i);n++){const e=t.getTile(n,s,0);e!==W&&e!==q&&(e===V?t.setTile(n,s,0,N):t.setTile(n,s,0,K),t.setAnimated(n,s,0,!1),t.setBlocked(n,s,!1))}}createVTunnel(t,e,i,s){for(let n=Math.min(e,i);n<=Math.max(e,i);n++){const e=t.getTile(s,n,0);e!==W&&e!==q&&(e===V?t.setTile(s,n,0,N):t.setTile(s,n,0,K),t.setAnimated(s,n,0,!1),t.setBlocked(s,n,!1))}}placeMonsters(t,e){const i=this.game,s=i.rng,n=s.nextRange(0,ct);for(let r=0;r<n;r++){const n=s.nextRange(t.x1+1,t.x2-1),r=s.nextRange(t.y1+1,t.y2-1);if(i.getEntityAt(n,r))continue;const o=s.nextRange(0,100),h=2*e+s.nextRange(1,3);let l=null;l=o<40?new c.Spider(i,n,r,h):o<80?new a.Bat(i,n,r,h):new d.Troll(i,n,r,h),i.entities.add(l)}}placeItems(t){const e=this.game,i=e.rng,s=i.nextRange(0,dt);for(let a=0;a<s;a++){const s=i.nextRange(t.x1+1,t.x2-1),a=i.nextRange(t.y1+1,t.y2-1);if(e.getEntityAt(s,a))continue;const h=i.nextRange(0,100);let l=null;l=h<50?new u.HealthPotion(e,s,a):h<70?new p.Scroll(e,s,a,new o.LightningAbility):h<85?new p.Scroll(e,s,a,new r.FireballAbility):new p.Scroll(e,s,a,new n.ConfuseAbility),e.entities.add(l)}}placeObstacles(t){const e=this.game,i=e.rng,s=e.tileMap,n=i.nextRange(0,ut+1);for(let r=0;r<n;r++){const n=i.nextRange(t.x1+2,t.x2-3),r=i.nextRange(t.y1+2,t.y2-3);e.getEntityAt(n,r)||(i.nextRange(0,100)<80?(s.setTile(n,r,0,K),s.setTile(n,r,1,z)):(s.setTile(n,r,0,K),s.setTile(n,r,1,U)),s.setBlocked(n,r,!0,!1))}}createRiver(t,e,i){const s=this.game.rng,n=e.getCenter();for(let r=0;r<i;r++)if(t.setTile(n.x,n.y,0,V),t.setTile(n.x-1,n.y,0,V),t.setTile(n.x+1,n.y,0,V),t.setTile(n.x,n.y-1,0,V),t.setTile(n.x,n.y+1,0,V),t.setAnimated(n.x,n.y,0,!0),t.setAnimated(n.x-1,n.y,0,!0),t.setAnimated(n.x+1,n.y,0,!0),t.setAnimated(n.x,n.y-1,0,!0),t.setAnimated(n.x,n.y+1,0,!0),t.setBlocked(n.x,n.y,!0,!1),t.setBlocked(n.x-1,n.y,!0,!1),t.setBlocked(n.x+1,n.y,!0,!1),t.setBlocked(n.x,n.y-1,!0,!1),t.setBlocked(n.x,n.y+1,!0,!1),n.x+=s.nextRange(-1,2),n.y+=s.nextRange(-1,2),!e.contains(n))return}touchUp(t){const e=this.game,i=e.rng;for(let s=0;s<x;s++)for(let n=0;n<v;n++){const r=t.getTile(n,s,0),o=t.getTile(n,s+1,0),a=t.getTile(n-1,s,0),h=t.getTile(n+1,s,0),c=t.getTile(n,s-1,0);if(r===K&&a===C&&c===O&&0===i.nextRange(0,4)&&t.setTile(n,s,1,k),r===K&&h===C&&c===O&&0===i.nextRange(0,4)&&t.setTile(n,s,1,B),r===K&&a===C&&o===C&&0===i.nextRange(0,4)&&t.setTile(n,s,1,G),r===K&&h===C&&o===C&&0===i.nextRange(0,4)&&t.setTile(n,s,1,j),r===F&&o!==C&&t.setTile(n,s+1,2,L),r===C&&o!==C&&o!==F){const e=i.nextRange(0,20);0===e?t.setTile(n,s,0,H):1===e?t.setTile(n,s,0,D):t.setTile(n,s,0,O),t.setTile(n,s+1,2,L)}r!==V&&o===V&&t.setTile(n,s+1,2,L);const d=o===N||a===N||h===N||c===N;r===V&&d&&1===i.nextRange(0,20)&&e.entities.add(new l.Shark(e,n,s))}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=8,r=new s.Sprite(128,32,16,24,3,!1),o=[new s.Message("Confuse",s.Colors.WHITE),new s.Message("20 mana",s.Colors.WHITE),new s.Message("Befuddles an enemy into a random",s.Colors.YELLOW),new s.Message("stupor for 10 turns.",s.Colors.YELLOW)];e.ConfuseAbility=class{constructor(){this.sprite=r,this.name="confuse",this.targetType=s.TargetType.ENTITY,this.minRange=1,this.maxRange=n,this.cooldown=1,this.tooltipMessages=o}cast(t,e){const i=t.game;return t.distanceTo(e)>n?(t===i.player&&i.log("Target out of range.",s.Colors.LIGHT_GRAY),!1):i.tileMap&&!i.tileMap.isVisible(e.x,e.y)?(t===i.player&&i.log("Target not visible.",s.Colors.LIGHT_GRAY),!1):(e.ai=new s.ConfusedMonster(e),i.log("The eyes of the "+e.name+" look vacant, as he stumbles around!",s.Colors.LIGHT_GREEN),t.ap--,!0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2),r=new s.Sprite(192,144,16,24,2,!0,void 0,1733810687);class o extends s.AI{doAi(){const t=this.actor,e=t.game.player;if(!e)return;const i=e.game.rng;t.distanceTo(e)<3&&i.nextRange(0,100)<33?t.attack(e,t.getDamage()):this.actor.move(i.nextRange(-2,3),i.nextRange(-2,3))}}e.Bat=class extends n.Monster{constructor(t,e,i,s){super(t,e,i,"Bat",r,s),this.ai=new o(this)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=new s.Sprite(896,168,16,24,1,!0,void 0,4294902015),r=[new s.Message("Gold",s.Colors.WHITE),new s.Message("The coin of the realm.",s.Colors.WHITE)];e.Gold=class extends s.Item{constructor(t,e,i){super(t,e,i,"gold",n,!1),this.tooltipMessages=r}onPickup(t){this.game.log(t.name+" picked up gold coins",s.Colors.LIGHT_GREEN)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),r=i(2),o=i(5),a=new s.Sprite(448,144,16,24,2,!0,void 0,4075971071),h=10;class l extends s.AI{doAi(){const t=this.actor,e=t.game,i=e.player;if(!i||i.hp<=0)return;const s=t.leapTalent;if(0===s.cooldown){const n=this.findLeapTarget(e,t,i);if(n&&s.use(n))return}if(t.distanceTo(i)<=2)t.attack(i,h);else if(t.sentiment===o.Sentiment.HOSTILE)t.moveToward(i.x,i.y);else{const e=i.game.rng;t.move(e.nextRange(-1,2),e.nextRange(-1,2))}}findLeapTarget(t,e,i){for(let s=i.y-1;s<=i.y+1;s++)for(let n=i.x-1;n<=i.x+1;n++){const i=t.tileMap&&t.tileMap.getCell(n,s);if(i&&!i.blocked&&!(e.distanceTo(i)>3||t.getActorAt(n,s)))return i}}}e.Griffon=class extends r.Monster{constructor(t,e,i,r){super(t,e,i,"Griffon",a,r),this.maxHp=10*this.level,this.hp=this.maxHp,this.ai=new l(this),this.talents.add(new s.Talent(this,new n.LeapAbility)),this.sentiment=o.Sentiment.NEUTRAL}get leapTalent(){return this.talents.get(0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2),r=new s.Sprite(0,168,16,24,2,!0,void 0,1469102079),o=10;class a extends s.AI{doAi(){const t=this.actor,e=t.game.player;e&&t.distanceTo(e)<2&&t.attack(e,o)}}e.Shark=class extends n.Monster{constructor(t,e,i){super(t,e,i,"Shark",r,1),this.ai=new a(this)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2),r=new s.Sprite(64,144,16,24,2,!0,void 0,551964671);e.Spider=class extends n.Monster{constructor(t,e,i,s){super(t,e,i,"Spider",r,s)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2),r=new s.Sprite(64,216,16,24,2,!0,void 0,551964671);e.Troll=class extends n.Monster{constructor(t,e,i,s){super(t,e,i,"Troll",r,s)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2),r=i(57),o=i(5),a=i(21),h=new s.Sprite(576,312,16,24,2,!0,void 0,3574665727),l=10;class c extends s.AI{doAi(){const t=this.actor,e=t.game,i=e.player;if(i&&!(i.hp<=0))if(t.sentiment!==o.Sentiment.HOSTILE||0!==t.cooldown)t.cooldown>0&&t.cooldown--,t.distanceTo(i)<=2&&t.attack(i,l);else{const i=t.room,s=e.rng;for(let t=i.x1+1;t<i.x2-1;t++)0===s.nextRange(0,2)?e.entities.add(new r.FlameCrawler(e,t,i.y1+1,0,1)):e.entities.add(new r.FlameCrawler(e,t,i.y2-1,0,-1));for(let t=i.y1+1;t<i.y2-1;t++)0===s.nextRange(0,2)?e.entities.add(new r.FlameCrawler(e,i.x1+1,t,1,0)):e.entities.add(new r.FlameCrawler(e,i.x2-1,t,-1,0));t.cooldown=10}}}e.RedDragon=class extends n.Monster{constructor(t,e,i,s,n){super(t,e,i,"Dragon",h,s),this.cooldown=0,this.room=n,this.maxHp=10*s,this.hp=this.maxHp,this.ai=new c(this),this.sentiment=o.Sentiment.NEUTRAL}getLoot(){return[new a.Key(this.game,this.x,this.y,0)]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2),r=new s.Sprite(256,312,16,24,2,!0,void 0,3574665727),o=8;class a extends s.AI{constructor(t){super(t),this.alwaysActive=!0,this.aliveCount=0}doAi(){const t=this.actor,e=t.game.player;if(!e||e.hp<=0)return;if(this.aliveCount++,1===this.aliveCount)return;const i=t.x+t.dx,s=t.y+t.dy;e.x===i&&e.y===s?t.attack(e,o):t.move(t.dx,t.dy)||t.game.entities.remove(t)}}e.FlameCrawler=class extends n.Monster{constructor(t,e,i,s,n){super(t,e,i,"Flame Crawler",r,1),this.ai=new a(this),this.dx=s,this.dy=n,this.showFrame=!1,this.seen=!0,this.blocks=!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2),r=i(5),o=new s.Sprite(320,96,16,24,2,!0,void 0,1469102079);class a extends s.AI{constructor(t,e){super(t),this.waypoints=e,this.waypointIndex=0,this.waitCount=0,this.aggroCount=0}doAi(){const t=this.actor,e=t.game.player;if(t.sentiment===r.Sentiment.HOSTILE){if(this.aggroCount++,1===this.aggroCount){const e=t.game;e.log("Guard shouts for help!",s.Colors.LIGHT_BLUE);for(let i=0;i<e.entities.length;i++){const s=e.entities.get(i);if(s instanceof h){const e=s;t.distanceTo(e)<6&&(e.sentiment=r.Sentiment.HOSTILE)}}}else if(t.distanceTo(e)>1)t.moveToward(e.x,e.y);else if(e.hp>0){const i=10;t.attack(e,i)}return}if(this.waitCount>0)return void this.waitCount--;const i=this.waypoints[this.waypointIndex];if(t.x===i.x&&t.y===i.y)return this.waypointIndex=(this.waypointIndex+1)%this.waypoints.length,void(this.waitCount=t.game.rng.nextRange(5,15));t.moveToward(i.x,i.y)}}class h extends n.Monster{constructor(t,e,i,s){super(t,e,i,"Guard",o,10),this.ai=new a(this,s),this.seen=!0,this.sentiment=r.Sentiment.FRIENDLY}}e.Guard=h},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0);e.Portal=class extends s.Item{constructor(t,e,i,s,n){super(t,e,i,s,n,!1),this.zIndex=0,this.fade=!1}onBump(t){const e=this.other;return!!e&&(this.game.warpToPoint(e),!0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Dungeon=class{constructor(t,e){this.rect=t,this.level=e,this.rooms=[]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(22);e.LockedDoor=class extends s.Door{constructor(t,e,i,s){super(t,e,i),this.keyId=s,this.zIndex=0}onBump(t){return!!t.keys[this.keyId]&&(this.openDoor(),t.moveTo(this.x,this.y),!0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(22);e.BossDoor=class extends s.Door{constructor(t,e,i,s){super(t,e,i),this.boss=s,this.zIndex=0}onBump(t){if(this.boss.hp<=0)return this.openDoor(),t.moveTo(this.x,this.y),!0;if((this.x-t.x)*(this.boss.x-t.x)+(this.y-t.y)*(this.boss.y-t.y)>0){const e=this.x-t.x,i=this.y-t.y;return t.move(2*e,2*i),!0}return!1}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(5),r=i(64),o=i(65),a=new s.Sprite(320,358,16,24,2,!0,void 0,2688590079);class h extends s.AI{doAi(){const t=this.actor,e=t.game.player;e&&t.sentiment===n.Sentiment.HOSTILE&&(t.distanceTo(e)>1.5?t.moveToward(e.x,e.y):e.hp>0&&t.attack(e,t.getDamage()))}}e.King=class extends n.StatsActor{constructor(t,e,i){super(t,e,i,"King",a),this.ai=new h(this),this.level=99,this.maxHp=10+2*this.level,this.hp=this.maxHp,this.strength=10+2*this.level}onBump(t){if(!this.dialog){const t=["A THREAT WITHIN","","I hope you strapped your belt on tight,","young paladin, because there is work to","do here in Northshire.","","And I don't mean farming.","","The Stormwind guards are hard pressed to","keep the peace here, with so many of us","in distant lands and so many threats","pressing close. And so we're enlisting","the aid of anyone willing to defend","their home. And their alliance.","","If you're here to answer the call, then","speak with my superior, Marshal McBride.","He's inside the abbey behind me."],e=new r.QuestDialog(new s.Rect(10,40,200,200));e.quest=new o.Quest(t,40),this.game.gui.add(e),this.dialog=e}return this.dialog.visible=!0,!0}takeDamage(t,e){super.takeDamage(t,e),this.sentiment=n.Sentiment.HOSTILE}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=8;e.QuestDialog=class extends s.Dialog{constructor(t){super(t),this.modal=!0}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect||!this.quest)return;const t=this.rect,e=(this.gui.renderer.buttonSlotRect,t.x1,t.x2,t.x+n);let i=t.y+n;for(let t=0;t<this.quest.description.length;t++)this.gui.app.drawString(this.quest.description[t],e,i,s.Colors.WHITE),i+=10;this.rect.height=Math.max(200,i+n-t.y),this.drawChildren()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.Quest=class{constructor(t,e){this.description=t,this.xpGain=e}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(2),r=new s.Sprite(64,288,16,24,2,!0,void 0,3772833952);e.Ghost=class extends n.Monster{constructor(t,e,i,s){super(t,e,i,"Ghost",r,s)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(8),r=i(2),o=i(5),a=new s.Sprite(288,312,16,24,2,!0,void 0,2866675711),h=10;class l extends s.AI{doAi(){const t=this.actor,e=t.game.player;if(e&&!(e.hp<=0))if(t.distanceTo(e)<=2)t.attack(e,h);else{const i=e.game.rng;t.move(i.nextRange(-1,2),i.nextRange(-1,2))}}}e.WindElemental=class extends r.Monster{constructor(t,e,i,r){super(t,e,i,"Wind",a,r),this.maxHp=10*this.level,this.hp=this.maxHp,this.ai=new l(this),this.talents.add(new s.Talent(this,new n.LeapAbility)),this.sentiment=o.Sentiment.HOSTILE}get leapTalent(){return this.talents.get(0)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=5,r=2,o=new s.Sprite(688,144,16,24,1,!1,void 0,3225428223),a=new s.Sprite(640,144,16,24,1,!1,void 0,3225428223),h=new s.Sprite(688,168,16,24,1,!1,void 0,3225428223),l=new s.Sprite(608,312,16,24,1,!1,void 0,3225428223),c=[[new s.Message("Constitution",s.Colors.YELLOW),new s.Message("Health, staminal,",s.Colors.WHITE),new s.Message("and vital force",s.Colors.WHITE)],[new s.Message("Dexterity",s.Colors.YELLOW),new s.Message("Physical agility, reflexes,",s.Colors.WHITE),new s.Message("balance, and poise",s.Colors.WHITE)],[new s.Message("Intelligence",s.Colors.YELLOW),new s.Message("Mental acuity, recall,",s.Colors.WHITE),new s.Message("and analytical skill",s.Colors.WHITE)],[new s.Message("Strength",s.Colors.YELLOW),new s.Message("Natural athleticism,",s.Colors.WHITE),new s.Message("and bodily power",s.Colors.WHITE)]];e.LevelUpDialog=class extends s.Dialog{constructor(t,e){super(t),this.player=e,this.modal=!0;const i=new s.ButtonSlot(new s.Rect(0,0,24,24),s.Keys.VK_1),n=new s.Button(new s.Rect(0,0,16,24),o,void 0,()=>this.incConstitution());i.add(n),this.add(i);const r=new s.ButtonSlot(new s.Rect(0,0,24,24),s.Keys.VK_2),c=new s.Button(new s.Rect(0,0,16,24),a,void 0,()=>this.incDexterity());r.add(c),this.add(r);const d=new s.ButtonSlot(new s.Rect(0,0,24,24),s.Keys.VK_3),u=new s.Button(new s.Rect(0,0,16,24),h,void 0,()=>this.incIntelligence());d.add(u),this.add(d);const p=new s.ButtonSlot(new s.Rect(0,0,24,24),s.Keys.VK_4),g=new s.Button(new s.Rect(0,0,16,24),l,void 0,()=>this.incStrength());p.add(g),this.add(p)}incConstitution(){this.increaseStat(1,0,0,0)}incDexterity(){this.increaseStat(0,1,0,0)}incIntelligence(){this.increaseStat(0,0,1,0)}incStrength(){this.increaseStat(0,0,0,1)}increaseStat(t,e,i,s){this.player.constitution+=t,this.player.dexterity+=e,this.player.intelligence+=i,this.player.strength+=s,this.player.remainingAbilityPoints--,0===this.player.remainingAbilityPoints&&(this.visible=!1)}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect,i=t.x+n;let o=t.y+n;this.gui.app.drawString("Leveled up!",i,o,s.Colors.WHITE),o+=10,this.gui.app.drawString("Choose "+this.player.remainingAbilityPoints+" stats to increase:",i,o,s.Colors.WHITE),o+=10;for(let t=0;t<4;t++){const s=c[t];for(let t=0;t<s.length;t++)this.gui.app.drawString(s[t].text,i+25,o+1+8*t,s[t].color);const n=this.children.get(t);n.rect.x=i,n.rect.y=o,n.rect.width=e.width,n.rect.height=e.height,o+=e.height+r}this.rect.height=o+n-t.y,this.drawChildren()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(5);e.EntityFrames=class extends s.Panel{constructor(t){super(new s.Rect(0,40,40,200)),this.game=t}drawContents(){if(!this.gui)return;const t=this.game.blackoutRect;if(!t)return;const e=this.gui.app,i=this.game.player,r=this.game.entities;let o=40;for(let a=0;a<r.length;a++){const h=r.get(a);if(h===this.game.player||!(h instanceof n.StatsActor))continue;const l=h;if(!l.showFrame||l.visibleDuration<0)continue;e.drawImage(2,o,64,48,54,18);let c=s.Colors.YELLOW;l.sentiment===n.Sentiment.FRIENDLY?c=s.Colors.LIGHT_GREEN:l.sentiment===n.Sentiment.HOSTILE&&(c=s.Colors.RED),e.drawCenteredString(l.name,22,o+1,c);const d=Math.round(38*l.hp/l.maxHp);e.drawImage(3,o+9,t.x,t.y,t.width,t.height,s.Colors.DARK_GREEN,d,7),e.drawCenteredString(l.hp+"/"+l.maxHp,22,o+9,s.Colors.WHITE);let u=s.Colors.YELLOW;l.level>i.level+3?u=s.Colors.RED:l.level>i.level+1?u=s.Colors.ORANGE:l.level<i.level-3?u=s.Colors.LIGHT_GREEN:l.level<i.level-1&&(u=3152954623),e.drawCenteredString(l.level.toString(),49,o+5,u),o+=24}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=[{display:"NEW GAME",hash:"chooseseed",enabled:!0},{display:"CONTINUE",hash:"game",enabled:!1},{display:"TUTORIAL",hash:"tutorial",enabled:!0},{display:"HIGH SCORES",hash:"highscores",enabled:!0},{display:"CREDITS",hash:"credits",enabled:!0}];e.MainMenu=class extends s.AppState{constructor(t){super(t),this.selectedIndex=0,this.time=0,this.sprites=[],this.chooseSprites()}chooseSprites(){this.sprites=[];for(let t=0;t<4;t++){const t=32*Math.floor(19*Math.random()),e=96+24*Math.floor(13*Math.random()),i=s.fromHsv(Math.random(),.9,.5);this.sprites.push(new s.Sprite(t,e,16,24,2,!0,void 0,i))}}update(){s.Sprite.updateGlobalAnimations();const t=this.app;n[1].enabled=!!t.game;const e=this.time%300;e<80&&e%8==0&&this.chooseSprites(),this.app.drawImage(this.app.center.x-128,0,0,800,256,128),this.app.drawCenteredString("KOPI LUWAK DUNGEON",this.app.center.x+1,33,s.Colors.BLACK),this.app.drawCenteredString("KOPI LUWAK DUNGEON",this.app.center.x,32);for(let t=0;t<4;t++){const e=this.app.center.x-56+32*t,i=52;this.sprites[t].draw(this.app,e,i)}const i=this.app.mouse;for(let t=0;t<n.length;t++){const e=n[t],r=this.app.center.x,o=90+15*t;let a=s.Colors.WHITE;e.enabled?t===this.selectedIndex&&(a=s.Colors.YELLOW):a=s.Colors.GRAY,this.app.drawCenteredString(e.display,r+1,o+1,s.Colors.BLACK),this.app.drawCenteredString(e.display,r,o,a),i.y>=o&&i.y<o+14&&i.isClicked()&&(window.location.hash=e.hash),t===this.selectedIndex&&this.app.isKeyPressed(s.Keys.VK_ENTER)&&(window.location.hash=e.hash)}this.app.isKeyPressed(s.Keys.VK_UP)&&this.selectedIndex--,this.app.isKeyPressed(s.Keys.VK_DOWN)&&this.selectedIndex++,this.selectedIndex<0&&(this.selectedIndex+=n.length),this.selectedIndex>=n.length&&(this.selectedIndex-=n.length),this.time++}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(14),r=i(72),o=i(73),a=i(19),h=i(74),l=i(75),c=[new a.Human,new r.Dwarf,new o.Elf,new h.Orc,new l.Undead];e.RaceMenu=class extends s.AppState{constructor(t){super(t),this.gui.renderer.baseRect=new s.Rect(0,64,24,24),this.gui.add(new s.MessagePanel(new s.Rect(2,2,256,10),new s.Message("Choose your race",s.Colors.WHITE)));const e=new s.ComplexSelectDialog(new s.Rect(2,15,246,204),c);e.renderer=new n.MenuItemRenderer(60,40),e.onSelect=(t=>{this.app.playerRace=t,window.location.hash="chooseclass"}),e.onCancel=(()=>{window.history.back()}),this.gui.add(e)}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(11),r="Dwarf",o=new s.Sprite(510,730,34,34,void 0,void 0,void 0,1082179839),a="Bold and hardy, skilled warriors",h=[new s.Message("+4 Constitution, +2 Strength",s.Colors.LIGHT_GREEN),new s.Message("Critical strike bonus",s.Colors.YELLOW),new s.Message("Stoneform - Removes all curses",s.Colors.YELLOW)];e.Dwarf=class extends n.CharacterRace{constructor(){super(r,o,a,h)}initPlayer(t){t.race=this,t.constitution+=4,t.strength+=2}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(11),r="Elf",o=new s.Sprite(238,730,34,34,void 0,void 0,void 0,4286611711),a="Magical people of otherworldly grace",h=[new s.Message("+3 Dexterity, +3 Intelligence",s.Colors.LIGHT_GREEN),new s.Message("Shadowmeld - slip into the shadows",s.Colors.YELLOW)];e.Elf=class extends n.CharacterRace{constructor(){super(r,o,a,h)}initPlayer(t){t.race=this,t.dexterity+=3,t.intelligence+=3}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(11),r="Orc",o=new s.Sprite(442,730,34,34,void 0,void 0,void 0,548413695),a="Noble savages of shamanistic roots",h=[new s.Message("+2 Constitution, +4 Strength",s.Colors.LIGHT_GREEN),new s.Message("War Shout - Boost all stats by +1 for 5 turns",s.Colors.YELLOW)];e.Orc=class extends n.CharacterRace{constructor(){super(r,o,a,h)}initPlayer(t){t.race=this,t.constitution+=2,t.strength+=4}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(11),r="Undead",o=new s.Sprite(578,730,34,34,void 0,void 0,void 0,3493908735),a="Cursed to wander for eternity",h=[new s.Message("+2 Dexterity, +4 Intelligence",s.Colors.LIGHT_GREEN),new s.Message("Cannibalize - 10% of damage returns as health",s.Colors.YELLOW)];e.Undead=class extends n.CharacterRace{constructor(){super(r,o,a,h)}initPlayer(t){t.race=this,t.dexterity+=2,t.intelligence+=4}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=new s.Sprite(848,168,16,24,1,!0,void 0,2160115967),r=[new s.Message("Hearthstone",s.Colors.WHITE),new s.Message("Item Level 1",s.Colors.YELLOW),new s.Message("Use: Returns you to your home.",s.Colors.LIGHT_GREEN),new s.Message("Speak to an Innkeeper in a different",s.Colors.LIGHT_GREEN),new s.Message("place to change your home location.",s.Colors.LIGHT_GREEN)];e.Hearthstone=class extends s.Item{constructor(t,e,i){super(t,e||0,i||0,"Hearthstone",n,!1),this.tooltipMessages=r}onUse(t){const e=t.game;return e.hideAllDialogs(),e.warpToPoint(t.home),!0}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const s=i(0),n=i(14);class r{constructor(t,e,i){this.number=t,this.name=e,this.description=i||""}}e.SeedMenu=class extends s.AppState{constructor(t){super(t),this.gui.renderer.baseRect=new s.Rect(0,64,24,24);const e=[new r(1,"One"),new r(2,"Two"),new r(3,"Three"),new r(4,"Four"),new r(5,"Five"),new r(Math.round(1e3*Math.random()),"Random")];this.gui.add(new s.MessagePanel(new s.Rect(2,2,256,10),new s.Message("Choose your seed",s.Colors.WHITE)));const i=new s.ComplexSelectDialog(new s.Rect(2,15,246,204),e);i.renderer=new n.MenuItemRenderer(15,15),i.onSelect=(t=>{console.log("set seed",t.number),this.app.seed=t.number,window.location.hash="chooserace"}),i.onCancel=(()=>{window.history.back()}),this.gui.add(i)}}}]);
//# sourceMappingURL=index.js.map