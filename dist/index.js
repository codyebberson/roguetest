!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=30)}([function(e,t,i){window,e.exports=function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=41)}([function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(27);t.Serializable=function(e,t){return function(i){const r=s.createSerializeMetadata(i);r.className=e,t&&(r.valueType=!!t.valueType)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2);class r extends s.Vec2{constructor(e,t,i,s){super(e,t),this.width=i,this.height=s}get x1(){return this.x}get y1(){return this.y}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get left(){return this.x}get top(){return this.y}clone(){return new r(this.x,this.y,this.width,this.height)}copy(e){this.x=e.x,this.y=e.y,this.width=e.width,this.height=e.height}getCenter(){return new s.Vec2(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(e){return this.x<=e.x2&&this.x2>=e.x&&this.y<=e.y2&&this.y2>=e.y}contains(e){return e.x>=this.x&&e.x<=this.x2&&e.y>=this.y&&e.y<=this.y2}}t.Rect=r},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});let r=class{constructor(e,t){this.x=e,this.y=t}add(e){this.x+=e.x,this.y+=e.y}};r=s([i(0).Serializable("Vec2",{valueType:!0})],r),t.Vec2=r},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(8);let o=class{constructor(e){this.gui=null,this.rect=e,this.children=new r.ArrayList,this.modal=!1,this.visible=!0}setGui(e){if(!this.gui){this.gui=e;for(let t=0;t<this.children.length;t++)this.children.get(t).setGui(e)}}add(e){e.parent=this,e.setGui(this.gui),this.children.add(e)}remove(e){this.children.remove(e)}move(e){this.parent&&this.parent.remove(this),e.add(this)}getPanelAt(e){for(let t=this.children.length-1;t>=0;t--){const i=this.children.get(t);if(!i.visible)continue;if(i.isDragging())continue;const s=i.getPanelAt(e);if(s)return s}if(this.rect.contains(e))return this}drawContents(){this.drawChildren()}drawChildren(){for(let e=0;e<this.children.length;e++){const t=this.children.get(e);t.visible&&t.drawContents()}}handleInput(){return this.handleChildrenInput()}handleChildrenInput(){for(let e=this.children.length-1;e>=0;e--){const t=this.children.get(e);if(t.visible&&(t.handleInput()||t.modal))return!0}return!1}isDragging(){return this.gui&&this.gui.dragElement===this}onDrop(e){return!1}updateTooltip(e){e.visible=!1}};o=s([i(0).Serializable("Panel")],o),t.Panel=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});class s{}s.VK_CANCEL=3,s.VK_HELP=6,s.VK_BACK_SPACE=8,s.VK_TAB=9,s.VK_CLEAR=12,s.VK_ENTER=13,s.VK_SHIFT=16,s.VK_CONTROL=17,s.VK_ALT=18,s.VK_PAUSE=19,s.VK_CAPS_LOCK=20,s.VK_ESCAPE=27,s.VK_SPACE=32,s.VK_PAGE_UP=33,s.VK_PAGE_DOWN=34,s.VK_END=35,s.VK_HOME=36,s.VK_LEFT=37,s.VK_UP=38,s.VK_RIGHT=39,s.VK_DOWN=40,s.VK_PRINTSCREEN=44,s.VK_INSERT=45,s.VK_DELETE=46,s.VK_0=48,s.VK_1=49,s.VK_2=50,s.VK_3=51,s.VK_4=52,s.VK_5=53,s.VK_6=54,s.VK_7=55,s.VK_8=56,s.VK_9=57,s.VK_COLON=58,s.VK_SEMICOLON=59,s.VK_LESS_THAN=60,s.VK_EQUALS=61,s.VK_GREATER_THAN=62,s.VK_QUESTION_MARK=63,s.VK_AT=64,s.VK_A=65,s.VK_B=66,s.VK_C=67,s.VK_D=68,s.VK_E=69,s.VK_F=70,s.VK_G=71,s.VK_H=72,s.VK_I=73,s.VK_J=74,s.VK_K=75,s.VK_L=76,s.VK_M=77,s.VK_N=78,s.VK_O=79,s.VK_P=80,s.VK_Q=81,s.VK_R=82,s.VK_S=83,s.VK_T=84,s.VK_U=85,s.VK_V=86,s.VK_W=87,s.VK_X=88,s.VK_Y=89,s.VK_Z=90,s.VK_CONTEXT_MENU=93,s.VK_NUMPAD0=96,s.VK_NUMPAD1=97,s.VK_NUMPAD2=98,s.VK_NUMPAD3=99,s.VK_NUMPAD4=100,s.VK_NUMPAD5=101,s.VK_NUMPAD6=102,s.VK_NUMPAD7=103,s.VK_NUMPAD8=104,s.VK_NUMPAD9=105,s.VK_MULTIPLY=106,s.VK_ADD=107,s.VK_SEPARATOR=108,s.VK_SUBTRACT=109,s.VK_DECIMAL=110,s.VK_DIVIDE=111,s.VK_F1=112,s.VK_F2=113,s.VK_F3=114,s.VK_F4=115,s.VK_F5=116,s.VK_F6=117,s.VK_F7=118,s.VK_F8=119,s.VK_F9=120,s.VK_F10=121,s.VK_F11=122,s.VK_F12=123,s.VK_F13=124,s.VK_F14=125,s.VK_F15=126,s.VK_F16=127,s.VK_F17=128,s.VK_F18=129,s.VK_F19=130,s.VK_F20=131,s.VK_F21=132,s.VK_F22=133,s.VK_F23=134,s.VK_F24=135,s.VK_NUM_LOCK=144,s.VK_SCROLL_LOCK=145,s.VK_CIRCUMFLEX=160,s.VK_EXCLAMATION=161,s.VK_DOUBLE_QUOTE=162,s.VK_HASH=163,s.VK_DOLLAR=164,s.VK_PERCENT=165,s.VK_AMPERSAND=166,s.VK_UNDERSCORE=167,s.VK_OPEN_PAREN=168,s.VK_CLOSE_PAREN=169,s.VK_ASTERISK=170,s.VK_PLUS=171,s.VK_PIPE=172,s.VK_HYPHEN_MINUS=173,s.VK_OPEN_CURLY_BRACKET=174,s.VK_CLOSE_CURLY_BRACKET=175,s.VK_TILDE=176,s.VK_COMMA=188,s.VK_PERIOD=190,s.VK_SLASH=191,s.VK_BACK_QUOTE=192,s.VK_OPEN_BRACKET=219,s.VK_BACK_SLASH=220,s.VK_CLOSE_BRACKET=221,s.VK_QUOTE=222,s.VK_META=224,s.VK_ALTGR=225,s.VK_WIN=91,s.VK_KANA=21,s.VK_HANGUL=21,s.VK_EISU=22,s.VK_JUNJA=23,s.VK_FINAL=24,s.VK_HANJA=25,s.VK_KANJI=25,s.VK_CONVERT=28,s.VK_NONCONVERT=29,s.VK_ACCEPT=30,s.VK_MODECHANGE=31,s.VK_SELECT=41,s.VK_PRINT=42,s.VK_EXECUTE=43,s.VK_SLEEP=95,t.Keys=s},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(42);t.Animation=class{constructor(e,t){this.promise=new s.AnimationPromise,this.countdown=e,this.blocking=t}isDone(){return this.countdown<=0}update(){this.countdown--}draw(e){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(11);class r{}r.BLACK=s.fromRgb(0,0,0),r.WHITE=s.fromRgb(255,255,255),r.GRAY=s.fromRgb(128,128,128),r.LIGHT_GRAY=s.fromRgb(170,170,170),r.DARK_GRAY=s.fromRgb(85,85,85),r.YELLOW=s.fromRgb(255,255,85),r.BROWN=s.fromRgb(170,85,0),r.RED=s.fromRgb(255,0,0),r.LIGHT_RED=s.fromRgb(255,85,85),r.DARK_RED=s.fromRgb(170,0,0),r.GREEN=s.fromRgb(0,255,0),r.LIGHT_GREEN=s.fromRgb(85,255,85),r.DARK_GREEN=s.fromRgb(0,170,0),r.LIGHT_CYAN=s.fromRgb(85,255,255),r.DARK_CYAN=s.fromRgb(0,170,170),r.BLUE=s.fromRgb(0,0,255),r.LIGHT_BLUE=s.fromRgb(85,85,255),r.DARK_BLUE=s.fromRgb(0,0,170),r.LIGHT_MAGENTA=s.fromRgb(255,85,255),r.DARK_MAGENTA=s.fromRgb(170,0,170),r.ORANGE=s.fromRgb(255,136,0),t.Colors=r},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),o=i(3);let n=class extends o.Panel{constructor(e){super(e),this.closeButton=!1}drawContents(){this.gui&&this.gui.renderer.draw(this.gui.app,this)}handleInput(){if(!this.gui)return!1;if(this.handleChildrenInput())return!0;if(this.gui.app.isKeyPressed(r.Keys.VK_ESCAPE))return this.visible=!1,!0;const e=this.gui.app.mouse;return!(!e.isClicked()||this.rect.contains(e)||(this.visible=!1,0))}close(){this.gui&&this.gui.remove(this)}};n=s([i(0).Serializable("Dialog")],n),t.Dialog=n},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});let r=class{constructor(){this.elements=[]}get length(){return this.elements.length}clear(){this.elements.splice(0,this.elements.length)}get(e){return this.elements[e]}add(e){if(this.elements.push(e),this.listeners)for(let t=0;t<this.listeners.length;t++)this.listeners[t].onAdd(this,e)}remove(e){const t=this.elements.indexOf(e);if(t>=0&&(this.elements.splice(t,1),this.listeners))for(let t=0;t<this.listeners.length;t++)this.listeners[t].onRemove(this,e)}contains(e){return this.elements.indexOf(e)>=0}addListener(e){this.listeners||(this.listeners=[]),this.listeners.push(e)}};r=s([i(0).Serializable("ArrayList")],r),t.ArrayList=r},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(6),o=i(13);let n=class extends o.Button{constructor(e,t,i){super(e,t.ability.sprite),this.talent=t,this.shortcut=!!i,this.tooltipMessages=t.ability.tooltipMessages}click(){this.talent.use()}drawContents(){if(super.drawContents(),this.talent.cooldown>0){const e=this.talent.actor.game,t=e.cooldownSprite;if(t){const i=1-this.talent.cooldown/this.talent.ability.cooldown,s=Math.round(i*t.frames),o=t.x+s*t.width,n=t.y,a=this.rect.x+(this.rect.width-t.width)/2|0,l=this.rect.y+(this.rect.height-t.height)/2|0;e.app.drawImage(a,l,o,n,t.width,t.height);const h=this.rect.x+this.rect.width/2|0,c=this.rect.y+this.rect.height/2|0;e.app.drawCenteredString(this.talent.cooldown.toString(),h+1,c-2,r.Colors.BLACK),e.app.drawCenteredString(this.talent.cooldown.toString(),h,c-3,r.Colors.WHITE)}}}};n=s([i(0).Serializable("TalentButton")],n),t.TalentButton=n},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(8),o=i(13);let n=class extends o.Button{constructor(e,t,i){super(e,i.sprite),this.containerItems=t,this.stackItems=new r.ArrayList,this.stackItems.add(i),this.tooltipMessages=i.tooltipMessages}click(){if(this.stackItems.length>0){const e=this.stackItems.get(0),t=e.game.player;t&&t.use(e)}}removeAll(){for(let e=this.stackItems.length-1;e>=0;e--)this.containerItems.remove(this.stackItems.get(e))}drawContents(){if(this.gui&&(super.drawContents(),this.stackItems.length>1)){const e=this.rect;this.gui.app.drawRightString(this.stackItems.length.toString(),e.x2-3,e.y2-10)}}updateTooltip(e){if(this.stackItems.length>0){const e=this.stackItems.get(0);e.onUpdateTooltip(),this.tooltipMessages=e.tooltipMessages}super.updateTooltip(e)}};n=s([i(0).Serializable("ItemButton")],n),t.ItemButton=n},function(e,t,i){"use strict";function s(e,t,i,s){return void 0===s&&(s=255),(e<<24)+(t<<16)+(i<<8)+s}Object.defineProperty(t,"__esModule",{value:!0}),t.fromRgb=s,t.fromHsv=function(e,t,i,r){const o=6*e|0,n=6*e-o,a=i*(1-t),l=i*(1-n*t),h=i*(1-(1-n)*t);let c,d,u;switch(o%6){case 0:c=i,d=h,u=a;break;case 1:c=l,d=i,u=a;break;case 2:c=a,d=i,u=h;break;case 3:c=a,d=l,u=i;break;case 4:c=h,d=a,u=i;break;case 5:c=i,d=a,u=l;break;default:c=0,d=0,u=0}return void 0===r&&(r=1),s(255*c|0,255*d|0,255*u|0,255*r|0)}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(13);let o=class extends r.Button{constructor(e,t,i){super(e,i.sprite),this.containerItems=t,this.shortcutItem=i,this.tooltipMessages=i.tooltipMessages}click(){const e=this.getItem();if(e){const t=e.game.player;t&&t.use(e)}}drawContents(){if(this.gui&&(super.drawContents(),!this.isDragging())){const e=this.rect,t=this.countItems();this.gui.app.drawRightString(t.toString(),e.x2-3,e.y2-10)}}getItem(){for(let e=0;e<this.containerItems.length;e++){const t=this.containerItems.get(e);if(this.shortcutItem.isStackable(t))return t}}countItems(){let e=0;for(let t=0;t<this.containerItems.length;t++)this.shortcutItem.isStackable(this.containerItems.get(t))&&e++;return e}};o=s([i(0).Serializable("ItemShortcutButton")],o),t.ItemShortcutButton=o},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(3);let o=class extends r.Panel{constructor(e,t,i,s){super(e),this.sprite=t,this.shortcutKey=i,this.onClick=s}drawContents(){if(!this.gui)return;const e=this.sprite,t=this.rect,i=(t.width-e.width)/2|0,s=(t.height-e.height)/2|0;e.draw(this.gui.app,t.x+i,t.y+s)}handleInput(){if(!this.gui)return!1;const e=this.gui.app,t=e.mouse;return this.rect.contains(t.start)&&t.isDragging()?(this.gui.startDragging(this),!0):this.shortcutKey&&e.isKeyPressed(this.shortcutKey)||this.rect.contains(t)&&t.isClicked()?(this.click(),!0):t.down&&this.rect.contains(t)}click(){this.onClick&&this.onClick()}updateTooltip(e){this.tooltipMessages?(e.messages=this.tooltipMessages,e.visible=!0):e.visible=!1}};o=s([i(0).Serializable("Button")],o),t.Button=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(39),r=i(1),o=i(51);t.getTileId=function(e,t){return 64*t+e},t.TileMap=class{constructor(e,t,i,n){this.width=e,this.height=t,this.depth=i,this.tileSize=n,this.grid=new Array(t),this.layers=new Array(i),this.dirty=!0,this.originX=0,this.originY=0,this.visibleRect=new r.Rect(0,0,e,t),this.prevVisibleRect=new r.Rect(0,0,e,t);for(let i=0;i<t;i++){this.grid[i]=new Array(e);for(let t=0;t<e;t++)this.grid[i][t]=new s.TileMapCell(t,i)}for(let s=0;s<i;s++)this.layers[s]=new o.TileMapLayer(e,t)}isOutOfRange(e,t,i){return e<0||e>=this.width||t<0||t>=this.height||i<0||i>=this.depth}clear(){for(let e=0;e<this.layers.length;e++)this.layers[e].clear()}getTile(e,t,i){return this.isOutOfRange(e,t,i)?0:this.layers[i].getTile(e,t)}setTile(e,t,i,s){this.isOutOfRange(e,t,i)||this.layers[i].setTile(e,t,s)}isBlocked(e,t){return!!this.isOutOfRange(e,t,0)||this.grid[t][e].blocked}setBlocked(e,t,i,s){this.isOutOfRange(e,t,0)||(this.grid[t][e].blocked=i,this.grid[t][e].blockedSight=void 0!==s?s:i)}getCell(e,t){return this.isOutOfRange(e,t,0)?null:this.grid[t][e]}isVisible(e,t){return!(e<this.visibleRect.x1||e>=this.visibleRect.x2||t<this.visibleRect.y1||t>=this.visibleRect.y2)&&this.grid[t][e].visible}isSeen(e,t){const i=this.getCell(e,t);return i&&i.seen}setSeen(e,t,i){const s=this.getCell(e,t);s&&(s.seen=i)}isAnimated(e,t,i){return!this.isOutOfRange(e,t,i)&&this.layers[i].isAnimated(e,t)}setAnimated(e,t,i,s){this.isOutOfRange(e,t,i)||this.layers[i].setAnimated(e,t,s)}resetFov(){for(let e=0;e<this.height;e++)for(let t=0;t<this.width;t++)this.grid[e][t].seen=!1,this.grid[e][t].visible=!1}computeFov(e,t,i,s){this.originX=e,this.originY=t,this.prevVisibleRect.copy(this.visibleRect);const r=i,o=s||i;this.visibleRect.x=Math.max(0,e-r),this.visibleRect.y=Math.max(0,t-o),this.visibleRect.width=Math.min(this.width-1,e+r)-this.visibleRect.x+1,this.visibleRect.height=Math.min(this.height-1,t+o)-this.visibleRect.y+1;for(let e=this.visibleRect.y1;e<this.visibleRect.y2;e++)for(let t=this.visibleRect.x1;t<this.visibleRect.x2;t++)this.grid[e][t].visible=!1;this.grid[t][e].visible=!0,this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantY(1,-1),this.computeOctantX(1,-1),this.computeOctantY(-1,1),this.computeOctantX(-1,1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1),this.dirty=!0}computeOctantY(e,t){const i=[],s=[];let r,o,n,a,l,h,c,d,u,p,g=1,f=0,y=0,m=0;for(o=this.originY+t;o>=this.visibleRect.y1&&o<this.visibleRect.y2;o+=t,y=f,++g)for(n=.5/g,p=-1,a=Math.floor(m*g+.5),r=this.originX+a*e;a<=g&&r>=this.visibleRect.x1&&r<this.visibleRect.x2;r+=e,++a,p=u){if(l=!0,h=!1,d=p,u=(c=a/g)+n,y>0)if(this.grid[o-t][r].visible&&!this.grid[o-t][r].blockedSight||this.grid[o-t][r-e].visible&&!this.grid[o-t][r-e].blockedSight){for(let e=0;e<y&&l;++e)if(d<=s[e]&&u>=i[e])if(this.grid[o][r].blockedSight){if(d>=i[e]&&u<=s[e]){l=!1;break}i[e]=Math.min(i[e],d),s[e]=Math.max(s[e],u),h=!0}else if(c>i[e]&&c<s[e]){l=!1;break}}else l=!1;l&&(this.grid[o][r].visible=!0,this.grid[o][r].seen=!0,this.grid[o][r].blockedSight&&(m>=d?m=u:h||(i[f]=d,s[f++]=u)))}}computeOctantX(e,t){const i=[],s=[];let r,o,n,a,l,h,c,d,u,p,g=1,f=0,y=0,m=0;for(r=this.originX+e;r>=this.visibleRect.x1&&r<this.visibleRect.x2;r+=e,y=f,++g)for(n=.5/g,p=-1,a=Math.floor(m*g+.5),o=this.originY+a*t;a<=g&&o>=this.visibleRect.y1&&o<this.visibleRect.y2;o+=t,++a,p=u){if(l=!0,h=!1,d=p,u=(c=a/g)+n,y>0)if(this.grid[o][r-e].visible&&!this.grid[o][r-e].blockedSight||this.grid[o-t][r-e].visible&&!this.grid[o-t][r-e].blockedSight){for(let e=0;e<y&&l;++e)if(d<=s[e]&&u>=i[e])if(this.grid[o][r].blockedSight){if(d>=i[e]&&u<=s[e]){l=!1;break}i[e]=Math.min(i[e],d),s[e]=Math.max(s[e],u),h=!0}else if(c>i[e]&&c<s[e]){l=!1;break}}else l=!1;l&&(this.grid[o][r].visible=!0,this.grid[o][r].seen=!0,this.grid[o][r].blockedSight&&(m>=d?m=u:h||(i[f]=d,s[f++]=u)))}}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(3);let o=class extends r.Panel{constructor(e,t){super(e),this.shortcutKey=t}get button(){return this.children.length>0?this.children.get(0):void 0}drawContents(){if(!this.gui)return;const e=this.rect,t=this.gui.renderer.buttonSlotRect;t&&this.gui.app.drawImage(e.x,e.y,t.x,t.y,e.width,e.height);const i=this.button;i&&!i.isDragging()&&(i.rect.x=this.rect.x,i.rect.y=this.rect.y,i.rect.width=this.rect.width,i.rect.height=this.rect.height,this.drawChildren()),this.shortcutKey&&this.gui.app.drawRightString(String.fromCharCode(this.shortcutKey),e.x2-3,e.y+3)}handleInput(){if(!this.gui)return!1;if(this.handleChildrenInput())return!0;const e=this.gui.app,t=e.mouse,i=this.button;return i&&(this.shortcutKey&&e.isKeyPressed(this.shortcutKey)||this.rect.contains(t)&&t.isClicked())?(i.click(),!0):t.down&&this.rect.contains(t)}};o=s([i(0).Serializable("ButtonSlot")],o),t.ButtonSlot=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.SELF=0]="SELF",e[e.ENTITY=1]="ENTITY",e[e.TILE=2]="TILE"}(t.TargetType||(t.TargetType={}))},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(2);let o=class extends r.Vec2{constructor(e,t,i,s,o,n){super(t,i),this.game=e,this.offset=new r.Vec2(0,0),this.name=s,this.sprite=o,this.blocks=n,this.zIndex=1}get pixelX(){return this.x*this.game.tileSize.width+this.offset.x}get pixelY(){return this.y*this.game.tileSize.height+this.offset.y}get centerPixelX(){return this.pixelX+this.sprite.width/2|0}get centerPixelY(){return this.pixelY+this.sprite.height/2|0}distanceTo(e){return Math.hypot(e.x-this.x,e.y-this.y)}distance(e,t){return Math.hypot(e-this.x,t-this.y)}draw(){this.sprite.draw(this.game.app,this.pixelX-this.game.viewport.x,this.pixelY-this.game.viewport.y)}startTurn(){}endTurn(){}sendToBack(){}onBump(e){return!1}};o=s([i(0).Serializable("Entity")],o),t.Entity=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AI=class{constructor(e){this.actor=e,this.alwaysActive=!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Input=class{constructor(){this.down=!1,this.downCount=0,this.upCount=0}update(){this.down?(this.downCount++,this.upCount=0):(this.downCount=0,this.upCount++)}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(34),o=i(12),n=i(3),a=i(9),l=i(1),h=i(2),c=i(10);let d=class{constructor(e){this.app=e,this.renderer=new r.DialogRenderer(new l.Rect(0,0,1,1)),this.rootPanel=new n.Panel(e.size),this.rootPanel.gui=this}add(e){this.rootPanel.add(e)}remove(e){this.rootPanel.remove(e)}getPanelAt(e){return this.rootPanel.getPanelAt(e)}handleInput(){return this.dragElement&&this.dragOffset?(this.updateDragging(),!0):this.rootPanel.handleInput()}draw(){this.rootPanel.drawContents(),this.dragElement&&this.dragElement.drawContents()}startDragging(e){const t=this.app.mouse;this.dragElement=e,this.dragOffset=new h.Vec2(t.start.x-e.rect.x,t.start.y-e.rect.y)}updateDragging(){const e=this.app.mouse,t=this.dragElement,i=this.dragOffset;if(e.down)t.rect.x=e.x-i.x,t.rect.y=e.y-i.y;else{const s=this.rootPanel.getPanelAt(e);s&&s.onDrop(t)?(t.rect.x=s.rect.x,t.rect.y=s.rect.y,t.move(s)):t instanceof c.ItemButton&&s===this.rootPanel?t.removeAll():t instanceof o.ItemShortcutButton&&s===this.rootPanel?t.parent&&t.parent.remove(t):t instanceof a.TalentButton&&t.shortcut&&s===this.rootPanel?t.parent&&t.parent.remove(t):(t.rect.x=e.start.x-i.x,t.rect.y=e.start.y-i.y),this.dragElement=void 0,this.dragOffset=void 0}}};d=s([i(0).Serializable("GUI")],d),t.GUI=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Message=class{constructor(e,t){this.text=e,this.color=t}draw(e,t){e.drawString(this.text,t.x,t.y,this.color,t)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(32);t.TileMapRenderer=class{constructor(e,t){this.gl=e,this.tileMap=t,this.quadVertBuffer=e.createBuffer(),e.bindBuffer(e.ARRAY_BUFFER,this.quadVertBuffer),e.bufferData(e.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,-1,0,1,1,1,1,0,-1,1,0,0]),e.STATIC_DRAW),this.tilemapShader=s.initShaderProgram(e,"precision highp float;attribute vec2 position;attribute vec2 texture;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 viewOffset;uniform vec2 viewportSize;uniform vec2 tileSize;uniform vec2 mapSize;void main(void) {   pixelCoord = (texture * viewportSize) + viewOffset;   texCoord = pixelCoord / mapSize / tileSize;   gl_Position = vec4(position, 0.0, 1.0);}","precision highp float;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 tileSize;uniform float animFrame;uniform sampler2D tiles;uniform sampler2D sprites;void main(void) {   vec4 tile = texture2D(tiles, texCoord);   if(tile.x == 0.0 && tile.y == 0.0) { discard; }   vec2 spriteOffset = floor(tile.xy * 256.0) * tileSize;   if(tile.z != 0.0) spriteOffset.x += animFrame * tileSize.x;   vec2 spriteCoord = mod(pixelCoord, tileSize);   gl_FragColor = texture2D(sprites, (spriteOffset + spriteCoord) / 1024.0);   if (gl_FragColor.a == 0.0) discard;   gl_FragColor.a *= tile.a;}"),this.positionAttribute=e.getAttribLocation(this.tilemapShader,"position"),this.textureAttribute=e.getAttribLocation(this.tilemapShader,"texture"),this.viewportSizeUniform=e.getUniformLocation(this.tilemapShader,"viewportSize"),this.viewOffsetUniform=e.getUniformLocation(this.tilemapShader,"viewOffset"),this.mapSizeUniform=e.getUniformLocation(this.tilemapShader,"mapSize"),this.tileSizeUniform=e.getUniformLocation(this.tilemapShader,"tileSize"),this.animFrameUniform=e.getUniformLocation(this.tilemapShader,"animFrame"),this.tileSamplerUniform=e.getUniformLocation(this.tilemapShader,"tiles"),this.spriteSamplerUniform=e.getUniformLocation(this.tilemapShader,"sprites"),this.layerTextures=new Array(t.depth);for(let i=0;i<t.depth;i++){const s=e.createTexture(),r=t.layers[i].imageData;e.bindTexture(e.TEXTURE_2D,s),e.texImage2D(e.TEXTURE_2D,0,e.RGBA,t.width,t.height,0,e.RGBA,e.UNSIGNED_BYTE,r),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),this.layerTextures[i]=s}}draw(e,t,i,s,r){const o=this.gl,n=this.tileMap;o.enable(o.BLEND),o.blendFunc(o.SRC_ALPHA,o.ONE_MINUS_SRC_ALPHA),o.useProgram(this.tilemapShader),o.bindBuffer(o.ARRAY_BUFFER,this.quadVertBuffer),o.enableVertexAttribArray(this.positionAttribute),o.enableVertexAttribArray(this.textureAttribute),o.vertexAttribPointer(this.positionAttribute,2,o.FLOAT,!1,16,0),o.vertexAttribPointer(this.textureAttribute,2,o.FLOAT,!1,16,8),o.uniform2f(this.viewOffsetUniform,e,t),o.uniform2f(this.viewportSizeUniform,i,s),o.uniform2f(this.tileSizeUniform,n.tileSize.width,n.tileSize.height),o.uniform1f(this.animFrameUniform,r||0),o.activeTexture(o.TEXTURE0),o.uniform1i(this.spriteSamplerUniform,0),o.activeTexture(o.TEXTURE1),o.uniform1i(this.tileSamplerUniform,1);const a=Math.min(n.visibleRect.x1,n.prevVisibleRect.x1),l=Math.min(n.visibleRect.y1,n.prevVisibleRect.y1),h=Math.max(n.visibleRect.x2,n.prevVisibleRect.x2),c=Math.max(n.visibleRect.y2,n.prevVisibleRect.y2);for(let e=0;e<n.depth;e++){const t=n.layers[e],i=this.layerTextures[e];if(o.uniform2f(this.mapSizeUniform,n.width,n.height),o.bindTexture(o.TEXTURE_2D,i),n.dirty){for(let e=l;e<c;e++)for(let i=a;i<h;i++){const s=n.isVisible(i,e)?255:n.isSeen(i,e)?144:0;t.setAlpha(i,e,s)}o.texSubImage2D(o.TEXTURE_2D,0,0,0,t.width,t.height,o.RGBA,o.UNSIGNED_BYTE,t.imageData)}o.drawArrays(o.TRIANGLES,0,6)}n.dirty=!1}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(16),o=i(24),n=i(25),a=i(26),l=i(8),h=i(6),c=i(17);let d=class extends c.Entity{constructor(e,t,i,s,r,o){super(e,t,i,s,r,o),this.hp=100,this.maxHp=100,this.ap=1,this.maxAp=1,this.inventory=new l.ArrayList,this.talents=new l.ArrayList,this.visibleDuration=-1,this.seen=!1}startTurn(){this.ap=this.maxAp;for(let e=0;e<this.talents.length;e++){const t=this.talents.get(e);t.cooldown>0&&t.cooldown--}}move(e,t,i){const s=this.x+e,r=this.y+t;if(this.blocks){if(this.game.isBlocked(s,r))return!1}else if(this.game.tileMap.isBlocked(s,r))return!1;this.x=s,this.y=r,this.ap--,this.offset.x=-e*this.game.tileSize.width,this.offset.y=-t*this.game.tileSize.height;const o=i||4,n=this.game.tileSize.width/o,l=this.game.tileSize.height/o;return this.game.animations.push(new a.SlideAnimation(this,e*n,t*l,o)),this.game.blocked=!0,!0}moveTo(e,t,i){return this.move(e-this.x,t-this.y,i)}moveToward(e,t,i){const s=e-this.x,r=t-this.y;if(s<0&&r<0&&this.move(-1,-1,i))return!0;if(s<0&&r>0&&this.move(-1,1,i))return!0;if(s>0&&r<0&&this.move(1,-1,i))return!0;if(s>0&&r>0&&this.move(1,1,i))return!0;if(Math.abs(s)>Math.abs(r)){if(s<0&&this.move(-1,0,i))return!0;if(s>0&&this.move(1,0,i))return!0;if(r<0&&this.move(0,-1,i))return!0;if(r>0&&this.move(0,1,i))return!0}else{if(r<0&&this.move(0,-1,i))return!0;if(r>0&&this.move(0,1,i))return!0;if(s<0&&this.move(-1,0,i))return!0;if(s>0&&this.move(1,0,i))return!0}return!1}attack(e,t){e!==this&&(this.onAttack(e,t),e.takeDamage(this,t),this.ap--,this.game.animations.push(new o.BumpAnimation(this,e)),this.game.blocked=!0)}takeHeal(e){this.hp=Math.min(this.hp+e,this.maxHp),this.addFloatingText(e.toString(),h.Colors.LIGHT_GREEN)}takeDamage(e,t){this.hp<=0||(this.hp-=t,this.addFloatingText(t.toString(),h.Colors.RED),this.hp<=0&&(this.hp=0,this.onDeath(e),this.game.entities.remove(this)))}pickup(e){e.onPickup(this),this.inventory.add(e),this.game.entities.remove(e)}use(e){return e.onUse(this)}cast(e,t,i){e.targetType===r.TargetType.SELF||t?e.cast(this,t)&&i&&i():this.game.startTargeting(e,i)}addFloatingText(e,t){this.game.animations.push(new n.FloatingTextAnimation(this,e,t))}onAttack(e,t){}onDeath(e){}};d=s([i(0).Serializable("Actor")],d),t.Actor=d},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5);t.BumpAnimation=class extends s.Animation{constructor(e,t){super(12,!0),this.entity=e,this.dx=t.x-e.x,this.dy=t.y-e.y}update(){const e=12-this.countdown;e>=0&&e<4&&(this.entity.offset.x+=this.dx,this.entity.offset.y+=this.dy),e>=4&&e<8&&(this.entity.offset.x-=this.dx,this.entity.offset.y-=this.dy),super.update()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(6),r=i(5);t.FloatingTextAnimation=class extends r.Animation{constructor(e,t,i){super(40,!1),this.actor=e,this.str=t,this.color=i||s.Colors.WHITE}draw(e){const t=40-this.countdown,i=this.actor.pixelX+(this.actor.sprite.width/2|0)-e.viewport.x,s=this.actor.pixelY-3-e.viewport.y-Math.min(4,Math.floor(t/2));e.app.drawCenteredString(this.str,i,s,this.color)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5);t.SlideAnimation=class extends s.Animation{constructor(e,t,i,s){super(s,!0),this.entity=e,this.dx=t,this.dy=i}update(){this.countdown--,this.countdown>=0&&(this.entity.offset.x+=this.dx,this.entity.offset.y+=this.dy),0===this.countdown&&(this.entity.offset.x=0,this.entity.offset.y=0)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s="__wgltMetadata";function r(e){const t=new o;return e[s]=t,t}t.createSerializeMetadata=r,t.getSerializeMetadata=function(e){return e[s]||r(e)};class o{constructor(){this.className="Object",this.valueType=!1}}t.SerializeMetadata=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(48),r=i(29),o=i(30),n=i(1),a=i(31),l=i(2),h=i(4),c=[h.Keys.VK_NUMPAD7,h.Keys.VK_Y],d=[h.Keys.VK_NUMPAD9,h.Keys.VK_U],u=[h.Keys.VK_NUMPAD1,h.Keys.VK_B],p=[h.Keys.VK_NUMPAD3,h.Keys.VK_N],g=[h.Keys.VK_UP,h.Keys.VK_NUMPAD8,h.Keys.VK_K],f=[h.Keys.VK_LEFT,h.Keys.VK_NUMPAD4,h.Keys.VK_H],y=[h.Keys.VK_DOWN,h.Keys.VK_NUMPAD2,h.Keys.VK_J],m=[h.Keys.VK_RIGHT,h.Keys.VK_NUMPAD6,h.Keys.VK_L],w=[h.Keys.VK_SPACE,h.Keys.VK_NUMPAD5];t.App=class{constructor(e){const t=e.canvas;if(!t)throw new Error("Null or missing canvas element");const i=t.getContext("webgl",{alpha:!1,antialias:!1});if(!i)throw new Error("Could not get WebGL context");this.canvas=t,this.gl=i,this.size=e.size||new n.Rect(0,0,400,224),this.font=e.font||s.FONT_04B03,this.fillWindow=e.fillWindow||!1,this.scaleFactor=e.scaleFactor||2,this.center=new l.Vec2(this.size.width/2|0,this.size.height/2|0),i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),t.width=this.size.width,t.height=this.size.height,t.style.outline="none",t.tabIndex=0,t.focus(),this.mobile=this.isMobile(),this.renderSet=new a.RenderSet(i,e.imageUrl,this.font),this.keyboard=new r.Keyboard(t),this.mouse=new o.Mouse(this),this.fillWindow&&(window.addEventListener("resize",this.handleResizeEvent.bind(this),!1),this.handleResizeEvent()),this.renderLoop()}handleResizeEvent(){const e=window.innerWidth,t=window.innerHeight,i=this.isMobile(),s=i?320:400,r=i?224:300;this.scaleFactor=1,this.scaleFactor=e>t?Math.max(1,Math.min(Math.round(e/s),Math.round(t/r))):Math.max(1,Math.min(Math.round(e/r),Math.round(t/s))),this.size.width=Math.round(e/this.scaleFactor),this.size.height=Math.round(t/this.scaleFactor),this.center.x=this.size.width/2|0,this.center.y=this.size.height/2|0,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.canvas.style.left="0",this.canvas.style.top="0",this.canvas.style.width=e+"px",this.canvas.style.height=t+"px"}isMobile(){return!!navigator.userAgent.match(/Android|iPhone|iPod|IEMobile|WPDesktop|Opera Mini/i)}renderLoop(){this.keyboard.update(),this.mouse.update(),this.resetGl(),this.state&&this.state.update(),this.renderSet.flush(this.size.width,this.size.height),requestAnimationFrame(this.renderLoop.bind(this))}resetGl(){const e=this.gl;e.viewport(0,0,this.size.width,this.size.height),e.clearColor(0,0,0,1),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),this.renderSet.positionArrayIndex=0,this.renderSet.texcoordArrayIndex=0,this.renderSet.colorArrayIndex=0}drawImage(e,t,i,s,r,o,n,a,l){this.renderSet.drawImage(e,t,i,s,r,o,n,a,l)}drawString(e,t,i,s,r){this.renderSet.drawString(e,t,i,s,r)}drawCenteredString(e,t,i,s){this.renderSet.drawCenteredString(e,t,i,s)}drawRightString(e,t,i,s){this.renderSet.drawRightString(e,t,i,s)}isKeyDown(e){const t=this.keyboard.getKey(e);return t&&t.down}isKeyPressed(e){const t=this.keyboard.getKey(e),i=t?t.downCount:0;return 1===i||i>30}isDownLeftKeyPressed(){return this.isKeyArrayPressed(u)}isDownKeyPressed(){return this.isKeyArrayPressed(y)}isDownRightKeyPressed(){return this.isKeyArrayPressed(p)}isLeftKeyPressed(){return this.isKeyArrayPressed(f)}isWaitKeyPressed(){return this.isKeyArrayPressed(w)}isRightKeyPressed(){return this.isKeyArrayPressed(m)}isUpLeftKeyPressed(){return this.isKeyArrayPressed(c)}isUpKeyPressed(){return this.isKeyArrayPressed(g)}isUpRightKeyPressed(){return this.isKeyArrayPressed(d)}isKeyArrayPressed(e){for(let t=0;t<e.length;t++)if(this.isKeyPressed(e[t]))return!0;return!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(19),r=256;t.Keyboard=class{constructor(e){this.keys=new Array(r);for(let e=0;e<r;e++)this.keys[e]=new s.Input;e.addEventListener("keydown",e=>this.setKey(e,!0)),e.addEventListener("keyup",e=>this.setKey(e,!1))}setKey(e,t){e.stopPropagation(),e.preventDefault();const i=e.keyCode;i>=0&&i<r&&(this.keys[i].down=t)}update(){for(let e=0;e<r;e++)this.keys[e].down?this.keys[e].downCount++:this.keys[e].downCount=0}getKey(e){return e>=0&&e<r?this.keys[e]:null}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(19),r=i(1),o=i(2);t.Mouse=class extends s.Input{constructor(e){super(),this.app=e,this.prev=new o.Vec2(0,0),this.start=new o.Vec2(0,0),this.x=0,this.y=0,this.dx=0,this.dy=0,this.dragDistance=0,this.longPress=!1,this.wheelDelta=0,this.lastWheelDelta=0;const t=e.canvas,i=this.handleEvent.bind(this);t.addEventListener("mousedown",i),t.addEventListener("mouseup",i),t.addEventListener("mousemove",i),t.addEventListener("contextmenu",i);const s=this.handleTouchEvent.bind(this);t.addEventListener("touchstart",s),t.addEventListener("touchend",s),t.addEventListener("touchcancel",s),t.addEventListener("touchmove",s);const r=this.handleMouseWheel.bind(this);t.addEventListener("mousewheel",r)}handleTouchEvent(e){if(e.stopPropagation(),e.preventDefault(),e.touches.length>0){const t=e.touches[0];this.updatePosition(t.clientX,t.clientY)}"touchstart"===e.type&&(this.down=!0,this.prev.x=this.x,this.prev.y=this.y,this.start.x=this.x,this.start.y=this.y,this.dx=0,this.dy=0,this.dragDistance=0),"touchend"===e.type&&(this.down=!1,this.longPress=this.downCount>=30)}handleEvent(e){e.stopPropagation(),e.preventDefault(),this.updatePosition(e.clientX,e.clientY),"mousedown"===e.type&&(this.down=!0,this.start.x=this.x,this.start.y=this.y,this.dragDistance=0,this.app.canvas.focus()),"mouseup"===e.type&&(this.down=!1,this.longPress=this.downCount>=30)}updatePosition(e,t){let i=this.app.canvas.getBoundingClientRect();const s=this.app.size.width/this.app.size.height,o=i.width/i.height;if(o-s>.01){const e=s*i.height,t=i.width-e;i=new r.Rect(Math.floor(t/2),0,e,i.height)}if(o-s<-.01){const e=i.width/s,t=i.height-e;i=new r.Rect(0,Math.floor(t/2),i.width,e)}this.x=this.app.size.width*(e-i.left)/i.width|0,this.y=this.app.size.height*(t-i.top)/i.height|0}handleMouseWheel(e){e.stopPropagation(),e.preventDefault();const t=e;return this.lastWheelDelta=Math.max(-1,Math.min(1,t.deltaY)),!1}update(){super.update(),this.dx=this.x-this.prev.x,this.dy=this.y-this.prev.y,this.prev.x=this.x,this.prev.y=this.y,this.wheelDelta=this.lastWheelDelta,this.lastWheelDelta=0,this.down&&(this.dragDistance+=Math.abs(this.dx)+Math.abs(this.dy))}isClicked(){return 1===this.upCount&&this.dragDistance<4&&!this.longPress}isDragging(){return this.down&&this.dragDistance>4}isLongPress(){return 30===this.downCount&&!this.isDragging()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(32),r=65536;t.RenderSet=class{constructor(e,t,i){this.gl=e,this.font=i;const o=s.initShaderProgram(e,"uniform vec2 u_viewportSize;attribute vec2 a_position;attribute vec2 a_texCoord;attribute vec4 a_color;varying vec2 v_texCoord;varying vec4 v_color;void main() {vec2 zeroToOne = a_position / u_viewportSize;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;v_color = a_color;}","precision highp float;uniform sampler2D u_image;varying vec2 v_texCoord;varying vec4 v_color;void main() {gl_FragColor = texture2D(u_image, v_texCoord);if (gl_FragColor.a < 0.1) discard;if (v_color.a != 0.0) gl_FragColor = v_color;}");this.program=o,this.viewportSizeLocation=e.getUniformLocation(o,"u_viewportSize"),this.positionLocation=e.getAttribLocation(o,"a_position"),this.texcoordLocation=e.getAttribLocation(o,"a_texCoord"),this.colorLocation=e.getAttribLocation(o,"a_color"),this.positionBuffer=e.createBuffer(),this.texcoordBuffer=e.createBuffer(),this.colorBuffer=e.createBuffer(),this.spriteTexture=s.createTexture(e,t),this.positionArray=new Float32Array(r),this.positionArrayIndex=0,this.texcoordArray=new Float32Array(r),this.texcoordArrayIndex=0,this.colorUint8Array=new Uint8Array(r),this.colorDataView=new DataView(this.colorUint8Array.buffer),this.colorArrayIndex=0}drawCenteredString(e,t,i,s){const r=t-this.font.getStringWidth(e)/2|0;this.drawString(e,r,i,s)}drawRightString(e,t,i,s){const r=t-this.font.getStringWidth(e);this.drawString(e,r,i,s)}drawString(e,t,i,s,r){const o=e.split("\n"),n=this.font.getHeight();let a=t,l=i;for(let e=0;e<o.length;e++){e>0&&(a=t,l+=n);for(let t=0;t<o[e].length;t++){const i=o[e].charCodeAt(t);if(this.font.isInRange(i)){const e=this.font.getOffset(i),t=this.font.getWidth(i);this.drawImage(a,l,e,0,t,n,s),a+=t}}}r&&(r.x=a,r.y=l)}drawChar(e,t,i,s){if(this.font.isInRange(e)){const r=this.font.getOffset(e),o=this.font.getWidth(e),n=this.font.getHeight();this.drawImage(t,i,r,0,o,n,s)}}drawImage(e,t,i,s,r,o,n,a,l){const h=this.spriteTexture;if(!h.loaded)return;const c=void 0!==a?a:r,d=void 0!==l?l:o,u=e+Math.abs(c),p=t+d,g=i/h.width,f=s/h.height,y=(i+r)/h.width,m=(s+o)/h.height,w=n||0;this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=p,this.texcoordArray[this.texcoordArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=f,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=f,this.texcoordArray[this.texcoordArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=m,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=p,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=p,this.texcoordArray[this.texcoordArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=m,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=f,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=m;for(let e=0;e<6;e++)this.colorDataView.setUint32(this.colorArrayIndex,w,!1),this.colorArrayIndex+=4}flush(e,t){if(!this.spriteTexture.loaded||0===this.positionArrayIndex)return;const i=this.gl;i.useProgram(this.program),i.uniform2f(this.viewportSizeLocation,e,t),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.spriteTexture);{i.enableVertexAttribArray(this.positionLocation),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,this.positionArray,i.DYNAMIC_DRAW);const e=2,t=i.FLOAT,s=!1,r=0,o=0;i.vertexAttribPointer(this.positionLocation,e,t,s,r,o)}{i.enableVertexAttribArray(this.texcoordLocation),i.bindBuffer(i.ARRAY_BUFFER,this.texcoordBuffer),i.bufferData(i.ARRAY_BUFFER,this.texcoordArray,i.DYNAMIC_DRAW);const e=2,t=i.FLOAT,s=!1,r=0,o=0;i.vertexAttribPointer(this.texcoordLocation,e,t,s,r,o)}{i.enableVertexAttribArray(this.colorLocation),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),i.bufferData(i.ARRAY_BUFFER,this.colorUint8Array,i.DYNAMIC_DRAW);const e=4,t=i.UNSIGNED_BYTE,s=!0,r=0,o=0;i.vertexAttribPointer(this.colorLocation,e,t,s,r,o)}const s=i.TRIANGLES,r=this.positionArrayIndex/2;i.drawArrays(s,0,r)}}},function(e,t,i){"use strict";function s(e,t,i){const s=e.createShader(t);return e.shaderSource(s,i),e.compileShader(s),s}Object.defineProperty(t,"__esModule",{value:!0}),t.ExtendedTexture=class extends WebGLTexture{constructor(){super(),this.loaded=!1,this.width=0,this.height=0}},t.initShaderProgram=function(e,t,i){const r=s(e,e.VERTEX_SHADER,t),o=s(e,e.FRAGMENT_SHADER,i),n=e.createProgram();return e.attachShader(n,r),e.attachShader(n,o),e.linkProgram(n),n},t.loadShader=s,t.createTexture=function(e,t){const i=e.createTexture();e.bindTexture(e.TEXTURE_2D,i);const s=e.RGBA,r=e.RGBA,o=e.UNSIGNED_BYTE,n=new Uint8Array([0,0,0,255]);e.texImage2D(e.TEXTURE_2D,0,s,1,1,0,r,o,n);const a=new Image;return a.onload=(()=>{e.bindTexture(e.TEXTURE_2D,i),e.texImage2D(e.TEXTURE_2D,0,s,r,o,a),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.NEAREST),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.NEAREST),e.generateMipmap(e.TEXTURE_2D),i.loaded=!0,i.width=a.width,i.height=a.height}),a.src=t,i}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(20);t.AppState=class{constructor(e){this.app=e,this.gui=new s.GUI(e)}update(){this.gui.handleInput(),this.gui.draw()}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});let r=class{constructor(e,t){this.baseRect=e,this.closeButtonRect=t}draw(e,t){const i=this.baseRect.x,s=this.baseRect.y,r=this.baseRect.width/3|0,o=this.baseRect.height/3|0,n=i+r,a=s+o,l=i+2*r,h=s+2*r,c=t.rect.x,d=t.rect.y,u=t.rect.width-2*r,p=t.rect.height-2*o,g=c+r,f=d+o,y=g+u,m=f+p;if(e.drawImage(c,d,i,s,r,o,void 0,r,o),e.drawImage(g,d,n,s,r,o,void 0,u,o),e.drawImage(y,d,l,s,r,o,void 0,r,o),e.drawImage(c,f,i,a,r,o,void 0,r,p),e.drawImage(g,f,n,a,r,o,void 0,u,p),e.drawImage(y,f,l,a,r,o,void 0,r,p),e.drawImage(c,m,i,h,r,o,void 0,r,o),e.drawImage(g,m,n,h,r,o,void 0,u,o),e.drawImage(y,m,l,h,r,o,void 0,r,o),this.closeButtonRect&&t.closeButton){const i=this.closeButtonRect.width,s=this.closeButtonRect.height,r=t.rect.x2-i,o=t.rect.y,n=this.closeButtonRect.x,a=this.closeButtonRect.y;e.drawImage(r,o,n,a,i,s)}}};r=s([i(0).Serializable("DialogRenderer")],r),t.DialogRenderer=r},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(16),o=i(23),n=i(33),a=i(6),l=i(50),h=i(4),c=i(36),d=i(1),u=i(37),p=i(38),g=i(2),f=i(8),y=i(0),m=i(14),w=i(22),S=new d.Rect(0,0,256,256);let _=class extends n.AppState{constructor(e,t){super(e),this.viewport=new d.Rect(0,0,e.size.width,e.size.height),this.viewportFocus=new g.Vec2(0,0),this.focusMargins=t.focusMargins||new g.Vec2(0,0),this.animations=[],this.entities=new f.ArrayList,this.turnIndex=0,this.blocked=!1,this.cursor=new g.Vec2(-1,-1),this.tooltip=new l.TooltipDialog,this.rng=new u.RNG,this.pathIndex=0,this.horizontalViewDistance=t.viewDistance||13,this.verticalViewDistance=t.viewDistance||13,this.zoom=1,t.horizontalViewDistance&&(this.horizontalViewDistance=t.horizontalViewDistance),t.verticalViewDistance&&(this.verticalViewDistance=t.verticalViewDistance);const i=t.mapSize||S,s=t.mapLayers||1,r=t.tileSize||new d.Rect(0,0,16,16);this.tileMap=new m.TileMap(i.width,i.height,s,r),this.tileMapRenderer=new w.TileMapRenderer(e.gl,this.tileMap)}get tileSize(){return this.tileMap.tileSize}log(e,t){this.messageLog&&this.messageLog.add(e,t)}addAnimation(e){return this.animations.push(e),e.promise}update(){p.Sprite.updateGlobalAnimations(),this.updateTooltip(),this.updateZoom(),this.gui.handleInput()||(this.updateAnimations(),this.updateEntities(),this.onUpdate&&this.onUpdate(),this.updateViewport()),this.drawTileMap(),1===this.zoom&&(this.drawTargeting(),this.drawEntities(),this.drawAnimations()),this.gui.draw()}updateTooltip(){if(this.gui.dragElement)return void(this.tooltip.visible=!1);this.tooltip.visible||(this.tooltipElement=void 0);const e=this.app.mouse,t=e.isLongPress();if(!e.down&&(0!==e.dx||0!==e.dy)||t){const i=this.gui.getPanelAt(e);this.tooltipElement!==i&&(this.tooltipElement=i,i&&(i.updateTooltip(this.tooltip),t&&window.navigator.vibrate(100))),this.tooltip.visible&&(this.tooltip.gui||this.gui.add(this.tooltip),this.tooltip.showAt(e.x,e.y),this.tooltip.modal=this.app.mobile)}}updateZoom(){if(0!==this.app.mouse.wheelDelta){const e=this.viewport.getCenter();this.viewportFocus.x=e.x,this.viewportFocus.y=e.y,this.app.mouse.wheelDelta>0?this.zoom*=.5:this.zoom*=2,this.viewport.width=this.zoom*this.app.size.width|0,this.viewport.height=this.zoom*this.app.size.height|0,this.viewport.x=e.x-(this.app.size.width/this.zoom/2|0),this.viewport.y=e.y-(this.app.size.height/this.zoom/2|0)}}updateAnimations(){this.blocked=!1;for(let e=0;e<this.animations.length;e++){const t=this.animations[e];t.update(),t.blocking&&(this.blocked=!0)}for(let e=this.animations.length-1;e>=0;e--)this.animations[e].isDone()&&(this.animations[e].promise.resolve(),this.animations.splice(e,1))}updateEntities(){if(this.player&&this.player.hp<=0)return;let e=0;for(;0!==this.entities.length&&(this.turnIndex>=this.entities.length&&(this.turnIndex=0),!(e>2*this.entities.length));){const t=this.entities.get(this.turnIndex);if(t instanceof o.Actor){if(t.ap>0){if(t===this.player){this.blocked||this.handlePlayerInput();break}this.doAi(t)}t.ap<=0&&(t.ap=0,this.nextTurn())}else this.nextTurn();e++}}resetViewport(){this.player&&(this.viewportFocus.x=this.player.centerPixelX,this.viewportFocus.y=this.player.centerPixelY,this.viewport.x=this.viewportFocus.x-(this.app.size.width/this.zoom/2|0),this.viewport.y=this.viewportFocus.y-(this.app.size.height/this.zoom/2|0))}updateViewport(){this.viewport.width=this.app.size.width/this.zoom,this.viewport.height=this.app.size.height/this.zoom;const e=this.app.mouse;if(e.isDragging())this.viewport.x-=e.dx/this.zoom,this.viewport.y-=e.dy/this.zoom,this.viewportFocus.x=this.viewport.x+(this.viewport.width/2|0),this.viewportFocus.y=this.viewport.y+(this.viewport.height/2|0);else{const e=.05,t=this.viewportFocus.x-(this.app.size.width/this.zoom/2|0);if(t!==this.viewport.x){let i=e*t-e*this.viewport.x;i=i<0?Math.floor(i):Math.ceil(i),this.viewport.x+=i}const i=this.viewportFocus.y-(this.app.size.height/this.zoom/2|0);if(i!==this.viewport.y){let t=e*i-e*this.viewport.y;t=t<0?Math.floor(t):Math.ceil(t),this.viewport.y+=t}}}drawTileMap(){if(this.app.renderSet.spriteTexture.loaded){const e=(this.viewport.x/this.zoom|0)*this.zoom,t=(this.viewport.y/this.zoom|0)*this.zoom,i=(p.Sprite.globalAnimIndex/30|0)%2;this.tileMapRenderer.draw(e,t,this.viewport.width,this.viewport.height,i)}}drawTargeting(){if(this.isTargeting()&&this.targetSprite){const e=this.cursor.x*this.tileMap.tileSize.width-this.viewport.x,t=this.cursor.y*this.tileMap.tileSize.height-this.viewport.y;this.targetSprite.draw(this.app,e,t)}}drawEntities(){for(let e=0;e<3;e++)for(let t=0;t<this.entities.length;t++){const i=this.entities.get(t);i.zIndex===e&&this.tileMap.isVisible(i.x,i.y)&&i.draw()}}drawAnimations(){let e=0;for(let t=0;t<this.animations.length;t++){const i=this.animations[t];0!==e&&i.blocking||i.draw(this),i.blocking&&e++}}isTargeting(){return!!this.targetAbility}startTargeting(e,t){this.targetAbility=e,this.targetCallback=t,this.player&&(this.cursor.x=this.player.x,this.cursor.y=this.player.y)}endTargeting(){if(this.player&&this.targetAbility){const e=this.targetAbility.targetType;let t=null;e===r.TargetType.ENTITY?t=this.getActorAt(this.cursor.x,this.cursor.y):e===r.TargetType.TILE&&(t=this.tileMap.getCell(this.cursor.x,this.cursor.y)),t&&this.targetAbility.cast(this.player,t)&&this.targetCallback&&this.targetCallback()}this.cancelTargeting()}cancelTargeting(){this.targetAbility=void 0,this.targetCallback=void 0}handlePlayerInput(){if(!this.player||this.blocked)return;if(this.player.ai)return this.player.ai.doAi(),void(this.player.ap=0);const e=this.app.mouse;if((e.down||0!==e.dx||0!==e.dy)&&(this.cursor.x=(this.viewport.x+e.x)/this.tileMap.tileSize.width|0,this.cursor.y=(this.viewport.y+e.y)/this.tileMap.tileSize.height|0),this.app.isKeyDown(h.Keys.VK_SHIFT)){let e=0,t=0;return this.app.isDownLeftKeyPressed()&&(e=-1,t=1),this.app.isDownKeyPressed()&&(t=1),this.app.isDownRightKeyPressed()&&(e=1,t=1),this.app.isLeftKeyPressed()&&(e=-1),this.app.isRightKeyPressed()&&(e=1),this.app.isUpLeftKeyPressed()&&(e=-1,t=-1),this.app.isUpKeyPressed()&&(t=-1),this.app.isUpRightKeyPressed()&&(e=1,t=-1),this.viewportFocus.x-=e*this.tileMap.tileSize.height,void(this.viewportFocus.y-=t*this.tileMap.tileSize.height)}if(this.isTargeting())return(this.app.isKeyPressed(h.Keys.VK_ENTER)||this.app.mouse.isClicked())&&this.endTargeting(),this.app.isKeyPressed(h.Keys.VK_ESCAPE)&&this.cancelTargeting(),this.app.isDownLeftKeyPressed()&&(this.cursor.x--,this.cursor.y++),this.app.isDownKeyPressed()&&this.cursor.y++,this.app.isDownRightKeyPressed()&&(this.cursor.x++,this.cursor.y++),this.app.isLeftKeyPressed()&&this.cursor.x--,this.app.isRightKeyPressed()&&this.cursor.x++,this.app.isUpLeftKeyPressed()&&(this.cursor.x--,this.cursor.y--),this.app.isUpKeyPressed()&&this.cursor.y--,void(this.app.isUpRightKeyPressed()&&(this.cursor.x++,this.cursor.y--));if(e.isClicked()){const t=(this.viewport.x+e.x)/this.tileMap.tileSize.width|0,i=(this.viewport.y+e.y)/this.tileMap.tileSize.height|0,s=this.tileMap.getCell(t,i);s&&s!==this.targetTile&&(this.targetTile=s,this.path=c.computePath(this.tileMap,this.player,this.targetTile,100),this.pathIndex=0)}let t=null;if(this.path){for(t=this.path[this.pathIndex];t&&t.x===this.player.x&&t.y===this.player.y;)this.pathIndex++,t=this.pathIndex<this.path.length?this.path[this.pathIndex]:null;t||this.stopAutoWalk()}if(t){const e=t.x-this.player.x,i=t.y-this.player.y;this.tryMoveOrAttack(e,i)||this.stopAutoWalk()}else this.app.isDownLeftKeyPressed()&&this.tryMoveOrAttack(-1,1)||this.app.isDownKeyPressed()&&this.tryMoveOrAttack(0,1)||this.app.isDownRightKeyPressed()&&this.tryMoveOrAttack(1,1)||this.app.isLeftKeyPressed()&&this.tryMoveOrAttack(-1,0)||this.app.isRightKeyPressed()&&this.tryMoveOrAttack(1,0)||this.app.isUpLeftKeyPressed()&&this.tryMoveOrAttack(-1,-1)||this.app.isUpKeyPressed()&&this.tryMoveOrAttack(0,-1)||this.app.isUpRightKeyPressed()&&this.tryMoveOrAttack(1,-1)||this.app.isWaitKeyPressed()&&(this.player.ap=0)}tryMoveOrAttack(e,t){const i=this.player;if(!i)return!1;const s=i.x+e,r=i.y+t;for(let e=0;e<this.entities.length;e++){const t=this.entities.get(e);if(i!==t&&t.x===s&&t.y===r)return this.path&&t instanceof o.Actor?1===this.pathIndex?(this.stopAutoWalk(),t.onBump(i)):(this.stopAutoWalk(),!0):t.onBump(i)}return i.move(e,t)}recalculateViewportFocus(){const e=this.player;if(!e)return;const t=this.tileMap,i=t.tileSize.width,s=t.tileSize.height;let r=e.x*i,n=e.y*s,a=(e.x+1)*i,l=(e.y+1)*s;for(let o=e.y-this.verticalViewDistance;o<=e.y+this.verticalViewDistance;o++)for(let h=e.x-this.horizontalViewDistance;h<=e.x+this.horizontalViewDistance;h++)t.isVisible(h,o)&&(r=Math.min(r,h*i),n=Math.min(n,o*s),a=Math.max(a,(h+1)*i),l=Math.max(l,(o+1)*s));let h=e.x*i,c=e.y*s,d=h+i,u=c+s;if(this.path)for(let e=this.pathIndex;e<this.path.length;e++){const t=this.path[e];h=Math.min(h,t.x*i),c=Math.min(c,t.y*s),d=Math.max(d,(t.x+1)*i),u=Math.max(u,(t.y+1)*s)}else for(let e=0;e<this.entities.length;e++){const r=this.entities.get(e);r instanceof o.Actor&&t.isVisible(r.x,r.y)&&(h=Math.min(h,r.x*i),c=Math.min(c,r.y*s),d=Math.max(d,(r.x+1)*i),u=Math.max(u,(r.y+1)*s))}a-r<=this.viewport.width-2*this.focusMargins.x?this.viewportFocus.x=Math.round((r+a)/2):this.viewportFocus.x=Math.round((h+d)/2),l-n<=this.viewport.height-2*this.focusMargins.y?this.viewportFocus.y=Math.round((n+l)/2):this.viewportFocus.y=Math.round((c+u)/2)}doAi(e){e.ai?((e.visibleDuration>0||e.ai.alwaysActive)&&e.ai.doAi(),e.ap=0):e.ap=0}nextTurn(){if(this.turnIndex<this.entities.length){const e=this.entities.get(this.turnIndex);e.endTurn(),this.player===e&&this.recomputeFov()}if(this.turnIndex++,this.turnIndex>=this.entities.length&&(this.turnIndex=0),this.turnIndex>=0&&this.turnIndex<this.entities.length){const e=this.entities.get(this.turnIndex);e.startTurn(),this.player===e&&this.recalculateViewportFocus()}}stopAutoWalk(){this.path=void 0,this.targetTile=void 0}isBlocked(e,t){if(this.tileMap.isBlocked(e,t))return!0;for(let i=0;i<this.entities.length;i++){const s=this.entities.get(i);if(s.blocks&&s.x===e&&s.y===t)return!0}return!1}getEntityAt(e,t){for(let i=0;i<this.entities.length;i++){const s=this.entities.get(i);if(s.x===e&&s.y===t)return s}}getActorAt(e,t){for(let i=0;i<this.entities.length;i++){const s=this.entities.get(i);if(s instanceof o.Actor&&s.x===e&&s.y===t)return s}}recomputeFov(){if(this.player){this.tileMap.computeFov(this.player.x,this.player.y,this.horizontalViewDistance,this.verticalViewDistance);for(let e=0;e<this.entities.length;e++){const t=this.entities.get(e);t!==this.player&&t instanceof o.Actor&&(this.tileMap.isVisible(t.x,t.y)?(t.seen||(t.seen=!0,this.player.addFloatingText("!",a.Colors.WHITE),this.stopAutoWalk(),this.viewportFocus.x=(this.player.centerPixelX+t.centerPixelX)/2|0,this.viewportFocus.y=(this.player.centerPixelY+t.centerPixelY)/2|0),t.visibleDuration++):t.visibleDuration=-1)}}}};_=s([y.Serializable("Game")],_),t.Game=_},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=[-1,0,1,-1,1,-1,0,1],r=[-1,-1,-1,0,0,1,1,1],o=[1.5,1,1.5,1,1,1.5,1,1.5];function n(e){let t=null,i=-1,s=1/0;for(let r=0;r<e.length;r++){const o=e[r];o.g!==1/0&&o.g+o.h<s&&(t=o,i=r,s=o.g+o.h)}return e.splice(i,1),t}function a(e){const t=[];let i=e;for(;i;)t.push(i),i=i.prev;return t.reverse(),t}t.computePath=function(e,t,i,l){!function(e,t){for(let i=0;i<e.height;i++)for(let s=0;s<e.width;s++){const r=e.grid[i][s];r.g=1/0,r.h=Math.min(Math.abs(s-t.x),Math.abs(i-t.y)),r.prev=null}}(e,i);const h=e.grid[t.y][t.x];h.g=0;const c=[h];for(;c.length>0;){const t=n(c);if(t.x===i.x&&t.y===i.y)return a(t);for(let n=0;n<s.length;n++){const a=t.x+s[n],h=t.y+r[n];if(a>=0&&a<e.width&&h>=0&&h<e.height){const s=e.grid[h][a],r=t.g+o[n];r<s.g&&r<=l&&(a===i.x&&h===i.y||!e.grid[h][a].blocked)&&(s.g=r,s.prev=t,c.push(s))}}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=624,r=397,o=2147483648,n=2147483647;t.RNG=class{constructor(e){this.mt=new Array(s),this.mti=625,this.setSeed(e||1)}setSeed(e){for(this.mt[0]=e>>>0,this.mti=1;this.mti<s;this.mti++){const e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30;this.mt[this.mti]=(1812433253*((4294901760&e)>>>16)<<16)+1812433253*(65535&e)+this.mti,this.mt[this.mti]>>>=0}}nextInt(){let e=0;const t=new Array(0,2567483615);if(this.mti>=s){var i;for(i=0;i<227;i++)e=this.mt[i]&o|this.mt[i+1]&n,this.mt[i]=this.mt[i+r]^e>>>1^t[1&e];for(;i<623;i++)e=this.mt[i]&o|this.mt[i+1]&n,this.mt[i]=this.mt[i+(r-s)]^e>>>1^t[1&e];e=this.mt[623]&o|this.mt[0]&n,this.mt[623]=this.mt[396]^e>>>1^t[1&e],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^=e>>>18)>>>0}nextFloat(){return this.nextInt()*(1/4294967296)}nextRange(e,t){return e+(this.nextFloat()*(t-e)|0)}chooseIndex(e){const t=e.reduce((e,t)=>e+t),i=this.nextRange(1,t+1);let s=0;for(let t=0;t<e.length;t++)if(i<=(s+=e[t]))return t;return e.length-1}chooseKey(e){const t=[],i=[];for(const s in e)e.hasOwnProperty(s)&&(t.push(s),i.push(e[s]));return t[this.chooseIndex(i)]}}},function(e,t,i){"use strict";var s,r=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const o=i(1),n=i(0);let a=s=class extends o.Rect{constructor(e,t,i,s,r,o,n,a){super(e,t,i,s),this.frames=r||1,this.loop=!!o,this.ticksPerFrame=n||30,this.colorOverride=a,this.animIndex=0,this.animDelay=0}draw(e,t,i,r){let o=this.animIndex;this.loop&&(o=(s.globalAnimIndex/this.ticksPerFrame|0)%this.frames);const n=this.x+o*this.width,a=this.y,l=r||this.colorOverride;e.drawImage(t,i,n,a,this.width,this.height,l),this.animDelay++,this.animDelay>this.ticksPerFrame&&(this.animDelay=0,this.animIndex++,this.animIndex>=this.frames&&(this.loop?this.animIndex=0:this.animIndex=this.frames-1))}clone(){return new s(this.x,this.y,this.width,this.height,this.frames,this.loop,this.ticksPerFrame,this.colorOverride)}static updateGlobalAnimations(){s.globalAnimIndex++}};a.globalAnimIndex=0,a=s=r([n.Serializable("Sprite")],a),t.Sprite=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(2);t.TileMapCell=class extends s.Vec2{constructor(e,t){super(e,t),this.blocked=!0,this.blockedSight=!0,this.visible=!1,this.seen=!1,this.g=0,this.h=0,this.prev=null}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(15),o=i(10),n=i(12),a=i(9);let l=class extends r.ButtonSlot{onDrop(e){if(this.children.length>0)return!1;if(e instanceof o.ItemButton){const t=e,i=t.containerItems,s=t.stackItems.get(0);return this.add(new n.ItemShortcutButton(this.rect.clone(),i,s)),!1}return e instanceof a.TalentButton?!!e.shortcut||(this.add(new a.TalentButton(this.rect.clone(),e.talent,!0)),!1):!!(e instanceof n.ItemShortcutButton||e instanceof a.TalentButton&&e.shortcut)}};l=s([i(0).Serializable("ShortcutButtonSlot")],l),t.ShortcutButtonSlot=l},function(e,t,i){"use strict";function s(e){for(var i in e)t.hasOwnProperty(i)||(t[i]=e[i])}Object.defineProperty(t,"__esModule",{value:!0}),s(i(16)),s(i(23)),s(i(18)),s(i(43)),s(i(44)),s(i(5)),s(i(24)),s(i(45)),s(i(46)),s(i(25)),s(i(47)),s(i(26)),s(i(28)),s(i(33)),s(i(8)),s(i(11)),s(i(6)),s(i(49)),s(i(17)),s(i(35)),s(i(20)),s(i(13)),s(i(15)),s(i(52)),s(i(7)),s(i(34)),s(i(54)),s(i(10)),s(i(55)),s(i(12)),s(i(57)),s(i(58)),s(i(3)),s(i(59)),s(i(60)),s(i(40)),s(i(9)),s(i(61)),s(i(19)),s(i(62)),s(i(29)),s(i(4)),s(i(21)),s(i(30)),s(i(36)),s(i(1)),s(i(37)),s(i(0)),s(i(63)),s(i(38)),s(i(64)),s(i(14)),s(i(39)),s(i(22)),s(i(2))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationPromise=class{constructor(){this.handlers=[]}then(e){return this.handlers.push(e),this}resolve(){for(let e=0;e<this.handlers.length;e++)this.handlers[e]()}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(18),o=i(0);let n=class extends r.AI{constructor(e,t){super(e),this.damageFunc=t}doAi(){const e=this.actor,t=e.game.player;if(t)if(e.distanceTo(t)>1.5)e.moveToward(t.x,t.y);else if(t.hp>0){const i=this.damageFunc?this.damageFunc(e,t):1;e.attack(t,i)}}};n=s([o.Serializable("BasicMonster")],n),t.BasicMonster=n},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(18);let o=class extends r.AI{constructor(e){super(e),this.numTurns=10,this.oldAi=e.ai}doAi(){if(this.numTurns>0){const e=this.actor.game.rng;this.actor.move(e.nextRange(-1,2),e.nextRange(-1,2)),this.numTurns--}else this.actor.ai=this.oldAi}};o=s([i(0).Serializable("ConfusedMonster")],o),t.ConfusedMonster=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(11),r=i(5);t.FadeInAnimation=class extends r.Animation{constructor(e){super(e,!0),this.duration=e}draw(e){const t=e.blackoutRect;if(!t)return;const i=this.countdown/this.duration,r=Math.max(1,Math.min(255,255*i|0)),o=s.fromRgb(0,0,0,r);e.app.drawImage(0,0,t.x,t.y,t.width,t.height,o,e.app.size.width,e.app.size.height)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(11),r=i(5);t.FadeOutAnimation=class extends r.Animation{constructor(e){super(e,!0),this.duration=e}draw(e){const t=e.blackoutRect;if(!t)return;const i=1-this.countdown/this.duration,r=Math.max(1,Math.min(255,255*i|0)),o=s.fromRgb(0,0,0,r);e.app.drawImage(0,0,t.x,t.y,t.width,t.height,o,e.app.size.width,e.app.size.height)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(5);t.ProjectileAnimation=class extends s.Animation{constructor(e,t,i,s){super(s,!0),this.sprite=e,this.position=t,this.velocity=i,this.duration=s}update(){super.update(),this.position.add(this.velocity)}draw(e){const t=this.position.x-e.viewport.x,i=this.position.y-e.viewport.y;this.sprite.draw(e.app,t,i)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=32,r=126;class o{isInRange(e){return e>=s&&e<=r}getStringWidth(e){let t=0;for(let i=0;i<e.length;i++)t+=this.getWidth(e.charCodeAt(i));return t}}t.Font=o,t.MonospacedFont=class extends o{constructor(e){super(),this.glyphSize=e}getOffset(e){return(e-s)*this.glyphSize.width}getWidth(){return this.glyphSize.width}getHeight(){return this.glyphSize.height}};class n extends o{constructor(e,t){super(),this.height=e,this.widths=t,this.offsets=[0];let i=0;for(let e=0;e<this.widths.length;e++)i+=this.widths[e],this.offsets.push(i)}getOffset(e){return this.offsets[e-s]}getWidth(e){return this.widths[e-s]}getHeight(){return this.height}}t.ProportionalFont=n,t.FONT_04B03=new n(8,[4,2,4,6,5,6,6,2,3,3,4,4,3,4,2,6,5,3,5,5,5,5,5,5,5,5,2,2,4,4,4,5,6,5,5,4,5,4,4,5,5,4,5,5,4,6,5,5,5,5,5,5,4,5,5,6,5,5,4,3,6,3,4,5,3,5,5,4,5,5,4,5,5,2,3,5,2,6,5,5,5,5,4,5,4,5,5,6,4,5,5,4,2,4,5,0])},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(21);t.CompoundMessage=class extends s.Message{constructor(...e){super("",0),this.messages=e}draw(e,t){for(let i=0;i<this.messages.length;i++)this.messages[i].draw(e,t)}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(1),o=i(7),n=i(0);let a=class extends o.Dialog{constructor(){super(new r.Rect(0,0,100,10)),this.messages=[],this.visible=!1}showAt(e,t){if(!this.gui)return;const i=this.gui.app,s=i.font,r=s.getHeight()+2;this.rect.width=10,this.rect.height=10+this.messages.length*r;for(let e=0;e<this.messages.length;e++){const t=this.messages[e],i=10+s.getStringWidth(t.text);this.rect.width=Math.max(this.rect.width,i)}e+this.rect.width>=i.size.width?this.rect.x=e-this.rect.width-2:this.rect.x=e+2,t-this.rect.height<0?this.rect.y=t+2:this.rect.y=t-this.rect.height-2,this.rect.x<0&&(this.rect.x=0),this.rect.y<0&&(this.rect.y=0),this.visible=!0}drawContents(){if(!this.gui)return;super.drawContents();const e=this.gui.app.font.getHeight()+2,t=this.rect.x+5;let i=this.rect.y+5;for(let s=0;s<this.messages.length;s++){const r=this.messages[s];this.gui.app.drawString(r.text,t,i,r.color),i+=e}}handleInput(){return!!this.gui&&(this.gui.app.mouse.isClicked()&&(this.visible=!1),!1)}};a=s([n.Serializable("TooltipDialog")],a),t.TooltipDialog=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(14);t.TileMapLayer=class{constructor(e,t){this.width=e,this.height=t,this.imageData=new Uint8Array(4*e*t),this.clear()}clear(){let e=0;for(;e<this.imageData.length;)this.imageData[e++]=0}getIndex(e,t){return 4*(t*this.width+e)}setTile(e,t,i){const s=this.getIndex(e,t);this.imageData[s]=i%64|0,this.imageData[s+1]=i/64|0}getTile(e,t){const i=this.getIndex(e,t);return s.getTileId(this.imageData[i],this.imageData[i+1])}isAnimated(e,t){const i=this.getIndex(e,t);return!!this.imageData[i+2]}setAnimated(e,t,i){const s=this.getIndex(e,t);this.imageData[s+2]=i?1:0}getAlpha(e,t){const i=this.getIndex(e,t);return this.imageData[i+3]}setAlpha(e,t,i){const s=this.getIndex(e,t);this.imageData[s+3]=i}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),o=i(2),n=i(53),a=i(7),l=i(0);let h=class extends a.Dialog{constructor(e,t){super(e),this.options=t,this.selectedIndex=0,this.renderer=new n.DefaultSelectOptionRenderer}drawContents(){if(!this.gui)return;super.drawContents();const e=this.rect,t=new o.Vec2(e.x+4,e.y+4);for(let e=0;e<this.options.length;e++){const i=this.options[e],s=e===this.selectedIndex;this.renderer.drawOption(this.gui,t,i,s),t.y+=this.renderer.getHeight(i,s)}}handleInput(){if(!this.gui)return!1;const e=this.gui.app;for(let t=0;t<this.options.length;t++)e.isKeyPressed(r.Keys.VK_A+t)&&(this.selectedIndex=t,this.onSelect&&this.onSelect(this.options[t]));e.isKeyPressed(r.Keys.VK_ENTER)&&this.onSelect&&this.onSelect(this.options[this.selectedIndex]),e.isKeyPressed(r.Keys.VK_ESCAPE)&&this.onCancel&&this.onCancel(),e.isKeyPressed(r.Keys.VK_UP)&&this.selectedIndex--,e.isKeyPressed(r.Keys.VK_DOWN)&&this.selectedIndex++,this.selectedIndex<0&&(this.selectedIndex+=this.options.length),this.selectedIndex>=this.options.length&&(this.selectedIndex-=this.options.length);const t=e.mouse,i=this.rect;let s=i.y+4;if(1===t.upCount&&t.x>=i.x1&&t.x<i.x2)for(let e=0;e<this.options.length;e++){const i=this.options[e],r=e===this.selectedIndex,o=this.renderer.getHeight(i,r),n=s,a=s+o;t.y>=n&&t.y<a&&(r?this.onSelect&&this.onSelect(i):this.selectedIndex=e),s+=o}return!0}};h=s([l.Serializable("ComplexSelectDialog")],h),t.ComplexSelectDialog=h},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(6);let o=class{getHeight(e,t){return 10}drawOption(e,t,i,s){const o=s?r.Colors.YELLOW:r.Colors.WHITE;e.app.drawString(i.name,t.x,t.y,o)}};o=s([i(0).Serializable("DefaultSelectOptionRenderer")],o),t.DefaultSelectOptionRenderer=o},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(3);let o=class extends r.Panel{constructor(e,t){super(t),this.srcRect=e}drawContents(){if(!this.gui)return;const e=this.srcRect,t=this.rect;this.gui.app.drawImage(t.x,t.y,e.x,e.y,t.width,t.height)}};o=s([i(0).Serializable("ImagePanel")],o),t.ImagePanel=o},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),o=i(1),n=i(7),a=i(10),l=i(56),h=i(0);let c=class extends n.Dialog{constructor(e,t,i,s){super(e),this.messages=t,this.capacity=i,this.items=s,this.modal=!0,s.addListener({onAdd:(e,t)=>this.addItem(t),onRemove:(e,t)=>this.removeItem(t)});for(let e=0;e<i;e++)this.add(new l.ItemContainerButtonSlot(new o.Rect(0,0,24,24),s,r.Keys.VK_A+e))}addItem(e){const t=this.getExistingButton(e);if(t)return void t.stackItems.add(e);const i=this.getNextFreeSlot();i&&i.add(new a.ItemButton(i.rect.clone(),this.items,e))}removeItem(e){for(let t=0;t<this.children.length;t++){const i=this.children.get(t),s=i.button;s&&s instanceof a.ItemButton&&s.stackItems.contains(e)&&(s.stackItems.remove(e),0===s.stackItems.length&&i.remove(s))}}getExistingButton(e){for(let t=0;t<this.children.length;t++){const i=this.children.get(t).button;if(i&&i instanceof a.ItemButton){const t=i.stackItems.get(0);if(e.isStackable(t))return i}}}getNextFreeSlot(){for(let e=0;e<this.children.length;e++){const t=this.children.get(e);if(!t.button)return t}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const e=this.rect,t=this.gui.renderer.buttonSlotRect;let i=e.x+4,s=e.y+4;for(let e=0;e<this.messages.length;e++){const t=this.messages[e];this.gui.app.drawString(t.text,i,s,t.color),s+=10}for(let r=0;r<this.capacity;r++){const o=this.children.get(r);o.rect.x=i,o.rect.y=s,o.rect.width=t.width,o.rect.height=t.height,(i+=t.width+2)>e.x2-t.width-4&&(i=e.x+4,s+=t.height+2)}this.rect.height=s+4-e.y,this.drawChildren()}};c=s([h.Serializable("ItemContainerDialog")],c),t.ItemContainerDialog=c},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(15),o=i(10);let n=class extends r.ButtonSlot{constructor(e,t,i){super(e,i),this.items=t}onDrop(e){return e instanceof o.ItemButton}};n=s([i(0).Serializable("ItemContainerButtonSlot")],n),t.ItemContainerButtonSlot=n},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(6),o=i(21),n=i(3),a=i(0),l=i(2);let h=class extends n.Panel{constructor(e,t){super(e),this.messages=[],this.maxItems=t||5}add(e,t){e instanceof n.Panel||(e instanceof o.Message?this.messages.push(e):this.messages.push(new o.Message(e,t||r.Colors.WHITE)),this.messages.length>this.maxItems&&this.messages.splice(0,this.messages.length-this.maxItems))}drawContents(){if(!this.gui)return;const e=new l.Vec2(this.rect.x,this.rect.y);if(e.y<0){const t=this.gui.app.size.height+e.y+this.rect.height;e.y=t-10*this.messages.length}for(let t=0;t<this.messages.length;t++)this.messages[t].draw(this.gui.app,e),e.x=0,e.y+=10}handleInput(){return!1}};h=s([a.Serializable("MessageLog")],h),t.MessageLog=h},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(3);let o=class extends r.Panel{constructor(e,t){super(e),this.message=t}drawContents(){if(!this.gui)return;const e=this.message,t=this.rect;this.gui.app.drawString(e.text,t.x,t.y,e.color)}};o=s([i(0).Serializable("MessagePanel")],o),t.MessagePanel=o},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),o=i(7),n=i(0);let a=class extends o.Dialog{constructor(e,t,i){super(e),this.options=t,this.callback=i}drawContents(){if(!this.gui)return;super.drawContents();const e=this.rect;for(let t=0;t<this.options.length;t++){const i=String.fromCharCode(65+t)+" - "+this.options[t].name;this.gui.app.drawString(i,e.x+4,e.y+4+10*t)}}handleInput(){if(!this.gui)return!1;for(let e=0;e<this.options.length;e++)if(this.gui.app.isKeyPressed(r.Keys.VK_A+e))return this.callback(this.options[e]),this.close(),!0;if(this.gui.app.isKeyPressed(r.Keys.VK_ESCAPE))return this.close(),!0;const e=this.gui.app.mouse,t=this.rect;if(e.isClicked()&&e.x>=t.x1&&e.x<t.x2){if(this.closeButton&&e.x>=t.x2-16&&e.y<t.y+16)return this.close(),!0;for(let i=0;i<this.options.length;i++){const s=t.y+4+10*i,r=s+10;e.y>=s&&e.y<r&&(this.callback(this.options[i]),this.close())}}return!0}};a=s([n.Serializable("SelectDialog")],a),t.SelectDialog=a},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),o=i(1),n=i(12),a=i(3),l=i(40),h=i(9),c=i(0);let d=class extends a.Panel{constructor(e,t,i){super(e),this.spacing=void 0!==i?i:2;for(let e=0;e<t;e++){const t=new l.ShortcutButtonSlot(new o.Rect(0,0,24,24),r.Keys.VK_1+e);this.add(t)}}addTalent(e,t){if(this.containsTalent(e))return;const i=this.getFreeSlot(!!t);i&&i.add(new h.TalentButton(i.rect.clone(),e,!0))}containsTalent(e){for(let t=0;t<this.children.length;t++){const i=this.children.get(t);if(i.button&&i.button instanceof h.TalentButton&&i.button.talent===e)return!0}return!1}addItem(e,t,i){if(this.containsItem(t))return;const s=this.getFreeSlot(!!i);s&&s.add(new n.ItemShortcutButton(s.rect.clone(),e,t))}containsItem(e){for(let t=0;t<this.children.length;t++){const i=this.children.get(t);if(i.button&&i.button instanceof n.ItemShortcutButton&&e.isStackable(i.button.shortcutItem))return!0}return!1}drawContents(){if(!this.gui)return;const e=this.gui.renderer.buttonSlotRect;if(e){for(let t=0;t<this.children.length;t++){const i=this.children.get(t);i.rect.x=this.rect.x+t*(e.width+2),i.rect.y=this.rect.y,i.rect.width=e.width,i.rect.height=e.height}this.drawChildren()}}getFreeSlot(e){if(e)for(let e=this.children.length-1;e>=0;e--){const t=this.children.get(e);if(!t.button)return t}else for(let e=0;e<this.children.length;e++){const t=this.children.get(e);if(!t.button)return t}}};d=s([c.Serializable("ShortcutBar")],d),t.ShortcutBar=d},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(4),o=i(1),n=i(15),a=i(7),l=i(9),h=i(0);let c=class extends a.Dialog{constructor(e,t,i,s){super(e),this.messages=t,this.capacity=i,this.talents=s,this.modal=!0,s.addListener({onAdd:(e,t)=>this.addItem(t),onRemove:(e,t)=>this.removeItem(t)});for(let e=0;e<i;e++)this.add(new n.ButtonSlot(new o.Rect(0,0,24,24),r.Keys.VK_A+e))}addItem(e){const t=this.getNextFreeSlot();t&&t.add(new l.TalentButton(t.rect.clone(),e))}removeItem(e){for(let t=0;t<this.children.length;t++){const i=this.children.get(t),s=i.button;s&&s instanceof l.TalentButton&&s.talent===e&&i.remove(s)}}getNextFreeSlot(){for(let e=0;e<this.children.length;e++){const t=this.children.get(e);if(!t.button)return t}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const e=this.rect,t=this.gui.renderer.buttonSlotRect;let i=e.x+4,s=e.y+4;for(let e=0;e<this.messages.length;e++){const t=this.messages[e];this.gui.app.drawString(t.text,i,s,t.color),s+=10}for(let r=0;r<this.capacity;r++){const o=this.children.get(r);o.rect.x=i,o.rect.y=s,o.rect.width=t.width,o.rect.height=t.height,(i+=t.width+2)>e.x2-t.width-4&&(i=e.x+4,s+=t.height+2)}this.rect.height=s+4-e.y,this.drawChildren()}};c=s([h.Serializable("TalentsDialog")],c),t.TalentsDialog=c},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(17);let o=class extends r.Entity{isStackable(e){return this.name===e.name}onBump(e){return e.pickup(this),e.moveToward(this.x,this.y),!0}onPickup(e){}onUse(e){return!1}onUpdateTooltip(){}};o=s([i(0).Serializable("Item")],o),t.Item=o},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(35),r=i(31),o=i(28),n=i(20),a=i(3),l=i(27),h=i(14),c=i(22);t.Serializer=class{constructor(){this.typeLists={}}serialize(e){return{root:this.serializeObject(e),refs:this.typeLists}}serializeObject(e){if(null==e)return e;const t=typeof e;if("boolean"===t||"number"===t||"string"===t)return e;if(!e.constructor)throw new Error("Object does not have a constructor");if(e instanceof o.App||e instanceof n.GUI||e instanceof a.Panel||e instanceof r.RenderSet||e instanceof h.TileMap||e instanceof c.TileMapRenderer||e instanceof Function)return;if(e instanceof Array)return this.serializeArray(e);const i=l.getSerializeMetadata(e.constructor),d=i.className,u=!i.valueType,p={};if(d&&u){if(void 0!==e.__index)return{__className:d,__index:e.__index};let t=this.typeLists[d];t||(t=[],this.typeLists[d]=t),e.__index=t.length,t.push(p)}const g=Object.getOwnPropertyNames(e);let f=0;for(let t=0;t<g.length;t++){const i=g[t],r=e[i];if("__index"===i)continue;if(e instanceof s.Game&&("tooltip"===i||"tooltipElement"===i||"messageLog"===i))continue;const o=this.serializeObject(r);void 0!==o&&(p[i]=o,f++)}return 0!==f?d&&u?{__className:d,__index:e.__index}:p:void 0}serializeArray(e){const t=[];for(let i=0;i<e.length;i++)t.push(this.serializeObject(e[i]));return t}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});let r=class{constructor(e,t,i){this.actor=e,this.ability=t,this.rank=i||1,this.cooldown=0}use(e){return!(this.cooldown>0||(this.actor.cast(this.ability,e,()=>{this.cooldown=this.ability.cooldown}),0))}};r=s([i(0).Serializable("Talent")],r),t.Talent=r}])},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(23),o=i(4),n=i(14),a=i(5),l=i(9),h=1367,c=1370;t.Monster=class extends o.StatsActor{constructor(e,t,i,r,n,a){super(e,t,i,r,n),this.ai=new s.BasicMonster(this,this.calculateDamage),this.sentiment=o.Sentiment.HOSTILE,this.level=a,this.strength=10+5*a,this.maxHp=10+3*a,this.hp=this.maxHp,this.armor=4*a,this.loot=this.getLoot()}takeDamage(e,t){super.takeDamage(e,t),this.sentiment=o.Sentiment.HOSTILE}onDeath(e){const t=this.game;if(t.log(this.name+" is dead"),t.entities.remove(this),e instanceof r.Player){const e=t.player,i=Math.round(10*e.level*Math.pow(2,.5*(this.level-e.level)));e.addXp(i)}t.tileMap.setTile(this.x,this.y,3,t.rng.nextRange(h,c));for(let e=0;e<this.loot.length;e++){const i=t.findFreeTile(this.x,this.y,5);if(!i)break;const s=this.loot[e];s.x=i.x,s.y=i.y,t.entities.add(s)}}calculateDamage(e,t){return e.getDamage()}getLoot(){const e=this.game,t=[];return this.game.rng.nextRange(0,6)<=2&&t.push(new n.Gold(e,this.x,this.y)),this.game.rng.nextRange(0,6)<=2&&t.push(new l.HealthPotion(e)),this.game.rng.nextRange(0,6)<=1&&t.push(new a.EquipmentBuilder(e).withRandomDrop(Math.round(this.level/2)).build()),t}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e[e.POOR=0]="POOR",e[e.COMMON=1]="COMMON",e[e.UNCOMMON=2]="UNCOMMON",e[e.RARE=3]="RARE",e[e.EPIC=4]="EPIC",e[e.LEGENDARY=5]="LEGENDARY"}(t.ItemQuality||(t.ItemQuality={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.HEAD="Head",e.NECK="Neck",e.BACK="Back",e.CHEST="Chest",e.HANDS="Hands",e.LEGS="Legs",e.FEET="Feet",e.RING="Ring",e.MAINHAND="Main Hand",e.OFFHAND="Off Hand"}(t.EquipmentSlot||(t.EquipmentSlot={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(3),o=i(14);var n;!function(e){e[e.HOSTILE=-1]="HOSTILE",e[e.NEUTRAL=0]="NEUTRAL",e[e.FRIENDLY=1]="FRIENDLY"}(n=t.Sentiment||(t.Sentiment={}));t.StatsActor=class extends s.Actor{constructor(e,t,i,r,o){super(e,t,i,r,o,!0),this.level=1,this.mp=1,this.maxMp=1,this.armor=0,this.strength=10,this.dexterity=10,this.constitution=10,this.intelligence=10,this.recalculateMaxHp(),this.hp=this.maxHp,this.showFrame=!0,this.sentiment=n.NEUTRAL,this.equipment=new s.ArrayList,this.buffs=[],this.equipment.addListener({onAdd:(e,t)=>this.addItem(t),onRemove:(e,t)=>this.removeItem(t)})}get strengthModifier(){return this.calculateModifier(this.strength)}get dexterityModifier(){return this.calculateModifier(this.dexterity)}get constitutionModifier(){return this.calculateModifier(this.constitution)}get intelligenceModifier(){return this.calculateModifier(this.intelligence)}calculateModifier(e){return Math.floor((e-10)/2)}countGold(){let e=0;for(let t=0;t<this.inventory.length;t++)this.inventory.get(t)instanceof o.Gold&&e++;return e}moveGold(e,t){let i=0;for(let s=this.inventory.length-1;s>=0;s--){const r=this.inventory.get(s);if(r instanceof o.Gold&&(this.inventory.remove(r),e.inventory.add(r),++i===t))return}}getEquipment(e){for(let t=0;t<this.equipment.length;t++){const i=this.equipment.get(t);if(i.slot===e)return i}}get mainHandWeapon(){return this.getEquipment(r.EquipmentSlot.MAINHAND)}getDamage(){const e=this.mainHandWeapon,t=this.game.rng;let i=1,s=this.strengthModifier;return e&&(i=t.nextRange(e.minDamage,e.maxDamage+1),s=e.finesse?this.dexterityModifier:this.strengthModifier),this.buffDamage(i+s)}buffDamage(e){let t=e;for(let e=0;e<this.buffs.length;e++)t=this.buffs[e].modifyDamageDealt(t);return t}takeDamage(e,t){let i=Math.max(0,t-Math.round(.1*this.armor));for(let e=0;e<this.buffs.length;e++)i=this.buffs[e].modifyDamageTaken(i);super.takeDamage(e,i)}onBump(e){return this.sentiment===n.FRIENDLY?this.onTalk(e):e.attack(this,e.getDamage()),!0}onTalk(e){}onAttack(e,t){t>0?this.game.log(this.name+" attacks "+e.name+" for "+t+" hit points.",2155905279):this.game.log(this.name+" attacks "+e.name+" but it has no effect!",2155905279)}startTurn(){super.startTurn();for(let e=this.buffs.length-1;e>=0;e--){const t=this.buffs[e];t.update(),t.isDone()&&this.buffs.splice(e,1)}}equipItem(e){const t=this.getEquipment(e.slot),i=this.hp;t&&this.equipment.remove(t),this.inventory.remove(e),this.equipment.add(e),t&&this.inventory.add(t),this.hp=Math.min(i,this.maxHp)}addItem(e){this.armor+=e.armor,this.constitution+=e.constitution,this.dexterity+=e.dexterity,this.strength+=e.strength,this.intelligence+=e.intelligence,this.recalculateMaxHp()}removeItem(e){this.armor-=e.armor,this.constitution-=e.constitution,this.dexterity-=e.dexterity,this.strength-=e.strength,this.intelligence-=e.intelligence,this.recalculateMaxHp()}recalculateMaxHp(){this.maxHp=8+2*this.level+this.constitutionModifier,this.hp=Math.min(this.hp,this.maxHp)}draw(){super.draw();for(let e=0;e<this.buffs.length;e++)this.buffs[e].draw()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(3),o=i(6),n=i(33),a=i(7),l=i(2),h=new s.Sprite(160,240,16,24,1,!1,void 0,2155905279);t.EquipmentBuilder=class{constructor(e){this.name="",this.sprite=h,this.itemLevel=1,this.slot=r.EquipmentSlot.HEAD,this.material=o.EquipmentMaterial.NONE,this.quality=l.ItemQuality.POOR,this.armor=0,this.strength=0,this.dexterity=0,this.constitution=0,this.intelligence=0,this.minDamage=1,this.maxDamage=2,this.ranged=!1,this.finesse=!1,this.statMultiplier=1,this.game=e}withName(e){return this.name=e,this}withSprite(e,t){return this.sprite=new s.Sprite(e.x,e.y,e.width,e.height,e.frames,e.loop,e.ticksPerFrame,t),this}withColor(e){return this.withSprite(this.sprite,e),this}withItemLevel(e){return this.itemLevel=e,this}withSlot(e){return this.slot=e,this}withMaterial(e){return this.material=e,this}withQuality(e){return this.quality=e,this}withArmor(e){return this.armor=e,this}withStrength(e){return this.strength=e,this}withDexterity(e){return this.dexterity=e,this}withConstitution(e){return this.constitution=e,this}withIntelligence(e){return this.intelligence=e,this}withDamage(e,t,i,s){return this.minDamage=e,this.maxDamage=t,this.ranged=!!i,this.finesse=!!s,this}withRandomDrop(e,t){return this.itemLevel=e,void 0!==t?this.quality=t:this.chooseQuality(),this.chooseSlot(),this.chooseFlair(),this}chooseQuality(){const e=this.game.rng.nextRange(0,100);e>99?(this.quality=l.ItemQuality.EPIC,this.statMultiplier=1.15):e>90?(this.quality=l.ItemQuality.RARE,this.statMultiplier=1.1):e>75?(this.quality=l.ItemQuality.UNCOMMON,this.statMultiplier=1.05):e>40?(this.quality=l.ItemQuality.COMMON,this.statMultiplier=1):(this.quality=l.ItemQuality.POOR,this.statMultiplier=.5)}chooseSlot(){switch(this.game.rng.nextRange(0,10)){case 0:this.chooseHead();break;case 1:this.chooseNeck();break;case 2:this.chooseBack();break;case 3:this.chooseChest();break;case 4:this.chooseHands();break;case 5:this.chooseLegs();break;case 6:this.chooseFeet();break;case 7:this.chooseRing();break;case 8:this.chooseMainHand();break;case 9:this.chooseOffHand()}}chooseHead(){switch(this.slot=r.EquipmentSlot.HEAD,this.game.rng.nextRange(0,3)){case 0:this.material=o.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Cowl","Crown","Hood","Wizard Hat"),this.armor=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.CLOTH_HELM_SPRITES);break;case 1:this.material=o.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Hood","Cover","Facemask","Mask"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.LEATHER_HELM_SPRITES);break;case 2:this.material=o.EquipmentMaterial.PLATE,this.name=this.chooseValue("Helm","Helmet","Headguard","Faceguard","Greathelm"),this.armor=Math.ceil(4.5*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.PLATE_HELM_SPRITES)}}chooseNeck(){this.slot=r.EquipmentSlot.NECK,this.name=this.chooseValue("Necklace"),this.sprite=a.NECKLACE_SPRITE_1}chooseBack(){this.slot=r.EquipmentSlot.BACK,this.name=this.chooseValue("Cloak"),this.sprite=this.chooseArrayValue(a.CLOAK_SPRITES),this.armor=Math.ceil(this.itemLevel*this.statMultiplier)}chooseChest(){switch(this.slot=r.EquipmentSlot.CHEST,this.game.rng.nextRange(0,3)){case 0:this.material=o.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Robe","Tunic"),this.armor=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.ROBE_SPRITES);break;case 1:this.material=o.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Vest","Chestpiece","Tunic"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.SHIRT_SPRITES);break;case 2:this.material=o.EquipmentMaterial.PLATE,this.name=this.chooseValue("Breastplate","Chestguard"),this.armor=Math.ceil(4.5*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.SHIRT_SPRITES)}}chooseHands(){switch(this.slot=r.EquipmentSlot.HANDS,this.game.rng.nextRange(0,3)){case 0:this.material=o.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Gloves","Wraps"),this.armor=Math.ceil(1*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.GLOVES_SPRITES);break;case 1:this.material=o.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Gloves","Gauntlets"),this.armor=Math.ceil(2*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.GLOVES_SPRITES);break;case 2:this.material=o.EquipmentMaterial.PLATE,this.name=this.chooseValue("Gloves","Gauntlets"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.GLOVES_SPRITES)}}chooseLegs(){switch(this.slot=r.EquipmentSlot.LEGS,this.game.rng.nextRange(0,3)){case 0:this.material=o.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Leggings","Pants"),this.armor=Math.ceil(1*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.PANTS_SPRITES);break;case 1:this.material=o.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Legguards","Pants"),this.armor=Math.ceil(2*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.PANTS_SPRITES);break;case 2:this.material=o.EquipmentMaterial.PLATE,this.name=this.chooseValue("Legplates","Legguards"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.PANTS_SPRITES)}}chooseFeet(){switch(this.slot=r.EquipmentSlot.FEET,this.game.rng.nextRange(0,3)){case 0:this.material=o.EquipmentMaterial.CLOTH,this.name=this.chooseValue("Boots","Sandals","Shoes","Slippers","Footpads"),this.armor=Math.ceil(1*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.BOOTS_SPRITES);break;case 1:this.material=o.EquipmentMaterial.LEATHER,this.name=this.chooseValue("Boots","Shoes","Treads"),this.armor=Math.ceil(2*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.BOOTS_SPRITES);break;case 2:this.material=o.EquipmentMaterial.PLATE,this.name=this.chooseValue("Boots","Greaves","Sabatons"),this.armor=Math.ceil(3*this.itemLevel*this.statMultiplier),this.sprite=this.chooseArrayValue(a.BOOTS_SPRITES)}}chooseRing(){this.slot=r.EquipmentSlot.RING,this.name=this.chooseValue("Ring","Band","Signet","Circle","Loop"),this.sprite=this.chooseArrayValue(a.RING_SPRITES)}chooseMainHand(){switch(this.slot=r.EquipmentSlot.MAINHAND,this.minDamage=Math.floor(1*this.itemLevel*this.statMultiplier),this.maxDamage=Math.ceil(1.2*this.itemLevel*this.statMultiplier),this.game.rng.nextRange(0,7)){case 0:this.name=this.chooseValue("Sword","Blade","Slicer","Sabre"),this.sprite=this.chooseArrayValue(a.SWORD_SPRITES);break;case 1:this.name=this.chooseValue("Axe","Ripper","Slicer"),this.sprite=a.AXE_SPRITE_1;break;case 2:this.name=this.chooseValue("Mace","Hammer","Gavel","Club"),this.sprite=this.chooseArrayValue(a.MACE_SPRITES);break;case 3:this.name=this.chooseValue("Dagger","Knife","Edge"),this.sprite=a.DAGGER_SPRITE_1,this.finesse=!0;break;case 4:this.name=this.chooseValue("Bow","Shortbow","Longbow","Recurve","Greatbow"),this.sprite=a.BOW_SPRITE_1,this.finesse=!0,this.ranged=!0;break;case 5:this.name=this.chooseValue("Crossbow","Bolt-Thrower","Speargun","Repeater"),this.sprite=a.CROSSBOW_SPRITE_1,this.finesse=!0,this.ranged=!0;break;case 6:this.name=this.chooseValue("Staff","Spellstaff"),this.sprite=this.chooseArrayValue(a.STAFF_SPRITES)}}chooseOffHand(){this.slot=r.EquipmentSlot.OFFHAND;const e=this.game.rng.nextRange(0,10);9===e?(this.name="Lantern",this.sprite=a.LANTERN_SPRITE,this.intelligence=Math.ceil(1*this.itemLevel*this.statMultiplier)):8===e?(this.name="Orb",this.sprite=a.ORB_SPRITE,this.intelligence=Math.ceil(1*this.itemLevel*this.statMultiplier)):e>=5?(this.name=this.chooseValue("Spellbook","Tome"),this.sprite=a.BOOK_SPRITE,this.intelligence=Math.ceil(1*this.itemLevel*this.statMultiplier)):(this.name=this.chooseValue("Shield","Shield Wall","Bulwark","Barrier"),this.sprite=this.chooseArrayValue(a.SHIELD_SPRITES),this.armor=Math.ceil(2*this.itemLevel*this.statMultiplier),this.constitution=Math.ceil(1*this.itemLevel*this.statMultiplier))}chooseFlair(){switch(this.quality){case l.ItemQuality.POOR:this.choosePoorFlair();break;case l.ItemQuality.COMMON:this.chooseCommonFlair();break;case l.ItemQuality.UNCOMMON:this.chooseUncommonFlair();break;case l.ItemQuality.RARE:this.chooseRareFlair();break;case l.ItemQuality.EPIC:this.chooseEpicFlair();break;case l.ItemQuality.LEGENDARY:this.chooseLegendaryFlair()}}choosePoorFlair(){this.name=this.chooseValue("Patched","Ragged","Chewed","Worn","Loose")+" "+this.name,this.withColor(s.Colors.LIGHT_GRAY)}chooseCommonFlair(){this.name=this.chooseValue("Hunting","Cadet","Veteran","Simple","Pioneer")+" "+this.name,this.withColor(3231744255)}chooseUncommonFlair(){switch(this.game.rng.nextRange(0,6)){case 0:this.name+=" of the Tiger",this.strength+=Math.ceil(this.itemLevel*this.statMultiplier),this.dexterity+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.ORANGE);break;case 1:this.name+=" of the Bear",this.strength+=Math.ceil(this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.BROWN);break;case 2:this.name+=" of the Gorilla",this.strength+=Math.ceil(this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_CYAN);break;case 3:this.name+=" of the Monkey",this.dexterity+=Math.ceil(this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_GREEN);break;case 4:this.name+=" of the Falcon",this.dexterity+=Math.ceil(this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_RED);break;case 5:this.name+=" of the Eagle",this.constitution+=Math.ceil(this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_BLUE)}}chooseRareFlair(){switch(this.game.rng.nextRange(0,4)){case 0:this.name="Elven "+this.name,this.dexterity+=Math.ceil(this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_MAGENTA);break;case 1:this.name="Obsidian "+this.name,this.strength+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.DARK_MAGENTA);break;case 2:this.name="Saphiron "+this.name,this.dexterity+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.DARK_BLUE);break;case 3:this.name="Scarlet "+this.name,this.intelligence+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(1.5*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.DARK_RED)}}chooseEpicFlair(){this.name="Cody's "+this.name,this.dexterity+=Math.ceil(2*this.itemLevel*this.statMultiplier),this.strength+=Math.ceil(2*this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(2*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(2*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_BLUE)}chooseLegendaryFlair(){this.name="Cody's "+this.name,this.dexterity+=Math.ceil(2.5*this.itemLevel*this.statMultiplier),this.strength+=Math.ceil(2.5*this.itemLevel*this.statMultiplier),this.intelligence+=Math.ceil(2.5*this.itemLevel*this.statMultiplier),this.constitution+=Math.ceil(2.5*this.itemLevel*this.statMultiplier),this.withColor(s.Colors.LIGHT_BLUE)}chooseValue(...e){return e[this.game.rng.nextRange(0,e.length)]}chooseArrayValue(e){return e[this.game.rng.nextRange(0,e.length)]}build(){return new n.Equipment(this)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){e.NONE="",e.CLOTH="Cloth",e.LEATHER="Leather",e.MAIL="Mail",e.PLATE="Plate"}(t.EquipmentMaterial||(t.EquipmentMaterial={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=16,o=24,n=2155905279;t.SWORD_SPRITE_1=new s.Sprite(608,96,r,o,1,!1,void 0,n),t.SWORD_SPRITE_2=new s.Sprite(624,96,r,o,1,!1,void 0,n),t.SWORD_SPRITE_3=new s.Sprite(752,120,r,o,1,!1,void 0,n),t.SWORD_SPRITE_4=new s.Sprite(768,120,r,o,1,!1,void 0,n),t.SWORD_SPRITES=[t.SWORD_SPRITE_1,t.SWORD_SPRITE_2,t.SWORD_SPRITE_3,t.SWORD_SPRITE_4],t.MACE_SPRITE_1=new s.Sprite(640,96,r,o,1,!1,void 0,n),t.MACE_SPRITE_2=new s.Sprite(688,96,r,o,1,!1,void 0,n),t.MACE_SPRITE_3=new s.Sprite(704,96,r,o,1,!1,void 0,n),t.MACE_SPRITE_4=new s.Sprite(720,96,r,o,1,!1,void 0,n),t.MACE_SPRITE_5=new s.Sprite(736,96,r,o,1,!1,void 0,n),t.MACE_SPRITE_6=new s.Sprite(833,96,r,o,1,!1,void 0,n),t.MACE_SPRITES=[t.MACE_SPRITE_1,t.MACE_SPRITE_2,t.MACE_SPRITE_3,t.MACE_SPRITE_4,t.MACE_SPRITE_5,t.MACE_SPRITE_6],t.DAGGER_SPRITE_1=new s.Sprite(672,96,r,o,1,!1,void 0,n),t.AXE_SPRITE_1=new s.Sprite(752,96,r,o,1,!1,void 0,n),t.BOW_SPRITE_1=new s.Sprite(880,96,r,o,1,!1,void 0,n),t.CROSSBOW_SPRITE_1=new s.Sprite(896,96,r,o,1,!1,void 0,n),t.STAFF_SPRITE_1=new s.Sprite(896,120,r,o,1,!1,void 0,n),t.STAFF_SPRITE_2=new s.Sprite(608,120,r,o,1,!1,void 0,n),t.STAFF_SPRITE_3=new s.Sprite(624,120,r,o,1,!1,void 0,n),t.STAFF_SPRITE_4=new s.Sprite(640,120,r,o,1,!1,void 0,n),t.STAFF_SPRITE_5=new s.Sprite(656,120,r,o,1,!1,void 0,n),t.STAFF_SPRITES=[t.STAFF_SPRITE_1,t.STAFF_SPRITE_2,t.STAFF_SPRITE_3,t.STAFF_SPRITE_4,t.STAFF_SPRITE_5],t.SHIRT_SPRITE_1=new s.Sprite(608,144,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_2=new s.Sprite(608,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_3=new s.Sprite(624,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_4=new s.Sprite(640,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_5=new s.Sprite(656,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_6=new s.Sprite(672,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_7=new s.Sprite(688,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_8=new s.Sprite(704,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_9=new s.Sprite(720,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_10=new s.Sprite(736,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITE_11=new s.Sprite(752,264,r,o,1,!1,void 0,n),t.SHIRT_SPRITES=[t.SHIRT_SPRITE_1,t.SHIRT_SPRITE_2,t.SHIRT_SPRITE_3,t.SHIRT_SPRITE_4,t.SHIRT_SPRITE_5,t.SHIRT_SPRITE_6,t.SHIRT_SPRITE_7,t.SHIRT_SPRITE_8,t.SHIRT_SPRITE_9,t.SHIRT_SPRITE_10,t.SHIRT_SPRITE_11],t.ROBE_SPRITE_1=new s.Sprite(608,288,r,o,1,!1,void 0,n),t.ROBE_SPRITE_2=new s.Sprite(624,288,r,o,1,!1,void 0,n),t.ROBE_SPRITE_3=new s.Sprite(640,288,r,o,1,!1,void 0,n),t.ROBE_SPRITE_4=new s.Sprite(656,288,r,o,1,!1,void 0,n),t.ROBE_SPRITE_5=new s.Sprite(672,288,r,o,1,!1,void 0,n),t.ROBE_SPRITE_6=new s.Sprite(688,288,r,o,1,!1,void 0,n),t.ROBE_SPRITE_7=new s.Sprite(704,288,r,o,1,!1,void 0,n),t.ROBE_SPRITE_8=new s.Sprite(720,288,r,o,1,!1,void 0,n),t.ROBE_SPRITE_9=new s.Sprite(736,288,r,o,1,!1,void 0,n),t.ROBE_SPRITE_10=new s.Sprite(752,288,r,o,1,!1,void 0,n),t.ROBE_SPRITES=[t.ROBE_SPRITE_1,t.ROBE_SPRITE_2,t.ROBE_SPRITE_3,t.ROBE_SPRITE_4,t.ROBE_SPRITE_5,t.ROBE_SPRITE_6,t.ROBE_SPRITE_7,t.ROBE_SPRITE_8,t.ROBE_SPRITE_9,t.ROBE_SPRITE_10],t.HELM_SPRITE_1=new s.Sprite(608,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_2=new s.Sprite(624,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_3=new s.Sprite(640,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_4=new s.Sprite(656,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_5=new s.Sprite(672,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_6=new s.Sprite(688,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_7=new s.Sprite(704,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_8=new s.Sprite(720,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_9=new s.Sprite(736,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_10=new s.Sprite(752,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_11=new s.Sprite(768,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_12=new s.Sprite(784,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_13=new s.Sprite(800,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_14=new s.Sprite(816,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_15=new s.Sprite(832,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_16=new s.Sprite(848,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_17=new s.Sprite(864,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_18=new s.Sprite(880,240,r,o,1,!1,void 0,n),t.HELM_SPRITE_19=new s.Sprite(896,240,r,o,1,!1,void 0,n),t.HELM_SPRITES=[t.HELM_SPRITE_1,t.HELM_SPRITE_2,t.HELM_SPRITE_3,t.HELM_SPRITE_4,t.HELM_SPRITE_5,t.HELM_SPRITE_6,t.HELM_SPRITE_7,t.HELM_SPRITE_8,t.HELM_SPRITE_9,t.HELM_SPRITE_10,t.HELM_SPRITE_11,t.HELM_SPRITE_12,t.HELM_SPRITE_13,t.HELM_SPRITE_14,t.HELM_SPRITE_15,t.HELM_SPRITE_16,t.HELM_SPRITE_17,t.HELM_SPRITE_18,t.HELM_SPRITE_19],t.CLOTH_HELM_SPRITES=[t.HELM_SPRITE_12,t.HELM_SPRITE_13,t.HELM_SPRITE_14,t.HELM_SPRITE_15,t.HELM_SPRITE_16],t.LEATHER_HELM_SPRITES=[t.HELM_SPRITE_1,t.HELM_SPRITE_2,t.HELM_SPRITE_4,t.HELM_SPRITE_6,t.HELM_SPRITE_7,t.HELM_SPRITE_17,t.HELM_SPRITE_18,t.HELM_SPRITE_19],t.PLATE_HELM_SPRITES=[t.HELM_SPRITE_1,t.HELM_SPRITE_4,t.HELM_SPRITE_8,t.HELM_SPRITE_9,t.HELM_SPRITE_10,t.HELM_SPRITE_11,t.HELM_SPRITE_19],t.GLOVES_SPRITE_1=new s.Sprite(608,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITE_2=new s.Sprite(624,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITE_3=new s.Sprite(640,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITE_4=new s.Sprite(656,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITE_5=new s.Sprite(672,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITE_6=new s.Sprite(688,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITE_7=new s.Sprite(704,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITE_8=new s.Sprite(720,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITE_9=new s.Sprite(736,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITE_10=new s.Sprite(752,312,r,o,1,!1,void 0,n),t.GLOVES_SPRITES=[t.GLOVES_SPRITE_1,t.GLOVES_SPRITE_2,t.GLOVES_SPRITE_3,t.GLOVES_SPRITE_4,t.GLOVES_SPRITE_5,t.GLOVES_SPRITE_6,t.GLOVES_SPRITE_7,t.GLOVES_SPRITE_8,t.GLOVES_SPRITE_9,t.GLOVES_SPRITE_10],t.PANTS_SPRITE_1=new s.Sprite(656,144,r,o,1,!1,void 0,n),t.PANTS_SPRITE_2=new s.Sprite(768,312,r,o,1,!1,void 0,n),t.PANTS_SPRITE_3=new s.Sprite(784,312,r,o,1,!1,void 0,n),t.PANTS_SPRITE_4=new s.Sprite(800,312,r,o,1,!1,void 0,n),t.PANTS_SPRITE_5=new s.Sprite(816,312,r,o,1,!1,void 0,n),t.PANTS_SPRITE_6=new s.Sprite(832,312,r,o,1,!1,void 0,n),t.PANTS_SPRITE_7=new s.Sprite(848,312,r,o,1,!1,void 0,n),t.PANTS_SPRITES=[t.PANTS_SPRITE_1,t.PANTS_SPRITE_2,t.PANTS_SPRITE_3,t.PANTS_SPRITE_4,t.PANTS_SPRITE_5,t.PANTS_SPRITE_6,t.PANTS_SPRITE_7],t.BOOTS_SPRITE_1=new s.Sprite(640,144,r,o,1,!1,void 0,n),t.BOOTS_SPRITES=[t.BOOTS_SPRITE_1],t.SHIELD_SPRITE_1=new s.Sprite(688,144,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_2=new s.Sprite(608,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_3=new s.Sprite(624,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_4=new s.Sprite(640,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_5=new s.Sprite(656,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_6=new s.Sprite(672,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_7=new s.Sprite(688,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_8=new s.Sprite(704,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_9=new s.Sprite(720,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_10=new s.Sprite(736,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_11=new s.Sprite(752,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_12=new s.Sprite(768,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_13=new s.Sprite(784,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_14=new s.Sprite(800,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_15=new s.Sprite(816,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_16=new s.Sprite(832,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITE_17=new s.Sprite(848,216,r,o,1,!1,void 0,n),t.SHIELD_SPRITES=[t.SHIELD_SPRITE_1,t.SHIELD_SPRITE_2,t.SHIELD_SPRITE_3,t.SHIELD_SPRITE_4,t.SHIELD_SPRITE_5,t.SHIELD_SPRITE_6,t.SHIELD_SPRITE_7,t.SHIELD_SPRITE_8,t.SHIELD_SPRITE_9,t.SHIELD_SPRITE_10,t.SHIELD_SPRITE_11,t.SHIELD_SPRITE_12,t.SHIELD_SPRITE_13,t.SHIELD_SPRITE_14,t.SHIELD_SPRITE_15,t.SHIELD_SPRITE_16,t.SHIELD_SPRITE_17],t.NECKLACE_SPRITE_1=new s.Sprite(768,144,r,o,1,!1,void 0,n),t.RING_SPRITE_1=new s.Sprite(784,144,r,o,1,!1,void 0,n),t.RING_SPRITE_2=new s.Sprite(800,144,r,o,1,!1,void 0,n),t.RING_SPRITES=[t.RING_SPRITE_1,t.RING_SPRITE_2],t.CLOAK_SPRITE_1=new s.Sprite(768,288,r,o,1,!1,void 0,n),t.CLOAK_SPRITE_2=new s.Sprite(784,288,r,o,1,!1,void 0,n),t.CLOAK_SPRITE_3=new s.Sprite(800,288,r,o,1,!1,void 0,n),t.CLOAK_SPRITE_4=new s.Sprite(816,288,r,o,1,!1,void 0,n),t.CLOAK_SPRITE_5=new s.Sprite(832,288,r,o,1,!1,void 0,n),t.CLOAK_SPRITE_6=new s.Sprite(848,288,r,o,1,!1,void 0,n),t.CLOAK_SPRITE_7=new s.Sprite(864,288,r,o,1,!1,void 0,n),t.CLOAK_SPRITES=[t.CLOAK_SPRITE_1,t.CLOAK_SPRITE_2,t.CLOAK_SPRITE_3,t.CLOAK_SPRITE_4,t.CLOAK_SPRITE_5,t.CLOAK_SPRITE_6,t.CLOAK_SPRITE_7],t.LANTERN_SPRITE=new s.Sprite(880,168,r,o,1,!1,void 0,n),t.ORB_SPRITE=new s.Sprite(848,168,r,o,1,!1,void 0,n),t.CLOCK_SPRITE=new s.Sprite(880,144,r,o,1,!1,void 0,n),t.BOOK_SPRITE=new s.Sprite(816,168,r,o,1,!1,void 0,n)},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CharacterClass=class{constructor(e,t,i,s){this.name=e,this.icon=t,this.description=i,this.details=s}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(10),n=i(2),a=new r.Sprite(656,168,16,24,1,!0,void 0,4278190335);let l=class extends o.BaseItem{constructor(e){super(e,"Healing Potion",a,n.ItemQuality.COMMON,5,20,5)}addTooltipDescription(e){e.push(new r.Message("Use: Restore 10 health",r.Colors.LIGHT_GREEN))}onPickup(e){this.game.log(e.name+" picked up a "+this.name,r.Colors.LIGHT_GREEN)}onUse(e){return e.hp===e.maxHp?(this.game.log("You are already at full health.",r.Colors.DARK_RED),!1):(this.game.log("Your wounds start to feel better!",r.Colors.LIGHT_MAGENTA),e.takeHeal(4),e.inventory.remove(this),e.ap--,!0)}};l=s([r.Serializable("HealthPotion")],l),t.HealthPotion=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(2),o=2644352511,n=4294967295,a=520028415,l=7396863,h=2738220799,c=4286578943;t.BaseItem=class extends s.Item{constructor(e,t,i,s,r,o,n){super(e,0,0,t,i,!1),this.quality=s,this.itemLevel=r,this.maxStack=o,this.sellPrice=n,this.onUpdateTooltip()}getColor(e){switch(e){case r.ItemQuality.COMMON:return n;case r.ItemQuality.UNCOMMON:return a;case r.ItemQuality.RARE:return l;case r.ItemQuality.EPIC:return h;case r.ItemQuality.LEGENDARY:return c;default:return o}}onUpdateTooltip(){this.tooltipMessages=[],this.tooltipMessages.push(new s.Message(this.name,this.getColor(this.quality))),this.tooltipMessages.push(new s.Message("Item Level "+this.itemLevel,s.Colors.YELLOW)),this.addTooltipDescription(this.tooltipMessages),this.maxStack>1&&this.tooltipMessages.push(new s.Message("Max Stack: "+this.maxStack,s.Colors.WHITE)),this.sellPrice>1&&this.tooltipMessages.push(new s.Message("Sell Price: "+this.sellPrice,s.Colors.WHITE))}addTooltipDescription(e){}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.CharacterRace=class{constructor(e,t,i,s){this.name=e,this.icon=t,this.description=i,this.details=s}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(21),n=r.fromRgb(255,128,128),a=new r.Sprite(720,336,16,24,void 0,void 0,void 0,n),l=[new r.Message("Heroic Leap",r.Colors.WHITE),new r.Message("Instant cast",r.Colors.WHITE),new r.Message("Stun all enemies within 1 tile.",r.Colors.YELLOW)];let h=class{constructor(){this.sprite=a,this.name="leap",this.targetType=r.TargetType.TILE,this.minRange=1,this.maxRange=3,this.cooldown=10,this.tooltipMessages=l}cast(e,t){const i=e.game;if(e.distanceTo(t)>3)return e===i.player&&i.log("Target out of range.",r.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(t.x,t.y))return e===i.player&&i.log("Target not visible.",r.Colors.LIGHT_GRAY),!1;if(i.tileMap&&i.tileMap.isBlocked(t.x,t.y))return e===i.player&&i.log("Target is blocked.",r.Colors.LIGHT_GRAY),!1;if(i.getActorAt(t.x,t.y))return e===i.player&&i.log("Target is occupied.",r.Colors.LIGHT_GRAY),!1;const s=(t.x-e.x)*i.tileSize.width/4,a=(t.y-e.y)*i.tileSize.height/4;return i.addAnimation(new r.SlideAnimation(e,s,a,4)).then(()=>{e.x=t.x,e.y=t.y;let s=0;for(let n=i.entities.length-1;n>=0;n--){const a=i.entities.get(n);a!==e&&(a instanceof r.Actor&&a.distanceTo(t)<2&&(a.ai=new o.Stunned(a,1),s++))}s>0&&i.log("Stunned "+s+" foes!",n),e.ap--}),!0}};h=s([r.Serializable("LeapAbility")],h),t.LeapAbility=h},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=[new r.Message("Lightning",r.Colors.WHITE),new r.Message("10 mana",r.Colors.WHITE),new r.Message("Instant cast",r.Colors.WHITE),new r.Message("Hurls a bolt of lightning at the nearest",r.Colors.YELLOW),new r.Message("enemy dealing 4 + INT damage.",r.Colors.YELLOW)];let n=class{constructor(){this.sprite=new r.Sprite(158,10,16,24,void 0,void 0,void 0,4294902015),this.name="lightning",this.targetType=r.TargetType.SELF,this.minRange=1,this.maxRange=5,this.cooldown=10,this.tooltipMessages=o}cast(e){const t=e.game,i=this.getClosestMonster(t,e,e.x,e.y,5);if(!i)return t.log("No enemy is close enough to strike.",r.Colors.LIGHT_RED),!1;t.log("A lightning bolt strikes the "+i.name+" with a loud thunder!",r.Colors.LIGHT_BLUE);const s=4+e.intelligenceModifier,o=new r.Sprite(256,408,16,24,2,!0,8,r.Colors.YELLOW);return t.addAnimation(new r.ProjectileAnimation(o,new r.Vec2(i.pixelX,i.pixelY),new r.Vec2(0,0),32)).then(()=>{t.log("The damage is "+s+" hit points",r.Colors.LIGHT_BLUE),i.takeDamage(e,s),e.ap--}),!0}getClosestMonster(e,t,i,s,o){let n=o+1,a=null;for(let o=0;o<e.entities.length;o++){const l=e.entities.get(o);if(l===t)continue;if(!(l instanceof r.Actor))continue;if(e.tileMap&&!e.tileMap.isVisible(l.x,l.y))continue;const h=l.distance(i,s);h<n&&(n=h,a=l)}return a}};n=s([r.Serializable("LightningAbility")],n),t.LightningAbility=n},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=new r.Sprite(896,168,16,24,1,!0,void 0,4294902015),n=[new r.Message("Gold",r.Colors.WHITE),new r.Message("The coin of the realm.",r.Colors.WHITE)];let a=class extends r.Item{constructor(e,t,i){super(e,t||0,i||0,"gold",o,!1),this.tooltipMessages=n}onPickup(e){this.game.log(e.name+" picked up gold coins",r.Colors.LIGHT_GREEN)}};a=s([r.Serializable("Gold")],a),t.Gold=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);!function(e){e[e.EMPTY=0]="EMPTY",e[e.SHADOW=s.getTileId(0,3)]="SHADOW",e[e.WALL=s.getTileId(0,19)]="WALL",e[e.HALF_WALL=s.getTileId(0,20)]="HALF_WALL",e[e.HALF_WALL2=s.getTileId(1,20)]="HALF_WALL2",e[e.HALF_WALL3=s.getTileId(2,20)]="HALF_WALL3",e[e.FLOOR=s.getTileId(13,17)]="FLOOR",e[e.WATER=s.getTileId(0,18)]="WATER",e[e.BRIDGE=s.getTileId(15,27)]="BRIDGE",e[e.COBWEB_NORTHWEST=s.getTileId(28,22)]="COBWEB_NORTHWEST",e[e.COBWEB_NORTHEAST=s.getTileId(29,22)]="COBWEB_NORTHEAST",e[e.COBWEB_SOUTHWEST=s.getTileId(30,22)]="COBWEB_SOUTHWEST",e[e.COBWEB_SOUTHEAST=s.getTileId(31,22)]="COBWEB_SOUTHEAST",e[e.CLOSED_DOOR=s.getTileId(7,19)]="CLOSED_DOOR",e[e.STAIRS_DOWN=s.getTileId(14,18)]="STAIRS_DOWN",e[e.STAIRS_UP=s.getTileId(15,18)]="STAIRS_UP",e[e.BARREL=s.getTileId(24,19)]="BARREL",e[e.STATUE=s.getTileId(16,20)]="STATUE",e[e.GRASS=s.getTileId(0,17)]="GRASS",e[e.TREE1=s.getTileId(20,23)]="TREE1",e[e.TREE2=s.getTileId(22,23)]="TREE2",e[e.PATH=s.getTileId(18,17)]="PATH",e[e.FENCE1=s.getTileId(16,22)]="FENCE1",e[e.FENCE2=s.getTileId(17,22)]="FENCE2",e[e.FENCE3=s.getTileId(18,22)]="FENCE3",e[e.FENCE4=s.getTileId(19,22)]="FENCE4",e[e.FENCE5=s.getTileId(20,22)]="FENCE5",e[e.FENCE6=s.getTileId(21,22)]="FENCE6",e[e.FENCE7=s.getTileId(22,22)]="FENCE7",e[e.FENCE8=s.getTileId(23,22)]="FENCE8",e[e.FENCE9=s.getTileId(24,22)]="FENCE9",e[e.FENCE10=s.getTileId(25,22)]="FENCE10"}(t.Tiles||(t.Tiles={}))},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Buff=class{constructor(e){this.actor=e}update(){}modifyDamageTaken(e){return e}modifyDamageDealt(e){return e}draw(){}isDone(){return!1}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.MenuItemRenderer=class{constructor(e,t){this.expandedHeight=e,this.collapsedHeight=t}drawOption(e,t,i,r){const o=e.app;let n=t.x;const a=t.y;let l=s.Colors.GRAY,h=s.Colors.GRAY,c=s.Colors.GRAY;if(r&&(l=void 0,h=s.Colors.YELLOW,c=s.Colors.WHITE),i.icon&&(i.icon.draw(o,n,a,l),n+=i.icon.width+2),o.drawString(i.name,n,a,h),i.description&&o.drawString(i.description,n+3,a+10,c),r&&i.details)for(let e=0;e<i.details.length;e++){const t=i.details[e],l=r?t.color:s.Colors.LIGHT_GRAY;o.drawString(t.text,n+3,a+20+10*e,l)}}getHeight(e,t){return t?this.expandedHeight:this.collapsedHeight}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);let o=class extends r.Item{constructor(e,t,i,s,r){super(e,t,i,s,r,!1),this.zIndex=0,this.fade=!1}onBump(e){const t=this.other;return!!t&&(this.game.warpToPoint(t),!0)}};o=s([r.Serializable("Portal")],o),t.Portal=o},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(20),n=i(12),a=i(13),l=i(8),h=i(5),c=i(7),d=i(3),u=i(6),p=i(2),g=new r.Sprite(504,700,24,26,void 0,void 0,void 0,4286611711),f=new r.Sprite(320,96,16,24,2,!0,void 0,4286611711),y=[new r.Message("+2 Strength, +2 Intelligence",r.Colors.LIGHT_GREEN),new r.Message("Heroic Leap - jump up to 3 tiles and stun enemies",r.Colors.YELLOW)];let m=class extends l.CharacterClass{constructor(){super("Paladin",g,"Holy warriors commanding the power of the light",y)}initPlayer(e){const t=e.game;e.class=this,e.sprite=f,e.talents.add(new r.Talent(e,new n.LeapAbility)),e.talents.add(new r.Talent(e,new a.LightningAbility)),e.talents.add(new r.Talent(e,new o.FlashHealAbility)),e.equipment.add(new h.EquipmentBuilder(t).withName("Squire's Vest").withItemLevel(1).withQuality(p.ItemQuality.COMMON).withSlot(d.EquipmentSlot.CHEST).withMaterial(u.EquipmentMaterial.PLATE).withSprite(c.SHIRT_SPRITE_1,3231744255).withArmor(7).build()),e.equipment.add(new h.EquipmentBuilder(t).withName("Squire's Pants").withItemLevel(1).withQuality(p.ItemQuality.COMMON).withSlot(d.EquipmentSlot.LEGS).withMaterial(u.EquipmentMaterial.PLATE).withSprite(c.PANTS_SPRITE_1,3231744255).withArmor(6).build()),e.equipment.add(new h.EquipmentBuilder(t).withName("Squire's Boots").withItemLevel(1).withQuality(p.ItemQuality.COMMON).withSlot(d.EquipmentSlot.FEET).withMaterial(u.EquipmentMaterial.PLATE).withSprite(c.BOOTS_SPRITE_1,3231744255).withArmor(5).build()),e.equipment.add(new h.EquipmentBuilder(t).withName("Battleworn Hammer").withItemLevel(1).withQuality(p.ItemQuality.COMMON).withSlot(d.EquipmentSlot.MAINHAND).withDamage(1,2).withSprite(c.MACE_SPRITE_1,3231744255).build()),e.strength+=2,e.intelligence+=2}};m=s([r.Serializable("Paladin")],m),t.Paladin=m},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=new r.Sprite(672,144,16,24,1,!1,void 0,4291875071),n=[new r.Message("Flash Heal",r.Colors.WHITE),new r.Message("20 mana",r.Colors.WHITE),new r.Message("A fast spell that heals an ally",r.Colors.YELLOW),new r.Message("for 1d8 + INT points.",r.Colors.YELLOW)];let a=class{constructor(){this.sprite=o,this.name="Flash Heal",this.targetType=r.TargetType.SELF,this.minRange=0,this.maxRange=0,this.cooldown=5,this.tooltipMessages=n}cast(e){if(e.hp===e.maxHp)return e===e.game.player&&e.game.log("You are already at full health.",r.Colors.DARK_RED),!1;const t=e.game.rng.nextRange(1,8)+e.intelligenceModifier;return e.takeHeal(t),e.ap--,!0}};a=s([r.Serializable("FlashHealAbility")],a),t.FlashHealAbility=a},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0);let o=class extends r.AI{constructor(e,t){super(e),this.numTurns=t,this.oldAi=e.ai}doAi(){this.numTurns>0?this.numTurns--:this.actor.ai=this.oldAi}};o=s([r.Serializable("Stunned")],o),t.Stunned=o},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(35),n=r.Colors.ORANGE,a=new r.Sprite(512,336,16,24,void 0,void 0,void 0,n),l=[new r.Message("Fireball",r.Colors.WHITE),new r.Message("2% of base mana",r.Colors.WHITE),new r.Message("2 turn cast",r.Colors.WHITE),new r.Message("Throws a fiery ball causing 8 + INT damage",r.Colors.YELLOW),new r.Message("to all enemies within 3 tiles.",r.Colors.YELLOW)];let h=class{constructor(){this.sprite=a,this.name="fireball",this.targetType=r.TargetType.TILE,this.minRange=1,this.maxRange=10,this.cooldown=30,this.tooltipMessages=l}cast(e,t){const i=e.game,s=e.distanceTo(t);if(s>10)return e===i.player&&i.log("Target out of range.",r.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(t.x,t.y))return e===i.player&&i.log("Target not visible.",r.Colors.LIGHT_GRAY),!1;const n=s*(i.tileSize.width/8),l=(t.x*i.tileSize.width-e.pixelX)/n,h=(t.y*i.tileSize.height-e.pixelY)/n;return e.ap--,i.addAnimation(new r.ProjectileAnimation(a,new r.Vec2(e.pixelX,e.pixelY),new r.Vec2(l,h),n)).then(()=>{i.addAnimation(new o.ExplosionAnimation(i,t,3,30)).then(()=>{i.log("The fireball explodes, burning everything within 3 tiles!",r.Colors.ORANGE);const s=e.buffDamage(8+e.intelligenceModifier);for(let o=i.entities.length-1;o>=0;o--){const n=i.entities.get(o);n!==e&&n instanceof r.Actor&&n.distanceTo(t)<=3&&(i.log("The "+n.name+" gets burned for "+s+" hit points.",r.Colors.ORANGE),n.takeDamage(e,s))}})}),!0}};h=s([r.Serializable("FireballAbility")],h),t.FireballAbility=h},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(19),n=i(24),a=i(4),l=new r.Sprite(0,96,16,24,2,!0,void 0,4291779839);let h=class extends a.StatsActor{constructor(e,t,i){super(e,t,i,"Player",l),this.level=1,this.hp=10,this.maxHp=10,this.xp=0,this.maxXp=20,this.race=new n.Human,this.class=new o.Paladin,this.remainingAbilityPoints=0,this.home=new r.Vec2(t,i),this.keys=new Array(1e3)}takeDamage(e,t){this.game.stopAutoWalk(),super.takeDamage(e,t)}onDeath(){this.game.log("You died!")}addXp(e){this.xp+=e,this.addFloatingText("+"+e,r.Colors.LIGHT_MAGENTA);let t=!1;for(;this.xp>=this.maxXp;)this.level++,this.xp-=this.maxXp,this.maxXp=this.nextMaxXp(this.maxXp),this.remainingAbilityPoints+=2,this.game.log("You reached level "+this.level,r.Colors.LIGHT_MAGENTA),t=!0;t&&(this.recalculateMaxHp(),this.game.levelUpDialog.visible=!0)}nextMaxXp(e){return 10*Math.round(1.5*e/10)}};h=s([r.Serializable("Player")],h),t.Player=h},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(11),n=new r.Sprite(0,730,34,34,void 0,void 0,void 0,3719193343),a=[new r.Message("+1 all attributes",r.Colors.LIGHT_GREEN),new r.Message("Reduced stun times",r.Colors.YELLOW),new r.Message("Hustle - when active, double actions",r.Colors.YELLOW)];let l=class extends o.CharacterRace{constructor(){super("Human",n,"Young race with lust for power",a)}initPlayer(e){e.race=this,e.constitution++,e.strength++,e.dexterity++,e.intelligence++}};l=s([r.Serializable("Human")],l),t.Human=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=new r.Sprite(64,144,16,24,2,!0,void 0,551964671);let a=class extends o.Monster{constructor(e,t,i,s){super(e,t,i,"Spider",n,s)}};a=s([r.Serializable("Spider")],a),t.Spider=a},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=new r.Sprite(192,144,16,24,2,!0,void 0,1733810687);let a=class extends r.AI{doAi(){const e=this.actor,t=e.game.player;if(!t)return;const i=t.game.rng;e.distanceTo(t)<3&&i.nextRange(0,100)<33?e.attack(t,e.getDamage()):this.actor.move(i.nextRange(-2,3),i.nextRange(-2,3))}};a=s([r.Serializable("BatAI")],a);let l=class extends o.Monster{constructor(e,t,i,s){super(e,t,i,"Bat",n,s),this.ai=new a(this)}};l=s([r.Serializable("Bat")],l),t.Bat=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=new r.Sprite(64,216,16,24,2,!0,void 0,551964671);let a=class extends o.Monster{constructor(e,t,i,s){super(e,t,i,"Troll",n,s)}};a=s([r.Serializable("Troll")],a),t.Troll=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=s.getTileId(7,20),o=new s.Sprite(256,432,16,24,1,!0,void 0,2877763839);t.Door=class extends s.Item{constructor(e,t,i){super(e,t,i,"door",o,!0),this.zIndex=0}openDoor(){const e=this.game,t=e.tileMap;e.entities.remove(this),t.setTile(this.x,this.y,0,r),t.setBlocked(this.x,this.y,!1)}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(10),n=i(2),a=new r.Sprite(736,168,16,24,1,!0,void 0,4042318079);let l=class extends o.BaseItem{constructor(e,t,i,s){super(e,"scroll of "+s.name,a,n.ItemQuality.UNCOMMON,1,0,0),this.ability=s,this.tooltipMessages=s.tooltipMessages}onPickup(e){this.game.log(e.name+" picked up a "+this.name,r.Colors.LIGHT_GREEN)}onUse(e){this.game.hideAllDialogs();const t=this.ability;return t.targetType===r.TargetType.SELF?t.cast(e)&&e.inventory.remove(this):this.game.startTargeting(t,()=>{e.inventory.remove(this)}),!0}};l=s([r.Serializable("Scroll")],l),t.Scroll=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=new(i(31).App);window.location.hash&&"#"!==window.location.hash&&(window.location.hash=""),window.addEventListener("hashchange",function(){const e=window.location.hash;"#startgame"===e?s.startGame():"#game"===e?s.playGame():"#chooseseed"===e?s.chooseSeed():"#chooserace"===e?s.chooseRace():"#chooseclass"===e?s.chooseClass():"#highscores"===e?s.showHighScores():"#credits"===e?s.showCredits():s.showMainMenu()})},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(0),o=i(32),n=i(50),a=i(81),l=i(82),h=i(87),c=i(88),d=i(14);t.App=class extends s.App{constructor(){super({canvas:document.querySelector("canvas"),imageUrl:"graphics.png",size:new r.Rect(0,0,224,400),fillWindow:!0}),this.mainMenu=new a.MainMenu(this),this.seedMenu=new c.SeedMenu(this),this.raceMenu=new l.RaceMenu(this),this.classMenu=new o.ClassMenu(this),this.highScores=new r.AppState(this),this.credits=new r.AppState(this),this.seed=0,this.showMainMenu()}showMainMenu(){this.state=this.mainMenu}chooseSeed(){this.state=this.seedMenu}chooseRace(){this.state=this.raceMenu}chooseClass(){this.state=this.classMenu}startGame(){this.game=new n.Game(this,this.seed);const e=this.game.player;e.inventory.add(new h.Hearthstone(this.game));for(let t=0;t<20;t++)e.inventory.add(new d.Gold(this.game));this.playerRace&&this.playerRace.initPlayer(this.game.player),this.playerClass&&this.playerClass.initPlayer(this.game.player),window.location.hash="game"}playGame(){const e=this.game;this.state=e,e.addAnimation(new r.FadeInAnimation(30))}showHighScores(){this.state=this.highScores}showCredits(){this.state=this.credits}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(19),o=i(34),n=i(38),a=i(40),l=i(42),h=i(47),c=i(17),d=[new r.Paladin,new o.Priest,new n.Ranger,new a.Rogue,new l.Warlock,new h.Warrior];t.ClassMenu=class extends s.AppState{constructor(e){super(e),this.gui.renderer.baseRect=new s.Rect(0,64,24,24),this.gui.add(new s.MessagePanel(new s.Rect(2,2,256,10),new s.Message("Choose your class",s.Colors.WHITE)));const t=new s.ComplexSelectDialog(new s.Rect(2,15,246,204),d);t.renderer=new c.MenuItemRenderer(60,30),t.onSelect=(e=>{this.app.playerClass=e,window.location.hash="startgame"}),t.onCancel=(()=>{window.history.back()}),this.gui.add(t)}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(3),n=i(6),a=i(10);let l=class extends a.BaseItem{constructor(e){const t=10*e.itemLevel;super(e.game,e.name,e.sprite,e.quality,e.itemLevel,0,t),this.slot=e.slot,this.material=e.material,this.armor=e.armor,this.strength=e.strength,this.dexterity=e.dexterity,this.constitution=e.constitution,this.intelligence=e.intelligence,this.minDamage=e.minDamage,this.maxDamage=e.maxDamage,this.ranged=e.ranged,this.finesse=e.finesse,this.onUpdateTooltip()}isStackable(){return!1}onPickup(e){this.game.log(new r.CompoundMessage(new r.Message(e.name+" picked up ",r.Colors.WHITE),new r.Message("["+this.name+"]",this.getColor(this.quality))))}onUse(e){return e.equipItem(this),!1}onUpdateTooltip(){const e=this.game.player.getEquipment(this.slot);e&&e!==this?this.buildComparisonTooltip(e):this.buildNormalTooltip()}buildComparisonTooltip(e){this.tooltipMessages=[],this.tooltipMessages.push(new r.Message(this.name,this.getColor(this.quality))),this.tooltipMessages.push(new r.Message("Item Level "+this.itemLevel+" (vs "+e.itemLevel+")",r.Colors.YELLOW)),this.material===n.EquipmentMaterial.NONE?this.tooltipMessages.push(new r.Message(this.slot,r.Colors.WHITE)):this.tooltipMessages.push(new r.Message(this.slot+", "+this.material,r.Colors.WHITE)),this.slot===o.EquipmentSlot.MAINHAND&&this.tooltipMessages.push(new r.Message(this.minDamage+"-"+this.maxDamage+" Damage (vs "+e.minDamage+"-"+e.maxDamage+")",r.Colors.YELLOW)),(this.armor>0||e.armor>0)&&this.tooltipMessages.push(new r.Message(this.armor+" Armor (vs "+e.armor+")",r.Colors.YELLOW)),(this.strength>0||e.strength>0)&&this.tooltipMessages.push(new r.Message("+"+this.strength+" Strength (vs "+e.strength+")",r.Colors.LIGHT_GREEN)),(this.dexterity>0||e.dexterity>0)&&this.tooltipMessages.push(new r.Message("+"+this.dexterity+" Dexterity (vs "+e.dexterity+")",r.Colors.LIGHT_GREEN)),(this.constitution>0||e.constitution>0)&&this.tooltipMessages.push(new r.Message("+"+this.constitution+" Constitution (vs "+e.constitution+")",r.Colors.LIGHT_GREEN)),(this.intelligence>0||e.intelligence>0)&&this.tooltipMessages.push(new r.Message("+"+this.intelligence+" Intelligence (vs "+e.intelligence+")",r.Colors.LIGHT_GREEN))}buildNormalTooltip(){this.tooltipMessages=[],this.tooltipMessages.push(new r.Message(this.name,this.getColor(this.quality))),this.tooltipMessages.push(new r.Message("Item Level "+this.itemLevel,r.Colors.YELLOW)),this.material===n.EquipmentMaterial.NONE?this.tooltipMessages.push(new r.Message(this.slot,r.Colors.WHITE)):this.tooltipMessages.push(new r.Message(this.slot+", "+this.material,r.Colors.WHITE)),this.slot===o.EquipmentSlot.MAINHAND&&this.tooltipMessages.push(new r.Message(this.minDamage+"-"+this.maxDamage+" Damage",r.Colors.YELLOW)),this.armor>0&&this.tooltipMessages.push(new r.Message(this.armor+" Armor",r.Colors.YELLOW)),this.strength>0&&this.tooltipMessages.push(new r.Message("+"+this.strength+" Strength",r.Colors.LIGHT_GREEN)),this.dexterity>0&&this.tooltipMessages.push(new r.Message("+"+this.dexterity+" Dexterity",r.Colors.LIGHT_GREEN)),this.constitution>0&&this.tooltipMessages.push(new r.Message("+"+this.constitution+" Constitution",r.Colors.LIGHT_GREEN)),this.intelligence>0&&this.tooltipMessages.push(new r.Message("+"+this.intelligence+" Intelligence",r.Colors.LIGHT_GREEN))}};l=s([r.Serializable("Equipment")],l),t.Equipment=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(22),n=i(20),a=i(13),l=i(8),h=i(36),c=i(7),d=i(5),u=i(3),p=i(6),g=i(2),f=new r.Sprite(0,700,24,26,void 0,void 0,void 0,4294967295),y=new r.Sprite(384,96,16,24,2,!0,void 0,4177066239),m=[new r.Message("+5 Intelligence",r.Colors.LIGHT_GREEN),new r.Message("Heroic Leap - jump up to 3 tiles and stun enemies",r.Colors.YELLOW)];let w=class extends l.CharacterClass{constructor(){super("Priest",f,"Devoted to the spiritual, powerful healing magic",m)}initPlayer(e){const t=e.game;e.class=this,e.sprite=y,e.talents.add(new r.Talent(e,new o.FireballAbility)),e.talents.add(new r.Talent(e,new a.LightningAbility)),e.talents.add(new r.Talent(e,new n.FlashHealAbility)),e.talents.add(new r.Talent(e,new h.BubbleAbility)),e.equipment.add(new d.EquipmentBuilder(t).withName("Neophyte's Robe").withItemLevel(1).withSlot(u.EquipmentSlot.CHEST).withQuality(g.ItemQuality.COMMON).withMaterial(p.EquipmentMaterial.CLOTH).withSprite(c.ROBE_SPRITE_1,3231744255).withArmor(2).build()),e.equipment.add(new d.EquipmentBuilder(t).withName("Neophyte's Pants").withItemLevel(1).withSlot(u.EquipmentSlot.LEGS).withQuality(g.ItemQuality.COMMON).withMaterial(p.EquipmentMaterial.CLOTH).withSprite(c.PANTS_SPRITE_1,3231744255).withArmor(2).build()),e.equipment.add(new d.EquipmentBuilder(t).withName("Neophyte's Shoes").withItemLevel(1).withSlot(u.EquipmentSlot.FEET).withQuality(g.ItemQuality.COMMON).withMaterial(p.EquipmentMaterial.CLOTH).withSprite(c.BOOTS_SPRITE_1,3231744255).withArmor(1).build()),e.equipment.add(new d.EquipmentBuilder(t).withName("Bent Staff").withItemLevel(1).withSlot(u.EquipmentSlot.MAINHAND).withQuality(g.ItemQuality.COMMON).withDamage(1,2).withSprite(c.STAFF_SPRITE_1,3231744255).build()),e.intelligence+=5}};w=s([r.Serializable("Priest")],w),t.Priest=w},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.ExplosionAnimation=class extends s.Animation{constructor(e,t,i,s){super(s,!0),this.game=e,this.center=t,this.radius=i,this.duration=s,this.sprites=[]}update(){super.update();const e=this.game,t=this.radius*(1-(this.countdown+1)/(this.duration+1)),i=this.center.x*e.tileSize.width,r=this.center.y*e.tileSize.height;for(let o=0;o<3;o++){const n=t,a=this.countdown+o,l=i+e.tileSize.width*n*Math.cos(a),h=r+e.tileSize.height*n*Math.sin(a),c=new s.Sprite(512,336,16,24,4,!1,4,s.Colors.ORANGE),d=new s.ProjectileAnimation(c,new s.Vec2(l,h),new s.Vec2(0,0),16);d.blocking=!1,e.animations.push(d)}}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(37),n=new r.Sprite(896,216,16,24,1,!0,void 0,3438215167),a=[new r.Message("Bubble",r.Colors.WHITE),new r.Message("20 mana",r.Colors.WHITE),new r.Message("Instant cast",r.Colors.WHITE),new r.Message("Shields the caster absorbing 4 + INT",r.Colors.YELLOW),new r.Message("damage.",r.Colors.YELLOW)];let l=class{constructor(){this.sprite=n,this.name="Bubble",this.targetType=r.TargetType.SELF,this.minRange=1,this.maxRange=1,this.cooldown=20,this.tooltipMessages=a}cast(e){for(let t=0;t<e.buffs.length;t++)if(e.buffs[t]instanceof o.Bubble)return e===e.game.player&&e.game.log("You already have a bubble.",r.Colors.LIGHT_GRAY),!1;const t=4+e.intelligenceModifier;return e.buffs.push(new o.Bubble(e,t)),e.ap--,!0}};l=s([r.Serializable("BubbleAbility")],l),t.BubbleAbility=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(16),o=i(0),n=new o.Sprite(608,408,16,24,2,!0,void 0,2866675711);let a=class extends r.Buff{constructor(e,t){super(e),this.remaining=t}modifyDamageTaken(e){if(e<=0)return e;const t=Math.min(this.remaining,e);return this.remaining-=t,this.remaining<=0?this.actor.game.log("Absorbed the last "+t+" of the bubble!",2866675711):this.actor.game.log("Bubble absorbed "+t+" damage.",2866675711),e-t}draw(){const e=this.actor,t=e.game,i=t.app;n.draw(i,e.pixelX-t.viewport.x,e.pixelY-t.viewport.y)}isDone(){return this.remaining<=0}};a=s([o.Serializable("Bubble")],a),t.Bubble=a},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(12),n=i(8),a=i(39),l=i(7),h=i(5),c=i(3),d=i(2),u=i(6),p=new r.Sprite(168,700,24,26,void 0,void 0,void 0,2164228351),g=new r.Sprite(64,120,16,24,2,!0,void 0,2164228351),f=[new r.Message("+2 Strength, +2 Dexterity",r.Colors.LIGHT_GREEN),new r.Message("Heroic Leap - jump up to 3 tiles and stun enemies",r.Colors.YELLOW)];let y=class extends n.CharacterClass{constructor(){super("Ranger",p,"Strategy and finesse, attacking from a distance",f)}initPlayer(e){const t=e.game;e.class=this,e.sprite=g,e.talents.add(new r.Talent(e,new a.ShootAbility)),e.talents.add(new r.Talent(e,new o.LeapAbility)),e.equipment.add(new h.EquipmentBuilder(t).withName("Trapper's Vest").withItemLevel(1).withSlot(c.EquipmentSlot.CHEST).withQuality(d.ItemQuality.COMMON).withMaterial(u.EquipmentMaterial.LEATHER).withSprite(l.SHIRT_SPRITE_1,3231744255).withArmor(7).build()),e.equipment.add(new h.EquipmentBuilder(t).withName("Trapper's Pants").withItemLevel(1).withSlot(c.EquipmentSlot.LEGS).withQuality(d.ItemQuality.COMMON).withMaterial(u.EquipmentMaterial.LEATHER).withSprite(l.PANTS_SPRITE_1,3231744255).withArmor(6).build()),e.equipment.add(new h.EquipmentBuilder(t).withName("Trapper's Boots").withItemLevel(1).withSlot(c.EquipmentSlot.FEET).withQuality(d.ItemQuality.COMMON).withMaterial(u.EquipmentMaterial.LEATHER).withSprite(l.BOOTS_SPRITE_1,3231744255).withArmor(5).build()),e.equipment.add(new h.EquipmentBuilder(t).withName("Weathered Crossbow").withItemLevel(1).withSlot(c.EquipmentSlot.MAINHAND).withQuality(d.ItemQuality.COMMON).withDamage(1,2,!0,!0).withSprite(l.CROSSBOW_SPRITE_1,3231744255).build()),e.strength+=2,e.dexterity+=2}};y=s([r.Serializable("Ranger")],y),t.Ranger=y},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=new r.Sprite(896,96,16,24,1,!1,void 0,1087426815),n=[new r.Message("Shoot",r.Colors.WHITE),new r.Message("30 yard range",r.Colors.WHITE),new r.Message("Requires a ranged weapon.",r.Colors.WHITE)];let a=class{constructor(){this.sprite=o,this.name="shoot",this.targetType=r.TargetType.ENTITY,this.minRange=1,this.maxRange=8,this.cooldown=3,this.tooltipMessages=n}cast(e,t){const i=e.game,s=e.mainHandWeapon;return s&&s.ranged?e.distanceTo(t)>8?(e===i.player&&i.log("Target out of range.",r.Colors.LIGHT_GRAY),!1):i.tileMap&&!i.tileMap.isVisible(t.x,t.y)?(e===i.player&&i.log("Target not visible.",r.Colors.LIGHT_GRAY),!1):(t.takeDamage(e,e.getDamage()),e.ap--,!0):(e===i.player&&i.log("Shoot requires a ranged weapon.",r.Colors.LIGHT_GRAY),!1)}};a=s([r.Serializable("ShootAbility")],a),t.ShootAbility=a},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(12),n=i(41),a=i(8),l=i(3),h=i(6),c=i(7),d=i(5),u=i(9),p=i(2),g=new r.Sprite(144,700,24,26,void 0,void 0,void 0,2684354815),f=new r.Sprite(192,96,16,24,2,!0,void 0,2684354815),y=[new r.Message("+5 Dexterity",r.Colors.LIGHT_GREEN),new r.Message("Stealth - go invisible for 10 turns",r.Colors.YELLOW),new r.Message("Shadow Strike - sneak attack from a distance",r.Colors.YELLOW)];let m=class extends a.CharacterClass{constructor(){super("Rogue",g,"Lethal assasins and masters of stealth",y)}initPlayer(e){const t=e.game;e.class=this,e.sprite=f,e.talents.add(new r.Talent(e,new o.LeapAbility)),e.talents.add(new r.Talent(e,new n.ShadowStrikeAbility));for(let i=0;i<5;i++)e.inventory.add(new u.HealthPotion(t));e.equipment.add(new d.EquipmentBuilder(t).withName("Footpad's Vest").withItemLevel(1).withSlot(l.EquipmentSlot.CHEST).withQuality(p.ItemQuality.COMMON).withMaterial(h.EquipmentMaterial.LEATHER).withSprite(c.SHIRT_SPRITE_1,3231744255).withArmor(7).build()),e.equipment.add(new d.EquipmentBuilder(t).withName("Footpad's Pants").withItemLevel(1).withSlot(l.EquipmentSlot.LEGS).withQuality(p.ItemQuality.COMMON).withMaterial(h.EquipmentMaterial.LEATHER).withSprite(c.PANTS_SPRITE_1,3231744255).withArmor(6).build()),e.equipment.add(new d.EquipmentBuilder(t).withName("Footpad's Boots").withItemLevel(1).withSlot(l.EquipmentSlot.FEET).withQuality(p.ItemQuality.COMMON).withMaterial(h.EquipmentMaterial.LEATHER).withSprite(c.BOOTS_SPRITE_1,3231744255).withArmor(5).build()),e.equipment.add(new d.EquipmentBuilder(t).withName("Worn Dirk").withItemLevel(1).withSlot(l.EquipmentSlot.MAINHAND).withQuality(p.ItemQuality.COMMON).withDamage(1,2,!1,!0).withSprite(c.DAGGER_SPRITE_1,3231744255).build()),e.dexterity+=5}};m=s([r.Serializable("Rogue")],m),t.Rogue=m},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=new r.Sprite(656,192,16,24,void 0,void 0,void 0,3301229823),n=[new r.Message("Shadow Strike",r.Colors.WHITE),new r.Message("Instant cast",r.Colors.WHITE),new r.Message("Appear behind your target up to 25 yards away,",r.Colors.YELLOW),new r.Message("dealing double damage.",r.Colors.YELLOW)];let a=class{constructor(){this.sprite=o,this.name="Shadow Strike",this.targetType=r.TargetType.ENTITY,this.minRange=1,this.maxRange=10,this.cooldown=10,this.tooltipMessages=n}cast(e,t){const i=e.game;if(e.distanceTo(t)>10)return e===i.player&&i.log("Target out of range.",r.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(t.x,t.y))return e===i.player&&i.log("Target not visible.",r.Colors.LIGHT_GRAY),!1;let s=null,o=0;for(let n=t.y-1;n<=t.y+1;n++)for(let a=t.x-1;a<=t.x+1;a++){if(i.isBlocked(a,n))continue;const t=e.distance(a,n);t>o&&(s=new r.Vec2(a,n),o=t)}if(!s)return e===i.player&&i.log("No free spaces available.",r.Colors.LIGHT_GRAY),!1;const n=(s.x-e.x)*i.tileSize.width/4,a=(s.y-e.y)*i.tileSize.height/4;return i.addAnimation(new r.SlideAnimation(e,n,a,4)).then(()=>{e.x=s.x,e.y=s.y,e.attack(t,2*e.getDamage()),e.ap--}),!0}};a=s([r.Serializable("ShadowStrikeAbility")],a),t.ShadowStrikeAbility=a},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(43),n=i(45),a=i(13),l=i(7),h=i(5),c=i(3),d=i(2),u=i(6),p=i(8),g=new r.Sprite(24,700,24,26,void 0,void 0,void 0,2686492927),f=new r.Sprite(416,96,16,24,2,!0,void 0,2686492927),y=[new r.Message("+2 Constitution, +2 Intelligence",r.Colors.LIGHT_GREEN),new r.Message("Demonic Gateway - teleport by dark magic",r.Colors.YELLOW)];let m=class extends p.CharacterClass{constructor(){super("Warlock",g,"Practitioners of the dark arts",y)}initPlayer(e){const t=e.game;e.class=this,e.sprite=f,e.talents.add(new r.Talent(e,new o.CurseAbility)),e.talents.add(new r.Talent(e,new a.LightningAbility)),e.talents.add(new r.Talent(e,new n.DemonicGatewayAbility)),e.equipment.add(new h.EquipmentBuilder(t).withName("Acolyte's Robe").withItemLevel(1).withSlot(c.EquipmentSlot.CHEST).withQuality(d.ItemQuality.COMMON).withMaterial(u.EquipmentMaterial.CLOTH).withSprite(l.ROBE_SPRITE_1,3231744255).withArmor(2).build()),e.equipment.add(new h.EquipmentBuilder(t).withName("Acolyte's Pants").withItemLevel(1).withSlot(c.EquipmentSlot.LEGS).withQuality(d.ItemQuality.COMMON).withMaterial(u.EquipmentMaterial.CLOTH).withSprite(l.PANTS_SPRITE_1,3231744255).withArmor(2).build()),e.equipment.add(new h.EquipmentBuilder(t).withName("Acolyte's Shoes").withItemLevel(1).withSlot(c.EquipmentSlot.FEET).withQuality(d.ItemQuality.COMMON).withMaterial(u.EquipmentMaterial.CLOTH).withSprite(l.BOOTS_SPRITE_1,3231744255).withArmor(1).build()),e.equipment.add(new h.EquipmentBuilder(t).withName("Bent Staff").withItemLevel(1).withSlot(c.EquipmentSlot.MAINHAND).withQuality(d.ItemQuality.COMMON).withDamage(1,2).withSprite(l.STAFF_SPRITE_1,3231744255).build()),e.constitution+=2,e.intelligence+=2}};m=s([r.Serializable("Warlock")],m),t.Warlock=m},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(44),n=new r.Sprite(880,144,16,24,1,!1,void 0,3225469183),a=[new r.Message("Curse",r.Colors.WHITE),new r.Message("20 mana",r.Colors.WHITE),new r.Message("Instant cast",r.Colors.WHITE),new r.Message("Corrupts the target, causing (1 + INT) / 4",r.Colors.YELLOW),new r.Message("damage per turn for 8 turns.",r.Colors.YELLOW)];let l=class{constructor(){this.sprite=n,this.name="Curse",this.targetType=r.TargetType.ENTITY,this.minRange=1,this.maxRange=8,this.cooldown=3,this.tooltipMessages=a}cast(e,t){const i=e.game;if(e.distanceTo(t)>8)return e===i.player&&i.log("Target out of range.",r.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(t.x,t.y))return e===i.player&&i.log("Target not visible.",r.Colors.LIGHT_GRAY),!1;const s=Math.round((1+e.intelligenceModifier)/4);return t.buffs.push(new o.Curse(e,t,s,8)),e.ap--,!0}};l=s([r.Serializable("CurseAbility")],l),t.CurseAbility=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(16);let o=class extends r.Buff{constructor(e,t,i,s){super(t),this.caster=e,this.damage=i,this.countdown=s}update(){this.countdown>0&&(this.actor.takeDamage(this.caster,this.damage),this.countdown--)}isDone(){return this.countdown<=0}};o=s([i(0).Serializable("Curse")],o),t.Curse=o},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(46),n=new r.Sprite(432,408,16,24,1,!0,void 0,3285193471),a=[new r.Message("Demonic Gateway",r.Colors.WHITE),new r.Message("20 mana",r.Colors.WHITE),new r.Message("2 turn cast",r.Colors.WHITE),new r.Message("Creates a demonic gateway between two",r.Colors.YELLOW),new r.Message("locations. User can transport to the other gateway.",r.Colors.YELLOW)];let l=class{constructor(){this.sprite=n,this.name="Demonic Gateway",this.targetType=r.TargetType.TILE,this.minRange=1,this.maxRange=10,this.cooldown=10,this.tooltipMessages=a}cast(e,t){const i=e.game;if(e.distanceTo(t)>10)return e===i.player&&i.log("Target out of range.",r.Colors.LIGHT_GRAY),!1;if(i.tileMap&&!i.tileMap.isVisible(t.x,t.y))return e===i.player&&i.log("Target not visible.",r.Colors.LIGHT_GRAY),!1;const s=new o.Gateway(i,e.x,e.y,e),n=new o.Gateway(i,t.x,t.y,e);return s.other=n,n.other=s,i.entities.add(s),i.entities.add(n),e.move(t.x-e.x,t.y-e.y,16),e.ap--,!0}};l=s([r.Serializable("DemonicGatewayAbility")],l),t.DemonicGatewayAbility=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=new r.Sprite(432,408,16,24,1,!0,void 0,3285193471);let n=class extends r.Item{constructor(e,t,i,s){super(e,t,i,"gateway",o,!1),this.owner=s,this.zIndex=0}onBump(e){const t=this.other;return!!t&&(e.move(t.x-e.x,t.y-e.y,16),!0)}};n=s([r.Serializable("Gateway")],n),t.Gateway=n},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(12),n=i(8),a=i(48),l=i(5),h=i(7),c=i(3),d=i(2),u=i(6),p=i(9),g=new r.Sprite(216,700,24,26,void 0,void 0,void 0,2151678207),f=new r.Sprite(0,96,16,24,2,!0,void 0,4291779839),y=[new r.Message("+5 Strength, +2 Constitution",r.Colors.LIGHT_GREEN),new r.Message("Heroic Leap - jump up to 3 tiles and stun enemies",r.Colors.YELLOW)];let m=class extends n.CharacterClass{constructor(){super("Warrior",g,"Lords of war, strength, and combat",y)}initPlayer(e){const t=e.game;e.class=this,e.sprite=f,e.talents.add(new r.Talent(e,new o.LeapAbility)),e.talents.add(new r.Talent(e,new a.RageAbility));for(let i=0;i<5;i++)e.inventory.add(new p.HealthPotion(t));e.equipment.add(new l.EquipmentBuilder(t).withName("Squire's Vest").withItemLevel(1).withSlot(c.EquipmentSlot.CHEST).withQuality(d.ItemQuality.COMMON).withMaterial(u.EquipmentMaterial.PLATE).withSprite(h.SHIRT_SPRITE_1,3231744255).withArmor(7).build()),e.equipment.add(new l.EquipmentBuilder(t).withName("Squire's Pants").withItemLevel(1).withSlot(c.EquipmentSlot.LEGS).withQuality(d.ItemQuality.COMMON).withMaterial(u.EquipmentMaterial.PLATE).withSprite(h.PANTS_SPRITE_1,3231744255).withArmor(6).build()),e.equipment.add(new l.EquipmentBuilder(t).withName("Squire's Boots").withItemLevel(1).withSlot(c.EquipmentSlot.FEET).withQuality(d.ItemQuality.COMMON).withMaterial(u.EquipmentMaterial.PLATE).withSprite(h.BOOTS_SPRITE_1,3231744255).withArmor(5).build()),e.equipment.add(new l.EquipmentBuilder(t).withName("Worn Greatsword").withItemLevel(1).withSlot(c.EquipmentSlot.MAINHAND).withQuality(d.ItemQuality.COMMON).withDamage(1,2).withSprite(h.SWORD_SPRITE_1,3231744255).build()),e.constitution+=2,e.strength+=5}};m=s([r.Serializable("Warrior")],m),t.Warrior=m},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(49),n=new r.Sprite(656,192,16,24,void 0,void 0,void 0,3710001919),a=[new r.Message("Rage",r.Colors.WHITE),new r.Message("Instant cast",r.Colors.WHITE),new r.Message("Become enraged increasing damage by",r.Colors.YELLOW),new r.Message("100% for 8 turns.",r.Colors.YELLOW)];let l=class{constructor(){this.sprite=n,this.name="Rage",this.targetType=r.TargetType.SELF,this.minRange=1,this.maxRange=1,this.cooldown=20,this.tooltipMessages=a}cast(e){for(let t=0;t<e.buffs.length;t++)if(e.buffs[t]instanceof o.Rage)return e===e.game.player&&e.game.log("You already have rage.",r.Colors.LIGHT_GRAY),!1;return e.buffs.push(new o.Rage(e,8)),e.ap--,!0}};l=s([r.Serializable("RageAbility")],l),t.RageAbility=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(16),o=i(0),n=new o.Sprite(640,408,16,24,2,!0,void 0,3710001919);let a=class extends r.Buff{constructor(e,t){super(e),this.countdown=t}update(){this.countdown>0&&this.countdown--}modifyDamageDealt(e){return e<=0?e:2*e}draw(){const e=this.actor,t=e.game,i=t.app;n.draw(i,e.pixelX-t.viewport.x,e.pixelY-t.viewport.y)}isDone(){return this.countdown<=0}};a=s([o.Serializable("Rage")],a),t.Rage=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(0),o=i(23),n=i(51),a=i(52),l=i(53),h=i(54),c=i(79),d=i(80),u=i(9),p=i(29),g=new r.Sprite(16,40,16,24);t.Game=class extends s.Game{constructor(e,t){super(e,{mapSize:new r.Rect(0,0,512,512),mapLayers:4,tileSize:new r.Rect(0,0,16,24),horizontalViewDistance:6,verticalViewDistance:4,focusMargins:new r.Vec2(0,40)}),this.rng.setSeed(t),this.targetSprite=g,this.cooldownSprite=new r.Sprite(192,16,16,24,24),this.blackoutRect=new r.Rect(0,40,16,16),this.gui.renderer.baseRect=new r.Rect(0,64,24,24),this.mapGen=new h.MapGenerator(this);const i=new o.Player(this,30,20);this.player=i,this.entities.add(i),this.gui.renderer.baseRect=new r.Rect(0,16,24,24),this.gui.renderer.buttonSlotRect=new r.Rect(64,16,20,28),this.messageLog=new r.MessageLog(new r.Rect(1,-84,100,50)),this.gui.add(this.messageLog),this.log("Welcome stranger! Prepare to perish!",r.Colors.DARK_RED);const s=new l.TopPanel(i);this.gui.add(s);const f=new n.BottomPanel;this.gui.add(f),this.gui.add(new d.EntityFrames(this));const y=new r.Button(new r.Rect(0,0,20,28),new r.Sprite(832,168,16,24,1,!0,30,3766493439),void 0,()=>{this.hideAllDialogs(),this.inventoryDialog.visible=!0});y.tooltipMessages=[new r.Message("Traveler's Backpack",r.Colors.GREEN),new r.Message("Item Level 55",r.Colors.YELLOW),new r.Message("16 Slot Bag",r.Colors.WHITE),new r.Message("Sell Price: 87 coins",r.Colors.WHITE)],f.inventorySlot.add(y);const m=new r.Button(new r.Rect(0,0,20,28),new r.Sprite(640,240,16,24,void 0,void 0,void 0,4291779839),void 0,()=>{this.hideAllDialogs(),this.characterDialog.visible=!0});m.tooltipMessages=[new r.Message("Character",r.Colors.WHITE),new r.Message("Currently equipped items,",r.Colors.YELLOW),new r.Message("stats and abilities.",r.Colors.YELLOW)],s.characterSlot.add(m);const w=new r.Button(new r.Rect(0,0,20,28),new r.Sprite(656,360,16,24,void 0,void 0,void 0,r.Colors.LIGHT_BLUE),void 0,()=>{this.hideAllDialogs(),this.talentsDialog.visible=!0});w.tooltipMessages=[new r.Message("Talents",r.Colors.WHITE),new r.Message("A list of all of your",r.Colors.YELLOW),new r.Message("character's talents.",r.Colors.YELLOW)],s.talentsSlot.add(w);const S=new r.Button(new r.Rect(0,0,20,28),new r.Sprite(352,672,16,24,void 0,void 0,void 0,r.Colors.LIGHT_GRAY),void 0,()=>{window.location.hash="menu"});S.tooltipMessages=[new r.Message("Main Menu",r.Colors.WHITE)],s.menuSlot.add(S),this.inventoryDialog=new r.ItemContainerDialog(new r.Rect(4,38,94,126),[new r.Message("Traveler's Backpack",r.Colors.GREEN),new r.Message("Click an item to use",r.Colors.LIGHT_GRAY),new r.Message("Drag for shortcut",r.Colors.LIGHT_GRAY)],16,i.inventory),this.inventoryDialog.visible=!1,this.gui.add(this.inventoryDialog),this.characterDialog=new a.CharacterDialog(new r.Rect(4,38,120,126),i),this.characterDialog.visible=!1,this.gui.add(this.characterDialog),this.talentsDialog=new r.TalentsDialog(new r.Rect(4,38,94,126),[new r.Message("Talents",r.Colors.GREEN),new r.Message("Click an ability to use",r.Colors.LIGHT_GRAY),new r.Message("Drag for shortcut",r.Colors.LIGHT_GRAY)],16,i.talents),this.talentsDialog.visible=!1,this.gui.add(this.talentsDialog);const _=new c.LevelUpDialog(new r.Rect(4,38,140,126),i);_.visible=!1,this.gui.add(_),this.levelUpDialog=_,i.inventory.addListener({onAdd:(e,t)=>{(t instanceof u.HealthPotion||t instanceof p.Scroll)&&f.shortcutBar.addItem(i.inventory,t,!0)},onRemove:()=>{}}),i.talents.addListener({onAdd:(e,t)=>{f.shortcutBar.addTalent(t)},onRemove:()=>{}}),this.mapGen.createMap()}hideAllDialogs(){this.inventoryDialog.visible=!1,this.characterDialog.visible=!1,this.talentsDialog.visible=!1}warpToPoint(e){this.addAnimation(new r.FadeOutAnimation(30)).then(()=>{this.player&&(this.player.x=e.x,this.player.y=e.y),this.stopAutoWalk(),this.resetViewport(),this.recomputeFov(),this.addAnimation(new r.FadeInAnimation(30))})}findFreeTile(e,t,i){for(let s=0;s<=i;s+=.5){const i=Math.ceil(s);for(let o=t-i;o<=t+i;o++)for(let n=e-i;n<=e+i;n++)if(Math.hypot(n-e,o-t)<=s&&!this.isBlocked(n,o)&&!this.getEntityAt(n,o))return new r.Vec2(n,o)}}save(){const e=(new r.Serializer).serialize(this);console.log("result",e)}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.BottomPanel=class extends s.Panel{constructor(){super(new s.Rect(0,-43,400,43)),this.add(new s.ShortcutBar(new s.Rect(0,0,144,28),6)),this.add(new s.ButtonSlot(new s.Rect(100,0,20,28),s.Keys.VK_I))}get shortcutBar(){return this.children.get(0)}get inventorySlot(){return this.children.get(this.children.length-1)}drawContents(){if(!this.gui)return;const e=this.gui.app,t=e.size.height-43;e.drawImage(0,t,48,16,16,48,void 0,e.size.width,48);for(let t=0;t<this.children.length;t++)this.children.get(t).rect.y=e.size.height-31;this.inventorySlot.rect.x=e.size.width-22,this.drawChildren()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(3),o=4,n=2;t.CharacterDialog=class extends s.Dialog{constructor(e,t){super(e),this.player=t,this.modal=!0;for(let e=0;e<10;e++)this.add(new s.ButtonSlot(new s.Rect(0,0,24,24)));t.equipment.addListener({onAdd:(e,t)=>this.addItem(t),onRemove:(e,t)=>this.removeItem(t)})}get headSlot(){return this.children.get(0)}get neckSlot(){return this.children.get(1)}get backSlot(){return this.children.get(2)}get chestSlot(){return this.children.get(3)}get handsSlot(){return this.children.get(4)}get legsSlot(){return this.children.get(5)}get feetSlot(){return this.children.get(6)}get ringSlot(){return this.children.get(7)}get mainHandSlot(){return this.children.get(8)}get offHandSlot(){return this.children.get(9)}addItem(e){const t=this.getSlot(e);t&&t.add(new s.ItemButton(t.rect.clone(),this.player.inventory,e))}removeItem(e){const t=this.getSlot(e);if(t){const e=t.button;e&&t.remove(e)}}getSlot(e){switch(e.slot){case r.EquipmentSlot.HEAD:return this.headSlot;case r.EquipmentSlot.NECK:return this.neckSlot;case r.EquipmentSlot.BACK:return this.backSlot;case r.EquipmentSlot.CHEST:return this.chestSlot;case r.EquipmentSlot.HANDS:return this.handsSlot;case r.EquipmentSlot.LEGS:return this.legsSlot;case r.EquipmentSlot.FEET:return this.feetSlot;case r.EquipmentSlot.RING:return this.ringSlot;case r.EquipmentSlot.MAINHAND:return this.mainHandSlot;case r.EquipmentSlot.OFFHAND:return this.offHandSlot;default:return}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const e=this.rect,t=this.gui.renderer.buttonSlotRect,i=(e.x1+e.x2)/2|0,r=e.x+o;let a=e.y+o;this.gui.app.drawCenteredString("ORYX THE BRAVE",i,a,s.Colors.WHITE),a+=10;const l="Level "+this.player.level+" "+this.player.race.name+" "+this.player.class.name;this.gui.app.drawCenteredString(l,i,a,s.Colors.WHITE),a+=10,this.player.sprite.draw(this.gui.app,i-8,a+32);for(let e=0;e<4;e++){const i=this.children.get(e);i.rect.x=r,i.rect.y=a+e*(t.height+n),i.rect.width=t.width,i.rect.height=t.height}for(let i=0;i<4;i++){const s=this.children.get(4+i);s.rect.x=e.x2-o-t.width,s.rect.y=a+i*(t.height+n),s.rect.width=t.width,s.rect.height=t.height}this.mainHandSlot.rect.x=i-t.width-1,this.mainHandSlot.rect.y=a+90,this.mainHandSlot.rect.width=t.width,this.mainHandSlot.rect.height=t.height,this.offHandSlot.rect.x=i+1,this.offHandSlot.rect.y=a+90,this.offHandSlot.rect.width=t.width,this.offHandSlot.rect.height=t.height,a+=4*(t.height+n)+o,this.gui.app.drawString("Armor",r+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.armor.toString(),r+85,a,s.Colors.WHITE),a+=10,this.gui.app.drawString("Constitution",r+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.constitution.toString(),r+85,a,s.Colors.WHITE),this.gui.app.drawString("+"+this.player.constitutionModifier,r+95,a,s.Colors.LIGHT_GREEN),a+=10,this.gui.app.drawString("Strength",r+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.strength.toString(),r+85,a,s.Colors.WHITE),this.gui.app.drawString("+"+this.player.strengthModifier,r+95,a,s.Colors.LIGHT_GREEN),a+=10,this.gui.app.drawString("Dexterity",r+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.dexterity.toString(),r+85,a,s.Colors.WHITE),this.gui.app.drawString("+"+this.player.dexterityModifier,r+95,a,s.Colors.LIGHT_GREEN),a+=10,this.gui.app.drawString("Intelligence",r+2,a,s.Colors.YELLOW),this.gui.app.drawRightString(this.player.intelligence.toString(),r+85,a,s.Colors.WHITE),this.gui.app.drawString("+"+this.player.intelligenceModifier,r+95,a,s.Colors.LIGHT_GREEN),a+=10,this.rect.height=a+o-e.y,this.drawChildren()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0);t.TopPanel=class extends s.Panel{constructor(e){super(new s.Rect(0,0,400,42)),this.player=e,this.add(new s.ButtonSlot(new s.Rect(0,3,20,28),s.Keys.VK_C)),this.add(new s.ButtonSlot(new s.Rect(0,3,20,28),s.Keys.VK_T)),this.add(new s.ButtonSlot(new s.Rect(0,3,20,28),s.Keys.VK_QUESTION_MARK)),this.add(new s.ButtonSlot(new s.Rect(0,3,20,28),s.Keys.VK_Q))}get characterSlot(){return this.children.get(0)}get talentsSlot(){return this.children.get(1)}get inspectSlot(){return this.children.get(2)}get menuSlot(){return this.children.get(3)}drawContents(){if(!this.gui)return;const e=this.player.game.blackoutRect;if(!e)return;const t=this.gui.app;t.drawImage(0,0,32,22,16,42,void 0,t.size.width,42);const i=this.player;t.drawImage(2,2,64,48,54,18),t.drawCenteredString("ORYX",22,3,s.Colors.WHITE);const r=Math.round(38*i.hp/i.maxHp);t.drawImage(3,11,e.x,e.y,e.width,e.height,s.Colors.DARK_GREEN,r,7),t.drawCenteredString(i.hp+"/"+i.maxHp,22,11,s.Colors.WHITE),t.drawCenteredString(i.level.toString(),49,7,s.Colors.WHITE);for(let e=0;e<this.children.length;e++)this.children.get(e).rect.x=t.size.width-22*(4-e);this.drawChildren()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(55),o=i(18),n=i(15),a=i(56),l=i(67),h=512,c=512;t.MapGenerator=class{constructor(e){this.nextKeyId=0,this.game=e}createMap(){const e=new a.Overworld(this),t=new l.Dungeon(this,e.rect.x2,0),i=this.game,r=i.player,n=new s.Sprite(528,408,16,24,1,!1,void 0,16777215),h=new o.Portal(i,r.x+4,r.y,"portal",n),c=t.layers[0].entrance;h.other=c,c.other=h,i.entities.add(h),this.touchUp(this.game.tileMap),i.resetViewport(),i.recomputeFov()}clearMap(e,t,i,s,r){for(let o=t.y1;o<t.y2;o++)for(let a=t.x1;a<t.x2;a++){e.setTile(a,o,0,i),e.setAnimated(a,o,0,!1),e.setBlocked(a,o,s,r);for(let t=1;t<4;t++)e.setTile(t,a,o,n.Tiles.EMPTY),e.setAnimated(a,o,t,!1)}}createRiver(e,t,i){const s=this.game.rng,r=t.getCenter();for(let o=0;o<i;o++)if(e.setTile(r.x,r.y,0,n.Tiles.WATER),e.setTile(r.x-1,r.y,0,n.Tiles.WATER),e.setTile(r.x+1,r.y,0,n.Tiles.WATER),e.setTile(r.x,r.y-1,0,n.Tiles.WATER),e.setTile(r.x,r.y+1,0,n.Tiles.WATER),e.setAnimated(r.x,r.y,0,!0),e.setAnimated(r.x-1,r.y,0,!0),e.setAnimated(r.x+1,r.y,0,!0),e.setAnimated(r.x,r.y-1,0,!0),e.setAnimated(r.x,r.y+1,0,!0),e.setBlocked(r.x,r.y,!0,!1),e.setBlocked(r.x-1,r.y,!0,!1),e.setBlocked(r.x+1,r.y,!0,!1),e.setBlocked(r.x,r.y-1,!0,!1),e.setBlocked(r.x,r.y+1,!0,!1),r.x+=s.nextRange(-1,2),r.y+=s.nextRange(-1,2),!t.contains(r))return}touchUp(e){const t=this.game,i=t.rng;for(let s=0;s<c;s++)for(let o=0;o<h;o++){const a=e.getTile(o,s,0),l=e.getTile(o,s+1,0),h=e.getTile(o-1,s,0),c=e.getTile(o+1,s,0),d=e.getTile(o,s-1,0);if(a===n.Tiles.FLOOR&&h===n.Tiles.WALL&&d===n.Tiles.HALF_WALL&&0===i.nextRange(0,4)&&e.setTile(o,s,1,n.Tiles.COBWEB_NORTHWEST),a===n.Tiles.FLOOR&&c===n.Tiles.WALL&&d===n.Tiles.HALF_WALL&&0===i.nextRange(0,4)&&e.setTile(o,s,1,n.Tiles.COBWEB_NORTHEAST),a===n.Tiles.FLOOR&&h===n.Tiles.WALL&&l===n.Tiles.WALL&&0===i.nextRange(0,4)&&e.setTile(o,s,1,n.Tiles.COBWEB_SOUTHWEST),a===n.Tiles.FLOOR&&c===n.Tiles.WALL&&l===n.Tiles.WALL&&0===i.nextRange(0,4)&&e.setTile(o,s,1,n.Tiles.COBWEB_SOUTHEAST),a===n.Tiles.CLOSED_DOOR&&l!==n.Tiles.WALL&&e.setTile(o,s+1,2,n.Tiles.SHADOW),a===n.Tiles.WALL&&l!==n.Tiles.WALL&&l!==n.Tiles.CLOSED_DOOR){const t=i.nextRange(0,20);0===t?e.setTile(o,s,0,n.Tiles.HALF_WALL2):1===t?e.setTile(o,s,0,n.Tiles.HALF_WALL3):e.setTile(o,s,0,n.Tiles.HALF_WALL),e.setTile(o,s+1,2,n.Tiles.SHADOW)}a!==n.Tiles.WATER&&l===n.Tiles.WATER&&e.setTile(o,s+1,2,n.Tiles.SHADOW);const u=l===n.Tiles.BRIDGE||h===n.Tiles.BRIDGE||c===n.Tiles.BRIDGE||d===n.Tiles.BRIDGE;a===n.Tiles.WATER&&u&&1===i.nextRange(0,20)&&t.entities.add(new r.Shark(t,o,s,3))}}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=new r.Sprite(0,168,16,24,2,!0,void 0,1469102079);let a=class extends r.AI{doAi(){const e=this.actor,t=e.game.player;t&&e.distanceTo(t)<2&&e.attack(t,e.getDamage())}};a=s([r.Serializable("SharkAI")],a);let l=class extends o.Monster{constructor(e,t,i,s){super(e,t,i,"Shark",n,s),this.ai=new a(this)}};l=s([r.Serializable("Shark")],l),t.Shark=l},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(15),o=i(57),n=i(25),a=i(58),l=i(26),h=i(27),c=i(18),d=i(59),u=i(62),p=i(64),g=i(9),f=i(5),y=i(2),m=256,w=256;t.Overworld=class{constructor(e){const t=e.game,i=t.tileMap,p=t.player,g=t.rng,f=new s.Rect(0,0,m,w),y=new s.Rect(4,4,m-8,w-8);e.clearMap(i,f,r.Tiles.WATER,!0,!1),e.clearMap(i,y,r.Tiles.GRASS,!1,!1),p.x=m/2|0,p.y=w/2|0,p.home.x=p.x,p.home.y=p.y;const S=new s.Vec2(0,0);for(S.y=f.y1;S.y<f.y2;S.y++)for(S.x=f.x1;S.x<f.x2;S.x++)y.contains(S)||i.setAnimated(S.x,S.y,0,!0);e.createRiver(i,y,5e3);for(let e=p.y-4;e<=p.y+4;e++)for(let t=p.x-4;t<=p.x+4;t++)i.setTile(t,e,0,r.Tiles.GRASS),i.setAnimated(t,e,0,!1),i.setBlocked(t,e,!1);const _=[];for(let e=0;e<5;e++){const e=g.nextRange(14,18),n=g.nextRange(8,12),a=g.nextRange(y.x1,y.x2-e),l=g.nextRange(y.y1,y.y2-n),h=new s.Rect(a,l,e,n),c=h.getCenter();for(let e=h.y1;e<h.y2;e++)for(let t=h.x1;t<h.x2;t++)t===h.x1&&e===h.y1?(i.setTile(t,e,0,r.Tiles.GRASS),i.setTile(t,e,1,r.Tiles.FENCE8),i.setBlocked(t,e,!0,!1)):t===h.x2-1&&e===h.y1?(i.setTile(t,e,0,r.Tiles.GRASS),i.setTile(t,e,1,r.Tiles.FENCE7),i.setBlocked(t,e,!0,!1)):t===h.x1&&e===h.y2-1?(i.setTile(t,e,0,r.Tiles.GRASS),i.setTile(t,e,1,r.Tiles.FENCE6),i.setBlocked(t,e,!0,!1)):t===h.x2-1&&e===h.y2-1?(i.setTile(t,e,0,r.Tiles.GRASS),i.setTile(t,e,1,r.Tiles.FENCE5),i.setBlocked(t,e,!0,!1)):t===h.x1?(i.setTile(t,e,0,r.Tiles.GRASS),i.setTile(t,e,1,r.Tiles.FENCE10),i.setBlocked(t,e,!0,!1)):t===h.x2-1?(i.setTile(t,e,0,r.Tiles.GRASS),i.setTile(t,e,1,r.Tiles.FENCE9),i.setBlocked(t,e,!0,!1)):e===h.y1||e===h.y2-1?(i.setTile(t,e,0,r.Tiles.GRASS),i.setTile(t,e,1,r.Tiles.FENCE1),i.setBlocked(t,e,!0,!1)):(i.setTile(t,e,0,r.Tiles.GRASS),i.setAnimated(t,e,0,!1),i.setBlocked(t,e,!1));i.setTile(c.x,h.y1,0,r.Tiles.GRASS),i.setTile(c.x,h.y1,1,r.Tiles.EMPTY),i.setBlocked(c.x,h.y1,!1),i.setTile(c.x,h.y2-1,0,r.Tiles.GRASS),i.setTile(c.x,h.y2-1,1,r.Tiles.EMPTY),i.setBlocked(c.x,h.y2-1,!1);const d=Math.hypot(c.x-p.x,c.y-p.y),u=Math.round(d/5),f=new o.Ghost(t,c.x,c.y,u);t.entities.add(f),_.push(h)}const R=new u.Castle(e,new s.Rect(0,0,10,10));let E=s.computePath(i,p,R.center,1e4);if(!E){let e=p.x;for(let t=Math.min(p.y,R.center.y);t<=Math.max(p.y,R.center.y);t++)i.isBlocked(e,t)&&(i.setTile(e,t,0,r.Tiles.BRIDGE),i.setAnimated(e,t,0,!1),i.setBlocked(e,t,!1));let t=p.y;for(let e=Math.min(p.x,R.center.x);e<=Math.max(p.x,R.center.x);e++)i.isBlocked(e,t)&&(i.setTile(e,t,0,r.Tiles.BRIDGE),i.setAnimated(e,t,0,!1),i.setBlocked(e,t,!1));E=s.computePath(i,p,R.center,1e4)}if(E)for(let e=0;e<E.length;e++)i.getTile(E[e].x,E[e].y,0)===r.Tiles.GRASS&&i.setTile(E[e].x,E[e].y,1,r.Tiles.PATH);else console.log("eek! no path!");for(let e=0;e<5e3;e++){const e=g.nextRange(y.x1,y.x2),t=g.nextRange(y.y1,y.y2);Math.hypot(e-p.x,t-p.y)<6||i.getTile(e,t,0)!==r.Tiles.GRASS||i.getTile(e,t,1)===r.Tiles.PATH||i.isBlocked(e,t)||(i.setTile(e,t,0,r.Tiles.GRASS),i.setBlocked(e,t,!0),0===g.nextRange(0,2)?i.setTile(e,t,1,r.Tiles.TREE1):i.setTile(e,t,1,r.Tiles.TREE2))}for(let e=0;e<600;e++){const e=g.nextRange(y.x1+1,y.x2-2),s=g.nextRange(y.y1+1,y.y2-2),o=Math.hypot(e-p.x,s-p.y);if(o<10)continue;const c=g.nextRange(0,100);for(let d=0;d<3;d++){const d=t.findFreeTile(e,s,3);if(!d)break;if(i.getTile(d.x,d.y,0)!==r.Tiles.GRASS)continue;const u=Math.round((o-10)/10)+g.nextRange(1,3);let p=null;p=c<25?new n.Spider(t,d.x,d.y,u):c<50?new a.Snake(t,d.x,d.y,u):c<75?new l.Bat(t,d.x,d.y,u):new h.Troll(t,d.x,d.y,u),t.entities.add(p)}}const T=new s.Sprite(528,408,16,24,1,!1,void 0,4278255615),v=new c.Portal(t,p.x+2,p.y,"portal",T),b=new c.Portal(t,_[0].x+2,_[0].y+2,"portal",T);v.other=b,b.other=v,t.entities.add(v),t.entities.add(b);const x=new d.King(t,p.x-2,p.y);t.entities.add(x),this.createVendor(t,p.x,p.y+2,1),this.rect=f}createVendor(e,t,i,s){const r=new p.Vendor(e,t,i);for(let t=0;t<20;t++)r.inventory.add(new g.HealthPotion(e));for(let t=0;t<4;t++)r.inventory.add(new f.EquipmentBuilder(e).withRandomDrop(s+t,y.ItemQuality.UNCOMMON).build());e.entities.add(r)}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=new r.Sprite(64,288,16,24,2,!0,void 0,3772833952);let a=class extends o.Monster{constructor(e,t,i,s){super(e,t,i,"Ghost",n,s)}};a=s([r.Serializable("Ghost")],a),t.Ghost=a},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=new r.Sprite(256,144,16,24,2,!0,void 0,1469102079);let a=class extends r.AI{doAi(){const e=this.actor,t=e.game.player;t&&e.distanceTo(t)<4&&e.attack(t,e.getDamage())}};a=s([r.Serializable("SnakeAI")],a);let l=class extends o.Monster{constructor(e,t,i,s){super(e,t,i,"Snake",n,s),this.ai=new a(this)}};l=s([r.Serializable("Snake")],l),t.Snake=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(4),n=i(60),a=i(61),l=new r.Sprite(320,360,16,24,2,!0,void 0,2688590079);let h=class extends r.AI{doAi(){const e=this.actor,t=e.game.player;t&&e.sentiment===o.Sentiment.HOSTILE&&(e.distanceTo(t)>1.5?e.moveToward(t.x,t.y):t.hp>0&&e.attack(t,e.getDamage()))}};h=s([r.Serializable("KingAI")],h);let c=class extends o.StatsActor{constructor(e,t,i){super(e,t,i,"King",l),this.ai=new h(this),this.level=99,this.maxHp=10+2*this.level,this.hp=this.maxHp,this.strength=10+2*this.level}onBump(e){if(!this.dialog){const e=["A THREAT WITHIN","","I hope you strapped your belt on tight,","young paladin, because there is work to","do here in Northshire.","","And I don't mean farming.","","The Stormwind guards are hard pressed to","keep the peace here, with so many of us","in distant lands and so many threats","pressing close. And so we're enlisting","the aid of anyone willing to defend","their home. And their alliance.","","If you're here to answer the call, then","speak with my superior, Marshal McBride.","He's inside the abbey behind me."],t=new n.QuestDialog(new r.Rect(10,40,200,200));t.quest=new a.Quest(e,40),this.game.gui.add(t),this.dialog=t}return this.dialog.visible=!0,!0}takeDamage(e,t){super.takeDamage(e,t),this.sentiment=o.Sentiment.HOSTILE}};c=s([r.Serializable("King")],c),t.King=c},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=8;t.QuestDialog=class extends s.Dialog{constructor(e){super(e),this.modal=!0}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect||!this.quest)return;const e=this.rect,t=(this.gui.renderer.buttonSlotRect,e.x1,e.x2,e.x+r);let i=e.y+r;for(let e=0;e<this.quest.description.length;e++)this.gui.app.drawString(this.quest.description[e],t,i,s.Colors.WHITE),i+=10;this.rect.height=Math.max(200,i+r-e.y),this.drawChildren()}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});let r=class{constructor(e,t){this.description=e,this.xpGain=t}};r=s([i(0).Serializable("Quest")],r),t.Quest=r},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(15),r=i(0),o=i(63);t.Castle=class{constructor(e,t){const i=e.game,n=i.tileMap,a=i.rng,l=t.getCenter(),h=t,c=new r.Rect(t.x+2,t.y+2,t.width-4,t.height-4),d=new r.Rect(c.x+1,c.y+1,c.width-2,c.height-2);for(let e=h.y1;e<h.y2;e++)for(let t=h.x1;t<h.x2;t++)n.setTile(t,e,0,s.Tiles.WATER),n.setTile(t,e,1,s.Tiles.EMPTY),n.setAnimated(t,e,0,!0),n.setBlocked(t,e,!0,!1);for(let e=c.y1;e<c.y2;e++)for(let t=c.x1;t<c.x2;t++)n.setTile(t,e,0,s.Tiles.FLOOR),n.setAnimated(t,e,0,!1),n.setBlocked(t,e,!1);for(let e=c.x1;e<c.x2;e++)n.setTile(e,c.y1,0,s.Tiles.WALL),n.setBlocked(e,c.y1,!0),n.setTile(e,c.y2-1,0,s.Tiles.WALL),n.setBlocked(e,c.y2-1,!0);for(let e=c.y1;e<c.y2;e++)n.setTile(c.x1,e,0,s.Tiles.WALL),n.setBlocked(c.x1,e,!0),n.setTile(c.x2-1,e,0,s.Tiles.WALL),n.setBlocked(c.x2-1,e,!0);for(let e=h.y1-1;e<h.y1+3;e++)for(let t=l.x-1;t<=l.x;t++)n.setTile(t,e,0,s.Tiles.BRIDGE),n.setTile(t,e,1,s.Tiles.EMPTY),n.setAnimated(t,e,0,!1),n.setBlocked(t,e,!1);for(let e=h.y2-3;e<h.y2+1;e++)for(let t=l.x-1;t<=l.x;t++)n.setTile(t,e,0,s.Tiles.BRIDGE),n.setTile(t,e,1,s.Tiles.EMPTY),n.setAnimated(t,e,0,!1),n.setBlocked(t,e,!1);for(let e=l.y-1;e<=l.y;e++)for(let t=h.x1-1;t<h.x1+3;t++)n.setTile(t,e,0,s.Tiles.BRIDGE),n.setTile(t,e,1,s.Tiles.EMPTY),n.setAnimated(t,e,0,!1),n.setBlocked(t,e,!1);for(let e=l.y-1;e<=l.y;e++)for(let t=h.x2-3;t<h.x2+1;t++)n.setTile(t,e,0,s.Tiles.BRIDGE),n.setTile(t,e,1,s.Tiles.EMPTY),n.setAnimated(t,e,0,!1),n.setBlocked(t,e,!1);for(let e=0;e<10;e++){const e=[new r.Vec2(a.nextRange(d.x1,d.x2),a.nextRange(d.y1,d.y2))];for(let t=1;t<4;t++){const i=e[t-1];0===a.nextRange(0,2)?e.push(new r.Vec2(i.x,a.nextRange(d.y1,d.y2))):e.push(new r.Vec2(a.nextRange(d.x1,d.x2),i.y))}const t=new o.Guard(i,e[0].x,e[0].y,e);i.entities.add(t)}this.rect=t,this.center=l}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=i(4),a=new r.Sprite(320,96,16,24,2,!0,void 0,1469102079);let l=class extends r.AI{constructor(e,t){super(e),this.waypoints=t,this.waypointIndex=0,this.waitCount=0,this.aggroCount=0}doAi(){const e=this.actor,t=e.game,i=t.player;if(this.aggroTarget){if(this.aggroTarget.hp<=0)return this.aggroTarget=void 0,void(this.aggroCount=0);if(this.aggroCount++,1===this.aggroCount){const t=e.game;t.log("Guard shouts for help!",r.Colors.LIGHT_BLUE);for(let i=0;i<t.entities.length;i++){const s=t.entities.get(i);if(s instanceof h){const t=s;e.distanceTo(t)<6&&(t.sentiment=e.sentiment,t.ai.aggroTarget=this.aggroTarget)}}}else if(e.distanceTo(this.aggroTarget)>1)e.moveToward(this.aggroTarget.x,this.aggroTarget.y);else{const t=10;e.attack(this.aggroTarget,t)}return}if(this.aggroCount=0,e.sentiment===n.Sentiment.HOSTILE)return void(this.aggroTarget=i);for(let e=0;e<t.entities.length;e++){const i=t.entities.get(e);if(i instanceof o.Monster&&!(i instanceof h)&&t.tileMap.isVisible(i.x,i.y))return void(this.aggroTarget=i)}if(this.waitCount>0)return void this.waitCount--;const s=this.waypoints[this.waypointIndex];if(e.x===s.x&&e.y===s.y)return this.waypointIndex=(this.waypointIndex+1)%this.waypoints.length,void(this.waitCount=e.game.rng.nextRange(5,15));e.moveToward(s.x,s.y)}};l=s([r.Serializable("GuardAI")],l);let h=class extends o.Monster{constructor(e,t,i,s){super(e,t,i,"Guard",a,10),this.ai=new l(this,s),this.seen=!0,this.sentiment=n.Sentiment.FRIENDLY}};h=s([r.Serializable("Guard")],h),t.Guard=h},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(4),n=i(65),a=new r.Sprite(224,360,16,24,2,!0,void 0,3285193471);let l=class extends r.AI{doAi(){const e=this.actor,t=e.game.player;t&&e.sentiment===o.Sentiment.HOSTILE&&(e.distanceTo(t)>1.5?e.moveToward(t.x,t.y):t.hp>0&&e.attack(t,e.getDamage()))}};l=s([r.Serializable("VendorAI")],l);let h=class extends o.StatsActor{constructor(e,t,i){super(e,t,i,"Vendor",a),this.ai=new l(this),this.level=99,this.maxHp=10+2*this.level,this.hp=this.maxHp,this.strength=10+2*this.level}onBump(e){if(!this.dialog){const e=new n.VendorDialog(new r.Rect(10,40,125,175),this);this.game.gui.add(e),this.dialog=e}return this.dialog.visible=!0,!0}takeDamage(e,t){super.takeDamage(e,t),this.sentiment=o.Sentiment.HOSTILE}};h=s([r.Serializable("Vendor")],h),t.Vendor=h},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(66),n=i(10),a=i(14);let l=class extends r.Dialog{constructor(e,t){super(e),this.vendor=t,this.items=t.inventory,this.modal=!0;for(let e=0;e<5;e++)this.add(new r.ButtonSlot(new r.Rect(0,0,24,24),r.Keys.VK_A+e));for(let e=0;e<t.inventory.length;e++)this.addItem(t.inventory.get(e));this.items.addListener({onAdd:(e,t)=>this.addItem(t),onRemove:(e,t)=>this.removeItem(t)}),this.messages=[new r.Message("How are ya?",r.Colors.WHITE)]}addItem(e){if(e instanceof a.Gold)return;const t=this.getExistingButton(e);if(t)return void t.stackItems.add(e);const i=this.getNextFreeSlot();i&&i.add(new o.VendorButton(i.rect.clone(),this.vendor,e))}removeItem(e){for(let t=0;t<this.children.length;t++){const i=this.children.get(t),s=i.button;s&&s instanceof o.VendorButton&&s.stackItems.contains(e)&&(s.stackItems.remove(e),0===s.stackItems.length&&i.remove(s))}}getExistingButton(e){for(let t=0;t<this.children.length;t++){const i=this.children.get(t).button;if(i&&i instanceof o.VendorButton){const t=i.stackItems.get(0);if(e.isStackable(t))return i}}}getNextFreeSlot(){for(let e=0;e<this.children.length;e++){const t=this.children.get(e);if(!t.button)return t}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const e=this.rect,t=this.gui.renderer.buttonSlotRect,i=e.x+4;let s=e.y+4;for(let e=0;e<this.messages.length;e++){const t=this.messages[e];this.gui.app.drawString(t.text,i,s,t.color),s+=10}for(let e=0;e<5;e++){const o=this.children.get(e);o.rect.x=i,o.rect.y=s,o.rect.width=t.width,o.rect.height=t.height;const a=o.button;if(a){const e=a.getFirstItem();e&&e instanceof n.BaseItem&&(this.gui.app.drawString(e.name,i+25,s+3,r.Colors.YELLOW),this.gui.app.drawString(e.sellPrice+" gold",i+25,s+11,r.Colors.WHITE))}s+=t.height+2}this.rect.height=s+4-e.y,this.drawChildren()}};l=s([r.Serializable("VendorDialog")],l),t.VendorDialog=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(10);let n=class extends r.Button{constructor(e,t,i){super(e,i.sprite),this.vendor=t,this.stackItems=new r.ArrayList,this.stackItems.add(i),this.tooltipMessages=i.tooltipMessages}getFirstItem(){return this.stackItems.length>0?this.stackItems.get(0):void 0}click(){const e=this.getFirstItem();if(!(e&&e instanceof o.BaseItem))return;const t=e.game,i=t.player;i.countGold()<e.sellPrice?t.log("Insufficient funds",r.Colors.RED):(this.vendor.inventory.remove(e),i.inventory.add(e),i.moveGold(this.vendor,e.sellPrice),t.log("Purchased "+e.name))}drawContents(){if(this.gui&&(super.drawContents(),this.stackItems.length>1)){const e=this.rect;this.gui.app.drawRightString(this.stackItems.length.toString(),e.x2-3,e.y2-10)}}updateTooltip(e){if(this.stackItems.length>0){const e=this.stackItems.get(0);e.onUpdateTooltip(),this.tooltipMessages=e.tooltipMessages}super.updateTooltip(e)}};n=s([r.Serializable("VendorButton")],n),t.VendorButton=n},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(68),o=64,n=48;t.Dungeon=class{constructor(e,t,i){this.layers=[];for(let a=0;a<10;a++){const l=t,h=i+a*n,c=new r.DungeonLayer(e,new s.Rect(l,h,o,n),a);this.layers.push(c)}for(let e=1;e<10;e++){const t=this.layers[e-1].exit,i=this.layers[e].entrance;t.other=i,i.other=t}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(18),o=i(15),n=i(69),a=i(71),l=i(73),h=i(74),c=i(5),d=i(2),u=i(75),p=i(76),g=i(25),f=i(26),y=i(27),m=i(9),w=i(29),S=i(13),_=i(22),R=i(77),E=i(78),T=6,v=10,b=4,x=8,I=10,M=3,P=2,O=4,A=new s.Sprite(700,500,16,24,1),L=[{bossZone:new s.Rect(0,0,64,10),bossRoom:new s.Rect(8,2,14,8),stairsRoom:new s.Rect(2,4,4,4)},{bossZone:new s.Rect(0,0,64,10),bossRoom:new s.Rect(42,2,14,8),stairsRoom:new s.Rect(58,4,4,4)},{bossZone:new s.Rect(0,38,64,10),bossRoom:new s.Rect(8,38,14,8),stairsRoom:new s.Rect(2,40,4,4)},{bossZone:new s.Rect(0,38,64,10),bossRoom:new s.Rect(42,38,14,8),stairsRoom:new s.Rect(58,40,4,4)}];t.DungeonLayer=class{constructor(e,t,i){this.mapGen=e,this.rect=t,this.level=i,this.rooms=[];const g=e.game,f=g.tileMap,y=g.rng,m=e.nextKeyId++;e.clearMap(f,t,o.Tiles.WALL,!0,!0),e.createRiver(f,t,200);for(let e=t.x1;e<t.x2;e++)f.setTile(e,t.y1,0,o.Tiles.EMPTY),f.setAnimated(e,t.y1,0,!1),f.setBlocked(e,t.y1,!0),f.setTile(e,t.y2-1,0,o.Tiles.EMPTY),f.setAnimated(e,t.y2-1,0,!1),f.setBlocked(e,t.y2-1,!0);for(let e=t.y1;e<t.y2;e++)f.setTile(t.x1,e,0,o.Tiles.EMPTY),f.setAnimated(t.x1,e,0,!1),f.setBlocked(t.x1,e,!0),f.setTile(t.x2-1,e,0,o.Tiles.EMPTY),f.setAnimated(t.x2-1,e,0,!1),f.setBlocked(t.x2-1,e,!0);const w=L[y.nextRange(0,L.length)],S=new s.Rect(w.bossZone.x+t.x,w.bossZone.y+t.y,w.bossZone.width,w.bossZone.height),_=new s.Rect(w.bossRoom.x+t.x,w.bossRoom.y+t.y,w.bossRoom.width,w.bossRoom.height),R=new s.Rect(w.stairsRoom.x+t.x,w.stairsRoom.y+t.y,w.stairsRoom.width,w.stairsRoom.height);for(;this.rooms.length<I;){const e=y.nextRange(T,v),i=y.nextRange(b,x),n=y.nextRange(t.x1+2,t.x2-e-3),a=y.nextRange(t.y1+2,t.y2-i-3),l=new s.Rect(n,a,e,i);let h=l.intersects(S);for(let e=0;e<this.rooms.length;e++)if(l.intersects(this.rooms[e])){h=!0;break}if(h)continue;this.createRoom(f,l);const c=l.getCenter();if(0===this.rooms.length)this.entrance=new r.Portal(g,c.x,c.y,"stairs",A),g.entities.add(this.entrance),f.setTile(c.x,c.y,0,o.Tiles.STAIRS_UP);else{const e=this.rooms[this.rooms.length-1].getCenter();1===y.nextRange(0,1)?(this.createHTunnel(f,e.x,c.x,e.y),this.createVTunnel(f,e.y,c.y,c.x)):(this.createVTunnel(f,e.y,c.y,e.x),this.createHTunnel(f,e.x,c.x,c.y)),this.placeMonsters(l,this.level)}this.placeItems(l),this.rooms.push(l)}{this.createRoom(f,_);const e=this.rooms[this.rooms.length-1].getCenter(),t=_.getCenter();this.createHTunnel(f,e.x,t.x,e.y),this.createVTunnel(f,e.y,t.y,t.x);const i=3*this.level+2,s=y.nextRange(0,4);let w=void 0;(w=0===s?new n.RedDragon(g,t.x,t.y,i,_):1===s?new a.WindElemental(g,t.x,t.y,i,_):2===s?new l.Griffon(g,t.x,t.y,i):new E.StoneGolem(g,t.x,t.y,i)).loot.push(new h.Key(g,w.x,w.y,m));const S=Math.round(i/2),T=0===y.nextRange(0,3)?d.ItemQuality.EPIC:d.ItemQuality.RARE;w.loot.push(new c.EquipmentBuilder(g).withRandomDrop(S,T).build()),g.entities.add(w),t.y>e.y?(f.setTile(t.x,_.y1,0,o.Tiles.CLOSED_DOOR),f.setBlocked(t.x,_.y1,!0),g.entities.add(new u.BossDoor(g,t.x,_.y1,w))):(f.setTile(t.x,_.y2,0,o.Tiles.CLOSED_DOOR),f.setBlocked(t.x,_.y2,!0),g.entities.add(new u.BossDoor(g,t.x,_.y2,w))),this.createRoom(f,R);const v=R.getCenter();this.createHTunnel(f,t.x,v.x,v.y),f.setTile(v.x,v.y,0,o.Tiles.STAIRS_DOWN),this.exit=new r.Portal(g,v.x,v.y,"stairs",A),g.entities.add(this.exit),t.x>v.x?(f.setTile(_.x1,t.y,0,o.Tiles.CLOSED_DOOR),f.setBlocked(_.x1,t.y,!0),g.entities.add(new p.LockedDoor(g,_.x1,t.y,m))):(f.setTile(_.x2,t.y,0,o.Tiles.CLOSED_DOOR),f.setBlocked(_.x2,t.y,!0),g.entities.add(new p.LockedDoor(g,_.x2,t.y,m)))}for(let e=0;e<this.rooms.length;e++)this.placeObstacles(this.rooms[e]);g.resetViewport(),g.recomputeFov()}createRoom(e,t){for(let i=t.y1+1;i<t.y2;i++)for(let s=t.x1+1;s<t.x2;s++)e.setTile(s,i,0,o.Tiles.FLOOR),e.setAnimated(s,i,0,!1),e.setBlocked(s,i,!1)}createHTunnel(e,t,i,s){for(let r=Math.min(t,i);r<=Math.max(t,i);r++){const t=e.getTile(r,s,0);t!==o.Tiles.STAIRS_UP&&t!==o.Tiles.STAIRS_DOWN&&(t===o.Tiles.WATER?e.setTile(r,s,0,o.Tiles.BRIDGE):e.setTile(r,s,0,o.Tiles.FLOOR),e.setAnimated(r,s,0,!1),e.setBlocked(r,s,!1))}}createVTunnel(e,t,i,s){for(let r=Math.min(t,i);r<=Math.max(t,i);r++){const t=e.getTile(s,r,0);t!==o.Tiles.STAIRS_UP&&t!==o.Tiles.STAIRS_DOWN&&(t===o.Tiles.WATER?e.setTile(s,r,0,o.Tiles.BRIDGE):e.setTile(s,r,0,o.Tiles.FLOOR),e.setAnimated(s,r,0,!1),e.setBlocked(s,r,!1))}}placeMonsters(e,t){const i=this.mapGen.game,s=i.rng,r=s.nextRange(0,M);for(let o=0;o<r;o++){const r=s.nextRange(e.x1+1,e.x2-1),o=s.nextRange(e.y1+1,e.y2-1);if(i.getEntityAt(r,o))continue;const n=s.nextRange(0,100),a=2*t+s.nextRange(1,3);let l=null;l=n<40?new g.Spider(i,r,o,a):n<80?new f.Bat(i,r,o,a):new y.Troll(i,r,o,a),i.entities.add(l)}}placeItems(e){const t=this.mapGen.game,i=t.rng,s=i.nextRange(0,P);for(let r=0;r<s;r++){const s=i.nextRange(e.x1+1,e.x2-1),r=i.nextRange(e.y1+1,e.y2-1);if(t.getEntityAt(s,r))continue;const o=i.nextRange(0,100);let n=null;(n=o<50?new m.HealthPotion(t):o<70?new w.Scroll(t,s,r,new S.LightningAbility):o<85?new w.Scroll(t,s,r,new _.FireballAbility):new w.Scroll(t,s,r,new R.ConfuseAbility)).x=s,n.y=r,t.entities.add(n)}}placeObstacles(e){const t=this.mapGen.game,i=t.rng,s=t.tileMap,r=i.nextRange(0,O+1);for(let n=0;n<r;n++){const r=i.nextRange(e.x1+2,e.x2-3),n=i.nextRange(e.y1+2,e.y2-3);t.getEntityAt(r,n)||(i.nextRange(0,100)<80?(s.setTile(r,n,0,o.Tiles.FLOOR),s.setTile(r,n,1,o.Tiles.BARREL)):(s.setTile(r,n,0,o.Tiles.FLOOR),s.setTile(r,n,1,o.Tiles.STATUE)),s.setBlocked(r,n,!0,!1))}}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=i(70),a=i(4),l=new r.Sprite(576,312,16,24,2,!0,void 0,3574665727);let h=class extends r.AI{doAi(){const e=this.actor,t=e.game.player;if(t&&!(t.hp<=0))if(e.sentiment!==a.Sentiment.HOSTILE||0!==e.cooldown)e.cooldown>0&&e.cooldown--,e.distanceTo(t)<2?e.attack(t,e.getDamage()):e.moveToward(t.x,t.y);else{for(let t=e.y-1;t<=e.y+1;t++)for(let i=e.x-1;i<=e.x+1;i++)this.createCrawler(i,t,i-e.x,t-e.y);e.cooldown=5}}createCrawler(e,t,i,s){const r=this.actor,o=r.game;if(o.isBlocked(e,t))return;const a=o.player;a&&a.x===e&&a.y===t||o.entities.add(new n.FlameCrawler(o,e,t,i,s,r.level))}};h=s([r.Serializable("RedDragonAI")],h);let c=class extends o.Monster{constructor(e,t,i,s,r){super(e,t,i,"Dragon",l,s),this.cooldown=0,this.room=r,this.maxHp=10*s,this.hp=this.maxHp,this.ai=new h(this),this.sentiment=a.Sentiment.NEUTRAL}};c=s([r.Serializable("RedDragon")],c),t.RedDragon=c},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=new r.Sprite(256,312,16,24,2,!0,void 0,3574665727);let a=class extends r.AI{constructor(e){super(e),this.alwaysActive=!0,this.aliveCount=0}doAi(){const e=this.actor,t=e.game,i=t.player;if(!i||i.hp<=0)return;if(this.aliveCount++,1===this.aliveCount)return;const s=e.x+e.dx,r=e.y+e.dy;i.x===s&&i.y===r?(e.attack(i,Math.round(e.getDamage())),i.move(e.dx,e.dy)):t.tileMap.isBlocked(s,r)?e.game.entities.remove(e):e.move(e.dx,e.dy)}};a=s([r.Serializable("FlameCrawlerAI")],a);let l=class extends o.Monster{constructor(e,t,i,s,r,o){super(e,t,i,"Flame Crawler",n,o),this.ai=new a(this),this.dx=s,this.dy=r,this.showFrame=!1,this.seen=!0,this.blocks=!1}};l=s([r.Serializable("FlameCrawler")],l),t.FlameCrawler=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=i(4),a=i(72),l=new r.Sprite(288,312,16,24,2,!0,void 0,2866078463);let h=class extends r.AI{doAi(){const e=this.actor,t=e.game,i=t.player;if(i&&!(i.hp<=0))if(e.sentiment!==n.Sentiment.HOSTILE||0!==e.cooldown)e.cooldown>0&&e.cooldown--,e.distanceTo(i)<=2&&e.attack(i,e.getDamage());else{const i=e.room,s=t.rng;for(let e=i.x1+1;e<i.x2-1;e++)0===s.nextRange(0,2)?this.createCrawler(e,i.y1+1,0,1):this.createCrawler(e,i.y2-1,0,-1);for(let e=i.y1+1;e<i.y2-1;e++)0===s.nextRange(0,2)?this.createCrawler(i.x1+1,e,1,0):this.createCrawler(i.x2-1,e,-1,0);e.cooldown=10}}createCrawler(e,t,i,s){const r=this.actor,o=r.game,n=o.player;n&&n.x===e&&n.y===t||o.entities.add(new a.WindCrawler(o,e,t,i,s,r.level))}};h=s([r.Serializable("WindElementalAI")],h);let c=class extends o.Monster{constructor(e,t,i,s,r){super(e,t,i,"Wind",l,s),this.cooldown=0,this.room=r,this.maxHp=10*s,this.hp=this.maxHp,this.ai=new h(this),this.sentiment=n.Sentiment.NEUTRAL}};c=s([r.Serializable("WindElemental")],c),t.WindElemental=c},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=new r.Sprite(576,216,16,24,2,!0,void 0,2866078463);let a=class extends r.AI{constructor(e){super(e),this.alwaysActive=!0,this.aliveCount=0}doAi(){const e=this.actor,t=e.game,i=t.player;if(!i||i.hp<=0)return;if(this.aliveCount++,1===this.aliveCount)return;const s=e.x+e.dx,r=e.y+e.dy;i.x===s&&i.y===r?(e.attack(i,Math.round(e.getDamage()/2)),i.move(e.dx,e.dy)):t.tileMap.isBlocked(s,r)?e.game.entities.remove(e):e.move(e.dx,e.dy)}};a=s([r.Serializable("WindCrawlerAI")],a);let l=class extends o.Monster{constructor(e,t,i,s,r,o){super(e,t,i,"Wind Crawler",n,o),this.ai=new a(this),this.dx=s,this.dy=r,this.showFrame=!1,this.seen=!0,this.blocks=!1}};l=s([r.Serializable("WindCrawler")],l),t.WindCrawler=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=i(4),a=i(21),l=new r.Sprite(448,144,16,24,2,!0,void 0,4075971071);let h=class extends r.AI{constructor(){super(...arguments),this.countdown=0,this.cooldown=10,this.target=new r.Vec2(0,0)}doAi(){const e=this.actor,t=e.game,i=t.player;if(i&&!(i.hp<=0)){if(this.cooldown--,0===this.cooldown)return this.cooldown=10,this.countdown=5,this.target.x=i.x,this.target.y=i.y,void t.log("Griffon looks at the hero and growls.");if(this.countdown--,this.countdown>0)t.log("Griffon prepares to pounce...");else if(0!==this.countdown)e.distanceTo(i)<2?e.attack(i,e.getDamage()):e.moveToward(i.x,i.y);else if(t.log("Griffon leaps!"),i.x===this.target.x&&i.y===this.target.y){e.attack(i,4*e.getDamage());const s=t.findFreeTile(this.target.x,this.target.y,2);s&&e.moveTo(s.x,s.y)}else e.moveTo(this.target.x,this.target.y),i.distanceTo(this.target)<2&&(i.ai=new a.Stunned(i,2))}}};h=s([r.Serializable("GriffonAI")],h);let c=class extends o.Monster{constructor(e,t,i,s){super(e,t,i,"Griffon",l,s),this.maxHp=10*this.level,this.hp=this.maxHp,this.ai=new h(this),this.sentiment=n.Sentiment.NEUTRAL}};c=s([r.Serializable("Griffon")],c),t.Griffon=c},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=new r.Sprite(688,168,16,24,1,!0,void 0,4294902015);let n=class extends r.Item{constructor(e,t,i,s){super(e,t,i,"key",o,!1),this.keyId=s}onBump(e){return e.keys[this.keyId]=!0,e.moveTo(this.x,this.y),this.game.entities.remove(this),!0}};n=s([r.Serializable("Key")],n),t.Key=n},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(28);let n=class extends o.Door{constructor(e,t,i,s){super(e,t,i),this.boss=s,this.zIndex=0}onBump(e){if(this.boss.hp<=0)return this.openDoor(),e.moveTo(this.x,this.y),!0;if((this.x-e.x)*(this.boss.x-e.x)+(this.y-e.y)*(this.boss.y-e.y)>0){const t=this.x-e.x,i=this.y-e.y;return e.move(2*t,2*i),e.game.log("The door slams shut behind you."),!0}return!1}};n=s([r.Serializable("BossDoor")],n),t.BossDoor=n},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(28);let n=class extends o.Door{constructor(e,t,i,s){super(e,t,i),this.keyId=s,this.zIndex=0}onBump(e){return!!e.keys[this.keyId]&&(this.openDoor(),e.moveTo(this.x,this.y),!0)}};n=s([r.Serializable("LockedDoor")],n),t.LockedDoor=n},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=new r.Sprite(128,32,16,24,3,!1),n=[new r.Message("Confuse",r.Colors.WHITE),new r.Message("20 mana",r.Colors.WHITE),new r.Message("Befuddles an enemy into a random",r.Colors.YELLOW),new r.Message("stupor for 10 turns.",r.Colors.YELLOW)];let a=class{constructor(){this.sprite=o,this.name="confuse",this.targetType=r.TargetType.ENTITY,this.minRange=1,this.maxRange=8,this.cooldown=1,this.tooltipMessages=n}cast(e,t){const i=e.game;return e.distanceTo(t)>8?(e===i.player&&i.log("Target out of range.",r.Colors.LIGHT_GRAY),!1):i.tileMap&&!i.tileMap.isVisible(t.x,t.y)?(e===i.player&&i.log("Target not visible.",r.Colors.LIGHT_GRAY),!1):(t.ai=new r.ConfusedMonster(t),i.log("The eyes of the "+t.name+" look vacant, as he stumbles around!",r.Colors.LIGHT_GREEN),e.ap--,!0)}};a=s([r.Serializable("ConfuseAbility")],a),t.ConfuseAbility=a},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(1),n=i(4),a=new r.Sprite(480,264,16,24,2,!0,void 0,3570717951);let l=class extends r.AI{constructor(){super(...arguments),this.countdown=0,this.cooldown=10,this.charging=0,this.target=new r.Vec2(0,0)}doAi(){const e=this.actor,t=e.game,i=t.player;if(i&&!(i.hp<=0)){if(this.cooldown--,0===this.cooldown)return this.cooldown=15,this.countdown=3,this.target.x=i.x,this.target.y=i.y,void t.log("Golem looks at the hero and growls.");if(this.countdown--,this.countdown>0)t.log("Golem prepares to charge...");else if(0===this.countdown&&(t.log("Golem charges!"),this.charging=6),this.charging--,this.charging>0){const t=e.distanceTo(i),s=e.distanceTo(this.target);if(t<2)e.attack(i,e.getDamage());else if(s>=2){const t=Math.round((this.target.x-e.x)/s*2),i=Math.round((this.target.y-e.y)/s*2);e.move(t,i)}else e.moveToward(this.target.x,this.target.y)}else e.distanceTo(i)<2?e.attack(i,e.getDamage()):e.moveToward(i.x,i.y)}}};l=s([r.Serializable("StoneGolemAI")],l);let h=class extends o.Monster{constructor(e,t,i,s){super(e,t,i,"Golem",a,s),this.maxHp=10*this.level,this.hp=this.maxHp,this.ai=new l(this),this.sentiment=n.Sentiment.NEUTRAL}};h=s([r.Serializable("StoneGolem")],h),t.StoneGolem=h},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=5,o=2,n=new s.Sprite(688,144,16,24,1,!1,void 0,3225428223),a=new s.Sprite(640,144,16,24,1,!1,void 0,3225428223),l=new s.Sprite(688,168,16,24,1,!1,void 0,3225428223),h=new s.Sprite(608,312,16,24,1,!1,void 0,3225428223),c=[[new s.Message("Constitution",s.Colors.YELLOW),new s.Message("Health, staminal,",s.Colors.WHITE),new s.Message("and vital force",s.Colors.WHITE)],[new s.Message("Dexterity",s.Colors.YELLOW),new s.Message("Physical agility, reflexes,",s.Colors.WHITE),new s.Message("balance, and poise",s.Colors.WHITE)],[new s.Message("Intelligence",s.Colors.YELLOW),new s.Message("Mental acuity, recall,",s.Colors.WHITE),new s.Message("and analytical skill",s.Colors.WHITE)],[new s.Message("Strength",s.Colors.YELLOW),new s.Message("Natural athleticism,",s.Colors.WHITE),new s.Message("and bodily power",s.Colors.WHITE)]];t.LevelUpDialog=class extends s.Dialog{constructor(e,t){super(e),this.player=t,this.modal=!0;const i=new s.ButtonSlot(new s.Rect(0,0,24,24),s.Keys.VK_1),r=new s.Button(new s.Rect(0,0,16,24),n,void 0,()=>this.incConstitution());i.add(r),this.add(i);const o=new s.ButtonSlot(new s.Rect(0,0,24,24),s.Keys.VK_2),c=new s.Button(new s.Rect(0,0,16,24),a,void 0,()=>this.incDexterity());o.add(c),this.add(o);const d=new s.ButtonSlot(new s.Rect(0,0,24,24),s.Keys.VK_3),u=new s.Button(new s.Rect(0,0,16,24),l,void 0,()=>this.incIntelligence());d.add(u),this.add(d);const p=new s.ButtonSlot(new s.Rect(0,0,24,24),s.Keys.VK_4),g=new s.Button(new s.Rect(0,0,16,24),h,void 0,()=>this.incStrength());p.add(g),this.add(p)}incConstitution(){this.increaseStat(1,0,0,0)}incDexterity(){this.increaseStat(0,1,0,0)}incIntelligence(){this.increaseStat(0,0,1,0)}incStrength(){this.increaseStat(0,0,0,1)}increaseStat(e,t,i,s){this.player.constitution+=e,this.player.dexterity+=t,this.player.intelligence+=i,this.player.strength+=s,this.player.remainingAbilityPoints--,0===this.player.remainingAbilityPoints&&(this.visible=!1)}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const e=this.rect,t=this.gui.renderer.buttonSlotRect,i=e.x+r;let n=e.y+r;this.gui.app.drawString("Leveled up!",i,n,s.Colors.WHITE),n+=10,this.gui.app.drawString("Choose "+this.player.remainingAbilityPoints+" stats to increase:",i,n,s.Colors.WHITE),n+=10;for(let e=0;e<4;e++){const s=c[e];for(let e=0;e<s.length;e++)this.gui.app.drawString(s[e].text,i+25,n+1+8*e,s[e].color);const r=this.children.get(e);r.rect.x=i,r.rect.y=n,r.rect.width=t.width,r.rect.height=t.height,n+=t.height+o}this.rect.height=n+r-e.y,this.drawChildren()}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(4);t.EntityFrames=class extends s.Panel{constructor(e){super(new s.Rect(0,40,40,200)),this.game=e}drawContents(){if(!this.gui)return;const e=this.game.blackoutRect;if(!e)return;const t=this.gui.app,i=this.game.player,o=this.game.entities;let n=40;for(let a=0;a<o.length;a++){const l=o.get(a);if(l===this.game.player||!(l instanceof r.StatsActor))continue;const h=l;if(!h.showFrame||h.visibleDuration<0)continue;t.drawImage(2,n,64,48,54,18);let c=s.Colors.YELLOW;h.sentiment===r.Sentiment.FRIENDLY?c=s.Colors.LIGHT_GREEN:h.sentiment===r.Sentiment.HOSTILE&&(c=s.Colors.RED),t.drawCenteredString(h.name,22,n+1,c);const d=Math.round(38*h.hp/h.maxHp);t.drawImage(3,n+9,e.x,e.y,e.width,e.height,s.Colors.DARK_GREEN,d,7),t.drawCenteredString(h.hp+"/"+h.maxHp,22,n+9,s.Colors.WHITE);let u=s.Colors.YELLOW;h.level>i.level+3?u=s.Colors.RED:h.level>i.level+1?u=s.Colors.ORANGE:h.level<i.level-3?u=s.Colors.LIGHT_GREEN:h.level<i.level-1&&(u=3152954623),t.drawCenteredString(h.level.toString(),49,n+5,u),n+=24}}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=[{display:"NEW GAME",hash:"chooseseed",enabled:!0},{display:"CONTINUE",hash:"game",enabled:!1},{display:"TUTORIAL",hash:"tutorial",enabled:!0},{display:"HIGH SCORES",hash:"highscores",enabled:!0},{display:"CREDITS",hash:"credits",enabled:!0}];t.MainMenu=class extends s.AppState{constructor(e){super(e),this.selectedIndex=0,this.time=0,this.sprites=[],this.chooseSprites()}chooseSprites(){this.sprites=[];for(let e=0;e<4;e++){const e=32*Math.floor(19*Math.random()),t=96+24*Math.floor(13*Math.random()),i=s.fromHsv(Math.random(),.9,.5);this.sprites.push(new s.Sprite(e,t,16,24,2,!0,void 0,i))}}update(){s.Sprite.updateGlobalAnimations();const e=this.app;r[1].enabled=!!e.game;const t=this.time%300;t<80&&t%8==0&&this.chooseSprites(),this.app.drawImage(this.app.center.x-128,0,0,800,256,128),this.app.drawCenteredString("KOPI LUWAK DUNGEON",this.app.center.x+1,33,s.Colors.BLACK),this.app.drawCenteredString("KOPI LUWAK DUNGEON",this.app.center.x,32);for(let e=0;e<4;e++){const t=this.app.center.x-56+32*e,i=52;this.sprites[e].draw(this.app,t,i)}const i=this.app.mouse;for(let e=0;e<r.length;e++){const t=r[e],o=this.app.center.x,n=90+15*e;let a=s.Colors.WHITE;t.enabled?e===this.selectedIndex&&(a=s.Colors.YELLOW):a=s.Colors.GRAY,this.app.drawCenteredString(t.display,o+1,n+1,s.Colors.BLACK),this.app.drawCenteredString(t.display,o,n,a),i.y>=n&&i.y<n+14&&i.isClicked()&&(window.location.hash=t.hash),e===this.selectedIndex&&this.app.isKeyPressed(s.Keys.VK_ENTER)&&(window.location.hash=t.hash)}this.app.isKeyPressed(s.Keys.VK_UP)&&this.selectedIndex--,this.app.isKeyPressed(s.Keys.VK_DOWN)&&this.selectedIndex++,this.selectedIndex<0&&(this.selectedIndex+=r.length),this.selectedIndex>=r.length&&(this.selectedIndex-=r.length),this.time++}}},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(17),o=i(83),n=i(84),a=i(24),l=i(85),h=i(86),c=[new a.Human,new o.Dwarf,new n.Elf,new l.Orc,new h.Undead];t.RaceMenu=class extends s.AppState{constructor(e){super(e),this.gui.renderer.baseRect=new s.Rect(0,64,24,24),this.gui.add(new s.MessagePanel(new s.Rect(2,2,256,10),new s.Message("Choose your race",s.Colors.WHITE)));const t=new s.ComplexSelectDialog(new s.Rect(2,15,246,204),c);t.renderer=new r.MenuItemRenderer(60,40),t.onSelect=(e=>{this.app.playerRace=e,window.location.hash="chooseclass"}),t.onCancel=(()=>{window.history.back()}),this.gui.add(t)}}},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(11),n=new r.Sprite(510,730,34,34,void 0,void 0,void 0,1082179839),a=[new r.Message("+4 Constitution, +2 Strength",r.Colors.LIGHT_GREEN),new r.Message("Critical strike bonus",r.Colors.YELLOW),new r.Message("Stoneform - Removes all curses",r.Colors.YELLOW)];let l=class extends o.CharacterRace{constructor(){super("Dwarf",n,"Bold and hardy, skilled warriors",a)}initPlayer(e){e.race=this,e.constitution+=4,e.strength+=2}};l=s([r.Serializable("Dwarf")],l),t.Dwarf=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(11),n=new r.Sprite(238,730,34,34,void 0,void 0,void 0,4286611711),a=[new r.Message("+3 Dexterity, +3 Intelligence",r.Colors.LIGHT_GREEN),new r.Message("Shadowmeld - slip into the shadows",r.Colors.YELLOW)];let l=class extends o.CharacterRace{constructor(){super("Elf",n,"Magical people of otherworldly grace",a)}initPlayer(e){e.race=this,e.dexterity+=3,e.intelligence+=3}};l=s([r.Serializable("Elf")],l),t.Elf=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(11),n=new r.Sprite(442,730,34,34,void 0,void 0,void 0,548413695),a=[new r.Message("+2 Constitution, +4 Strength",r.Colors.LIGHT_GREEN),new r.Message("War Shout - Boost all stats by +1 for 5 turns",r.Colors.YELLOW)];let l=class extends o.CharacterRace{constructor(){super("Orc",n,"Noble savages of shamanistic roots",a)}initPlayer(e){e.race=this,e.constitution+=2,e.strength+=4}};l=s([r.Serializable("Orc")],l),t.Orc=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=i(11),n=new r.Sprite(578,730,34,34,void 0,void 0,void 0,3493908735),a=[new r.Message("+2 Dexterity, +4 Intelligence",r.Colors.LIGHT_GREEN),new r.Message("Cannibalize - 10% of damage returns as health",r.Colors.YELLOW)];let l=class extends o.CharacterRace{constructor(){super("Undead",n,"Cursed to wander for eternity",a)}initPlayer(e){e.race=this,e.dexterity+=2,e.intelligence+=4}};l=s([r.Serializable("Undead")],l),t.Undead=l},function(e,t,i){"use strict";var s=this&&this.__decorate||function(e,t,i,s){var r,o=arguments.length,n=o<3?t:null===s?s=Object.getOwnPropertyDescriptor(t,i):s;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,i,s);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(n=(o<3?r(n):o>3?r(t,i,n):r(t,i))||n);return o>3&&n&&Object.defineProperty(t,i,n),n};Object.defineProperty(t,"__esModule",{value:!0});const r=i(0),o=new r.Sprite(848,168,16,24,1,!0,void 0,2160115967),n=[new r.Message("Hearthstone",r.Colors.WHITE),new r.Message("Item Level 1",r.Colors.YELLOW),new r.Message("Use: Returns you to your home.",r.Colors.LIGHT_GREEN),new r.Message("Speak to an Innkeeper in a different",r.Colors.LIGHT_GREEN),new r.Message("place to change your home location.",r.Colors.LIGHT_GREEN)];let a=class extends r.Item{constructor(e,t,i){super(e,t||0,i||0,"Hearthstone",o,!1),this.tooltipMessages=n}onUse(e){const t=e.game;return t.hideAllDialogs(),t.warpToPoint(e.home),!0}};a=s([r.Serializable("Hearthstone")],a),t.Hearthstone=a},function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const s=i(0),r=i(17);class o{constructor(e,t,i){this.number=e,this.name=t,this.description=i||""}}t.SeedMenu=class extends s.AppState{constructor(e){super(e),this.gui.renderer.baseRect=new s.Rect(0,64,24,24);const t=[new o(1,"One"),new o(2,"Two"),new o(3,"Three"),new o(4,"Four"),new o(5,"Five"),new o(Math.round(1e3*Math.random()),"Random")];this.gui.add(new s.MessagePanel(new s.Rect(2,2,256,10),new s.Message("Choose your seed",s.Colors.WHITE)));const i=new s.ComplexSelectDialog(new s.Rect(2,15,246,204),t);i.renderer=new r.MenuItemRenderer(15,15),i.onSelect=(e=>{console.log("set seed",e.number),this.app.seed=e.number,window.location.hash="chooserace"}),i.onCancel=(()=>{window.history.back()}),this.gui.add(i)}}}]);
//# sourceMappingURL=index.js.map