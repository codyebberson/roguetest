{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./node_modules/wglt/dist/index.js","webpack:///./src/abilities/confuse.ts","webpack:///./src/abilities/fireball.ts","webpack:///./src/abilities/leap.ts","webpack:///./src/abilities/lightning.ts","webpack:///./src/ai/stunned.ts","webpack:///./src/effects/explosioneffect.ts","webpack:///./src/entities/bat.ts","webpack:///./src/entities/griffon.ts","webpack:///./src/entities/monster.ts","webpack:///./src/entities/player.ts","webpack:///./src/entities/shark.ts","webpack:///./src/entities/spider.ts","webpack:///./src/entities/statsactor.ts","webpack:///./src/entities/troll.ts","webpack:///./src/game.ts","webpack:///./src/gui/bottompanel.ts","webpack:///./src/gui/toppanel.ts","webpack:///./src/index.ts","webpack:///./src/items/healthpotion.ts","webpack:///./src/items/scroll.ts","webpack:///./src/mapgen.ts"],"names":[],"mappings":"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","file":"index.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/index.ts\");\n","!function(t,e){\"object\"==typeof exports&&\"object\"==typeof module?module.exports=e():\"function\"==typeof define&&define.amd?define(\"wglt\",[],e):\"object\"==typeof exports?exports.wglt=e():t.wglt=e()}(window,function(){return function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,\"a\",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p=\"\",i(i.s=33)}([function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(1);class r extends s.Vec2{constructor(t,e,i,s){super(t,e),this.width=i,this.height=s}get x1(){return this.x}get y1(){return this.y}get x2(){return this.x+this.width}get y2(){return this.y+this.height}get left(){return this.x}get top(){return this.y}clone(){return new r(this.x,this.y,this.width,this.height)}getCenter(){return new s.Vec2(this.x+this.width/2|0,this.y+this.height/2|0)}intersects(t){return this.x<=t.x2&&this.x2>=t.x&&this.y<=t.y2&&this.y2>=t.y}contains(t){return t.x>=this.x&&t.x<=this.x2&&t.y>=this.y&&t.y<=this.y2}}e.Rect=r},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.Vec2=class{constructor(t,e){this.x=t,this.y=e}add(t){this.x+=t.x,this.y+=t.y}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(15);e.Panel=class{constructor(t){this.gui=null,this.rect=t,this.children=new s.XArray,this.modal=!1,this.visible=!0}setGui(t){if(!this.gui){this.gui=t;for(let e=0;e<this.children.length;e++)this.children.get(e).setGui(t)}}add(t){t.parent=this,t.setGui(this.gui),this.children.add(t)}remove(t){this.children.remove(t)}move(t){this.parent&&this.parent.remove(this),t.add(this)}getPanelAt(t){for(let e=this.children.length-1;e>=0;e--){const i=this.children.get(e);if(!i.visible)continue;if(i.isDragging())continue;const s=i.getPanelAt(t);if(s)return s}if(this.rect.contains(t))return this}drawContents(){this.drawChildren()}drawChildren(){for(let t=0;t<this.children.length;t++){const e=this.children.get(t);e.visible&&e.drawContents()}}handleInput(){return this.handleChildrenInput()}handleChildrenInput(){for(let t=this.children.length-1;t>=0;t--){const e=this.children.get(t);if(e.visible&&(e.handleInput()||e.modal))return!0}return!1}isDragging(){return this.gui&&this.gui.dragElement===this}onDrop(t){return!1}updateTooltip(t){t.visible=!1}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(8);class r{}r.BLACK=s.fromRgb(0,0,0),r.WHITE=s.fromRgb(255,255,255),r.GRAY=s.fromRgb(128,128,128),r.LIGHT_GRAY=s.fromRgb(170,170,170),r.DARK_GRAY=s.fromRgb(85,85,85),r.YELLOW=s.fromRgb(255,255,85),r.BROWN=s.fromRgb(170,85,0),r.RED=s.fromRgb(255,0,0),r.LIGHT_RED=s.fromRgb(255,85,85),r.DARK_RED=s.fromRgb(170,0,0),r.GREEN=s.fromRgb(0,255,0),r.LIGHT_GREEN=s.fromRgb(85,255,85),r.DARK_GREEN=s.fromRgb(0,170,0),r.LIGHT_CYAN=s.fromRgb(85,255,255),r.DARK_CYAN=s.fromRgb(0,170,170),r.BLUE=s.fromRgb(0,0,255),r.LIGHT_BLUE=s.fromRgb(85,85,255),r.DARK_BLUE=s.fromRgb(0,0,170),r.LIGHT_MAGENTA=s.fromRgb(255,85,255),r.DARK_MAGENTA=s.fromRgb(170,0,170),r.ORANGE=s.fromRgb(255,136,0),e.Colors=r},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.Effect=class{constructor(t,e){this.countdown=t,this.blocking=e}isDone(){return this.countdown<=0}update(){this.countdown--}draw(t){}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});class s{}s.VK_CANCEL=3,s.VK_HELP=6,s.VK_BACK_SPACE=8,s.VK_TAB=9,s.VK_CLEAR=12,s.VK_ENTER=13,s.VK_SHIFT=16,s.VK_CONTROL=17,s.VK_ALT=18,s.VK_PAUSE=19,s.VK_CAPS_LOCK=20,s.VK_ESCAPE=27,s.VK_SPACE=32,s.VK_PAGE_UP=33,s.VK_PAGE_DOWN=34,s.VK_END=35,s.VK_HOME=36,s.VK_LEFT=37,s.VK_UP=38,s.VK_RIGHT=39,s.VK_DOWN=40,s.VK_PRINTSCREEN=44,s.VK_INSERT=45,s.VK_DELETE=46,s.VK_0=48,s.VK_1=49,s.VK_2=50,s.VK_3=51,s.VK_4=52,s.VK_5=53,s.VK_6=54,s.VK_7=55,s.VK_8=56,s.VK_9=57,s.VK_COLON=58,s.VK_SEMICOLON=59,s.VK_LESS_THAN=60,s.VK_EQUALS=61,s.VK_GREATER_THAN=62,s.VK_QUESTION_MARK=63,s.VK_AT=64,s.VK_A=65,s.VK_B=66,s.VK_C=67,s.VK_D=68,s.VK_E=69,s.VK_F=70,s.VK_G=71,s.VK_H=72,s.VK_I=73,s.VK_J=74,s.VK_K=75,s.VK_L=76,s.VK_M=77,s.VK_N=78,s.VK_O=79,s.VK_P=80,s.VK_Q=81,s.VK_R=82,s.VK_S=83,s.VK_T=84,s.VK_U=85,s.VK_V=86,s.VK_W=87,s.VK_X=88,s.VK_Y=89,s.VK_Z=90,s.VK_CONTEXT_MENU=93,s.VK_NUMPAD0=96,s.VK_NUMPAD1=97,s.VK_NUMPAD2=98,s.VK_NUMPAD3=99,s.VK_NUMPAD4=100,s.VK_NUMPAD5=101,s.VK_NUMPAD6=102,s.VK_NUMPAD7=103,s.VK_NUMPAD8=104,s.VK_NUMPAD9=105,s.VK_MULTIPLY=106,s.VK_ADD=107,s.VK_SEPARATOR=108,s.VK_SUBTRACT=109,s.VK_DECIMAL=110,s.VK_DIVIDE=111,s.VK_F1=112,s.VK_F2=113,s.VK_F3=114,s.VK_F4=115,s.VK_F5=116,s.VK_F6=117,s.VK_F7=118,s.VK_F8=119,s.VK_F9=120,s.VK_F10=121,s.VK_F11=122,s.VK_F12=123,s.VK_F13=124,s.VK_F14=125,s.VK_F15=126,s.VK_F16=127,s.VK_F17=128,s.VK_F18=129,s.VK_F19=130,s.VK_F20=131,s.VK_F21=132,s.VK_F22=133,s.VK_F23=134,s.VK_F24=135,s.VK_NUM_LOCK=144,s.VK_SCROLL_LOCK=145,s.VK_CIRCUMFLEX=160,s.VK_EXCLAMATION=161,s.VK_DOUBLE_QUOTE=162,s.VK_HASH=163,s.VK_DOLLAR=164,s.VK_PERCENT=165,s.VK_AMPERSAND=166,s.VK_UNDERSCORE=167,s.VK_OPEN_PAREN=168,s.VK_CLOSE_PAREN=169,s.VK_ASTERISK=170,s.VK_PLUS=171,s.VK_PIPE=172,s.VK_HYPHEN_MINUS=173,s.VK_OPEN_CURLY_BRACKET=174,s.VK_CLOSE_CURLY_BRACKET=175,s.VK_TILDE=176,s.VK_COMMA=188,s.VK_PERIOD=190,s.VK_SLASH=191,s.VK_BACK_QUOTE=192,s.VK_OPEN_BRACKET=219,s.VK_BACK_SLASH=220,s.VK_CLOSE_BRACKET=221,s.VK_QUOTE=222,s.VK_META=224,s.VK_ALTGR=225,s.VK_WIN=91,s.VK_KANA=21,s.VK_HANGUL=21,s.VK_EISU=22,s.VK_JUNJA=23,s.VK_FINAL=24,s.VK_HANJA=25,s.VK_KANJI=25,s.VK_CONVERT=28,s.VK_NONCONVERT=29,s.VK_ACCEPT=30,s.VK_MODECHANGE=31,s.VK_SELECT=41,s.VK_PRINT=42,s.VK_EXECUTE=43,s.VK_SLEEP=95,e.Keys=s},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(2);e.Dialog=class extends s.Panel{constructor(t){super(t),this.closeButton=!1}drawContents(){this.gui&&this.gui.renderer.draw(this.gui.app,this)}handleInput(){return!1}close(){this.gui&&this.gui.remove(this)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(3),r=i(10);e.TalentButton=class extends r.Button{constructor(t,e,i){super(t,e.ability.sprite),this.talent=e,this.shortcut=!!i,this.tooltipMessages=e.ability.tooltipMessages}click(){this.talent.use()}drawContents(){if(super.drawContents(),this.talent.cooldown>0){const t=this.talent.actor.game,e=t.cooldownSprite;if(e){const i=1-this.talent.cooldown/this.talent.ability.cooldown,r=Math.round(i*e.frames),n=e.x+r*e.width,o=e.y,h=this.rect.x+(this.rect.width-e.width)/2|0,a=this.rect.y+(this.rect.height-e.height)/2|0;t.app.drawImage(h,a,n,o,e.width,e.height);const c=this.rect.x+this.rect.width/2|0,l=this.rect.y+this.rect.height/2|0;t.app.drawCenteredString(this.talent.cooldown.toString(),c+1,l-2,s.Colors.BLACK),t.app.drawCenteredString(this.talent.cooldown.toString(),c,l-3,s.Colors.WHITE)}}}}},function(t,e,i){\"use strict\";function s(t,e,i,s){return void 0===s&&(s=255),(t<<24)+(e<<16)+(i<<8)+s}Object.defineProperty(e,\"__esModule\",{value:!0}),e.fromRgb=s,e.fromHsv=function(t,e,i,r){const n=6*t|0,o=6*t-n,h=i*(1-e),a=i*(1-o*e),c=i*(1-(1-o)*e);let l,d,u;switch(n%6){case 0:l=i,d=c,u=h;break;case 1:l=a,d=i,u=h;break;case 2:l=h,d=i,u=c;break;case 3:l=h,d=a,u=i;break;case 4:l=c,d=h,u=i;break;case 5:l=i,d=h,u=a;break;default:l=0,d=0,u=0}return void 0===r&&(r=1),s(255*l|0,255*d|0,255*u|0,255*r|0)}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(10);e.ItemShortcutButton=class extends s.Button{constructor(t,e,i){super(t,i.sprite),this.containerItems=e,this.shortcutItem=i,this.tooltipMessages=i.tooltipMessages}click(){const t=this.getItem();if(t){const e=t.game.player;e&&e.use(t)}}drawContents(){if(this.gui&&(super.drawContents(),!this.isDragging())){const t=this.rect,e=this.countItems();this.gui.app.drawRightString(e.toString(),t.x2-3,t.y2-10)}}getItem(){for(let t=0;t<this.containerItems.length;t++){const e=this.containerItems.get(t);if(e.name===this.shortcutItem.name)return e}}countItems(){let t=0;for(let e=0;e<this.containerItems.length;e++)this.containerItems.get(e).name===this.shortcutItem.name&&t++;return t}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(2);e.Button=class extends s.Panel{constructor(t,e,i,s){super(t),this.sprite=e,this.shortcutKey=i,this.onClick=s}drawContents(){if(!this.gui)return;const t=this.sprite,e=this.rect,i=(e.width-t.width)/2|0,s=(e.height-t.height)/2|0;t.draw(this.gui.app,e.x+i,e.y+s)}handleInput(){if(!this.gui)return!1;const t=this.gui.app,e=t.mouse;return this.rect.contains(e.start)&&e.isDragging()?(this.gui.startDragging(this),!0):this.shortcutKey&&t.isKeyPressed(this.shortcutKey)||this.rect.contains(e)&&e.isClicked()?(this.click(),!0):e.down&&this.rect.contains(e)}click(){this.onClick&&this.onClick()}updateTooltip(t){this.tooltipMessages?(t.messages=this.tooltipMessages,t.visible=!0):t.visible=!1}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(2);e.ButtonSlot=class extends s.Panel{constructor(t,e){super(t),this.shortcutKey=e}get button(){return this.children.length>0?this.children.get(0):void 0}drawContents(){if(!this.gui)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect;e&&this.gui.app.drawImage(t.x,t.y,e.x,e.y,t.width,t.height);const i=this.button;i&&!i.isDragging()&&(i.rect.x=this.rect.x,i.rect.y=this.rect.y,i.rect.width=this.rect.width,i.rect.height=this.rect.height,this.drawChildren()),this.shortcutKey&&this.gui.app.drawRightString(String.fromCharCode(this.shortcutKey),t.x2-3,t.y+3)}handleInput(){if(!this.gui)return!1;if(this.handleChildrenInput())return!0;const t=this.gui.app,e=t.mouse,i=this.button;return i&&(this.shortcutKey&&t.isKeyPressed(this.shortcutKey)||this.rect.contains(e)&&e.isClicked())?(i.click(),!0):e.down&&this.rect.contains(e)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(15),r=i(10);e.ItemButton=class extends r.Button{constructor(t,e,i){super(t,i.sprite),this.containerItems=e,this.stackItems=new s.XArray,this.stackItems.add(i),this.tooltipMessages=i.tooltipMessages}click(){if(this.stackItems.length>0){const t=this.stackItems.get(0),e=t.game.player;e&&e.use(t)}}drawContents(){if(this.gui&&(super.drawContents(),this.stackItems.length>1)){const t=this.rect;this.gui.app.drawRightString(this.stackItems.length.toString(),t.x2-3,t.y2-10)}}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0}),function(t){t[t.SELF=0]=\"SELF\",t[t.ENTITY=1]=\"ENTITY\",t[t.TILE=2]=\"TILE\"}(e.TargetType||(e.TargetType={}))},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(1);e.Entity=class extends s.Vec2{constructor(t,e,i,r,n,o){super(e,i),this.game=t,this.offset=new s.Vec2(0,0),this.name=r,this.sprite=n,this.blocks=o}get pixelX(){return this.x*this.game.tileSize.width+this.offset.x}get pixelY(){return this.y*this.game.tileSize.height+this.offset.y}get centerPixelX(){return this.pixelX+this.sprite.width/2|0}get centerPixelY(){return this.pixelY+this.sprite.height/2|0}distanceTo(t){return Math.hypot(t.x-this.x,t.y-this.y)}distance(t,e){return Math.hypot(t-this.x,e-this.y)}draw(){this.sprite.draw(this.game.app,this.pixelX-this.game.viewport.x,this.pixelY-this.game.viewport.y)}sendToBack(){}onBump(t){}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.XArray=class{constructor(){this.elements=[]}get length(){return this.elements.length}clear(){this.elements.splice(0,this.elements.length)}get(t){return this.elements[t]}add(t){if(this.elements.push(t),this.listeners)for(let e=0;e<this.listeners.length;e++)this.listeners[e].onAdd(this,t)}remove(t){const e=this.elements.indexOf(t);if(e>=0&&(this.elements.splice(e,1),this.listeners))for(let e=0;e<this.listeners.length;e++)this.listeners[e].onRemove(this,t)}contains(t){return this.elements.indexOf(t)>=0}addListener(t){this.listeners||(this.listeners=[]),this.listeners.push(t)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.AI=class{constructor(t){this.actor=t}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.Input=class{constructor(){this.down=!1,this.downCount=0,this.upCount=0}update(){this.down?(this.downCount++,this.upCount=0):(this.downCount=0,this.upCount++)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(13),r=i(3),n=i(19),o=i(20),h=i(21),a=i(14),c=i(15);e.Actor=class extends a.Entity{constructor(t,e,i,s,r,n){super(t,e,i,s,r,n),this.hp=100,this.maxHp=100,this.ap=1,this.maxAp=1,this.inventory=new c.XArray,this.talents=new c.XArray,this.activatedCount=-1,this.seen=!1}move(t,e){const i=this.x+t,s=this.y+e;if(this.game.isBlocked(i,s))return!1;const r=this.game.tileSize.width/4,n=this.game.tileSize.height/4;return this.game.effects.push(new h.SlideEffect(this,t*r,e*n,4)),this.game.blocked=!0,this.ap--,!0}moveToward(t,e){const i=t-this.x,s=e-this.y;if(Math.abs(i)>Math.abs(s)){if(i<0&&this.move(-1,0))return!0;if(i>0&&this.move(1,0))return!0;if(s<0&&this.move(0,-1))return!0;if(s>0&&this.move(0,1))return!0}else{if(s<0&&this.move(0,-1))return!0;if(s>0&&this.move(0,1))return!0;if(i<0&&this.move(-1,0))return!0;if(i>0&&this.move(1,0))return!0}return!1}attack(t,e){t!==this&&(this.onAttack(t,e),t.takeDamage(e),this.ap--,this.game.effects.push(new n.BumpEffect(this,t)),this.game.blocked=!0)}takeHeal(t){this.hp=Math.min(this.hp+t,this.maxHp),this.addFloatingText(t.toString(),r.Colors.LIGHT_GREEN)}takeDamage(t){if(this.hp-=t,this.addFloatingText(t.toString(),r.Colors.RED),this.hp<=0){this.hp=0,this.onDeath&&this.onDeath();const t=this.game.entities.indexOf(this);t>=0&&this.game.entities.splice(t,1)}}pickup(t){t.onPickup(this),this.inventory.add(t);const e=this.game.entities.indexOf(t);e>=0&&this.game.entities.splice(e,1)}use(t){return t.onUse(this)}cast(t,e){t.targetType===s.TargetType.SELF?t.cast(this)&&e&&e():this.game.startTargeting(t,e)}addFloatingText(t,e){this.game.effects.push(new o.FloatingTextEffect(this,t,e))}onAttack(t,e){}onDeath(){}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(4),r=12;e.BumpEffect=class extends s.Effect{constructor(t,e){super(r,!0),this.entity=t,this.dx=e.x-t.x,this.dy=e.y-t.y}update(){const t=r-this.countdown;t>=0&&t<4&&(this.entity.offset.x+=this.dx,this.entity.offset.y+=this.dy),t>=4&&t<8&&(this.entity.offset.x-=this.dx,this.entity.offset.y-=this.dy),super.update()}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(3),r=i(4);e.FloatingTextEffect=class extends r.Effect{constructor(t,e,i){super(40,!1),this.actor=t,this.str=e,this.color=i||s.Colors.WHITE}draw(t){const e=40-this.countdown,i=this.actor.pixelX+(this.actor.sprite.width/2|0)-t.viewport.x,s=this.actor.pixelY-3-t.viewport.y-Math.min(4,Math.floor(e/2));t.app.drawCenteredString(this.str,i,s,this.color)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(4);e.SlideEffect=class extends s.Effect{constructor(t,e,i,s){super(s,!0),this.entity=t,this.dx=e,this.dy=i}update(){this.countdown--,this.countdown>=0&&(this.entity.offset.x+=this.dx,this.entity.offset.y+=this.dy),0===this.countdown&&(this.entity.x+=this.entity.offset.x/this.entity.game.tileSize.width,this.entity.y+=this.entity.offset.y/this.entity.game.tileSize.height,this.entity.offset.x=0,this.entity.offset.y=0)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(17),r=256;e.Keyboard=class{constructor(t){this.keys=new Array(r);for(let t=0;t<r;t++)this.keys[t]=new s.Input;t.addEventListener(\"keydown\",t=>this.setKey(t,!0)),t.addEventListener(\"keyup\",t=>this.setKey(t,!1))}setKey(t,e){t.stopPropagation(),t.preventDefault();const i=t.keyCode;i>=0&&i<r&&(this.keys[i].down=e)}update(){for(let t=0;t<r;t++)this.keys[t].down?this.keys[t].downCount++:this.keys[t].downCount=0}getKey(t){return t>=0&&t<r?this.keys[t]:null}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(17),r=i(0),n=i(1),o=4,h=30;e.Mouse=class extends s.Input{constructor(t){super(),this.app=t,this.prev=new n.Vec2(0,0),this.start=new n.Vec2(0,0),this.x=0,this.y=0,this.dx=0,this.dy=0,this.dragDistance=0,this.longPress=!1;const e=t.canvas,i=this.handleEvent.bind(this);e.addEventListener(\"mousedown\",i),e.addEventListener(\"mouseup\",i),e.addEventListener(\"mousemove\",i),e.addEventListener(\"contextmenu\",i);const s=this.handleTouchEvent.bind(this);e.addEventListener(\"touchstart\",s),e.addEventListener(\"touchend\",s),e.addEventListener(\"touchcancel\",s),e.addEventListener(\"touchmove\",s)}handleTouchEvent(t){if(t.stopPropagation(),t.preventDefault(),t.touches.length>0){const e=t.touches[0];this.updatePosition(e.clientX,e.clientY)}\"touchstart\"===t.type&&(this.down=!0,this.prev.x=this.x,this.prev.y=this.y,this.start.x=this.x,this.start.y=this.y,this.dx=0,this.dy=0,this.dragDistance=0),\"touchend\"===t.type&&(this.down=!1,this.longPress=this.downCount>=h)}handleEvent(t){t.stopPropagation(),t.preventDefault(),this.updatePosition(t.clientX,t.clientY),\"mousedown\"===t.type&&(this.down=!0,this.start.x=this.x,this.start.y=this.y,this.dragDistance=0,this.app.canvas.focus()),\"mouseup\"===t.type&&(this.down=!1,this.longPress=this.downCount>=h)}updatePosition(t,e){let i=this.app.canvas.getBoundingClientRect();const s=this.app.size.width/this.app.size.height,n=i.width/i.height;if(n-s>.01){const t=s*i.height,e=i.width-t;i=new r.Rect(Math.floor(e/2),0,t,i.height)}if(n-s<-.01){const t=i.width/s,e=i.height-t;i=new r.Rect(0,Math.floor(e/2),i.width,t)}this.x=this.app.size.width*(t-i.left)/i.width|0,this.y=this.app.size.height*(e-i.top)/i.height|0}update(){super.update(),this.dx=this.x-this.prev.x,this.dy=this.y-this.prev.y,this.prev.x=this.x,this.prev.y=this.y,this.down&&(this.dragDistance+=Math.abs(this.dx)+Math.abs(this.dy))}isClicked(){return 1===this.upCount&&this.dragDistance<o&&!this.longPress}isDragging(){return this.down&&this.dragDistance>o}isLongPress(){return this.downCount===h&&!this.isDragging()}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});function s(t,e,i){const s=t.createShader(e);return t.shaderSource(s,i),t.compileShader(s),s}e.ExtendedTexture=class extends WebGLTexture{constructor(){super(),this.loaded=!1,this.width=0,this.height=0}},e.initShaderProgram=function(t,e,i){const r=s(t,t.VERTEX_SHADER,e),n=s(t,t.FRAGMENT_SHADER,i),o=t.createProgram();return t.attachShader(o,r),t.attachShader(o,n),t.linkProgram(o),o},e.loadShader=s,e.createTexture=function(t,e){const i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i);const s=t.RGBA,r=t.RGBA,n=t.UNSIGNED_BYTE,o=new Uint8Array([0,0,0,255]);t.texImage2D(t.TEXTURE_2D,0,s,1,1,0,r,n,o);const h=new Image;return h.onload=(()=>{t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,s,r,n,h),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.generateMipmap(t.TEXTURE_2D),i.loaded=!0,i.width=h.width,i.height=h.height}),h.src=e,i}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(26);e.AppState=class{constructor(t){this.app=t,this.gui=new s.GUI(t)}update(){this.gui.handleInput(),this.gui.draw()}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(27),r=i(9),n=i(2),o=i(7),h=i(0),a=i(1);e.GUI=class{constructor(t){this.app=t,this.renderer=new s.DialogRenderer(new h.Rect(0,0,1,1)),this.rootPanel=new n.Panel(t.size),this.rootPanel.gui=this}add(t){this.rootPanel.add(t)}remove(t){this.rootPanel.remove(t)}getPanelAt(t){return this.rootPanel.getPanelAt(t)}handleInput(){return this.dragElement&&this.dragOffset?(this.updateDragging(),!0):this.rootPanel.handleInput()}draw(){this.rootPanel.drawContents(),this.dragElement&&this.dragElement.drawContents()}startDragging(t){const e=this.app.mouse;this.dragElement=t,this.dragOffset=new a.Vec2(e.start.x-t.rect.x,e.start.y-t.rect.y)}updateDragging(){const t=this.app.mouse,e=this.dragElement,i=this.dragOffset;if(t.down)e.rect.x=t.x-i.x,e.rect.y=t.y-i.y;else{const s=this.rootPanel.getPanelAt(t);s&&s.onDrop(e)?(e.rect.x=s.rect.x,e.rect.y=s.rect.y,e.move(s)):e instanceof r.ItemShortcutButton&&s===this.rootPanel?e.parent&&e.parent.remove(e):e instanceof o.TalentButton&&e.shortcut&&s===this.rootPanel?e.parent&&e.parent.remove(e):(e.rect.x=t.start.x-i.x,e.rect.y=t.start.y-i.y),this.dragElement=void 0,this.dragOffset=void 0}}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.DialogRenderer=class{constructor(t,e){this.baseRect=t,this.closeButtonRect=e}draw(t,e){const i=this.baseRect.x,s=this.baseRect.y,r=this.baseRect.width/3|0,n=this.baseRect.height/3|0,o=i+r,h=s+n,a=i+2*r,c=s+2*r,l=e.rect.x,d=e.rect.y,u=e.rect.width-2*r,p=e.rect.height-2*n,g=l+r,f=d+n,y=g+u,x=f+p;if(t.drawImage(l,d,i,s,r,n,void 0,r,n),t.drawImage(g,d,o,s,r,n,void 0,u,n),t.drawImage(y,d,a,s,r,n,void 0,r,n),t.drawImage(l,f,i,h,r,n,void 0,r,p),t.drawImage(g,f,o,h,r,n,void 0,u,p),t.drawImage(y,f,a,h,r,n,void 0,r,p),t.drawImage(l,x,i,c,r,n,void 0,r,n),t.drawImage(g,x,o,c,r,n,void 0,u,n),t.drawImage(y,x,a,c,r,n,void 0,r,n),this.closeButtonRect&&e.closeButton){const i=this.closeButtonRect.width,s=this.closeButtonRect.height,r=e.rect.x2-i,n=e.rect.y,o=this.closeButtonRect.x,h=this.closeButtonRect.y;t.drawImage(r,n,o,h,i,s)}}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=[0,-1,1,0],r=[-1,0,0,1],n=[1,1,1,1];function o(t){let e=null,i=-1,s=1/0;for(let r=0;r<t.length;r++){const n=t[r];n.g!==1/0&&n.g+n.h<s&&(e=n,i=r,s=n.g+n.h)}return t.splice(i,1),e}function h(t){const e=[];let i=t;for(;i;)e.push(i),i=i.prev;return e.reverse(),e}e.computePath=function(t,e,i,a){!function(t,e){for(let i=0;i<t.height;i++)for(let s=0;s<t.width;s++){const r=t.grid[i][s];r.g=1/0,r.h=Math.min(Math.abs(s-e.x),Math.abs(i-e.y)),r.prev=null}}(t,i);const c=t.grid[e.y][e.x];c.g=0;const l=[c];for(;l.length>0;){const e=o(l);if(e.x===i.x&&e.y===i.y)return h(e);for(let i=0;i<s.length;i++){const o=e.x+s[i],h=e.y+r[i];if(o>=0&&o<t.width&&h>=0&&h<t.height){const s=t.grid[h][o],r=e.g+n[i];r<s.g&&r<=a&&!t.grid[h][o].blocked&&(s.g=r,s.prev=e,l.push(s))}}}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.RNG=class{constructor(t){this.m=2147483648,this.a=1103515245,this.c=12345,this.state=t||1}setSeed(t){this.state=t}nextInt(){return this.state=(this.a*this.state+this.c)%this.m,this.state}nextFloat(){return this.nextInt()/(this.m-1)}nextRange(t,e){const i=e-t;return t+(this.nextInt()/this.m*i|0)}chooseIndex(t){const e=t.reduce((t,e)=>t+e),i=this.nextRange(1,e+1);let s=0;for(let e=0;e<t.length;e++)if(i<=(s+=t[e]))return e;return t.length-1}chooseKey(t){const e=[],i=[];for(const s in t)t.hasOwnProperty(s)&&(e.push(s),i.push(t[s]));return e[this.chooseIndex(i)]}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(0),r=30;class n extends s.Rect{constructor(t,e,i,s,n,o,h,a){super(t,e,i,s),this.frames=n||1,this.loop=!!o,this.ticksPerFrame=h||r,this.colorOverride=a,this.animIndex=0,this.animDelay=0}draw(t,e,i,s){let r=this.animIndex;this.loop&&(r=(n.globalAnimIndex/this.ticksPerFrame|0)%this.frames);const o=this.x+r*this.width,h=this.y,a=s||this.colorOverride;t.drawImage(e,i,o,h,this.width,this.height,a),this.animDelay++,this.animDelay>this.ticksPerFrame&&(this.animDelay=0,this.animIndex++,this.animIndex>=this.frames&&(this.loop?this.animIndex=0:this.animIndex=this.frames-1))}static updateGlobalAnimations(){n.globalAnimIndex++}}n.globalAnimIndex=0,e.Sprite=n},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.Message=class{constructor(t,e){this.text=t,this.color=e}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(11),r=i(12),n=i(9),o=i(7);e.ShortcutButtonSlot=class extends s.ButtonSlot{onDrop(t){if(this.children.length>0)return!1;if(t instanceof r.ItemButton){const e=t,i=e.containerItems,s=e.stackItems.get(0);return this.add(new n.ItemShortcutButton(this.rect.clone(),i,s)),!1}return t instanceof o.TalentButton?!!t.shortcut||(this.add(new o.TalentButton(this.rect.clone(),t.talent,!0)),!1):!!(t instanceof n.ItemShortcutButton||t instanceof o.TalentButton&&t.shortcut)}}},function(t,e,i){\"use strict\";function s(t){for(var i in t)e.hasOwnProperty(i)||(e[i]=t[i])}Object.defineProperty(e,\"__esModule\",{value:!0}),s(i(13)),s(i(18)),s(i(16)),s(i(34)),s(i(35)),s(i(36)),s(i(25)),s(i(8)),s(i(3)),s(i(19)),s(i(4)),s(i(39)),s(i(40)),s(i(20)),s(i(41)),s(i(21)),s(i(14)),s(i(42)),s(i(26)),s(i(10)),s(i(11)),s(i(44)),s(i(6)),s(i(27)),s(i(12)),s(i(46)),s(i(9)),s(i(48)),s(i(2)),s(i(49)),s(i(50)),s(i(51)),s(i(52)),s(i(32)),s(i(7)),s(i(53)),s(i(17)),s(i(54)),s(i(22)),s(i(5)),s(i(31)),s(i(23)),s(i(28)),s(i(1)),s(i(0)),s(i(29)),s(i(30)),s(i(55)),s(i(56))},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(16),r=1;e.BasicMonster=class extends s.AI{constructor(t,e){super(t),this.damageFunc=e}doAi(){const t=this.actor,e=t.game.player;if(e)if(t.distanceTo(e)>1)t.moveToward(e.x,e.y);else if(e.hp>0){const i=this.damageFunc?this.damageFunc(t,e):r;t.attack(e,i)}}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(16);e.ConfusedMonster=class extends s.AI{constructor(t){super(t),this.numTurns=10,this.oldAi=t.ai}doAi(){if(this.numTurns>0){const t=this.actor.game.rng;this.actor.move(t.nextRange(-1,2),t.nextRange(-1,2)),this.numTurns--}else this.actor.ai=this.oldAi}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(37),r=i(22),n=i(23),o=i(0),h=i(38),a=i(1),c=400,l=224,d=!1,u=2;e.App=class{constructor(t){const e=t.canvas;if(!e)throw new Error(\"Null or missing canvas element\");const i=e.getContext(\"webgl\",{alpha:!1,antialias:!1});if(!i)throw new Error(\"Could not get WebGL context\");this.canvas=e,this.gl=i,this.size=t.size||new o.Rect(0,0,c,l),this.font=t.font||s.FONT_04B03,this.fillWindow=t.fillWindow||d,this.scaleFactor=t.scaleFactor||u,this.center=new a.Vec2(this.size.width/2|0,this.size.height/2|0),i.disable(i.DEPTH_TEST),i.enable(i.BLEND),i.blendFunc(i.SRC_ALPHA,i.ONE_MINUS_SRC_ALPHA),e.width=this.size.width,e.height=this.size.height,e.style.outline=\"none\",e.tabIndex=0,e.focus(),this.mobile=this.isMobile(),this.renderSet=new h.RenderSet(i,t.imageUrl,this.font),this.keyboard=new r.Keyboard(e),this.mouse=new n.Mouse(this),this.fillWindow&&(window.addEventListener(\"resize\",this.handleResizeEvent.bind(this),!1),this.handleResizeEvent()),this.renderLoop()}handleResizeEvent(){const t=window.innerWidth,e=window.innerHeight,i=this.isMobile(),s=i?320:400,r=i?224:300;this.scaleFactor=1,this.scaleFactor=t>e?Math.max(1,Math.min(Math.round(t/s),Math.round(e/r))):Math.max(1,Math.min(Math.round(t/r),Math.round(e/s))),this.size.width=Math.round(t/this.scaleFactor),this.size.height=Math.round(e/this.scaleFactor),this.center.x=this.size.width/2|0,this.center.y=this.size.height/2|0,this.canvas.width=this.size.width,this.canvas.height=this.size.height,this.canvas.style.left=\"0\",this.canvas.style.top=\"0\",this.canvas.style.width=t+\"px\",this.canvas.style.height=e+\"px\"}isMobile(){return!!navigator.userAgent.match(/Android|iPhone|iPod|IEMobile|WPDesktop|Opera Mini/i)}renderLoop(){this.keyboard.update(),this.mouse.update(),this.resetGl(),this.state&&this.state.update(),this.renderSet.flush(this.size.width,this.size.height),requestAnimationFrame(this.renderLoop.bind(this))}resetGl(){const t=this.gl;t.viewport(0,0,this.size.width,this.size.height),t.clearColor(0,0,0,1),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT),this.renderSet.positionArrayIndex=0,this.renderSet.texcoordArrayIndex=0,this.renderSet.colorArrayIndex=0}drawImage(t,e,i,s,r,n,o,h,a){this.renderSet.drawImage(t,e,i,s,r,n,o,h,a)}drawString(t,e,i,s){this.renderSet.drawString(t,e,i,s)}drawCenteredString(t,e,i,s){this.renderSet.drawCenteredString(t,e,i,s)}drawRightString(t,e,i,s){this.renderSet.drawRightString(t,e,i,s)}isKeyDown(t){const e=this.keyboard.getKey(t);return e&&e.down}isKeyPressed(t){const e=this.keyboard.getKey(t),i=e?e.downCount:0;return 1===i||i>30}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=32,r=126;class n{isInRange(t){return t>=s&&t<=r}getStringWidth(t){let e=0;for(let i=0;i<t.length;i++)e+=this.getWidth(t.charCodeAt(i));return e}}e.Font=n;e.MonospacedFont=class extends n{constructor(t){super(),this.glyphSize=t}getOffset(t){return(t-s)*this.glyphSize.width}getWidth(){return this.glyphSize.width}getHeight(){return this.glyphSize.height}};class o extends n{constructor(t,e){super(),this.height=t,this.widths=e,this.offsets=[0];let i=0;for(let t=0;t<this.widths.length;t++)i+=this.widths[t],this.offsets.push(i)}getOffset(t){return this.offsets[t-s]}getWidth(t){return this.widths[t-s]}getHeight(){return this.height}}e.ProportionalFont=o,e.FONT_04B03=new o(8,[4,2,4,6,5,6,6,2,3,3,4,4,3,4,2,6,5,3,5,5,5,5,5,5,5,5,2,2,4,4,4,5,6,5,5,4,5,4,4,5,5,4,5,5,4,6,5,5,5,5,5,5,4,5,5,6,5,5,4,3,6,3,4,5,3,5,5,4,5,5,4,5,5,2,3,5,2,6,5,5,5,5,4,5,4,5,5,6,4,5,5,4,2,4,5,0])},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(24),r=65536,n=\"uniform vec2 u_viewportSize;attribute vec2 a_position;attribute vec2 a_texCoord;attribute vec4 a_color;varying vec2 v_texCoord;varying vec4 v_color;void main() {vec2 zeroToOne = a_position / u_viewportSize;vec2 zeroToTwo = zeroToOne * 2.0;vec2 clipSpace = zeroToTwo - 1.0;gl_Position = vec4(clipSpace * vec2(1, -1), 0, 1);v_texCoord = a_texCoord;v_color = a_color;}\",o=\"precision highp float;uniform sampler2D u_image;varying vec2 v_texCoord;varying vec4 v_color;void main() {gl_FragColor = texture2D(u_image, v_texCoord);if (gl_FragColor.a < 0.1) discard;if (v_color.a != 0.0) gl_FragColor = v_color;}\";e.RenderSet=class{constructor(t,e,i){this.gl=t,this.font=i;const h=s.initShaderProgram(t,n,o);this.program=h,this.viewportSizeLocation=t.getUniformLocation(h,\"u_viewportSize\"),this.positionLocation=t.getAttribLocation(h,\"a_position\"),this.texcoordLocation=t.getAttribLocation(h,\"a_texCoord\"),this.colorLocation=t.getAttribLocation(h,\"a_color\"),this.positionBuffer=t.createBuffer(),this.texcoordBuffer=t.createBuffer(),this.colorBuffer=t.createBuffer(),this.spriteTexture=s.createTexture(t,e),this.positionArray=new Float32Array(r),this.positionArrayIndex=0,this.texcoordArray=new Float32Array(r),this.texcoordArrayIndex=0,this.colorUint8Array=new Uint8Array(r),this.colorDataView=new DataView(this.colorUint8Array.buffer),this.colorArrayIndex=0}drawCenteredString(t,e,i,s){const r=e-this.font.getStringWidth(t)/2|0;this.drawString(t,r,i,s)}drawRightString(t,e,i,s){const r=e-this.font.getStringWidth(t);this.drawString(t,r,i,s)}drawString(t,e,i,s){const r=t.split(\"\\n\"),n=this.font.getHeight();let o=i;for(let t=0;t<r.length;t++){let i=e;for(let e=0;e<r[t].length;e++){const h=r[t].charCodeAt(e);if(this.font.isInRange(h)){const t=this.font.getOffset(h),e=this.font.getWidth(h);this.drawImage(i,o,t,0,e,n,s),i+=e}}o+=n}}drawChar(t,e,i,s){if(this.font.isInRange(t)){const r=this.font.getOffset(t),n=this.font.getWidth(t),o=this.font.getHeight();this.drawImage(e,i,r,0,n,o,s)}}drawImage(t,e,i,s,r,n,o,h,a){const c=this.spriteTexture;if(!c.loaded)return;const l=void 0!==h?h:r,d=void 0!==a?a:n,u=t+Math.abs(l),p=e+d,g=i/c.width,f=s/c.height,y=(i+r)/c.width,x=(s+n)/c.height,m=o||0;this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=p,this.texcoordArray[this.texcoordArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=f,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=f,this.texcoordArray[this.texcoordArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=x,this.positionArray[this.positionArrayIndex++]=t,this.positionArray[this.positionArrayIndex++]=p,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=e,this.positionArray[this.positionArrayIndex++]=u,this.positionArray[this.positionArrayIndex++]=p,this.texcoordArray[this.texcoordArrayIndex++]=g,this.texcoordArray[this.texcoordArrayIndex++]=x,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=f,this.texcoordArray[this.texcoordArrayIndex++]=y,this.texcoordArray[this.texcoordArrayIndex++]=x;for(let t=0;t<6;t++)this.colorDataView.setUint32(this.colorArrayIndex,m,!1),this.colorArrayIndex+=4}flush(t,e){if(!this.spriteTexture.loaded||0===this.positionArrayIndex)return;const i=this.gl;i.useProgram(this.program),i.uniform2f(this.viewportSizeLocation,t,e),i.activeTexture(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,this.spriteTexture);{i.enableVertexAttribArray(this.positionLocation),i.bindBuffer(i.ARRAY_BUFFER,this.positionBuffer),i.bufferData(i.ARRAY_BUFFER,this.positionArray,i.DYNAMIC_DRAW);const t=2,e=i.FLOAT,s=!1,r=0,n=0;i.vertexAttribPointer(this.positionLocation,t,e,s,r,n)}{i.enableVertexAttribArray(this.texcoordLocation),i.bindBuffer(i.ARRAY_BUFFER,this.texcoordBuffer),i.bufferData(i.ARRAY_BUFFER,this.texcoordArray,i.DYNAMIC_DRAW);const t=2,e=i.FLOAT,s=!1,r=0,n=0;i.vertexAttribPointer(this.texcoordLocation,t,e,s,r,n)}{i.enableVertexAttribArray(this.colorLocation),i.bindBuffer(i.ARRAY_BUFFER,this.colorBuffer),i.bufferData(i.ARRAY_BUFFER,this.colorUint8Array,i.DYNAMIC_DRAW);const t=4,e=i.UNSIGNED_BYTE,s=!0,r=0,n=0;i.vertexAttribPointer(this.colorLocation,t,e,s,r,n)}const s=i.TRIANGLES,r=this.positionArrayIndex/2;i.drawArrays(s,0,r)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(8),r=i(4);e.FadeInEffect=class extends r.Effect{constructor(t){super(t,!0),this.duration=t}draw(t){const e=t.blackoutRect;if(!e)return;const i=this.countdown/this.duration,r=Math.max(1,Math.min(255,255*i|0)),n=s.fromRgb(0,0,0,r);t.app.drawImage(0,0,e.x,e.y,e.width,e.height,n,t.app.size.width,t.app.size.height)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(8),r=i(4);e.FadeOutEffect=class extends r.Effect{constructor(t){super(t,!0),this.duration=t}draw(t){const e=t.blackoutRect;if(!e)return;const i=1-this.countdown/this.duration,r=Math.max(1,Math.min(255,255*i|0)),n=s.fromRgb(0,0,0,r);t.app.drawImage(0,0,e.x,e.y,e.width,e.height,n,t.app.size.width,t.app.size.height)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(4);e.ProjectileEffect=class extends s.Effect{constructor(t,e,i,s){super(s,!0),this.sprite=t,this.position=e,this.velocity=i,this.duration=s}update(){super.update(),this.position.add(this.velocity)}draw(t){const e=this.position.x-t.viewport.x,i=this.position.y-t.viewport.y;this.sprite.draw(t.app,e,i)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(13),r=i(18),n=i(25),o=i(3),h=i(43),a=i(5),c=i(28),l=i(0),d=i(29),u=i(30),p=i(1),g=16,f=16,y=13,x=[a.Keys.VK_UP,a.Keys.VK_NUMPAD8,a.Keys.VK_K,a.Keys.VK_W,a.Keys.VK_Z],m=[a.Keys.VK_LEFT,a.Keys.VK_NUMPAD4,a.Keys.VK_H,a.Keys.VK_A,a.Keys.VK_Q],_=[a.Keys.VK_DOWN,a.Keys.VK_NUMPAD2,a.Keys.VK_J,a.Keys.VK_S],w=[a.Keys.VK_RIGHT,a.Keys.VK_NUMPAD6,a.Keys.VK_L,a.Keys.VK_D],v=[a.Keys.VK_SPACE,a.Keys.VK_NUMPAD5];e.Game=class extends n.AppState{constructor(t,e){super(t),this.tileSize=e.tileSize||new l.Rect(0,0,g,f),this.viewport=new l.Rect(0,0,t.size.width,t.size.height),this.viewportFocus=new p.Vec2(0,0),this.effects=[],this.entities=[],this.turnIndex=0,this.blocked=!1,this.cursor=new p.Vec2(-1,-1),this.tooltip=new h.TooltipDialog,this.rng=new d.RNG,this.pathIndex=0,this.viewDistance=e.viewDistance||y}log(t,e){this.messageLog&&this.messageLog.add(t,e)}update(){u.Sprite.updateGlobalAnimations(),this.updateTooltip(),this.gui.handleInput()||(this.updateEffects(),this.updateEntities(),this.onUpdate&&this.onUpdate(),this.updateViewport()),this.drawTileMap(),this.drawTargeting(),this.drawEntities(),this.drawEffects(),this.gui.draw()}updateTooltip(){if(this.gui.dragElement)return void(this.tooltip.visible=!1);this.tooltip.visible||(this.tooltipElement=void 0);const t=this.app.mouse,e=t.isLongPress();if(!t.down&&(0!==t.dx||0!==t.dy)||e){const i=this.gui.getPanelAt(t);this.tooltipElement!==i&&(this.tooltipElement=i,i&&(i.updateTooltip(this.tooltip),e&&window.navigator.vibrate(100))),this.tooltip.visible&&(this.tooltip.gui||this.gui.add(this.tooltip),this.tooltip.showAt(t.x,t.y),this.tooltip.modal=this.app.mobile)}}updateEffects(){this.blocked=!1;for(let t=0;t<this.effects.length;t++){const e=this.effects[t];e.blocking&&this.blocked||(e.update(),e.blocking&&(this.blocked=!0))}for(let t=this.effects.length-1;t>=0;t--)if(this.effects[t].isDone()){const e=this.effects[t];e.onDone&&e.onDone(),this.effects.splice(t,1)}}updateEntities(){let t=0;for(;!(this.turnIndex<0||this.turnIndex>=this.entities.length||t>2*this.entities.length);){const e=this.entities[this.turnIndex];if(e instanceof r.Actor){if(e.ap>0){if(e===this.player){this.handlePlayerInput();break}this.doAi(e)}!this.blocked&&e.ap<=0&&(e.ap=0,this.nextTurn())}else this.nextTurn();if(this.blocked)break;t++}}resetViewport(){this.player&&(this.viewportFocus.x=this.player.centerPixelX,this.viewportFocus.y=this.player.centerPixelY,this.viewport.x=this.viewportFocus.x-(this.app.size.width/2|0),this.viewport.y=this.viewportFocus.y-(this.app.size.height/2|0))}updateViewport(){this.viewport.width=this.app.size.width,this.viewport.height=this.app.size.height;const t=this.app.mouse;if(t.isDragging())this.viewport.x-=t.dx,this.viewport.y-=t.dy,this.viewportFocus.x=this.viewport.x+(this.viewport.width/2|0),this.viewportFocus.y=this.viewport.y+(this.viewport.height/2|0);else{const t=this.viewportFocus.x-(this.app.size.width/2|0);if(t!==this.viewport.x){let e=.1*t-.1*this.viewport.x;e=e<0?Math.floor(e):Math.ceil(e),this.viewport.x+=e}const e=this.viewportFocus.y-(this.app.size.height/2|0);if(e!==this.viewport.y){let t=.1*e-.1*this.viewport.y;t=t<0?Math.floor(t):Math.ceil(t),this.viewport.y+=t}}}drawTileMap(){this.app.renderSet.spriteTexture.loaded&&this.tileMap&&this.tileMap.draw(this.viewport.x,this.viewport.y,this.viewport.width,this.viewport.height)}drawTargeting(){if(this.isTargeting()&&this.targetSprite){const t=this.cursor.x*this.tileSize.width-this.viewport.x,e=this.cursor.y*this.tileSize.height-this.viewport.y;this.targetSprite.draw(this.app,t,e)}}drawEntities(){for(let t=0;t<this.entities.length;t++){const e=this.entities[t];this.tileMap&&!this.tileMap.isVisible(e.x,e.y)||e.draw()}}drawEffects(){let t=0;for(let e=0;e<this.effects.length;e++){const i=this.effects[e];0!==t&&i.blocking||i.draw(this),i.blocking&&t++}}isTargeting(){return!!this.targetAbility}startTargeting(t,e){this.targetAbility=t,this.targetCallback=e,this.player&&(this.cursor.x=this.player.x,this.cursor.y=this.player.y)}endTargeting(){if(this.player&&this.targetAbility){const t=this.targetAbility.targetType;let e=null;t===s.TargetType.ENTITY?e=this.getActorAt(this.cursor.x,this.cursor.y):t===s.TargetType.TILE&&this.tileMap&&(e=this.tileMap.getCell(this.cursor.x,this.cursor.y)),e&&this.targetAbility.cast(this.player,e)&&this.targetCallback&&this.targetCallback()}this.cancelTargeting()}cancelTargeting(){this.targetAbility=void 0,this.targetCallback=void 0}handlePlayerInput(){if(!this.player||this.blocked)return;if(this.player.ai)return this.player.ai.doAi(),void(this.player.ap=0);const t=this.app.mouse;if((t.down||0!==t.dx||0!==t.dy)&&(this.cursor.x=(this.viewport.x+t.x)/this.tileSize.width|0,this.cursor.y=(this.viewport.y+t.y)/this.tileSize.height|0),this.app.isKeyDown(a.Keys.VK_SHIFT))return this.isKeyPressed(x)&&(this.viewportFocus.y-=2*this.tileSize.height),this.isKeyPressed(m)&&(this.viewportFocus.x-=2*this.tileSize.width),this.isKeyPressed(w)&&(this.viewportFocus.x+=2*this.tileSize.width),void(this.isKeyPressed(_)&&(this.viewportFocus.y+=2*this.tileSize.height));if(this.isTargeting())return(this.app.isKeyPressed(a.Keys.VK_ENTER)||this.app.mouse.isClicked())&&this.endTargeting(),this.app.isKeyPressed(a.Keys.VK_ESCAPE)&&this.cancelTargeting(),this.isKeyPressed(x)&&this.cursor.y--,this.isKeyPressed(m)&&this.cursor.x--,this.isKeyPressed(w)&&this.cursor.x++,void(this.isKeyPressed(_)&&this.cursor.y++);if(t.isClicked()){const e=(this.viewport.x+t.x)/this.tileSize.width|0,i=(this.viewport.y+t.y)/this.tileSize.height|0;if(this.tileMap){const t=this.tileMap.getCell(e,i);t&&t!==this.targetTile&&(this.targetTile=t,this.path=c.computePath(this.tileMap,this.player,this.targetTile,100),this.pathIndex=0)}}let e=null;if(this.path){for(e=this.path[this.pathIndex];e&&e.x===this.player.x&&e.y===this.player.y;)this.pathIndex++,e=this.pathIndex<this.path.length?this.path[this.pathIndex]:null;e||this.stopAutoWalk()}const i=this.isKeyPressed(_)||e&&e.y>this.player.y,s=this.isKeyPressed(m)||e&&e.x<this.player.x,r=this.isKeyPressed(w)||e&&e.x>this.player.x,n=this.isKeyPressed(x)||e&&e.y<this.player.y,o=this.isKeyPressed(v);n&&this.tryMoveOrAttack(0,-1),s&&this.tryMoveOrAttack(-1,0),r&&this.tryMoveOrAttack(1,0),i&&this.tryMoveOrAttack(0,1),o&&(this.player.ap=0)}isKeyPressed(t){for(let e=0;e<t.length;e++)if(this.app.isKeyPressed(t[e]))return!0;return!1}tryMoveOrAttack(t,e){const i=this.player;if(!i)return;const s=i.x+t,r=i.y+e;for(let t=0;t<this.entities.length;t++){const e=this.entities[t];if(i!==e&&e.x===s&&e.y===r)return i.onBump&&i.onBump(e),this.stopAutoWalk(),!0}return i.move(t,e)}recalculateViewportFocus(){const t=this.player;if(!t)return;let e=t.pixelX,i=t.pixelY,s=e+t.sprite.width,n=i+t.sprite.height;if(this.path)for(let t=this.pathIndex;t<this.path.length;t++){const r=this.path[t];e=Math.min(e,r.x*this.tileSize.width),i=Math.min(i,r.y*this.tileSize.height),s=Math.max(s,(r.x+1)*this.tileSize.width),n=Math.max(n,(r.y+1)*this.tileSize.height)}else for(let t=0;t<this.entities.length;t++){const o=this.entities[t];o instanceof r.Actor&&this.tileMap&&this.tileMap.isVisible(o.x,o.y)&&(e=Math.min(e,o.pixelX),i=Math.min(i,o.pixelY),s=Math.max(s,o.pixelX+o.sprite.width),n=Math.max(n,o.pixelY+o.sprite.height))}this.viewportFocus.x=Math.round((e+s)/2),this.viewportFocus.y=Math.round((i+n)/2)}doAi(t){t.ai&&(!this.tileMap||this.tileMap.isVisible(t.x,t.y)&&t.activatedCount>0)&&t.ai.doAi(),t.ap=0}nextTurn(){if(this.player&&this.entities[this.turnIndex]===this.player&&(this.player&&this.tileMap&&(this.recomputeFov(),this.recalculateViewportFocus()),this.entities.sort((t,e)=>this.player?Math.hypot(t.x-this.player.x,t.y-this.player.y)-Math.hypot(e.x-this.player.x,e.y-this.player.y):0)),this.turnIndex++,this.turnIndex>=this.entities.length){this.turnIndex=0;for(let t=0;t<this.entities.length;t++){const e=this.entities[t];if(e instanceof r.Actor){e.ap=e.maxAp;for(let t=0;t<e.talents.length;t++){const i=e.talents.get(t);i.cooldown>0&&i.cooldown--}}}}}stopAutoWalk(){this.path=void 0,this.targetTile=void 0}isBlocked(t,e){if(this.tileMap&&this.tileMap.isBlocked(t,e))return!0;for(let i=0;i<this.entities.length;i++){const s=this.entities[i];if(s.blocks&&s.x===t&&s.y===e)return!0}return!1}getEntityAt(t,e){for(let i=0;i<this.entities.length;i++){const s=this.entities[i];if(s.x===t&&s.y===e)return s}}getActorAt(t,e){for(let i=0;i<this.entities.length;i++){const s=this.entities[i];if(s instanceof r.Actor&&s.x===t&&s.y===e)return s}}recomputeFov(){if(this.player&&this.tileMap){this.tileMap.computeFov(this.player.x,this.player.y,this.viewDistance);for(let t=0;t<this.entities.length;t++){const e=this.entities[t];e!==this.player&&e instanceof r.Actor&&(this.tileMap.isVisible(e.x,e.y)?(e.seen||(e.seen=!0,this.player.addFloatingText(\"!\",o.Colors.WHITE),this.stopAutoWalk(),this.viewportFocus.x=(this.player.centerPixelX+e.centerPixelX)/2|0,this.viewportFocus.y=(this.player.centerPixelY+e.centerPixelY)/2|0),e.activatedCount++):e.activatedCount=-1)}}}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(0),r=i(6),n=100,o=5,h=2;e.TooltipDialog=class extends r.Dialog{constructor(){super(new s.Rect(0,0,n,10)),this.messages=[],this.visible=!1}showAt(t,e){if(!this.gui)return;const i=this.gui.app,s=i.font,r=s.getHeight()+h;this.rect.width=2*o,this.rect.height=2*o+this.messages.length*r;for(let t=0;t<this.messages.length;t++){const e=this.messages[t],i=2*o+s.getStringWidth(e.text);this.rect.width=Math.max(this.rect.width,i)}t+this.rect.width>=i.size.width?this.rect.x=t-this.rect.width-2:this.rect.x=t+2,e-this.rect.height<0?this.rect.y=e+2:this.rect.y=e-this.rect.height-2,this.rect.x<0&&(this.rect.x=0),this.rect.y<0&&(this.rect.y=0),this.visible=!0}drawContents(){if(!this.gui)return;super.drawContents();const t=this.gui.app.font.getHeight()+h,e=this.rect.x+o;let i=this.rect.y+o;for(let s=0;s<this.messages.length;s++){const r=this.messages[s];this.gui.app.drawString(r.text,e,i,r.color),i+=t}}handleInput(){return!!this.gui&&(this.gui.app.mouse.isClicked()&&(this.visible=!1),!1)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(5),r=i(1),n=i(45),o=i(6),h=4;e.ComplexSelectDialog=class extends o.Dialog{constructor(t,e){super(t),this.options=e,this.selectedIndex=0,this.renderer=new n.DefaultSelectOptionRenderer}drawContents(){if(!this.gui)return;super.drawContents();const t=this.rect,e=new r.Vec2(t.x+h,t.y+h);for(let t=0;t<this.options.length;t++){const i=this.options[t],s=t===this.selectedIndex;this.renderer.drawOption(this.gui,e,i,s),e.y+=this.renderer.getHeight(i,s)}}handleInput(){if(!this.gui)return!1;const t=this.gui.app;for(let e=0;e<this.options.length;e++)t.isKeyPressed(s.Keys.VK_A+e)&&(this.selectedIndex=e,this.onSelect&&this.onSelect(this.options[e]));t.isKeyPressed(s.Keys.VK_ENTER)&&this.onSelect&&this.onSelect(this.options[this.selectedIndex]),t.isKeyPressed(s.Keys.VK_ESCAPE)&&this.onCancel&&this.onCancel(),t.isKeyPressed(s.Keys.VK_UP)&&this.selectedIndex--,t.isKeyPressed(s.Keys.VK_DOWN)&&this.selectedIndex++,this.selectedIndex<0&&(this.selectedIndex+=this.options.length),this.selectedIndex>=this.options.length&&(this.selectedIndex-=this.options.length);const e=t.mouse,i=this.rect;let r=i.y+h;if(1===e.upCount&&e.x>=i.x1&&e.x<i.x2)for(let t=0;t<this.options.length;t++){const i=this.options[t],s=t===this.selectedIndex,n=this.renderer.getHeight(i,s),o=r,h=r+n;e.y>=o&&e.y<h&&(s?this.onSelect&&this.onSelect(i):this.selectedIndex=t),r+=n}return!0}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(3);e.DefaultSelectOptionRenderer=class{getHeight(t,e){return 10}drawOption(t,e,i,r){const n=r?s.Colors.YELLOW:s.Colors.WHITE;t.app.drawString(i.name,e.x,e.y,n)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(5),r=i(0),n=i(6),o=i(12),h=i(47),a=4,c=2;e.ItemContainerDialog=class extends n.Dialog{constructor(t,e,i,n){super(t),this.messages=e,this.capacity=i,this.items=n,this.modal=!0,n.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)});for(let t=0;t<i;t++)this.add(new h.ItemContainerButtonSlot(new r.Rect(0,0,24,24),n,s.Keys.VK_A+t))}addItem(t){const e=this.getExistingButton(t);if(e)return void e.stackItems.add(t);const i=this.getNextFreeSlot();i&&i.add(new o.ItemButton(i.rect.clone(),this.items,t))}removeItem(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e),s=i.button;s&&s instanceof o.ItemButton&&s.stackItems.contains(t)&&(s.stackItems.remove(t),0===s.stackItems.length&&i.remove(s))}}getExistingButton(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e).button;if(i&&i instanceof o.ItemButton&&i.stackItems.get(0).name===t.name)return i}}getNextFreeSlot(){for(let t=0;t<this.children.length;t++){const e=this.children.get(t);if(!e.button)return e}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect;let i=t.x+a,s=t.y+a;for(let t=0;t<this.messages.length;t++){const e=this.messages[t];this.gui.app.drawString(e.text,i,s,e.color),s+=10}for(let r=0;r<this.capacity;r++){const n=this.children.get(r);n.rect.x=i,n.rect.y=s,n.rect.width=e.width,n.rect.height=e.height,(i+=e.width+c)>t.x2-e.width-a&&(i=t.x+a,s+=e.height+c)}this.rect.height=s+a-t.y,this.drawChildren()}handleInput(){return!(!this.gui||!this.handleChildrenInput()&&(!this.gui.app.isKeyPressed(s.Keys.VK_ESCAPE)||(this.visible=!1,0)))}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(11),r=i(12);e.ItemContainerButtonSlot=class extends s.ButtonSlot{constructor(t,e,i){super(t,i),this.items=e}onDrop(t){return t instanceof r.ItemButton}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(2);e.ImagePanel=class extends s.Panel{constructor(t,e){super(e),this.srcRect=t}drawContents(){if(!this.gui)return;const t=this.srcRect,e=this.rect;this.gui.app.drawImage(e.x,e.y,t.x,t.y,e.width,e.height)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(3),r=i(31),n=i(2);e.MessageLog=class extends n.Panel{constructor(t,e){super(t),this.messages=[],this.maxItems=e||5}add(t,e){t instanceof n.Panel||(this.messages.push(new r.Message(t,e||s.Colors.WHITE)),this.messages.length>this.maxItems&&this.messages.splice(0,this.messages.length-this.maxItems))}drawContents(){if(!this.gui)return;const t=this.rect.x;let e=this.rect.y;e<0&&(e=this.gui.app.size.height+e+this.rect.height-10*this.messages.length);for(let i=0;i<this.messages.length;i++){const s=this.messages[i];this.gui.app.drawString(s.text,t,e,s.color),e+=10}}handleInput(){return!1}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(2);e.MessagePanel=class extends s.Panel{constructor(t,e){super(t),this.message=e}drawContents(){if(!this.gui)return;const t=this.message,e=this.rect;this.gui.app.drawString(t.text,e.x,e.y,t.color)}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(5),r=i(6),n=4,o=10;e.SelectDialog=class extends r.Dialog{constructor(t,e,i){super(t),this.options=e,this.callback=i}drawContents(){if(!this.gui)return;super.drawContents();const t=this.rect;for(let e=0;e<this.options.length;e++){const i=String.fromCharCode(65+e)+\" - \"+this.options[e].name;this.gui.app.drawString(i,t.x+n,t.y+n+e*o)}}handleInput(){if(!this.gui)return!1;for(let t=0;t<this.options.length;t++)if(this.gui.app.isKeyPressed(s.Keys.VK_A+t))return this.callback(this.options[t]),this.close(),!0;if(this.gui.app.isKeyPressed(s.Keys.VK_ESCAPE))return this.close(),!0;const t=this.gui.app.mouse,e=this.rect;if(t.isClicked()&&t.x>=e.x1&&t.x<e.x2){if(this.closeButton&&t.x>=e.x2-16&&t.y<e.y+16)return this.close(),!0;for(let i=0;i<this.options.length;i++){const s=e.y+n+i*o,r=s+o;t.y>=s&&t.y<r&&(this.callback(this.options[i]),this.close())}}return!0}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(5),r=i(0),n=i(9),o=i(2),h=i(32),a=i(7);e.ShortcutButtonBar=class extends o.Panel{constructor(t,e){super(t);for(let t=0;t<e;t++){const e=new h.ShortcutButtonSlot(new r.Rect(0,0,24,24),s.Keys.VK_1+t);this.add(e)}}addTalent(t,e){if(this.containsTalent(t))return;const i=this.getFreeSlot(!!e);i&&i.add(new a.TalentButton(i.rect.clone(),t,!0))}containsTalent(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e);if(i.button&&i.button instanceof a.TalentButton&&i.button.talent===t)return!0}return!1}addItem(t,e,i){if(this.containsItem(e))return;const s=this.getFreeSlot(!!i);s&&s.add(new n.ItemShortcutButton(s.rect.clone(),t,e))}containsItem(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e);if(i.button&&i.button instanceof n.ItemShortcutButton&&i.button.shortcutItem.name===t.name)return!0}return!1}drawContents(){if(!this.gui)return;const t=this.gui.renderer.buttonSlotRect;if(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e);i.rect.x=this.rect.x+1+e*(t.width+2),i.rect.y=this.rect.y+1,i.rect.width=t.width,i.rect.height=t.height}this.drawChildren()}}getFreeSlot(t){if(t)for(let t=this.children.length-1;t>=0;t--){const e=this.children.get(t);if(!e.button)return e}else for(let t=0;t<this.children.length;t++){const e=this.children.get(t);if(!e.button)return e}}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(5),r=i(0),n=i(11),o=i(6),h=i(7),a=4,c=2;e.TalentsDialog=class extends o.Dialog{constructor(t,e,i,o){super(t),this.messages=e,this.capacity=i,this.talents=o,this.modal=!0,o.addListener({onAdd:(t,e)=>this.addItem(e),onRemove:(t,e)=>this.removeItem(e)});for(let t=0;t<i;t++)this.add(new n.ButtonSlot(new r.Rect(0,0,24,24),s.Keys.VK_A+t))}addItem(t){const e=this.getNextFreeSlot();e&&e.add(new h.TalentButton(e.rect.clone(),t))}removeItem(t){for(let e=0;e<this.children.length;e++){const i=this.children.get(e),s=i.button;s&&s instanceof h.TalentButton&&s.talent===t&&i.remove(s)}}getNextFreeSlot(){for(let t=0;t<this.children.length;t++){const e=this.children.get(t);if(!e.button)return e}}drawContents(){if(super.drawContents(),!this.gui||!this.gui.renderer.buttonSlotRect)return;const t=this.rect,e=this.gui.renderer.buttonSlotRect;let i=t.x+a,s=t.y+a;for(let t=0;t<this.messages.length;t++){const e=this.messages[t];this.gui.app.drawString(e.text,i,s,e.color),s+=10}for(let r=0;r<this.capacity;r++){const n=this.children.get(r);n.rect.x=i,n.rect.y=s,n.rect.width=e.width,n.rect.height=e.height,(i+=e.width+c)>t.x2-e.width-a&&(i=t.x+a,s+=e.height+c)}this.rect.height=s+a-t.y,this.drawChildren()}handleInput(){return!(!this.gui||!this.handleChildrenInput()&&(!this.gui.app.isKeyPressed(s.Keys.VK_ESCAPE)||(this.visible=!1,0)))}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(14);e.Item=class extends s.Entity{onPickup(t){}onUse(t){return!1}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});e.Talent=class{constructor(t,e,i){this.actor=t,this.ability=e,this.rank=i||1,this.cooldown=0}use(){return!(this.cooldown>0||(this.actor.cast(this.ability,()=>{this.cooldown=this.ability.cooldown}),0))}}},function(t,e,i){\"use strict\";Object.defineProperty(e,\"__esModule\",{value:!0});const s=i(24),r=i(1),n=\"precision highp float;attribute vec2 position;attribute vec2 texture;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 viewOffset;uniform vec2 viewportSize;uniform vec2 tileSize;uniform vec2 mapSize;void main(void) {   pixelCoord = (texture * viewportSize) + viewOffset;   texCoord = pixelCoord / mapSize / tileSize;   gl_Position = vec4(position, 0.0, 1.0);}\",o=\"precision highp float;varying vec2 pixelCoord;varying vec2 texCoord;uniform vec2 tileSize;uniform sampler2D tiles;uniform sampler2D sprites;void main(void) {   vec4 tile = texture2D(tiles, texCoord);   if(tile.x == 1.0 && tile.y == 1.0) { discard; }   vec2 spriteOffset = floor(tile.xy * 256.0) * tileSize;   vec2 spriteCoord = mod(pixelCoord, tileSize);   gl_FragColor = texture2D(sprites, (spriteOffset + spriteCoord) / 1024.0);   if (gl_FragColor.a == 0.0) discard;   gl_FragColor.a *= tile.a;}\";class h extends r.Vec2{constructor(t,e,i){super(t,e),this.tile=i,this.blocked=!0,this.blockedSight=!0,this.visible=!1,this.seen=!1,this.g=0,this.h=0,this.prev=null}}e.TileMapCell=h;class a{constructor(t,e){this.width=t,this.height=e,this.imageData=new Uint8Array(4*t*e),this.dimensions=new Float32Array([t,e]),this.texture=null,this.clear()}clear(){for(let t=0;t<this.imageData.length;t++)this.imageData[t]=255}setAlpha(t,e,i){this.imageData[4*(e*this.width+t)+3]=i}initGl(t){this.texture=t.createTexture(),t.bindTexture(t.TEXTURE_2D,this.texture),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,this.width,this.height,0,t.RGBA,t.UNSIGNED_BYTE,this.imageData),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE)}updateGl(t){t.texSubImage2D(t.TEXTURE_2D,0,0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.imageData)}}e.TileMapLayer=a;e.TileMap=class{constructor(t,e,i,r){this.gl=t,this.width=e,this.height=i,this.grid=new Array(i),this.layers=new Array(r),this.tileWidth=16,this.tileHeight=16,this.originX=0,this.originY=0,this.minX=0,this.maxX=e-1,this.minY=0,this.maxY=i-1;for(let t=0;t<i;t++){this.grid[t]=new Array(e);for(let i=0;i<e;i++)this.grid[t][i]=new h(i,t,0)}for(let t=0;t<r;t++)this.layers[t]=new a(e,i);this.quadVertBuffer=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,this.quadVertBuffer),t.bufferData(t.ARRAY_BUFFER,new Float32Array([-1,-1,0,1,1,-1,1,1,1,1,1,0,-1,-1,0,1,1,1,1,0,-1,1,0,0]),t.STATIC_DRAW),this.tilemapShader=s.initShaderProgram(t,n,o),this.positionAttribute=t.getAttribLocation(this.tilemapShader,\"position\"),this.textureAttribute=t.getAttribLocation(this.tilemapShader,\"texture\"),this.viewportSizeUniform=t.getUniformLocation(this.tilemapShader,\"viewportSize\"),this.viewOffsetUniform=t.getUniformLocation(this.tilemapShader,\"viewOffset\"),this.mapSizeUniform=t.getUniformLocation(this.tilemapShader,\"mapSize\"),this.tileSizeUniform=t.getUniformLocation(this.tilemapShader,\"tileSize\"),this.tileSamplerUniform=t.getUniformLocation(this.tilemapShader,\"tiles\"),this.spriteSamplerUniform=t.getUniformLocation(this.tilemapShader,\"sprites\");for(let e=0;e<this.layers.length;e++)this.layers[e].initGl(t)}setTile(t,e,i,s,r,n){if(e<0||e>=this.width||i<0||i>=this.height)return;0===t&&(this.grid[i][e].tile=s,this.grid[i][e].blocked=!!r,this.grid[i][e].blockedSight=void 0!==n?n:!!r);const o=this.layers[t],h=4*(i*o.width+e),a=0===s?255:(s-1)%64|0,c=0===s?255:(s-1)/64|0;o.imageData[h+0]=a,o.imageData[h+1]=c}getCell(t,e){return t<0||t>=this.width||e<0||e>=this.height?null:this.grid[e][t]}getTile(t,e){const i=this.getCell(t,e);return i?i.tile:0}isBlocked(t,e){const i=this.getCell(t,e);return!i||i.blocked}isVisible(t,e){return!(t<this.minX||t>this.maxX||e<this.minY||e>this.maxY)&&this.grid[e][t].visible}isSeen(t,e){const i=this.getCell(t,e);return i&&i.seen}setSeen(t,e,i){const s=this.getCell(t,e);s&&(s.seen=i)}draw(t,e,i,s){const r=this.gl;r.enable(r.BLEND),r.blendFunc(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA),r.useProgram(this.tilemapShader),r.bindBuffer(r.ARRAY_BUFFER,this.quadVertBuffer),r.enableVertexAttribArray(this.positionAttribute),r.enableVertexAttribArray(this.textureAttribute),r.vertexAttribPointer(this.positionAttribute,2,r.FLOAT,!1,16,0),r.vertexAttribPointer(this.textureAttribute,2,r.FLOAT,!1,16,8),r.uniform2f(this.viewOffsetUniform,t,e),r.uniform2f(this.viewportSizeUniform,i,s),r.uniform2f(this.tileSizeUniform,this.tileWidth,this.tileHeight),r.activeTexture(r.TEXTURE0),r.uniform1i(this.spriteSamplerUniform,0),r.activeTexture(r.TEXTURE1),r.uniform1i(this.tileSamplerUniform,1);const n=t/this.tileWidth|0,o=e/this.tileHeight|0,h=(t+i)/this.tileWidth|0,a=(e+s)/this.tileHeight|0;for(let t=0;t<this.layers.length;t++){const e=this.layers[t];for(let t=o;t<=a;t++)for(let i=n;i<=h;i++){const s=this.isVisible(i,t)?255:this.isSeen(i,t)?144:0;e.setAlpha(i,t,s)}r.uniform2fv(this.mapSizeUniform,e.dimensions),r.bindTexture(r.TEXTURE_2D,e.texture),e.updateGl(r),r.drawArrays(r.TRIANGLES,0,6)}}resetFov(){for(let t=0;t<this.height;t++)for(let e=0;e<this.width;e++)this.grid[t][e].seen=!1,this.grid[t][e].visible=!1}computeFov(t,e,i){this.originX=t,this.originY=e,this.minX=Math.max(0,t-i),this.minY=Math.max(0,e-i),this.maxX=Math.min(this.width-1,t+i),this.maxY=Math.min(this.height-1,e+i);for(let t=this.minY;t<=this.maxY;t++)for(let e=this.minX;e<=this.maxX;e++)this.grid[t][e].seen=this.grid[t][e].seen||this.grid[t][e].visible,this.grid[t][e].visible=!1;this.grid[e][t].visible=!0,this.computeOctantY(1,1),this.computeOctantX(1,1),this.computeOctantY(1,-1),this.computeOctantX(1,-1),this.computeOctantY(-1,1),this.computeOctantX(-1,1),this.computeOctantY(-1,-1),this.computeOctantX(-1,-1)}computeOctantY(t,e){const i=[],s=[];let r,n,o,h,a,c,l,d,u,p,g=1,f=0,y=0,x=0;for(n=this.originY+e;n>=this.minY&&n<=this.maxY;n+=e,y=f,++g)for(o=.5/g,p=-1,h=Math.floor(x*g+.5),r=this.originX+h*t;h<=g&&r>=this.minX&&r<=this.maxX;r+=t,++h,p=u){if(a=!0,c=!1,d=p,u=(l=h/g)+o,y>0)if(this.grid[n-e][r].visible&&!this.grid[n-e][r].blockedSight||this.grid[n-e][r-t].visible&&!this.grid[n-e][r-t].blockedSight){for(let t=0;t<y&&a;++t)if(d<=s[t]&&u>=i[t])if(this.grid[n][r].blockedSight){if(d>=i[t]&&u<=s[t]){a=!1;break}i[t]=Math.min(i[t],d),s[t]=Math.max(s[t],u),c=!0}else if(l>i[t]&&l<s[t]){a=!1;break}}else a=!1;a&&(this.grid[n][r].visible=!0,this.grid[n][r].blockedSight&&(x>=d?x=u:c||(i[f]=d,s[f++]=u)))}}computeOctantX(t,e){const i=[],s=[];let r,n,o,h,a,c,l,d,u,p,g=1,f=0,y=0,x=0;for(r=this.originX+t;r>=this.minX&&r<=this.maxX;r+=t,y=f,++g)for(o=.5/g,p=-1,h=Math.floor(x*g+.5),n=this.originY+h*e;h<=g&&n>=this.minY&&n<=this.maxY;n+=e,++h,p=u){if(a=!0,c=!1,d=p,u=(l=h/g)+o,y>0)if(this.grid[n][r-t].visible&&!this.grid[n][r-t].blockedSight||this.grid[n-e][r-t].visible&&!this.grid[n-e][r-t].blockedSight){for(let t=0;t<y&&a;++t)if(d<=s[t]&&u>=i[t])if(this.grid[n][r].blockedSight){if(d>=i[t]&&u<=s[t]){a=!1;break}i[t]=Math.min(i[t],d),s[t]=Math.max(s[t],u),c=!0}else if(l>i[t]&&l<s[t]){a=!1;break}}else a=!1;a&&(this.grid[n][r].visible=!0,this.grid[n][r].blockedSight&&(x>=d?x=u:c||(i[f]=d,s[f++]=u)))}}}}])});\n//# sourceMappingURL=index.js.map","import {Ability, Actor, Colors, ConfusedMonster, Message, Sprite, TargetType} from 'wglt';\n\nconst CONFUSE_RANGE = 8;\nconst CONFUSE_SPRITE = new Sprite(128, 32, 16, 24, 3, false);\nconst TOOLTIP_MESSAGES = [\n  new Message('Fireball', Colors.WHITE),\n  new Message('2% of base mana', Colors.WHITE),\n  new Message('2 turn cast', Colors.WHITE),\n  new Message('Throws a fiery ball causing 10 damage', Colors.YELLOW),\n  new Message('to all enemies within 3 tiles.', Colors.YELLOW),\n];\n\nexport class ConfuseAbility implements Ability {\n  readonly sprite: Sprite;\n  readonly name: string;\n  readonly targetType: TargetType;\n  readonly minRange: number;\n  readonly maxRange: number;\n  readonly cooldown: number;\n  readonly tooltipMessages: Message[];\n\n  constructor() {\n    this.sprite = CONFUSE_SPRITE;\n    this.name = 'confuse';\n    this.targetType = TargetType.ENTITY;\n    this.minRange = 1;\n    this.maxRange = CONFUSE_RANGE;\n    this.cooldown = 1;\n    this.tooltipMessages = TOOLTIP_MESSAGES;\n  }\n\n  cast(caster: Actor, target: Actor) {\n    const game = caster.game;\n\n    if (caster.distanceTo(target) > CONFUSE_RANGE) {\n      game.log('Target out of range.', Colors.LIGHT_GRAY);\n      return false;\n    }\n\n    target.ai = new ConfusedMonster(target);\n    game.log('The eyes of the ' + target.name + ' look vacant, as he stumbles around!', Colors.LIGHT_GREEN);\n    caster.ap--;\n    return true;\n  }\n}","import {Ability, Actor, Colors, Message, ProjectileEffect, Sprite, TargetType, TileMapCell, Vec2} from 'wglt';\n\nimport {ExplosionEffect} from '../effects/explosioneffect';\n\nconst FIREBALL_RANGE = 10;\nconst FIREBALL_RADIUS = 3;\nconst FIREBALL_DAMAGE = 12;\n\nconst SPRITE_WIDTH = 16;\nconst SPRITE_HEIGHT = 24;\nconst FIRE_COLOR = Colors.ORANGE;\nconst FIREBALL_SPRITE = new Sprite(512, 336, SPRITE_WIDTH, SPRITE_HEIGHT, undefined, undefined, undefined, FIRE_COLOR);\nconst TOOLTIP_MESSAGES = [\n  new Message('Fireball', Colors.WHITE),\n  new Message('2% of base mana', Colors.WHITE),\n  new Message('2 turn cast', Colors.WHITE),\n  new Message('Throws a fiery ball causing 10 damage', Colors.YELLOW),\n  new Message('to all enemies within 3 tiles.', Colors.YELLOW),\n];\n\nexport class FireballAbility implements Ability {\n  readonly sprite: Sprite;\n  readonly name: string;\n  readonly targetType: TargetType;\n  readonly minRange: number;\n  readonly maxRange: number;\n  readonly cooldown: number;\n  readonly tooltipMessages: Message[];\n\n  constructor() {\n    this.sprite = FIREBALL_SPRITE;\n    this.name = 'fireball';\n    this.targetType = TargetType.TILE;\n    this.minRange = 1;\n    this.maxRange = FIREBALL_RANGE;\n    this.cooldown = 50;\n    this.tooltipMessages = TOOLTIP_MESSAGES;\n  }\n\n  cast(caster: Actor, target: TileMapCell) {\n    const game = caster.game;\n    const player = caster;\n    const distance = player.distanceTo(target);\n    if (distance > FIREBALL_RANGE) {\n      game.log('Target out of range.', Colors.LIGHT_GRAY);\n      return false;\n    }\n\n    const speed = 8;\n    const count = distance * (game.tileSize.width / speed);\n    const dx = (target.x * game.tileSize.width - player.pixelX) / count;\n    const dy = (target.y * game.tileSize.height - player.pixelY) / count;\n\n    game.effects.push(\n        new ProjectileEffect(FIREBALL_SPRITE, new Vec2(player.pixelX, player.pixelY), new Vec2(dx, dy), count));\n\n    const explosionEffect = new ExplosionEffect(game, target, FIREBALL_RADIUS, 30);\n    explosionEffect.onDone = () => {\n      game.log('The fireball explodes, burning everything within ' + FIREBALL_RADIUS + ' tiles!', Colors.ORANGE);\n\n      for (let i = game.entities.length - 1; i >= 0; i--) {\n        const entity = game.entities[i];\n        if (entity instanceof Actor && entity.distanceTo(target) <= FIREBALL_RADIUS) {\n          game.log('The ' + entity.name + ' gets burned for ' + FIREBALL_DAMAGE + ' hit points.', Colors.ORANGE);\n          entity.takeDamage(FIREBALL_DAMAGE);\n        }\n      }\n\n      caster.ap--;\n    };\n\n    game.effects.push(explosionEffect);\n    return true;\n  }\n}","import {Ability, Actor, Colors, fromRgb, Message, SlideEffect, Sprite, TargetType, TileMapCell} from 'wglt';\nimport {Stunned} from '../ai/stunned';\n\nconst LEAP_RANGE = 3;\nconst LEAP_RADIUS = 2;\nconst LEAP_COLOR = fromRgb(0xFF, 0x80, 0x80);\nconst LEAP_SPRITE = new Sprite(722, 336, 16, 24, undefined, undefined, undefined, LEAP_COLOR);\nconst TOOLTIP_MESSAGES = [\n  new Message('Heroic Leap', Colors.WHITE), new Message('Instant cast', Colors.WHITE),\n  new Message('Stun all enemies within 1 tile.', Colors.YELLOW)\n];\n\nexport class LeapAbility implements Ability {\n  readonly sprite: Sprite;\n  readonly name: string;\n  readonly targetType: TargetType;\n  readonly minRange: number;\n  readonly maxRange: number;\n  readonly cooldown: number;\n  readonly tooltipMessages: Message[];\n\n  constructor() {\n    this.sprite = LEAP_SPRITE;\n    this.name = 'leap';\n    this.targetType = TargetType.TILE;\n    this.minRange = 1;\n    this.maxRange = LEAP_RANGE;\n    this.cooldown = 10;\n    this.tooltipMessages = TOOLTIP_MESSAGES;\n  }\n\n  cast(caster: Actor, target: TileMapCell) {\n    const game = caster.game;\n    const distance = caster.distanceTo(target);\n    if (distance > LEAP_RANGE) {\n      if (caster === game.player) {\n        game.log('Target out of range.', Colors.LIGHT_GRAY);\n      }\n      return false;\n    }\n\n    const existing = game.getActorAt(target.x, target.y);\n    if (existing) {\n      if (caster === game.player) {\n        game.log('Target is occupied.', Colors.LIGHT_GRAY);\n      }\n      return false;\n    }\n\n    const count = 4;\n    const xSpeed = (target.x - caster.x) * game.tileSize.width / count;\n    const ySpeed = (target.y - caster.y) * game.tileSize.height / count;\n    const slideEffect = new SlideEffect(caster, xSpeed, ySpeed, count);\n    slideEffect.onDone = () => {\n      let count = 0;\n      for (let i = game.entities.length - 1; i >= 0; i--) {\n        const entity = game.entities[i];\n        if (entity === caster) {\n          continue;\n        }\n        if (entity instanceof Actor && entity.distanceTo(target) < LEAP_RADIUS) {\n          entity.ai = new Stunned(entity, 3);\n          count++;\n        }\n      }\n\n      if (count > 0) {\n        game.log('Stunned ' + count + ' foes!', LEAP_COLOR);\n      }\n      caster.ap--;\n    };\n\n    game.effects.push(slideEffect);\n    return true;\n  }\n}\n","import {Ability, Actor, Colors, Entity, Game, Message, ProjectileEffect, Sprite, TargetType, Vec2} from 'wglt';\n\nconst LIGHTNING_DAMAGE = 10;\nconst LIGHTNING_RANGE = 5;\nconst MANA_COST = 10;\nconst TOOLTIP_MESSAGES = [\n  new Message('Lightning', Colors.WHITE),\n  new Message(MANA_COST + ' mana', Colors.WHITE),\n  new Message('Instant cast', Colors.WHITE),\n  new Message('Hurls a bolt of lightning at the nearest enemy', Colors.YELLOW),\n  new Message('dealing ' + LIGHTNING_DAMAGE + ' damage.', Colors.YELLOW),\n];\n\nexport class LightningAbility implements Ability {\n  readonly sprite: Sprite;\n  readonly name: string;\n  readonly targetType: TargetType;\n  readonly minRange: number;\n  readonly maxRange: number;\n  readonly cooldown: number;\n  readonly tooltipMessages: Message[];\n\n  constructor() {\n    this.sprite = new Sprite(158, 10, 16, 24, undefined, undefined, undefined, 0xFFFF00FF);\n    this.name = 'lightning';\n    this.targetType = TargetType.SELF;\n    this.minRange = 1;\n    this.maxRange = LIGHTNING_RANGE;\n    this.cooldown = 10;\n    this.tooltipMessages = TOOLTIP_MESSAGES;\n  }\n\n  cast(caster: Actor) {\n    const game = caster.game;\n    // Find closest enemy (inside a maximum range) and damage it\n    const monster = this.getClosestMonster(game, caster, caster.x, caster.y, LIGHTNING_RANGE);\n    if (!monster) {\n      game.log('No enemy is close enough to strike.', Colors.LIGHT_RED);\n      return false;\n    }\n\n    // Zap it!\n    game.log('A lightning bolt strikes the ' + monster.name + ' with a loud thunder!', Colors.LIGHT_BLUE);\n\n    // Create lightning animation\n    const explosion = new Sprite(256, 408, 16, 24, 2, true, 8, Colors.YELLOW);\n    const effect = new ProjectileEffect(explosion, new Vec2(monster.pixelX, monster.pixelY), new Vec2(0, 0), 32);\n    effect.onDone = () => {\n      game.log('The damage is ' + LIGHTNING_DAMAGE + ' hit points', Colors.LIGHT_BLUE);\n      monster.takeDamage(LIGHTNING_DAMAGE);\n      caster.ap--;\n    };\n    game.effects.push(effect);\n\n    return true;\n  }\n\n  private getClosestMonster(game: Game, player: Entity, x: number, y: number, range: number) {\n    let minDist = range + 1;\n    let result = null;\n    for (let i = 0; i < game.entities.length; i++) {\n      const entity = game.entities[i];\n      if (entity instanceof Actor && entity !== player) {\n        const dist = entity.distance(x, y);\n        if (dist < minDist) {\n          minDist = dist;\n          result = entity;\n        }\n      }\n    }\n    return result;\n  }\n}","import {Actor, AI, Colors} from 'wglt';\n\nexport class Stunned extends AI {\n  numTurns: number;\n  oldAi?: AI;\n\n  constructor(actor: Actor, turns: number) {\n    super(actor);\n    this.numTurns = turns;\n    this.oldAi = actor.ai;\n  }\n\n  doAi() {\n    if (this.numTurns > 0) {\n      // Stunned.  Sit still.\n      this.actor.addFloatingText('?', Colors.LIGHT_GRAY);\n      this.numTurns--;\n    } else {\n      this.actor.ai = this.oldAi;\n    }\n  }\n}\n","import {Colors, Effect, Game, ProjectileEffect, Sprite, Vec2} from 'wglt';\n\nexport class ExplosionEffect extends Effect {\n  readonly game: Game;\n  readonly center: Vec2;\n  readonly radius: number;\n  readonly duration: number;\n  readonly sprites: Sprite[];\n\n  constructor(game: Game, center: Vec2, radius: number, duration: number) {\n    super(duration, true);\n    this.game = game;\n    this.center = center;\n    this.radius = radius;\n    this.duration = duration;\n    this.sprites = [];\n  }\n\n  update() {\n    super.update();\n\n    const game = this.game;\n    const maxRadius = this.radius * (1.0 - (this.countdown + 1) / (this.duration + 1));\n    const centerX = (this.center.x) * game.tileSize.width;\n    const centerY = (this.center.y) * game.tileSize.height;\n\n    for (let i = 0; i < 3; i++) {\n      const radius = maxRadius;\n      const angle = this.countdown + i;\n      const x = centerX + game.tileSize.width * radius * Math.cos(angle);\n      const y = centerY + game.tileSize.height * radius * Math.sin(angle);\n      const explosion = new Sprite(512, 336, 16, 24, 4, false, 4, Colors.ORANGE);\n      const effect = new ProjectileEffect(explosion, new Vec2(x, y), new Vec2(0, 0), 16);\n      effect.blocking = false;\n      game.effects.push(effect);\n    }\n  }\n}\n","import {AI, Sprite} from 'wglt';\n\nimport {Game} from '../game';\n\nimport {Monster} from './monster';\n\nconst SPRITE = new Sprite(192, 144, 16, 24, 2, true, undefined, 0x6757d9FF);\nconst DAMAGE = 8;\n\nclass BatAI extends AI {\n  doAi() {\n    const monster = this.actor;\n    const player = monster.game.player;\n    if (!player) {\n      return;\n    }\n\n    const rng = player.game.rng;\n    if (monster.distanceTo(player) < 3 && rng.nextRange(0, 100) < 33) {\n      monster.attack(player, DAMAGE);\n    } else {\n      this.actor.move(rng.nextRange(-2, 3), rng.nextRange(-2, 3));\n    }\n  }\n}\n\nexport class Bat extends Monster {\n  constructor(game: Game, x: number, y: number) {\n    super(game, x, y, 'Bat', SPRITE);\n    this.ai = new BatAI(this);\n  }\n}","import {AI, Sprite, Talent} from 'wglt';\n\nimport {LeapAbility} from '../abilities/leap';\nimport {Game} from '../game';\n\nimport {Monster} from './monster';\nimport {Player} from './player';\n\nconst SPRITE = new Sprite(448, 144, 16, 24, 2, true, undefined, 0xf2f261ff);\nconst DAMAGE = 20;\n\nclass GriffonAI extends AI {\n  doAi() {\n    const griffon = this.actor as Griffon;\n    const game = griffon.game as Game;\n    const player = game.player as Player;\n    if (!player || player.hp <= 0) {\n      return;\n    }\n\n    // TODO: Move this ugly logic into Talent or Ability classes?\n    const talent = griffon.leapTalent;\n    if (talent.cooldown === 0) {\n      const target = this.findLeapTarget(game, griffon, player);\n      if (talent.ability.cast(griffon, target)) {\n        talent.cooldown = talent.ability.cooldown;\n        return;\n      }\n    }\n\n    const dist = griffon.distanceTo(player);\n    if (dist <= 2) {\n      griffon.attack(player, DAMAGE);\n    } else {\n      const rng = player.game.rng;\n      griffon.move(rng.nextRange(-1, 2), rng.nextRange(-1, 2));\n    }\n  }\n\n  private findLeapTarget(game: Game, griffon: Griffon, player: Player) {\n    for (let y = player.y - 1; y <= player.y + 1; y++) {\n      for (let x = player.x - 1; x <= player.x + 1; x++) {\n        if (game.getActorAt(x, y)) {\n          continue;\n        }\n        const tile = game.tileMap && game.tileMap.getCell(x, y);\n        if (!tile || tile.blocked) {\n          continue;\n        }\n        return tile;\n      }\n    }\n    return undefined;\n  }\n}\n\nexport class Griffon extends Monster {\n  readonly leapTalent: Talent;\n\n  constructor(game: Game, x: number, y: number) {\n    super(game, x, y, 'Griffon', SPRITE);\n    this.hp = 100;\n    this.maxHp = 100;\n    this.ai = new GriffonAI(this);\n    this.leapTalent = new Talent(this, new LeapAbility());\n  }\n}\n","import {Actor, BasicMonster, Sprite} from 'wglt';\n\nimport {Game} from '../game';\n\nimport {Player} from './player';\nimport {StatsActor} from './statsactor';\n\nexport abstract class Monster extends StatsActor {\n  constructor(game: Game, x: number, y: number, name: string, sprite: Sprite) {\n    super(game, x, y, name, sprite);\n    this.hp = 20;\n    this.ai = new BasicMonster(this, this.calculateDamage);\n  }\n\n  onDeath() {\n    this.game.log(this.name + ' is dead');\n    this.blocks = false;\n    this.ai = undefined;\n    this.name = 'remains of ' + this.name;\n    this.sendToBack();\n\n    // TODO: Calculate XP gain\n    const xpGain = 10;\n\n    // TODO: Add XP to the attacker, not the player\n    (this.game.player as Player).addXp(xpGain);\n  }\n\n  private calculateDamage(attacker: Actor, target: Actor) {\n    return 10;\n  }\n}\n","import {Actor, Sprite} from 'wglt';\n\nimport {Game} from '../game';\n\nimport {StatsActor} from './statsactor';\n\nconst PLAYER_SPRITE = new Sprite(0, 96, 16, 24, 2, true, undefined, 0xffcf5cff);\n\nexport class Player extends StatsActor {\n  xp: number;\n  maxXp: number;\n\n  constructor(game: Game, x: number, y: number) {\n    super(game, x, y, 'Player', PLAYER_SPRITE);\n    this.level = 1;\n    this.xp = 0;\n    this.maxXp = 100;\n  }\n\n  onDeath() {\n    this.game.log('You died!');\n  }\n\n  addXp(xpGain: number) {\n    this.xp += xpGain;\n\n    while (this.xp >= this.maxXp) {\n      this.level++;\n      this.xp = 0;\n      this.maxXp *= 2;\n      this.game.log('You reached level ' + this.level, 0xFF8000FF);\n    }\n  }\n}\n","import {AI, Sprite} from 'wglt';\n\nimport {Game} from '../game';\n\nimport {Monster} from './monster';\n\nconst SPRITE = new Sprite(0, 168, 16, 24, 2, true, undefined, 0x5790b7FF);\nconst DAMAGE = 30;\n\nclass SharkAI extends AI {\n  doAi() {\n    const monster = this.actor;\n    const player = monster.game.player;\n    if (!player) {\n      return;\n    }\n\n    if (monster.distanceTo(player) < 2) {\n      monster.attack(player, DAMAGE);\n    }\n  }\n}\n\nexport class Shark extends Monster {\n  constructor(game: Game, x: number, y: number) {\n    super(game, x, y, 'Shark', SPRITE);\n    this.ai = new SharkAI(this);\n  }\n}","import {Sprite} from 'wglt';\n\nimport {Game} from '../game';\n\nimport {Monster} from './monster';\n\nconst SPRITE = new Sprite(64, 144, 16, 24, 2, true, undefined, 0x20e64fFF);\n\nexport class Spider extends Monster {\n  constructor(game: Game, x: number, y: number) {\n    super(game, x, y, 'Spider', SPRITE);\n  }\n}","import {Actor, Sprite} from 'wglt';\nimport {Game} from '../game';\n\nexport class StatsActor extends Actor {\n  level: number;\n  mp: number;\n  maxMp: number;\n  strength: number;\n  dexterity: number;\n  constitution: number;\n  intelligence: number;\n  wisdom: number;\n  charisma: number;\n\n  constructor(game: Game, x: number, y: number, name: string, sprite: Sprite) {\n    super(game, x, y, name, sprite, true);\n    this.level = 1;\n    this.mp = 1;\n    this.maxMp = 1;\n    this.strength = 10;\n    this.dexterity = 10;\n    this.constitution = 10;\n    this.intelligence = 10;\n    this.wisdom = 10;\n    this.charisma = 10;\n  }\n\n  onAttack(target: Actor, damage: number) {\n    if (damage > 0) {\n      this.game.log(this.name + ' attacks ' + target.name + ' for ' + damage + ' hit points.', 0x808080FF);\n    } else {\n      this.game.log(this.name + ' attacks ' + target.name + ' but it has no effect!', 0x808080FF);\n    }\n  }\n}\n","import {Sprite} from 'wglt';\n\nimport {Game} from '../game';\n\nimport {Monster} from './monster';\n\nconst SPRITE = new Sprite(64, 216, 16, 24, 2, true, undefined, 0x20e64fFF);\n\nexport class Troll extends Monster {\n  constructor(game: Game, x: number, y: number) {\n    super(game, x, y, 'Troll', SPRITE);\n  }\n}","import * as wglt from 'wglt';\nimport {Actor, App, Button, Colors, Entity, FadeInEffect, FadeOutEffect, Item,\n  ItemContainerDialog, Message, MessageLog, Rect, Sprite, Talent, TalentsDialog} from 'wglt';\n\nimport {FireballAbility} from './abilities/fireball';\nimport {LeapAbility} from './abilities/leap';\nimport {LightningAbility} from './abilities/lightning';\nimport {Player} from './entities/player';\nimport {BottomPanel} from './gui/bottompanel';\nimport {TopPanel} from './gui/toppanel';\nimport {MapGenerator} from './mapgen';\n\nconst SPRITE_WIDTH = 16;\nconst SPRITE_HEIGHT = 24;\n\nconst TARGET_SPRITE = new Sprite(16, 40, SPRITE_WIDTH, SPRITE_HEIGHT);\n\nexport class Game extends wglt.Game {\n  private readonly mapGen: MapGenerator;\n\n  constructor(app: App) {\n    super(app, {tileSize: new Rect(0, 0, 16, 24), viewDistance: 7});\n\n    this.targetSprite = TARGET_SPRITE;\n    this.cooldownSprite = new Sprite(192, 16, 16, 24, 24);\n    this.blackoutRect = new Rect(0, 40, 16, 16);\n    this.gui.renderer.baseRect = new Rect(0, 64, 24, 24);\n\n    this.mapGen = new MapGenerator(this);\n\n    const player = new Player(this, 30, 20);\n    player.level = 1;\n    player.xp = 0;\n    player.maxXp = 10;\n    player.onBump = (other: Entity) => {\n      if (other instanceof Item) {\n        player.moveToward(other.x, other.y);\n        player.pickup(other);\n        return true;\n      }\n      if (other instanceof Actor) {\n        // TODO: Calculate damage\n        player.attack(other, 10);\n        return true;\n      }\n      if (other.name === 'stairs') {\n        this.nextLevel();\n        return true;\n      }\n      return false;\n    };\n\n    this.player = player;\n    this.entities.push(player);\n    this.gui.renderer.baseRect = new Rect(0, 16, 24, 24);\n    this.gui.renderer.buttonSlotRect = new Rect(64, 16, 20, 28);\n    this.messageLog = new MessageLog(new Rect(1, -84, 100, 50));\n    this.gui.add(this.messageLog);\n    this.log('Welcome stranger! Prepare to perish!', Colors.DARK_RED);\n\n    const topPanel = new TopPanel(player);\n    this.gui.add(topPanel);\n\n    const bottomPanel = new BottomPanel();\n    this.gui.add(bottomPanel);\n\n    const inventoryDialog = new ItemContainerDialog(\n        new Rect(10, 50, 94, 126),\n        [\n          new wglt.Message('Traveler\\'s Backpack', wglt.Colors.GREEN),\n          new wglt.Message('Click an item to use', wglt.Colors.LIGHT_GRAY),\n          new wglt.Message('Drag for shortcut', wglt.Colors.LIGHT_GRAY)\n        ],\n        16, player.inventory);\n    inventoryDialog.visible = false;\n    this.gui.add(inventoryDialog);\n\n    const inventoryButton = new Button(\n        new Rect(400 - 24, 224 - 24, 20, 28), new Sprite(834, 168, 16, 24, 1, true, 30, 0xe08020ff), undefined, () => {\n          inventoryDialog.visible = !inventoryDialog.visible;\n          talentsDialog.visible = false;\n        });\n    inventoryButton.tooltipMessages = [\n      new Message('Traveler\\'s Backpack', Colors.GREEN), new Message('Item Level 55', Colors.YELLOW),\n      new Message('16 Slot Bag', Colors.WHITE), new Message('Sell Price: 87 coins', Colors.WHITE)\n    ];\n    bottomPanel.inventorySlot.add(inventoryButton);\n\n    const talentsDialog = new TalentsDialog(\n        new Rect(10, 50, 94, 126),\n        [\n          new wglt.Message('Talents', wglt.Colors.GREEN),\n          new wglt.Message('Click an ability to use', wglt.Colors.LIGHT_GRAY),\n          new wglt.Message('Drag for shortcut', wglt.Colors.LIGHT_GRAY)\n        ],\n        16, player.talents);\n    talentsDialog.visible = false;\n    this.gui.add(talentsDialog);\n\n    const talentsButton = new Button(\n        new Rect(400 - 24, 224 - 24, 20, 28),\n        new Sprite(658, 360, 16, 24, undefined, undefined, undefined, Colors.LIGHT_BLUE), undefined, () => {\n          talentsDialog.visible = !talentsDialog.visible;\n          inventoryDialog.visible = false;\n        });\n    talentsButton.tooltipMessages = [\n      new Message('Talents', Colors.WHITE), new Message('A list of all of your', Colors.YELLOW),\n      new Message('character\\'s talents.', Colors.YELLOW)\n    ];\n    topPanel.talentsSlot.add(talentsButton);\n\n    player.inventory.addListener({\n      onAdd: (_, item) => {\n          bottomPanel.shortcutBar.addItem(player.inventory, item, true);\n      },\n      onRemove: () => { }\n    });\n\n    player.talents.addListener({\n      onAdd: (_, talent) => {\n          bottomPanel.shortcutBar.addTalent(talent);\n      },\n      onRemove: () => { }\n    });\n\n    player.talents.add(new Talent(player, new FireballAbility()));\n    player.talents.add(new Talent(player, new LightningAbility()));\n    player.talents.add(new Talent(player, new LeapAbility()));\n\n    // Generate the map\n    this.mapGen.createMap();\n  }\n\n  private nextLevel() {\n    const fadeOut = new FadeOutEffect(30);\n    const fadeIn = new FadeInEffect(30);\n\n    fadeOut.onDone = () => {\n      // Advance to the next level\n      this.log('You take a moment to rest, and recover your strength.', Colors.LIGHT_MAGENTA);\n      this.log('After a rare moment of peace, you descend deeper...', Colors.LIGHT_RED);\n\n      // Clear all entities other than the player\n      this.entities.splice(0, this.entities.length);\n      this.entities.push(this.player as Player);\n\n      // Reset the players targets\n      this.stopAutoWalk();\n      this.mapGen.createMap();\n    };\n\n    this.effects.push(fadeOut);\n    this.effects.push(fadeIn);\n  }\n}\n","import {ButtonSlot, Keys, Panel, Rect, ShortcutButtonSlot, ShortcutButtonBar} from 'wglt';\n\nexport class BottomPanel extends Panel {\n  constructor() {\n    super(new Rect(0, -43, 400, 43));\n\n    // // Create 6 slots for the action bar\n    // for (let i = 0; i < 6; i++) {\n    //   this.add(new ShortcutButtonSlot(new Rect(2 + i * 24, 0, 20, 28), Keys.VK_1 + i));\n    // }\n    this.add(new ShortcutButtonBar(new Rect(0, 0, 6 * 24, 28), 6));\n\n    // Create a slot for the inventory button\n    this.add(new ButtonSlot(new Rect(100, 0, 20, 28), Keys.VK_I));\n  }\n\n  get shortcutBar(): ShortcutButtonBar {\n    return this.children.get(0) as ShortcutButtonBar;\n  }\n\n  get inventorySlot(): ButtonSlot {\n    return this.children.get(this.children.length - 1) as ButtonSlot;\n  }\n\n  drawContents() {\n    if (!this.gui) {\n      return;\n    }\n\n    const app = this.gui.app;\n    const y = app.size.height - 43;\n    app.drawImage(0, y, 48, 16, 16, 48, undefined, app.size.width, 48);\n\n    // Update button y-positions\n    // This will normally be a no-op\n    for (let i = 0; i < this.children.length; i++) {\n      this.children.get(i).rect.y = app.size.height - 31;\n    }\n\n    // Update inventory button to be right-aligned\n    this.inventorySlot.rect.x = app.size.width - 22;\n\n    this.drawChildren();\n  }\n}\n","import {ButtonSlot, Colors, Keys, Panel, Rect} from 'wglt';\n\nimport {Player} from '../entities/player';\n\nexport class TopPanel extends Panel {\n  readonly player: Player;\n\n  constructor(player: Player) {\n    super(new Rect(0, 0, 400, 42));\n    this.player = player;\n\n    // Character / inventory\n    this.add(new ButtonSlot(new Rect(0, 3, 20, 28), Keys.VK_C));\n\n    // Talents / abilities\n    this.add(new ButtonSlot(new Rect(0, 3, 20, 28), Keys.VK_N));\n\n    // Inspect\n    this.add(new ButtonSlot(new Rect(0, 3, 20, 28), Keys.VK_QUESTION_MARK));\n\n    // Main menu\n    this.add(new ButtonSlot(new Rect(0, 3, 20, 28), Keys.VK_Q));\n  }\n\n  get characterSlot(): ButtonSlot {\n    return this.children.get(0) as ButtonSlot;\n  }\n\n  get talentsSlot(): ButtonSlot {\n    return this.children.get(1) as ButtonSlot;\n  }\n\n  get inspectSlot(): ButtonSlot {\n    return this.children.get(2) as ButtonSlot;\n  }\n\n  get menuSlot(): ButtonSlot {\n    return this.children.get(3) as ButtonSlot;\n  }\n\n  drawContents() {\n    if (!this.gui) {\n      return;\n    }\n\n    const app = this.gui.app;\n\n    app.drawImage(0, 0, 32, 22, 16, 42, undefined, app.size.width, 42);\n    app.drawString('Oryx the Brave'.toUpperCase(), 1, 1, Colors.WHITE);\n\n    // Health\n    app.drawImage(2, 12, 128, 16, 12, 12);\n    app.drawString(this.player.hp.toString(), 16, 15);\n\n    // Mana\n    app.drawImage(38, 12, 144, 16, 12, 12);\n    app.drawString('88', 52, 15);\n\n    // Energy\n    app.drawImage(74, 12, 160, 16, 12, 12);\n    app.drawString('88', 88, 15);\n\n    // Update button x-positions to right align\n    // This will normally be a no-op\n    for (let i = 0; i < this.children.length; i++) {\n      this.children.get(i).rect.x = app.size.width - 24 * (4 - i);\n    }\n\n    this.drawChildren();\n  }\n}\n","import {App, AppState, Rect, SelectDialog} from 'wglt';\nimport {SelectOption} from 'wglt/dist/gui/selectoption';\n\nimport {Game} from './game';\n\nconst app = new App({\n  canvas: document.querySelector('canvas') as HTMLCanvasElement,\n  imageUrl: 'graphics.png',\n  size: new Rect(0, 0, 224, 400),\n  fillWindow: true\n});\n\nconst game = new Game(app);\n\nconst mainMenu = new AppState(app);\nmainMenu.gui.renderer.baseRect = new Rect(0, 16, 24, 24);\nmainMenu.gui.add(\n    new SelectDialog(new Rect(16, 64, 160, 100), [{name: 'NEW GAME'}, {name: 'CONTINUE'}], (choice: SelectOption) => {\n      if (choice.name === 'NEW GAME') {\n        window.location.hash = 'game';\n      }\n    }));\n\nconst highScores = new AppState(app);\n\nconst credits = new AppState(app);\n\napp.state = mainMenu;\n\n// Clear the window hash on load\n// Always start at the root\nif (window.location.hash && window.location.hash !== '#') {\n  window.location.hash = '';\n}\n\n// Subscribe to future window hash change events\nwindow.addEventListener('hashchange', handleHashChange);\n\nfunction handleHashChange() {\n  const hash = window.location.hash;\n  if (hash === '#game') {\n    app.state = game;\n  } else if (hash === '#highscores') {\n    app.state = highScores;\n  } else if (hash === '#credits') {\n    app.state = credits;\n  } else {\n    app.state = mainMenu;\n  }\n}\n","import {Actor, Colors, Game, Item, Sprite} from 'wglt';\n\nconst HEAL_AMOUNT = 4;\n\nconst SPRITE = new Sprite(658, 168, 16, 24, 1, true, undefined, 0xFF0000FF);\n\nexport class HealthPotion extends Item {\n  constructor(game: Game, x: number, y: number) {\n    super(game, x, y, 'health potion', SPRITE, false);\n  }\n\n  onPickup(entity: Actor) {\n    this.game.log(entity.name + ' picked up a ' + this.name, Colors.LIGHT_GREEN);\n  }\n\n  onUse(user: Actor) {\n    if (user.hp === user.maxHp) {\n      this.game.log('You are already at full health.', Colors.DARK_RED);\n      return false;\n    }\n\n    this.game.log('Your wounds start to feel better!', Colors.LIGHT_MAGENTA);\n    user.takeHeal(HEAL_AMOUNT);\n    user.inventory.remove(this);\n    user.ap--;\n    return true;\n  }\n}\n","import {Ability, Actor, Colors, Game, Item, Sprite, TargetType} from 'wglt';\n\nconst SPRITE = new Sprite(738, 168, 16, 24, 1, true, undefined, 0xF0F0E0FF);\n\nexport class Scroll extends Item {\n  readonly ability: Ability;\n\n  constructor(game: Game, x: number, y: number, ability: Ability) {\n    super(game, x, y, 'scroll of ' + ability.name, SPRITE, false);\n    this.ability = ability;\n  }\n\n  onPickup(entity: Actor) {\n    this.game.log(entity.name + ' picked up a ' + this.name, Colors.LIGHT_GREEN);\n  }\n\n  onUse(user: Actor) {\n    const ability = this.ability;\n    if (ability.targetType === TargetType.SELF) {\n      if (ability.cast(user)) {\n        user.inventory.remove(this);\n      }\n    } else {\n      this.game.startTargeting(ability, () => {\n        user.inventory.remove(this);\n      });\n    }\n    return true;\n  }\n}","import {Entity, Rect, Sprite, TileMap, Vec2} from 'wglt';\n\nimport {ConfuseAbility} from './abilities/confuse';\nimport {FireballAbility} from './abilities/fireball';\nimport {LightningAbility} from './abilities/lightning';\nimport {Bat} from './entities/bat';\nimport {Griffon} from './entities/griffon';\nimport {Player} from './entities/player';\nimport {Shark} from './entities/shark';\nimport {Spider} from './entities/spider';\nimport {Troll} from './entities/troll';\nimport {HealthPotion} from './items/healthpotion';\nimport {Scroll} from './items/scroll';\nimport { Game } from './game';\n\n// Size of the map\nconst MAP_WIDTH = 64;\nconst MAP_HEIGHT = 32;\n\nconst TILE_EMPTY = 0;\nconst TILE_SHADOW = getTileId(0, 3);\nconst TILE_WALL = getTileId(0, 19);\nconst TILE_HALF_WALL = getTileId(0, 20);\nconst TILE_FLOOR = getTileId(13, 17);\nconst TILE_WATER = getTileId(0, 18);\nconst TILE_BRIDGE = getTileId(15, 27);\nconst TILE_COBWEB_NORTHWEST = getTileId(28, 22);\nconst TILE_COBWEB_NORTHEAST = getTileId(29, 22);\nconst TILE_COBWEB_SOUTHWEST = getTileId(30, 22);\nconst TILE_COBWEB_SOUTHEAST = getTileId(31, 22);\n\nfunction getTileId(tileX: number, tileY: number) {\n  return 1 + tileY * 64 + tileX;\n}\n\n// Parameters for dungeon generator\nconst ROOM_MIN_WIDTH = 6;\nconst ROOM_MAX_WIDTH = 10;\nconst ROOM_MIN_HEIGHT = 4;\nconst ROOM_MAX_HEIGHT = 8;\nconst MAX_ROOMS = 10;\nconst MAX_ROOM_MONSTERS = 3;\nconst MAX_ROOM_ITEMS = 2;\n\nconst SPRITE_WIDTH = 16;\nconst SPRITE_HEIGHT = 24;\n\nconst STAIRS_SPRITE = new Sprite(224, 432, SPRITE_WIDTH, SPRITE_HEIGHT, 1);\n\n// const SECTOR_DEFINITIONS = [\n//   {\n//       // 0: Sector 1\n//       roomCount: 10,\n//       roomMinWidth: 5,\n//       roomMaxWidth: 12,\n//       roomMinHeight: 5,\n//       roomMaxHeight: 8,\n//       minEntities: 1,\n//       maxEntities: 1,\n//       // floorTiles: [\n//       //     [TILE_STEEL_FLOOR_1, 0.7],\n//       //     [TILE_GRAY_CHECKER_FLOOR_1, 0.1],\n//       //     [TILE_GRAY_CHECKER_FLOOR_2, 0.1],\n//       //     [TILE_GRAY_CHECKER_FLOOR_3, 0.1],\n//       // ],\n//       // wallTiles: [\n//       //     [TILE_GRAY_WALL_1, 0.6],\n//       //     [TILE_GRAY_WALL_2, 0.1],\n//       //     [TILE_GRAY_WALL_3, 0.1],\n//       //     [TILE_GRAY_WALL_4, 0.1],\n//       //     [TILE_GRAY_WALL_6, 0.1],\n//       // ],\n//       entitityTypes: [\n//           [Spider, 1.0]\n//       ]\n//   },\n// ];\n\nexport class MapGenerator {\n  readonly game: Game;\n\n  constructor(game: Game) {\n    this.game = game;\n\n    const map = new TileMap(game.app.gl, MAP_WIDTH, MAP_HEIGHT, 3);\n    map.tileWidth = 16;\n    map.tileHeight = 24;\n    game.tileMap = map;\n  }\n\n  createMap() {\n    const game = this.game;\n    const map = game.tileMap as TileMap;\n    const player = game.player as Player;\n    const rng = game.rng;\n\n    // Clear the map to all walls\n    for (let y = 0; y < MAP_HEIGHT; y++) {\n      for (let x = 0; x < MAP_WIDTH; x++) {\n        map.setTile(0, x, y, TILE_WALL, true);\n        map.setTile(1, x, y, TILE_EMPTY);\n        map.setTile(2, x, y, TILE_EMPTY);\n      }\n    }\n\n    // Create bodies of water\n    const water = new Vec2(MAP_WIDTH / 2, MAP_HEIGHT / 2);\n    for (let i = 0; i < 100; i++) {\n      map.setTile(0, water.x, water.y, TILE_WATER, true, false);\n      map.setTile(0, water.x - 1, water.y, TILE_WATER, true, false);\n      map.setTile(0, water.x + 1, water.y, TILE_WATER, true, false);\n      map.setTile(0, water.x, water.y - 1, TILE_WATER, true, false);\n      map.setTile(0, water.x, water.y + 1, TILE_WATER, true, false);\n      water.x += rng.nextRange(-1, 2);\n      water.y += rng.nextRange(-1, 2);\n    }\n\n    // Make sure there's a ring of wall all around\n    for (let x = 0; x < MAP_WIDTH; x++) {\n      map.setTile(0, x, 0, TILE_EMPTY, true);\n      map.setTile(0, x, MAP_HEIGHT - 1, TILE_EMPTY, true);\n    }\n    for (let y = 0; y < MAP_HEIGHT; y++) {\n      map.setTile(0, 0, y, TILE_EMPTY, true);\n      map.setTile(0, MAP_WIDTH - 1, y, TILE_EMPTY, true);\n    }\n\n    // Reset field-of-view\n    map.resetFov();\n\n    const rooms = [];\n\n    while (rooms.length < MAX_ROOMS) {\n      // Random width and height\n      const w = rng.nextRange(ROOM_MIN_WIDTH, ROOM_MAX_WIDTH);\n      const h = rng.nextRange(ROOM_MIN_HEIGHT, ROOM_MAX_HEIGHT);\n\n      // Random position without going out of the boundaries of the map\n      const x = rng.nextRange(2, MAP_WIDTH - w - 3);\n      const y = rng.nextRange(2, MAP_HEIGHT - h - 3);\n\n      // \"Rect\" class makes rectangles easier to work with\n      const newRoom = new Rect(x, y, w, h);\n\n      // Run through the other rooms and see if they intersect with this one\n      let failed = false;\n      for (let j = 0; j < rooms.length; j++) {\n        if (newRoom.intersects(rooms[j])) {\n          failed = true;\n          break;\n        }\n      }\n\n      if (failed) {\n        continue;\n      }\n\n      // This means there are no intersections, so this room is valid\n\n      // \"paint\" it to the map's tiles\n      this.createRoom(map, newRoom);\n\n      // Center coordinates of new room, will be useful later\n      const center = newRoom.getCenter();\n\n      if (rooms.length === 0) {\n        // This is the first room, where the player starts at\n        player.x = center.x;\n        player.y = center.y;\n\n      } else {\n        // All rooms after the first:\n        // Connect it to the previous room with a tunnel\n\n        // Center coordinates of previous room\n        const prev = rooms[rooms.length - 1].getCenter();\n\n        // Draw a coin (random number that is either 0 or 1)\n        if (rng.nextRange(0, 1) === 1) {\n          // First move horizontally, then vertically\n          this.createHTunnel(map, prev.x, center.x, prev.y);\n          this.createVTunnel(map, prev.y, center.y, center.x);\n        } else {\n          // First move vertically, then horizontally\n          this.createVTunnel(map, prev.y, center.y, prev.x);\n          this.createHTunnel(map, prev.x, center.x, center.y);\n        }\n\n        if (rooms.length === MAX_ROOMS - 2) {\n          // Next to last\n          // Add a Griffon to the next to last room\n          const griffonLoc = newRoom.getCenter();\n          const griffon = new Griffon(game, griffonLoc.x, griffonLoc.y);\n          game.entities.push(griffon);\n\n        } else if (rooms.length === MAX_ROOMS - 1) {\n          // Last room\n          // Create stairs at the center of the last room\n          const stairsLoc = newRoom.getCenter();\n          const stairs = new Entity(game, stairsLoc.x, stairsLoc.y, 'stairs', STAIRS_SPRITE, true);\n          game.entities.push(stairs);\n        } else {\n          // Add monsters (spiders, bats, etc)\n          this.placeMonsters(newRoom);\n        }\n      }\n\n      // Add items (scrolls and health potions)\n      this.placeItems(newRoom);\n\n      // Finally, append the new room to the list\n      rooms.push(newRoom);\n    }\n\n    // Touch up walls / half walls\n    for (let y = 0; y < MAP_HEIGHT; y++) {\n      for (let x = 0; x < MAP_WIDTH; x++) {\n        const t1 = map.getTile(x, y);\n        const t2 = map.getTile(x, y + 1);\n        const t3 = map.getTile(x - 1, y);\n        const t4 = map.getTile(x + 1, y);\n        const t5 = map.getTile(x, y - 1);\n\n        if (t1 === TILE_FLOOR && t3 === TILE_WALL && t5 === TILE_HALF_WALL && rng.nextRange(0, 4) === 0) {\n          map.setTile(1, x, y, TILE_COBWEB_NORTHWEST);\n        }\n\n        if (t1 === TILE_FLOOR && t4 === TILE_WALL && t5 === TILE_HALF_WALL && rng.nextRange(0, 4) === 0) {\n          map.setTile(1, x, y, TILE_COBWEB_NORTHEAST);\n        }\n\n        if (t1 === TILE_FLOOR && t3 === TILE_WALL && t2 === TILE_WALL && rng.nextRange(0, 4) === 0) {\n          map.setTile(1, x, y, TILE_COBWEB_SOUTHWEST);\n        }\n\n        if (t1 === TILE_FLOOR && t4 === TILE_WALL && t2 === TILE_WALL && rng.nextRange(0, 4) === 0) {\n          map.setTile(1, x, y, TILE_COBWEB_SOUTHEAST);\n        }\n\n        if (t1 === TILE_WALL && t2 !== TILE_WALL) {\n          map.setTile(0, x, y, TILE_HALF_WALL, true);\n          map.setTile(2, x, y + 1, TILE_SHADOW);\n        }\n\n        if (t1 !== TILE_WATER && t2 === TILE_WATER) {\n          map.setTile(2, x, y + 1, TILE_SHADOW);\n        }\n\n        const nearBridge = t2 === TILE_BRIDGE || t3 === TILE_BRIDGE || t4 === TILE_BRIDGE || t5 === TILE_BRIDGE;\n        if (t1 === TILE_WATER && nearBridge && rng.nextRange(0, 20) === 1) {\n          game.entities.push(new Shark(game, x, y));\n        }\n      }\n    }\n\n    // Initial FOV\n    game.resetViewport();\n    game.recomputeFov();\n  }\n\n  private createRoom(map: TileMap, room: Rect) {\n    for (let y = room.y1 + 1; y < room.y2; y++) {\n      for (let x = room.x1 + 1; x < room.x2; x++) {\n        map.setTile(0, x, y, TILE_FLOOR, false);\n      }\n    }\n  }\n\n  private createHTunnel(map: TileMap, x1: number, x2: number, y: number) {\n    for (let x = Math.min(x1, x2); x <= Math.max(x1, x2); x++) {\n      if (map.getTile(x, y) === TILE_WATER) {\n        map.setTile(0, x, y, TILE_BRIDGE, false);\n      } else {\n        map.setTile(0, x, y, TILE_FLOOR, false);\n      }\n    }\n  }\n\n  private createVTunnel(map: TileMap, y1: number, y2: number, x: number) {\n    for (let y = Math.min(y1, y2); y <= Math.max(y1, y2); y++) {\n      const existing = map.getTile(x, y);\n      if (existing === TILE_WATER) {\n        map.setTile(0, x, y, TILE_BRIDGE, false);\n      } else {\n        map.setTile(0, x, y, TILE_FLOOR, false);\n      }\n    }\n  }\n\n  private placeMonsters(room: Rect) {\n    const game = this.game;\n    const rng = game.rng;\n\n    // Choose random number of monsters\n    const numMonsters = rng.nextRange(0, MAX_ROOM_MONSTERS);\n\n    for (let i = 0; i < numMonsters; i++) {\n      // Choose random spot for this monster\n      const x = rng.nextRange(room.x1 + 1, room.x2 - 1);\n      const y = rng.nextRange(room.y1 + 1, room.y2 - 1);\n\n      if (game.getEntityAt(x, y)) {\n        // Something already at this location\n        continue;\n      }\n\n      const roll = rng.nextRange(0, 100);\n      let monster = null;\n\n      if (roll < 40) {\n        monster = new Spider(game, x, y);\n      } else if (roll < 80) {\n        monster = new Bat(game, x, y);\n      } else {\n        monster = new Troll(game, x, y);\n      }\n\n      game.entities.push(monster);\n    }\n  }\n\n  private placeItems(room: Rect) {\n    const game = this.game;\n    const rng = game.rng;\n\n    // Choose random number of items\n    const numItems = rng.nextRange(0, MAX_ROOM_ITEMS);\n\n    for (let i = 0; i < numItems; i++) {\n      // Choose random spot for this item\n      const x = rng.nextRange(room.x1 + 1, room.x2 - 1);\n      const y = rng.nextRange(room.y1 + 1, room.y2 - 1);\n\n      if (game.getEntityAt(x, y)) {\n        // Something already at this location\n        continue;\n      }\n\n      const dice = rng.nextRange(0, 100);\n      let item = null;\n\n      if (dice < 50) {\n        // Create a healing potion (50% chance)\n        item = new HealthPotion(game, x, y);\n\n      } else if (dice < 50 + 20) {\n        // Create a lightning bolt scroll (20% chance)\n        item = new Scroll(game, x, y, new LightningAbility());\n\n      } else if (dice < 50 + 20 + 15) {\n        // Create a fireball scroll (15% chance)\n        item = new Scroll(game, x, y, new FireballAbility());\n\n      } else {\n        // Create a confuse scroll (15% chance)\n        item = new Scroll(game, x, y, new ConfuseAbility());\n      }\n\n      game.entities.push(item);\n    }\n  }\n}\n"],"sourceRoot":""}